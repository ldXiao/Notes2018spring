% !TeX spellcheck = en_GB
\documentclass[11pt]{article}
\usepackage{amssymb}
\usepackage{latexsym}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{stmaryrd}
\usepackage{fancyhdr}
\pagestyle{headings}
\usepackage{dsfont}
\usepackage{pifont}
\usepackage{mathtools}
\usepackage{natbib}
\usepackage{tikz-cd}
\usepackage{pgfplots}
\usepackage{enumitem} 
\usepackage{hyperref}
\usepackage{geometry}
\DeclareMathAlphabet{\mathpzc}{OT1}{pzc}{m}{it}

\geometry{left=4cm,right=4cm}
\pgfplotsset{every axis/.append style={
		axis x line=middle,    % put the x axis in the middle
		axis y line=middle,    % put the y axis in the middle
		axis line style={<->}, % arrows on the axis
		xlabel={$x$},          % default put x on x-axis
		ylabel={$y$},          % default put y on y-axis
		ticks=none,
}}
%\usepackage[urw-garamond]{mathdesign}
%\usepackage{cmbright}
%\usepackage{concmath}
%\usepackage{sansmathfonts}
%\renewcommand*\familydefault{\sfdefault} %% Only if the base font of the document is to be sans serif

%\usepackage{pdfrender,xcolor,scrpage2}
%\pdfrender{StrokeColor=black,TextRenderingMode=2,LineWidth=1pt}
\tikzset{
	subseteq/.style={
		draw=none,
		edge node={node [sloped, allow upside down, auto=false]{$\subseteq$}}},
	Subseteq/.style={
		draw=none,
		every to/.append style={
			edge node={node [sloped, allow upside down, auto=false]{$\subseteq$}}}
	},
	Subsetneq/.style={
		draw=none,
		every to/.append style={
			edge node={node [sloped, allow upside down, auto=false]{$\subsetneq$}}}
	},
	Supseteq/.style={
		draw=none,
		every to/.append style={
			edge node={node [sloped, allow upside down, auto=false]{$\supseteq$}}}
	},
	Subset/.style={
		draw=none,
		every to/.append style={
			edge node={node [sloped, allow upside down, auto=false]{$\subset$}}}
	}
}

\hypersetup{
	colorlinks,
	citecolor=blue,
	filecolor=blue,
	linkcolor=blue,
	urlcolor=blue
}
\newtheorem{thm}{Theorem}[section]
\newtheorem{prop}[thm]{Proposition}
\newtheorem{lemma}[thm]{Lemma}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{dfn}[thm]{Definition}
\newtheorem{axiom}[thm]{Axiom}
\newtheorem{rmk}[thm]{Remark}
\newtheorem{rmkt}[thm]{Remark by TeXer}
\newtheorem{ex}[thm]{Example}
\newtheorem{nex}[thm]{Non-example}
\newtheorem{exercise}[thm]{Exercise}
\newtheorem{question}[thm]{Question}
\newtheorem{problem}[thm]{Problem}
\newtheorem{dfn/thm}[thm]{Definition/Theorem}
\renewcommand{\baselinestretch}{1.1}
\renewcommand{\hom}{\text{ Hom}}
\newcommand{\phom}{\mathpzc{Hom\,}}
\newcommand{\spec}{\text{ Spec}\,}
\newcommand{\Proj}{\mathsf{ Proj}}
\newcommand{\res}{\text{ res}}
\newcommand{\affn}{\mathbb A}
\newcommand{\proj}{\mathbb P}
\newcommand{\reals}{\mathbb R}
\newcommand{\cplx}{\mathbb C}
\newcommand{\intg}{\mathbb Z}
\newcommand{\bbf}{\mathbb F}
\newcommand{\ratl}{\mathbb Q}
\newcommand{\torus}{\mathbb T}
\newcommand{\sca}{{\mathfrak a}}
\newcommand{\scb}{{\mathfrak b}}
\newcommand{\scc}{{\mathfrak c}}
\newcommand{\scm}{{\mathfrak m}}
\newcommand{\scn}{{\mathfrak n}}
\newcommand{\scp}{{\mathfrak p}}
\newcommand{\scq}{\mathfrak q}
\newcommand{\frakg}{{\mathfrak g}}
\newcommand{\frakd}{{\mathfrak d}}
\newcommand{\calf}{{\cal F}}
\newcommand{\calg}{{\cal G}}
\newcommand{\cala}{{\cal A}}
\newcommand{\calb}{{\cal B}}
\newcommand{\calc}{{\cal C}}
\newcommand{\cale}{{\cal E}}
\newcommand{\cali}{{\cal I}}
\newcommand{\call}{{\cal L}}
\newcommand{\caln}{{\cal N}}
\newcommand{\calo}{{\cal O}}
\newcommand{\calr}{{\cal R}}
\newcommand{\mathbold}{\bf}
\newcommand{\cinf}{C^{\infty}}
\newcommand{\row}[2]{#1_1,\dots ,#1_{#2}}
\newcommand{\dbyd}[2]{{\partial #1\over\partial #2}}
\newcommand{\Space}{{\bf Space}}
\newcommand{\alg}{{\mathbold Alg}}
\newcommand{\notsubset}{\not \subset}
\newcommand{\notsupset}{\not \supset}
\newcommand{\pois}{{\mathbold Pois}}
\newcommand{\pd}{\partial}
\newcommand{\pitilde}{\tilde{\pi}}
\newcommand{\drta}{\dashrightarrow}
\newcommand{\rta}{\rightarrow}
\newcommand{\Lrta}{\Longrightarrow}
\newcommand{\lrta}{\longrightarrow}
\newcommand{\llrta}{\longleftrightarrow}
\newcommand{\Llta}{\Longleftarrow}
\newcommand{\Llrta}{\Longleftrightarrow}
\newcommand{\lgl}{\langle}
\newcommand{\rgl}{\rangle}
\newcommand{\inj}{\hookrightarrow}
\newcommand{\surj}{\twoheadrightarrow}
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%
\newcommand{\downmapsto}{\rotatebox[origin=c]{-90}{$\scriptstyle\mapsto$}\mkern2mu}
\renewcommand{\qedsymbol}{$\square$}
\bibliographystyle{plain}
\title{\bf Lecture Notes for Algebraic Geometry I}
\author{Lecture delivered by Emmanuel Kowalski\\
Notes by Lin-Da Xiao and David Burgschweiger}
\date{2018 ETH} 
%\thanks{Research partially supported by NSF Grant DMS-96-25122 and the Miller Institute for Basic Research in Science.}
\begin{document}
\maketitle
\tableofcontents
\section*{About the notes}
In this notes we mainly focus on the algebraically closed fields.
\newpage
\section{Classical varieties}
\subsection{Feb 27th: Algebraic sets and morphisms}
\href{https://imaginary.org/programs}{https://imaginary.org/programs}

Recall: $V(I)\subset \affn^n =\{x|\forall f\in I, f(x)=0\}$.
\begin{dfn}
Closed subspaces of $\affn^n$ are called \textbf{affine algebraic sets} and irreducible algebraic sets are called \textbf{affine algebraic varieties}
\end{dfn}
\begin{dfn}
Given $Y$ an affine algebraic set in $\affn^n$, we define the \textbf{coordinate ring} $\calo(Y)$ as $K[X_1,...,X_n]/I(Y)$
\end{dfn}
\begin{dfn}
Let $X\subset \affn^m$ and $Y \subset \affn^n$ be affine algebraic sets. A \textbf{morphism} $X \lrta Y$ of affine algebraic sets is a map $f : X \lrta Y$ of the underlying sets such that there exist polynomials $f_1,...,f_n \in k[T_1,...,T_m]$ with $f(x) = (f_1(x),...,f_n(x))$ for all $x\in X$. 
\end{dfn}
We denote the category of affine algebraic sets over $K$ as $Alg_K$
\begin{thm}\label{thm:equivalence_of_categories_algebraic_sets_K_algebras}
Let $Y_1\subset \affn^n, X_1,...,X_n$, $Y_2\subset \affn^m, T_1,,..., T_m$ affine algebraic sets. There are bijections 

$$
\begin{aligned}
&\hom_{K\text{-alg}}(\calo(Y_2),\calo(Y_1))
\\
&\overset{(*)}{\llrta}\{(f_1,...,f_m)\in K[X]^m|\forall x\in Y_1,(f_1(x),...,f_m(x))\in Y_2) \}\\
&\overset{(**)}{\llrta} \{f:Y_1\lrta Y_2|\forall \varphi\in \calo(Y_2),\varphi\circ f\text{ is  in }  \calo(Y_1)\}\\
&=\hom_{Alg_K}(Y_1,Y_2)
\end{aligned}
$$
\end{thm}
\begin{proof}
\underline{Key observation}

To give $(f_1,...,f_m)\in K[X]^m$ is ``the same '' as giving a ring morphism $g_0:K[T]\lrta K[X]: T_i\mapsto f_i$, which gives by composition $g_1=\pi_1\circ g_0$, where $\pi_1: K[X]\lrta \calo(Y_1)$ is the canonical projection.
$$
g_1: K[T]\lrta \calo(Y_1)
$$
which has a factorization
\[
\begin{tikzcd}
K[T] \arrow[r,"g_1"] \arrow[d,"\pi_2"]  & \calo(Y_1)  \\
   \calo(Y_2) \arrow[ur,"g"] & 
\end{tikzcd}
\]
iff $g_1(I(Y_2))=0$, which means iff 
$$
g_1(\varphi)=\text{ ``replace $T_i$ by $f_i$ in $\varphi$''}
$$
belongs to $I(Y_1)$ if $\varphi\in I(Y_2)$, which means if $x\in Y_1$, then $g_1(\varphi)(x)=0$. That means $\varphi(f_1(x),...,f_m(x))=0$ for $\varphi\in I(Y_2),$ i.e., $(f_1(x),...,f_m(x))\in Y_2$. If $x\in Y_1$. In the statement, this gives the $(*)$ bijection. Any $k$-algebra morphism $\calo(Y_1)\lrta\calo(Y_2)$  comes from $K[T]\lrta \calo(Y_1)$ s.t. it vanishes on $I(Y_2)$.


For the bijection $(**)$, suppose 
$$
g:Y_1\overset{g}{\lrta} Y_2\overset{\varphi}{\lrta} K
$$
sends $\varphi(Y_2)$ to $\varphi\circ g\in\calo(Y_1)$. Then we get 
$$
\begin{aligned}
& \calo(Y_2)\lrta \calo(Y_1)\\
&\varphi\longmapsto \varphi\circ g,
\end{aligned}
$$
which is a $K$-algebra morphism.

As for the reverse direction, given $g$. From $\calo(Y_2)\lrta \calo(Y_1)$ to get a $g:Y_1\lrta Y_2$. We get a $\tilde{g}:Y_1\lrta Y_2$ in the second set
$$
\tilde{g}(x)=(f_1(x),...,f_m(x))
$$
then we have $\varphi\circ g\in\calo(Y_1)$ for $\varphi\in \calo(Y_2)$. One checks that this shows that the first and third sets are the same.
\end{proof}

Define morphism $Y_1\lrta Y_2$ by the second(and third) set.  Composition in the obvious way and identity is a morphism.
$\Lrta$ get a category $(Alg_K)$ of affine algebraic sets over $K$.

\begin{cor}
$Y\mapsto \calo(Y)$, $g\mapsto [\varphi\mapsto \varphi\circ g]$ is a functor: $(Alg_K)\lrta (K\text{-Alg})^{opp}$.
\end{cor}

\underline{Facts}: The ``image'' of this functor is the category of finitely generated $K$-algebras which are reduced.
\begin{proof}
$A$ finitely generated reduced $K$-algebra. ($\exists n\geq 1$, so that $K[X_1,...,X_n]/I\cong A$). Then ``$A$ is reduced''$\Llrta$ $I$ is radical ideal.
$\Lrta A=\calo(V(I))$, where $V(I)\subset \affn^n$.
\end{proof}

\begin{cor}
There is a equivalence of categories between 
$$
(\text{Algebraic sets over $K$})\llrta (\text{finitely generated reduced } K\text{-Algebras}.)
$$
\end{cor}

\begin{ex}\ 
\begin{enumerate}[label=(\arabic*)]
\item $\affn^1\lrta V(Y^2-X^3-X^2)\subset \affn^2$, $t\mapsto (t^2-1,t(t^2-1))$
\item $\affn^1\lrta V(Y^2-X^3)\subset \affn^2$: $t\longmapsto (t^2,t^3)$ is a bijection but \underline{Not} an isomorphism.
\item Assume $K$ with characteristic $p>0$, $K\supset \mathbb{F}_p$. $Y=V(f_1,...,f_m)$ where $f_i\in \mathbb{F}_p[X]\subset K[X]$. Consider the morphism:
$$
\begin{aligned}
&Y\lrta Y\\
& (x_1,..,x_n)\longmapsto (x_1^p,...,x_n^p).
\end{aligned}
$$
It is bijective and homeomorphism but not an isomorphism if $dim(Y)\geq 1$.
\end{enumerate}
\end{ex}
\begin{prop}
$Y=V(I)\subset \affn^n$
\begin{enumerate}[label=(\arabic*)]
\item The points of $Y$ are in bijection with maximal ideals $I\subset \calo(Y)$ by 
$$
Y\ni x\longmapsto \{f\in \calo(Y)|f(x)=0\}
$$
\item We have a bijection 
$$
\calo(Y)\llrta \hom_{Alg_K}(Y,\affn^1)
$$
\end{enumerate}
\end{prop}
\begin{proof}
(1) $I_x:=Ker(\calo(Y)\lrta K)$, $f\mapsto f(x)$, since the evaluation map is surjective $[1\mapsto 1]$, we get an isomorphism 
$$
\calo(Y)/I_x\overset{\sim}{\lrta} K,
$$
so $I_x$ is maximal in $\calo(Y)$.

Conversely, if $I\subset \calo(Y)$ is maximal, we get $I=I'/I(Y)$ for $I'\subset K[X]$ maximal. 

Nullstellensatz says $\exists (x_1,...,x_n)\in\affn^n$ s.t., $I'=(X_1-x_1,...,X_n-x_n)$. 

Since $I'\supset I(Y)$, we get $(x_1,..,x_n)\in Y$. Then we check that $\calo(Y)\lrta\calo(Y)/I\cong K$ is just given by $f\mapsto f(x_1,...,x_n)$. That means $I=I_x$.

(2) We saw in~\ref{thm:equivalence_of_categories_algebraic_sets_K_algebras}, that there is a bijection between sets
$$
\hom_{Alg_k}(Y,\affn^1)\llrta \hom_{K-alg}(\calo(\affn^1),\calo(Y)).
$$
But $\hom_{K-alg}(\calo(\affn^1),\calo(Y))=\hom_{K-alg}(K[X],\calo(Y))\cong \calo(Y)$ (by $g:\calo(\affn^1)\lrta \calo(Y)$, $g\mapsto g(X)$)
\end{proof}
\section*{Projective Algebraic sets}

Projective sets can have a good notion of ``compactness''.

N.B. Any $Y\in (Alg_K)$ is \textbf{quasi-compact}( open cover have a finite subcover).

\begin{dfn}
$\proj^n_K=\proj^n$ can be either defined as 

``the set of  lines in $\affn^{n+1}$ that pass through the origin''

or

``the equivalence classes of points in $K^{n+1}\backslash \{0\}$ with the equivalence relation $x\sim y$ iff $x=\lambda y$ for some $\lambda \in K$'' and we use the notion $[x_0:...:x_n]$ for the equivalence class of $(x_0,..,x_n)$
\end{dfn}

These two definitions are equivalent: 

Given a line $l\in \affn^1\llrta $ hyperplane in $K^{n+1}$, corresponds to a equation
$$
a_0X_0+....+a_n X_n=0
$$
with at least one of $a_i$ non-zero.

Conversely, from $[x_0:..:x_n]$, we  we get the corresponding hyperplane/line trivially.


Notes the following fact:

$$
\proj^n=\cup_{0\leq i\leq n} H_i,
$$
where $H_i=\{[x_0,...,x_n]|x_i\neq 0\}$ and there is a bijection 
$$
\begin{aligned}
&H_i\lrta K^n\\
&[x_0:...:x_n]\longmapsto\left(\frac{x_0}{x_i},...,\widehat{\frac{x_i}{x_i}},..,\frac{x_n}{x_i}\right)\\
&
[y_1:...:y_{i-1}:1:y_{i}:...:y_n]\mapsfrom(y_1,...,y_n)
\end{aligned}
$$
We define from linear algebra some notions in $\proj^n$ a line in $\proj^n$ is the image by the projection $K^{n+1}\backslash \{0\}\lrta \proj^n$ of the two dimensional affine subspace.

\begin{ex}
$l_1,l_2\subset \proj^2$ lines $\l_1\cap l_2$ is a line if $l_1$ and $l_2$ are identical and would be a single point otherwise.
\end{ex}

Observation: If $f\in K[X_0,...,X_{n+1}]$ is homogeneous, then for $x\in \proj^n$, it makes no sense to speak of ``$f(x)\in K$'', but the zero-loci or the set where $f(x)\neq 0$ does make sense.

\begin{dfn}
 A  \textbf{projective algebraic set} $S\subset \proj^n$ is 
 $$
  S=\{ x\in \proj^n|f_1(x)=...=f_m(x)=0\},
 $$
 where $f_1,...,f_m$ are homogeneous of some degrees.

 An irreducible projective algebraic set is called a \textbf{projective variety}
\end{dfn}

\underline{Notation}: $V(f_1,..,f_n)$

\begin{ex}
$V(Y^2 Z-X^3-X Z^2)\subset \proj^2$. 
\end{ex}
Let $0\leq i\leq n$, then $S\cap H_i=\{[x_0:...:x_n]\in S| x_i\neq 0\}$ is , via the bijection  $H_i\lrta K^n$, in bijection with an affine algebraic set $S_1\subset \affn^n$ given by $\tilde{f_1}(y)=...=\tilde{f}_m(y)=0$, where $\tilde{f}_i(y_1,..,y_n)=f_i(y_1,...,y_{i-1},1, y_i,...,y_n)$


\subsection{Mar 2nd: Projective algebraic sets and regular functions}
Recall: $\proj^n_K=K^{n-1}-\{0\}/\sim$, and $H_i:=\{[x_0:...:x_n]|x_i\neq 0\}$ is in bijection with $\affn^n$. $V(f_1,...,f_m)=\{x\in \proj^n|\forall i,f_i(x)=0\}$, where $f_1,..f_m$ are homogeneous.

More generally, we can define 
$$
V(I)=V(\text{homogeneous element of $I$=})=V(\cup_{d\geq 0} I_d)
$$
where $I$ is an homogeneous ideal of $K[X_0,...,X_n]$ that is  $I=\oplus_{d\geq 0} I_d$, $I_d$ the the degree $d$ piece of $K[X_0,...,X_n]$.

Conversely, given $S\subset \proj^n$, we can define 
$$
I(S):=\text{ideal generated by homogeneous polynomials that vanishes on $S$}
$$
\begin{lemma}
This is a homogeneous ideal
\end{lemma}
\begin{proof}
$f\in I(s)\Lrta f=\sum_{i\in I}g_i f_i$, where $f_i$ is homogeneous and vanishes on $S$. We can expand each $g_i$ as $\sum_j g_{ij}$, where each $g_{ij}$ is homogeneous in $I(S)$. Then we know $f\in \otimes I(S)_d$ and the converse is clear.
\end{proof}
\begin{lemma}
The projective sets $V(I)$ where $I$ is homogeneous form the closed sets of a topology. It is called the Zariski topology (same name for the induced topology on projective sets).
\end{lemma}
\begin{ex}
$H_0\subset \proj^n$ and $\sigma: H_0\cong \affn^n$. Under this bijection, the Zariski topologies correspond $\sigma $ is a homeomorphism
$$
f\in K[X_0,...,X_n]\text{ homogeneous} \leadsto V(f)\subset \proj^n
$$
$$
\tilde{f}=f(1,X_1,...,X_n)\in K[X_1,..,X_n]\leadsto V(\tilde{f})\subset \affn^n
$$
and $\sigma(V(f))=V(\tilde{f})$.
\end{ex}
\begin{dfn}
$Y\subset \proj^n$ projective $S(Y)=K[X_0,...,X_n]/I(Y)$, \textbf{homogeneous coordinate ring}
\end{dfn}
\underline{Note} elements in $S(Y)$ are not functions on $Y$. The geometric meaning of $S(Y)$ will be explained latter with the language of schemes.

We now want to define morphisms of  projective algebraic sets. We have to look at it more carefully because we can not simply copy the affine definition.
\begin{dfn}
$Y\subset \proj^n$ projective, let $V\subset Y $ be an open subsets of $Y$.
\begin{enumerate}[label=(\arabic*)]
\item $f: V\lrta K$ continuous is called \textbf{regular} on $Y$ if $\forall x\in Y$, $\exists U$ open $x\in U$, $\exists f_1,f_2\in K[X_0,...,X_n]$ homogeneous of same degree such that $f_2(x)\neq 0$ for all $x\in U$ and $f(x)=\frac{f_1(x)}{f_2(x)}$ for $x\in U\cap Y$
\item $Y_1,Y_2$ are projective sets in $\proj^n,\proj^m$, $f: Y_1\lrta Y_2$ is a \textbf{morphism} if $f$ is continuous and for any $U\subset Y_1$ open and any $\varphi:U\lrta K$ regular, the composite $\varphi\circ f: f^{-1}(U)\lrta K$ is regular.
\end{enumerate}
\end{dfn}
\underline{Note}: IN $(2)$, one can not restrict to $\varphi$ regular on $Y_2$ because often the space of such function is reduced to $K$
\begin{prop}
For $\proj^n$, the space of functions regular on $\proj^n$ is $K$.
\end{prop}
\begin{proof}
The case $n=1$ implies the general case: if $f:\proj^n\lrta K$ regular, and $x\neq y$ in $\proj^n$, the line joining $x$ to $y$ in $\proj^n$ is ``isomorphic'' to $\proj^1$ and $f|_L$ is regular so constant, hence $f(x)=f(y)$.

For $n=1$, suppose $x$, $y$ are arbitrary points and let $U \ni x$, $V\ni y$ be open neighbourhoods such that $f|_U =f_1(x)/f_2(x)$ and $f|_V = g_1(x)/g_2(x)$ where $f_1$, $f_2$, $g_1$, $g_2$ are homogeneous polynomials and $f_1$, $f_2$ have the same degree as well as $g_1$, $g_2$. We may assume that $f_1$ and $f_2$ are coprime and also $g_1$, $g_2$ are coprime. Hence on $U \cap V$,
$$
f_1 g_2 = g_1 f_2.
$$
We know that $U \cap V$ is infinite so this implies $f_1 = g_1$ and $ f_2 = g_2$. Since $x$ and $y$ were arbitrary points we conclude that $f = f_1(x)/f_2(x)$ on all of $\proj^1$ hence $f$ is a constant.
\end{proof}
\underline{Concretely}: To say that $f: Y_1\subset \proj^n\lrta Y_2\subset \proj^m$  is a morphism of projective algebraic sets. It reduces to 
$\forall x\in Y_1,\exists U$ open containing $x$ s.t. there exists $f_0,...,f_m\in K[X_0,...,X_{n+1}]$
homogeneous of same degree, with no common zero in $U$, such that
$\forall y\in U\cap Y_1$, $f(y)=[f_0(y):...:f_m(y)]$. It is easy to see that if $f$ is of this form, then it is a morphism.

The converse is left as an exercise.

\begin{ex}
\begin{enumerate}[label=(\arabic*)]
\item Let $g\in Gl_n(K), n\geq 1$. Define 
$$
f_g:\proj^n\lrta \proj^n
$$
$$
[x_0:...:x_n]\longmapsto [g(x_0,...,x_n)]
$$
is a morphism. In fact, it is an isomorphism. $f^{-1}_g=f_{g^{-1}}$.
It also has some other properties: $f_{g}=f_{\lambda g},\lambda\neq 0$ and we get an induced group morphism
\[
\begin{tikzcd}
PGL_{n+1}(K) \arrow[d] \arrow[r, equal] & GL_{n+1}(K)/K^\times \\
Aut_{proj}(\proj^n) & 
\end{tikzcd}
\]
which is an isomorphism. A special case is $Aut_{hol}(\cplx \proj^1)=PGL_2(\cplx)$
$$
g\longmapsto \left[z\mapsto \frac{az+b}{cz+d}\right]
$$
\item  $K=\cplx$. One can do  holomorphic geometry (using holomorphic functions instead of polynomials). IN $\cplx^n$,we get a  much more complicated picture [e.g. $V(\sin z)$] is a an infinite sets in $\proj^n_\cplx$, however Chow proved that the holomorphic sets and the projective algebraic sets are the same (Serre ``GAGA'' principle compares many different invariant of both categories.)
\item Consider the map $S:=V(Y^2Z-X^3-XZ^2)\overset{f}{\lrta} \proj^1$, $[x:y:z]\mapsto [y:z]$. \\
\underline{Claim}, this is a morphism of projective sets.
\\
This means that there is no solution to $Y^2Z-X^3-XZ^2=0$ with $Y=Z=0$. (But $[x:y:z]\mapsto [x:z]$ is not a morphism because $[0:1:0]\in S$). $f$ is surjective but not injective $[x:y:z]$ and $[x:-y:z]$ have same image. This works in field $k$ with $\text{char} k\neq 2$.
\item $\proj^1\overset{v}{\lrta} \proj^2$, $[x:y]\mapsto [x^2:xy:y^2]$ (special case of Veronese embedding). This is a morphism. The image of $v$ is equal to $[y_0:y_1:y_2], \proj^2$. $S=V(Y_1^2-Y_0Y_2)$.  In fact, $\sigma$ gives an isomorphism
$\sigma: \proj^1\lrta S$ with inverse given by 
$$
\tau: S\lrta \proj^1
$$
$$
[y_0:y_1:y_2]\mapsto\left\{\begin{matrix*}
&[Y_1:Y_2] \text{ if } Y_2\neq 0\\
&[Y_0:Y_1]\text{ if } Y_0\neq 0
\end{matrix*}
\right.
$$
$\tau$ is a morphism defined on all of $S$, because if $[y_0:y_1:y_2]\in S$ satisfies $y_0=y_2=0$, it would implie $y^2_1=y_0y_2=0\Lrta y_1=0$ 
$$
\begin{aligned}
\tau\circ \sigma([x:y])&=\tau([x^2:xy:y^2])
&=\left\{\begin{matrix*}
&[xy:y^2]=[x:y], y\neq 0
\\
&[x^2:xy]=[x:y], x\neq 0
\end{matrix*}\right.
\end{aligned}
$$
therefore $\tau\circ \sigma= id_{\proj^1}$ and $\sigma\circ \tau=id_S$ can proved similarly

One can not find $f_0:f_1$ in $K[Y_0,Y_1,Y_2]$ s.t. $\tau([y_0:y_1:y_2]=[f_0(Y):f_1(Y)]$ for all $Y\in S$
\end{enumerate}
\end{ex}

\subsection{Mar 5th: Exercise class}
The content covered can be found in Hartshorne, p50ff Proposition 7.4 and Theorem 7.5.


\subsection{Mar 6th: Rational/birational maps}

$Y\subset \affn^n$ algebraic if $Y$ is irreducible, then $\calo(Y)$ is an integral domain. Let $K(Y)$ be its quotient field. What is the geometric meaning of $K(Y)$? It is called the \textbf{function field} of $Y$.

We will see
\begin{thm}
For $Y_1,Y_2$ affine varieties (irreducible) $K(Y_1)\cong K(Y_2)$ as fields

$\Llrta$ $\exists U_1\subset Y_1$ open dense subset and $\exists U_2\subset Y_2$ open dense subset such that $U_1$ and $U_2$ are isomorphic.
\end{thm}
\begin{dfn}
(Quasi-affine  and quasi-projective) varieties)
\begin{enumerate}%[label=(\arabic*)]
  \item \textbf{quasi-affine variety} $V$ is an open subset $V\subset Y$, where $Y\subset \affn^n$ is an affine variety. $[V\neq \emptyset\Lrta V\text{ dense in } Y\Lrta V\text{ irreducible }]$. It is given by the Zariski's topology from $Y$.\\
  (1') $V\subset Y\subset \proj^n$ where $V$ is an open subset of $Y$ is \textbf{quasi-projective}, where $Y$ is projective variety.
  \item A regular function $f:V\lrta K=\affn^1$, where $V$ is quasi-affine is an $f$ such that for all $x\in V$, $\exists U\subset V$ open containing $x$ s.t., $\forall x\in V$, $f(x)=\frac{f_1(x)}{f_2(x)}$ where $f_1,f_2\in\calo(\affn^n)$ and $f_2(x)\neq 0$ on $U$.\\
  (2') $V$ is quasi-projective variety a regular function $f$ is $\frac{f_1(x)}{f_2(x)}$ $f_i$ homogeneous of same degrees.
  \item If $V_1,V_2$ are \underline{Varieties} (of any of the four types), then $f:V_1\lrta V_2$ is a \textbf{morphism} if for al open $U\subset V_2$ all $\varphi:U\lrta K$ regular, the composition $\varphi\circ f: f^{-1}U\lrta K$ is also regular.
  \end{enumerate}
\end{dfn}

N.B. \begin{enumerate}
\item This makes sense because if $U\subset V_2$, where $V_2$ is quasi affine $U$ open, $\Lrta$ $U\subset V_2\subset Y$ so $U$ is also quasi-affine in $\affn^n$
\item \underline{Exercise} If $f$ is regular on $V$, then $f$ is continuous $V\lrta \affn^1$. (check that $f^{-1}(\{a\})$ is closed, use that closedness is a local condition.)
\item In the (quasi)-affine case, it is enough to check that $\varphi\circ f$ is regular on $V_1$ for $\varphi$ regular on $V_2$.
\item \underline{Notation}:
$$\calo(V)=\{f:V\lrta K|\text{ regular}\}$$
This is a ring of with unity, and because of the condition that for open $V\subset Y$ in a variety $Y$, either $\calo(V)=0,V\neq \emptyset$ or $V$ is dense in $Y$, $\Lrta \calo(V)$ integral domain. 
\end{enumerate}

\begin{ex}\ 
\begin{enumerate}
\item $GL_n(K)=\{x\in M_{n\times n}(K)|\det(x)\neq 0\}\subset \affn^{n^2}$ is quasi-affine since $\det:M_{n\times n}(K)\lrta K$ is continuous and not emptyset.

\item In fact, for any $0\neq f\in \calo(\affn^n)$
$$
U_f=\{x\in \affn^n|f(x)\neq 0\}
$$
is a quasi-affine variety.

\underline{Fact}: There is an isomorphism
$$
\sigma = 
\left\{\begin{aligned}
U_f&\lrta Y=\{(x,y)\in\affn^{n+1}|yf(x)=1\}\\
x&\longmapsto \left(x,\frac{1}{f(x)}\right)
\end{aligned}
\right.
$$
with inverse
$(x,y)\overset{\pi}{\longmapsto}x$.
(Indeed, $\pi\circ \sigma=Id_{U_f}$, $\sigma\circ \pi=Id_Y$) and $\pi$ is a morphism: Consider $\varphi\in\calo(U_f)$
$$
Y\overset{u}{\lrta}U_f\overset{\varphi}{\lrta}K
$$
then $\varphi\circ \pi(x,y)=\varphi(x)$.

Indeed, for any $x\in U_f$, $\exists f_1,f_2\in \calo(\affn^2)\varphi(x)=\frac{f_1(x)}{f_2(x)}, f_2(x)\neq 0$, one can show: assume $f_2(x)=f(x)^d$ then 
$$
\varphi(x)=\frac{f_1(x)}{f(x)^d}=f_1(x)y^d
$$
for $(x,y)\in Y$, so this is regular.

(2) $\sigma$ is a morphism
$$
U_f\overset{\sigma}{\lrta}Y\overset{\varphi}{\lrta}K
$$
$\varphi\in\calo(Y)=K[X_1,...,X_n,Y]/(Yf(x)=1)$
$$
\begin{aligned}
\varphi\circ \sigma(x)&=\varphi(x,1/f(x))=\left(\sum_j a_j Y^j\right)|_{Y=1/f(X)}\\
&=\sum_j a_j (x)/f(x)^j\in \calo(U_f)
\end{aligned}
$$
\item $\proj^n=\cup_{0\leq i\leq n}H_i$, with $H_i=\{[x_0:...:x_n]|x_{i}\neq 0\}$, $H_i\subset \proj^n\}$ open , so quasi-projective. The map
$$
\left\{\begin{aligned}
H_i&\overset{f_i}{\lrta} \affn^n\\
[x_0:...:x_n]&\longmapsto (\frac{x_0}{x_1},...,\frac{x_{i-1}}{x_i},\frac{x_{i+1}{x_i}},...,\frac{x_n}{x_i})
\end{aligned}
\right.
$$
is an isomorphism.
\end{enumerate}
\end{ex}

\begin{dfn}
$Y$ variety, $K(Y)=\{(U,f)|\emptyset\neq U\subset Y\text{ open },f\in \calo(U)\}/\sim$, where $(U_1,f_1)\sim (U_2,f_2)$ iff $f_1|_{U_1\cap U_2}=f_2|_{U_1\cap U_2}$
\end{dfn}

\underline{Fact}: $\sim$ is an equivalence relation. We define
$$
(U_1,f_1)+(U_2,f_2)=(U_1\cap U_2,f_1+f_2)
$$
$$
0:=(Y,0),\ \ 1:=(Y,1)
$$
\begin{prop}
$Y$ is quasi-affine, $U\subset Y$ open nonempty.
\begin{enumerate}
\item $\calo(Y)\inj\calo(U)\inj K(Y)$\\
$f\longmapsto f|_U\mapsto (U,f)$
\item $K(Y)$ is a field, and identifies with the fraction field of $\calo(Y)$ and of $\calo(U)$.
\item if $Y$ is an affine variety, then $\calo(Y)$ as defined above coincides with $\calo(Y)=K[X_1,...,X_n]/I(Y)$ as defined in previous sections.\\

(3') If $Y=U_f$ for $0\neq f$ in $\calo(\affn^n)$, then $\calo(Y)=\{f_1/f^d|f_1\in \calo(\affn^n, d\geq 0\}=\calo(\affn^n)_f$ the localization at $f$.
\end{enumerate}
\end{prop}
\begin{proof}
(1), The morphism $\calo(Y)\lrta \calo(U)\lrta K(Y)$ are injective because any $U\subset Y,\neq \emptyset$ is dense.

(2) Let $(U,f)\neq 0$ in $K(Y)$, then $\exists x_0\in U$, $f(x_0)\neq 0$ in a $V\subset U$, $x_0\in V$
$$
f(x)=\frac{f_1(x)}{f_2(x)}, f_1,f_2\in\calo(\affn^n), f_2\neq 0\text{ in }V
$$
in particular, $f_1(x_0)\neq 0$ and $( U\cap\{f_1(x)\neq 0\},\frac{f_2(x)}{f_1(x)})\in K(Y)$, where $U\cap\{f_1(x)\neq 0\}\neq \emptyset$ is the inverse of $(U,f)$ in $K(Y)$. 

By $(1)$, $K(Y)\supset \calo(Y)$.

Let $(U,f)\in K(Y)$, pick $x\in Y$ so that around $x$, $f(x)=\frac{f_1}{f_2}$, $f_i\in\calo(\affn^n)$, then $(U,f)=\frac{(Y,f_1)}{(Y,f_2)}$, so $K(Y)$ is the fraction field of $\calo(Y)$.

(3) Write $\calo'(Y)=K[X]/I(Y)$.  Note $K[X..,Y]/I(Y)$ identifies to a ring of functions on $Y$, the claim is that this ring is $\calo(Y)$.

Observation:
For $x\in Y$, to say that $f: Y\lrta K$ is ``regular at $x$'' means precisely that $f\in \calo'(Y)_{I_x}$, where $I_x=\{f\in\calo'(Y)|f(x)=0\}$. (Localization at  a maximal ideal)

So $$
\begin{aligned}
\calo(Y)&=\bigcap_{x\in Y}\calo'(Y)_{I_x}\\
&=\bigcap_{\scm\subset\calo'(Y)}\calo'(Y)_\scm\\
&=\calo'(Y)
\end{aligned}
$$
the second equality from Nullstellensatz and the third from commutative algebra.

(3') Similarly, using characterization of maximal ideals in $A_f, f\neq 0$
\end{proof}

\begin{dfn}
K(Y) is called the fraction or function field of $Y$
\end{dfn}

\begin{ex}
$K(\affn^n)=K(\proj^n)=K(X_1,..,X_n)$
\end{ex}

\begin{dfn}
(Rational maps) $Y_1,Y_2$ varieties. A \textbf{rational map} $f: Y_1\dashrightarrow Y_2$ is a pair $(U,\tilde{f})$ where $U\neq \emptyset$ in $Y_1$ and $\tilde{f}:U\lrta Y_2$ is a morphism with $(U,\tilde{f})=(U',\tilde{f}')$ iff 
$$
\tilde{f}|_{U\cap U'}=\tilde{f}'|_{U\cap U'}
$$
[Check: this is coherent, i.e., this is an equivalence relation]
\end{dfn}

\begin{dfn}
$f:Y_1\dashrightarrow Y_2$ is a \textbf{dominant} if its image $\tilde{f}(U)\subset Y_2$ is dense.
\end{dfn}

\begin{ex}\ 
(1) there is a bijection $\{Y\dashrightarrow \affn^1\}=K(Y)$
$$
\begin{matrix}
(U,\tilde{f}) & (U,f)\\
\tilde{f}:U\lrta \affn^1\text{ morphism } & f: U\lrta K\text{ regular}
\end{matrix}
$$
So it is enough to check 
$$
\hom_{Var}(U,\affn^1)=\calo(U)
$$
Left as exercise

(2) $Y,f_1,f_2,f_3\in\calo(Y)$
$$
\left\{\begin{aligned}
Y&\dashrightarrow \proj^2\\
x&\longmapsto [f_1(x):f_2(x):f_2(x)]
\end{aligned}\right.
$$
defined on $\{x|f_i (x) \text{ are not all zero}\}$, which is open if any of the $3$ sections is non-zero.
\end{ex}
\begin{thm}
$Y_1,Y_2$ varieties

$\exists \{Y_1\overset{f}{\dashrightarrow} Y_2|f \text{ dominant}\}$

$\overset{bij}{\llrta}$

$K(Y_2)\lrta K(Y_1)$
\end{thm}

\begin{cor}
$Y_1, Y_2$ varieties. $Y_1$ and $Y_2$ are birational 

iff $K(Y_1)$ is isomorphic to $K(Y_2)$

iff $\exists U\subset Y_1$ open $\neq \emptyset$
$\exists V\subset Y_2$, open $\neq \emptyset$ so that $U$ and $V$ are isomorphic as varieties.
\end{cor}

\begin{cor}
Any variety $Y$ of dimension $d\geq 0$ is birational to a hypersurface $V\subset \proj^{d+1}$
\end{cor}
\begin{proof}
(1) Given $Y_1\overset{f}{\dashrightarrow}Y_2$ dominant, we want a morphism
$K(Y_2)\lrta K(Y_1)$.

 Let $(U,\tilde{f})=f$, $(V,\varphi),\varphi:V\lrta K$ in $K(Y_2)$
$$
\varphi\circ f: \tilde{f}^{-1}(V)\lrta K
$$ 
 is in $K(Y_1)$, provided $\tilde{f}^{-1}(V)$ is dense, it is enough that $\tilde{f}^{-1}(V)\neq \emptyset$, $\tilde{f}(U)\cap V\neq \emptyset$, since $V$ is open and $\tilde{f}(U)$ is dense.

 (2) Given $i: K(Y_2)\lrta K(Y_1)$. Let $\tilde{Y_2}\subset Y_2\subset \affn^n$ open quasi-affine so that $K(Y_2)=K(\tilde{Y_2})=Frac(\calo(\tilde{Y}_2))$

 Let $X_1,..,X_n$ be the coordinates  in $\affn^n$ as elements of $\calo(\tilde{Y}_2)$, then let
 $$
f_j =i (X_j)\in K(Y_1)
 $$
 $f_j\llrta (U_j,\tilde{f}_j)$ with $U_j\subset Y_1$ dense and $\tilde{f}_j\in\calo(U_j)$. Then 
 $f_j\llrta (U,\tilde{f}_j)$, $U:=U_1\cap ...\cap U_n$ still dense.

 Define $U\lrta \tilde{Y}_2\inj Y_2$ by
 $$
x\longmapsto (\tilde{f}_1(x),...,\tilde{f}_n(x)).
 $$
This is a rational map $Y_1\dashrightarrow Y_2$

\end{proof}

\subsection{Mar 9th: Continue and Nonsingular varieties}

Recall
\begin{thm} $Y_1,Y_2$ varieties
$$\{ \text{dominant }Y_1\dashrightarrow Y_2\}\llrta\{K(Y_2\inj K(Y_1)\}$$
\end{thm}
\begin{cor}The followings are equivalent:
\begin{itemize}
	\item
$Y_1$  and $Y_2$ are birational \item the function field $K(Y_1)$ and $K(Y_2)$ are isomorphic
\item $\exists \emptyset \neq U\subset Y_1$, $\emptyset \neq V\subset Y_2$ and isomorphism between $U$ and $V$
\end{itemize}
\end{cor}
\begin{proof}
The last condition implies the second because $K(Y_1)=Frac(\calo(U))\cong Frac(\calo(V))=K(Y_2)$. Assume we have rational maps 
$$
Y_1\overset{f_2}{\drta}Y_2\overset{f_2}{\drta} Y_1
$$
with $f_2\circ f_1=id_{Y_1}, f_2\circ f_1= id_{Y_2}$. 

Let $f_1=(U',\tilde{f}_1), f_2=(V',\tilde{f}_2)$
\[
\begin{tikzcd}
Y_1 \arrow[r, dashed,"f_1"] & Y_2 \arrow[r, dashed,"f_2"] & Y_1 \\
U' \arrow[ru, "\tilde{f}_1"'] \arrow[u,hook] & V' \arrow[ru, "\tilde{f}_2"'] \arrow[u, hook] & 
\end{tikzcd}
\]
$$
f_2\circ f_1=(Y_1,Id_{Y_1})
$$
so $\tilde{f}_2(\tilde{f}_1(x))=x$ if $\tilde{f}_1(x)\in V'$.
Similarly, $f_1\circ f_1=(\tilde{f}_2^{-1}(U'),\tilde{f}_1\circ \tilde{f}_2)$. Define $U=\tilde{f}^{-1}_{1}(\tilde{f}_{2}^{-1}(U'))\subset U'$, which is a dense open subset. Also we have $V=\tilde{f}^{-1}_{2}(\tilde{f}_{1}^{-1}(V'))$.

\underline{Claim}: $U\overset{\tilde{f}_1}{\lrta }V\overset{\tilde{f}_2}{\lrta} U$ and then $\tilde{f}_1|_U,\tilde{f}_2|_U$ are reciprocal isomorphism.

We check that if $x\in  U$, then $\tilde{f}_1(x)\in V$.
Let $y=\tilde{f}_1(x)\in V'$ so $\tilde{f}_2(y)=\tilde{f}_2(\tilde{f}_1(x))=x$ so $\tilde{f}_1(\tilde{f}_2(y))=\tilde{f}_1(x)\in V'$ $\Lrta y\in V$. Similarly for $f_2$.
\end{proof}

\begin{dfn}
A \textbf{rational variety} $Y$ is a variety $Y$ birational to $\proj^n$ for some $n$ (or to $\affn^n$). BY the theorem above we know $\exists n, K(Y)\cong K(X_1,...,X_n)$. 

A \textbf{unirational variety} $Y$ is a variety s.t. there is a dominant $\proj^n\drta Y$ for some $n$, by theorem above $\exists n, K(Y)\inj K(X_1,...,X_n)$
We obviously have
$$
\text{ Unirational } \Llta \text{rational}
$$
but 
$$
\text{ Unirational } \overset{?}{\Lrta} \text{rational}
$$
\end{dfn}
For $\text{char}= 0$: $\dim Y=1$ or $2$, Luroth and some italian showed that unirational curves or surfaces are rational.

First example in char $0$ of non-rational unirational varieties were provided by Clemens-Griffith: certain cubic hypersurfaces in $\dim 3$. 

Iskovskih-Manin ``general '' quantic hypersurfaces of $\dim 3$.

\begin{cor}
Any variety $Y$ is birational to a hypersurface in $\proj^{\dim(Y)+1}$ or $\affn^{\dim(Y)+1}$.
\end{cor}
\begin{proof}
Let $d=\dim(Y)=\dim(\calo(Y))$. Then a fact in commutative algebra says $K(Y)$ is a finite separable extension of $K(X_1,...,X_d)=:E$. By the primitive element theorem, there exists $\alpha:\in K(Y)$ such that  $K(Y)=E(\alpha)$. Let $f\in E[T]$ be the minimal polynomial of $\alpha$.

Write
$$
f=\sum_{i=0}^na_i T^i=\sum_{i=0}^n \frac{b_i}{c_i} T^i,
$$
where $a_i\in E$ and $a_i, b_i\in A=K[X_1,...X_d]$

$\Lrta$ $\tilde{f}(\alpha)=0$ where $\tilde{f}=\left(\prod c_i\right)f\in A[T]=K[X_1,...,X_d,T]$. Define $\tilde{Y}=V(\tilde{f})\subset \affn^{d+1}$. This is what we wanted.
\begin{enumerate}[label=(\arabic*)]
\item $\tilde{Y}$ is an irreducible hypersurface.
\item $\tilde{Y}$ is birational to $Y$ $\Llrta K(\tilde{Y})=K(Y)$
\end{enumerate}

\underline{Step 1}: Need $\tilde{f}_1\in K[X_1,...,X_d,T]$ irreducible. Suppose $\tilde{f}=\tilde{f}_1\tilde{f}_2, \tilde{f}_i\in A[T]\Lrta E\ni f=\frac{\tilde{f}_1}{\prod c_i}\tilde{f}_2 $ factors in $E[T]$, since $f$ is irreducible in  $E[T]$, one of $\deg(\tilde{f}_1)$ or $\deg(\tilde{f}_2)$ is zero

$\Lrta \tilde{f}$ is irreducible.

\underline{Step (2)}: $\calo(\tilde{Y})=K[X,T]/(\tilde{f})$. We have an injective morphism
$$
\left\{\begin{aligned}
 \calo(\tilde{Y})&\lrta K(Y)=E(\alpha)\\
 X_i&\longmapsto X_i\\
 T&\longmapsto \alpha
\end{aligned}
\right.
$$
so the fraction field $K(\tilde{Y})$ injects into $K(Y)$. The image of $K(\tilde{Y})$ contains $X_1,...,X_d$ and $\alpha$ hence it contains $E(\alpha)$, i.e., $K(\tilde{Y})=K(Y)$
\end{proof}

\section*{Nonsingular varieties}
Concrete geometric definition:
\begin{dfn}
$Y\subset \affn^n$ affine variety $\dim Y=d$, $x\in Y$. We say $Y$ is \textbf{nonsingular} at $x$ if for any generating set $\underline{f}:=(f_1,...,f_m)$ of $I(Y)$, the Jacobian matrix at $x$
$$
J_{\underline{f}}(x)=\left(\frac{\pd f_i(x)}{\pd x_j}\right)_{1\leq i\leq m, 1\leq j \leq n}\in M_{m\times n}(K)
$$
has rank $n-d$. If this holds for all $x$, then we say $Y$ is nonsingular.
\end{dfn}
\underline{Key fact}: It suffices to check the rank of $J_F(x)$ for some generating set. 

Indeed suppose $\underline{h}=(h_1,..,h_k)$ also generate $I(Y)$ so
$$
f_i = \sum^k_{\ell=1} g_{i\ell} h_\ell,
$$
where $g_{i\ell}\in \calo(\affn^n)$, $\frac{\pd f_i}{\pd x_j}=\sum^k_{\ell=1}\frac{\pd g_{i\ell}}{\pd x_j}h_\ell+\sum^k_{\ell=1}g_{i\ell}\frac{h_\ell}{x_j}$

At $x$ where $h_\ell(x)=0$, we get 
$$
\frac{\pd f_i}{x_j}(x)=\sum^k_{\ell=1}\frac{\pd g_{i\ell}}{\pd x_j}h_\ell
$$
$$
\Lrta J_{\underline{f}}(x)=M J_{\underline{h}}(x)
$$
so rank $J_{\underline{f}}(x)\leq \text{rank } J_{\underline{h}}(x)$. Exchanging $\underline{f},\underline{h}$, we get the equality.

\begin{ex}

\end{ex}\ 
\begin{enumerate}[label=(\arabic*)]
\item If $K=\cplx$, the implicit function theorem says that around a point where $J_{\underline{f}}(x)$ has rank $n-d$, then $V(f_1,...,f_m)$ is diffeomorphic to $\cplx^d$
\item Let $Y=V(f)$, $f$ irreducible in $\affn^n$. Then $x\in V(f)$ is nonsingular
$\Llrta(\pd f(x)/\pd x_1,...,\pd f(x)/\pd x_n)\neq 0$
\end{enumerate}


We have a singular point $\Llrta$ the system of $n+1$ equations 
$$
\left\{ \begin{aligned}
f(x)&=0\\
\frac{\pd f}{\pd x_1}(x)&=0\\
\vdots &\\
\frac{\pd f}{\pd x_n}(x)&=0
\end{aligned}\right.
$$
has a solution. 
For instance 
$$
Y^2=X^3
$$
\begin{center}
\includegraphics[scale=0.5]{Y^2-X^3}
\end{center}

$$
\left\{ \begin{aligned}
f&=Y^2-X^3\\
\frac{\pd f}{\pd X}&=-3X^2\\
\frac{\pd f}{\pd Y}&=2Y
\end{aligned}\right.
$$
so $X=Y=0$ is the only singular point.

$$Y^2=X^3-X$$
\begin{center}
\includegraphics[scale=0.5]{Y^2=X^3-X}
\end{center}
$$
\left\{ \begin{aligned}
f&=Y^2-X^3+X\\
\frac{\pd f}{\pd X}&=-3X^2+1=0\\
\frac{\pd f}{\pd Y}&=2Y=0
\end{aligned}\right.
$$
If $\text{char }k\neq 2$, $\Lrta Y=0$, $X^3-X=0$ $X=0,-1,1$ do not satisfy the system of solutions. In the case $\text{char}=2$, $(1,0)\in Y$ is singular.


The intrinsic characterization was found by Zariski. 
\begin{dfn}
$x\in Y$ variety
\begin{enumerate}[label=(\arabic*)]
\item The \textbf{local ring} of $Y$ at $x$
$$
\begin{aligned}
\calo_{Y,x}&=\{f\in K(Y)|f\text{ defined  at } x\}\\
&=\{\text{ regular functions on some } U\ni x\}/(f_1\sim f_2\text{ if they coincide on } U_{f_1}\cap U_{f_2})
\end{aligned}
$$
if $Y$ is affine, then $\calo_{Y,x}=\{f_1/f_2\in K(Y) \mid f_i\in\calo(Y),f_2(x)\neq 0\}=\calo(Y)_{\scm_x}$, where $\scm_x=\{f\in\calo(Y)|f(x)=0\}$ is the maximal ideal corresponding to $x$.
$$
\calo(Y)\subset\calo_{Y,x}\subset K(Y)
$$
\end{enumerate}
\end{dfn}
\begin{dfn}
$Y\subset \affn^n$ affine $x\in Y$. The (Zariski) cotangent spaces of $Y$ at $x$ is the $K$-vector space
$$
\scm_{Y,x}/\scm_{Y,x}^2,
$$
where $\scm_{Y,x}\subset \calo_{Y,x}$ is the maximal ideal 
\end{dfn}
\begin{rmk}
$\calo_{Y,x}$ is a local ring, it has a unique maximal ideal $\scm$ which is $\calo_x\calo_{Y,x}$ in the affine case. Moreover $\calo_{Y,x}/\scm=K$ by $f\mapsto f(x)$.
\end{rmk}

N.B. Intuitively,  the Taylor expansion of $f\in \calo_{Y,x}$ about $x\in\scm_{Y,x}$ is
$$
f(X)=f(x)+\sum^n_{j=1}\frac{\pd f}{\pd x_j}(x)(X-x_j)+\dots
$$
if $f\in\scm_{Y,x}$ then $f(x)=0$ and terms of order $\geq 2$ belongs to $\scm_{Y,x}^2$, so $f$ has image
$$
\sum \frac{\pd f}{\pd x_j}dX_j\in \scm_{Y,x}/\scm_{Y,x}^2
$$
where $dX_j=X-x_j$.



\begin{dfn}
A local ring $\calo$ with maximal ideal $\scm$ is callled \textbf{regular} if 
$$
\dim \calo= \dim_k \scm/\scm^2
$$
where $k=\calo/\scm$ is the residue field.
\end{dfn}

\subsection{Mar 13th-A: Continue and proofs}
%Recall:
%$x\in Y\subset \affn^n$, $d=\dim(Y)$ affine variety,  and $Y$ is non-singular at $x$ iff 
%$$
%rank\ J_{\underline{f}}(x)=n-d.
%$$
\begin{thm}(Zariski)
	For $x\in Y\subset \affn^n$ the following are equivalent:
	\begin{enumerate}[label=(\arabic*)]
		\item
		$Y$ is non-singular at $x$
		\item $\dim(Y)=\dim_K(\scm_{Y,x}/\scm_{Y,x}^2)$, where $\scm_{Y,x}$ is the maximal ideal in the local ring $\calo_{Y,x}:=\calo(Y)_{\tilde{\scm}_{Y,x}}$ with $\tilde{\scm}_{Y,x}=\{f\in\calo(Y)\mid f(x)=0\}$.
	\end{enumerate}
\end{thm}


\begin{rmk}
	One can show $\dim_K\scm_{Y,x}/\scm_{Y,x}^2\geq \dim (Y)$ so the question is whether it is larger or not. 
\end{rmk}

\begin{proof}
	Denote $I:=I(Y)$, $d= \dim Y$ and  $x:=(x_1,...,x_n)\in\affn^n$.
	Let $I_x:=(X_1-x_1,...,X_n-x_n)\subset \calo(\affn^n)$ so that $\tilde{\scm}_{Y,x}=I_x/I$.
	There  is an isomorphism of $K$-vector spaces
	$$
	\theta:\left\{\begin{aligned}
	I_x/I_x^2&\lrta K^n\\
	f&\longmapsto \left(\frac{\pd f}{\pd X_j}(x)\right)_{1\leq j\leq n}
	\end{aligned}\right. .
	$$
	To see this, note that $f\in I^2_x$ iff $f=\sum_{i,j}h_{ij}(X_i-x_i)(X_j-x_j)$ and thus each $f \in I_x/I_x^2$ can be expressed as
	$$
	f=\sum_{i}^n(X_i-x_i)\frac{\pd f}{\pd X_i}(x)+I_x^2.
	$$
	That means each $f$ is uniquely defined by its derivatives and this preserves scalar multiplication.
	
	Let $(f_1,...,f_m)$ be a generating set of $I$. Then $(\theta(f_1),...,\theta(f_m))$ are the columns of $J_{\underline{f}}(x)$ and for any $f\in I$ we can write
	$$
	f=\sum_j g_j f_j
	$$
	for some $g_j \in K[X]$. Thus
	$$
	\frac{\pd f}{\pd X_i}(x)=\sum^n_{j=1} g_j(x)\frac{\pd f_j}{\pd X_i}(x).
	$$
	In vector notation this is
	$$
	\theta(f)_i=\sum^n_{j=1} g_j(x) \theta(f_j)_i .
	$$
	We conclude that the span of the $\theta(f_j)$ is $\theta((I+I_x^2)/I_x^2)$, so 
	$$
	rank\  J_{\underline{f}}(x)=\dim_K\theta((I+I_x^2)/I_x^2) = \dim_K (I+I_x^2)/I_x^2 .
	$$
	Consider the short exact sequence
	$$
	0 \lrta (I +I_x^2)/I_x^2  \lrta I_x/I_x^2 \lrta I_x/(I+I_x^2)  \lrta 0 .
	$$
	From this we see that 
	$$ rank \ J_{\underline{f}}(x) + \dim_K  I_x/(I+I_x^2) = \dim_K I_x/I_x^2 .$$  
	We already established that the RHS is $n$ hence $x$ is non-singular iff 
	$d=\dim_K I_x/(I+I_x^2)$. 
	
	Consider 
	$$
	\begin{tikzcd}
	I_x \arrow[r] \arrow[rr, "\varphi"', bend right] & \tilde{\scm}_{Y,x}\subset \scm_{Y,x} \arrow[r] & \scm_{Y,x}/\scm_{Y,x}^2
	\end{tikzcd}
	$$
	Note $\varphi(I+I_x^2)=0$ so we get a $K$-linear map 
	$$
	I_x/(I+I_x^2)\lrta \scm_{Y,x}/\scm_{Y,x}^2
	$$
	\underline{Claim}: This is an isomorphism $[\Lrta$ the theorem].  
	(a) $\varphi$ is surjective: 
	$h\in \scm_{Y,x}\subset \calo_{Y,x}\subset K(Y)$, $\Lrta h=\frac{h_1}{h_2}$, with $h_1, h_2\in\calo(Y)$ and $h_2(x)\neq 0, h_1(x)=0$. Then $$
	h-\frac{h_1}{h_2(x)}=h_1\left(\frac{h_2(x)-h_2}{h_2(x)h_2}\right)\in\scm_{Y,x}^2$$
	$$
	\Lrta [h]=\varphi\left(\frac{h_1}{h_2(x)}\right),
	$$
	where $\frac{h_1}{h_2(x)}\in I_x$, so $\varphi$ is surjective.
	
	(b) $\ker(\varphi)=I+I_x^2\subset I_x$ (Intuitively, the restriction of $f$ on $Y$ vanishes to order $2$ ar $x$). 
	
	\underline{Precisely}: 
	$$
	\calo_{Y,x}=(\calo(\affn^n)/I)_{I_x/I}=\calo(\affn^n)_{I_x}/I\calo(\affn^n)_{I_x}
	$$
	the last equality from commutative algebra. $\varphi(f)=0$ means that $f\mod I$ belongs to $(I_x^2)_{I_x}$ which is an ideal in $\calo(\affn^n)_{I_x}$ generated by $I_x^2$
	$$
	f\mod I=\sum_{i,j}(X_i-x_i)(X_j-x_j)h_{ij}
	$$
	$\theta(f\mod I)=0\Lrta f\in I+I_x^2$.
\end{proof}

\begin{thm}
Let $Y\subset \affn^n$ affine variety. Then $Y^\circ =\{x\in Y\mid Y\text{ non-singular at } x\}$  is dense open subset.
\end{thm}
\begin{cor}
Any variety $Y$ is birational to a non-singular variety.
\end{cor}
\begin{proof}
(of theorem)\\
Let $S=Y-Y^\circ=\{\text{ singular points }\}$. Then we know

$(1)$ $S$ is closed in $Y$, indeed fixing $(f_1,...,f_m)$ generating $I(Y)$
$$
S=\{x\mid rank\  J_{\underline{f}}(x)\neq n-d\} 
$$
One can show that $rank\ J_{\underline{f}}(x\leq n-d)$. So
$$
\begin{aligned}
S&=\{x\mid rank\  J_{\underline{f}}(x)< n-d\}\\
&=\{x\in Y\mid \text{ for all minors $M$ of $J_{\underline{f}}$ of size $n-d$ are degenerate $\det (M)=0$.}\}
\end{aligned}
$$
is a closed algebraic set in $\affn^n$.

$(b)$, $S\neq Y(\Lrta Y^\circ\neq \emptyset$ and open, so is dense). 

If $S=Y$, then by the theorem of Zariski, the set of non-singular points in an open set of a hypersurface birational to $Y$ would be empty. This means that we may assume $Y=V(f)\subset \affn^{d+1}$ with $f$ non-zero irreducible.
 Then 
 $$
V(f)\supset S=\left\{x\in \affn^{d+1}|0=f(x=\frac{\pd f}{x_1}(x)=...=\frac{\pd f}{x_d}(x)\right\}
 $$
 so if $S=V(f)$, $\frac{\pd f}{\pd x_1}\in I(V(f))=f\calo(\affn^{d+1})=f K[X_1,..,X_{d+1}]$
 $$
\Lrta \text{ in char }=0, \text{ comparing degrees, we have contradiction}
 $$
 $\Lrta$ in chat $p\neq 0$, we get $\frac{\pd f}{\pd x_i}=0$ for $1\leq i\leq d$,
 $\Lrta f\in K[x_1^p,..,X_d^{p}]\Lrta f=g^p$, contradicting the irreducibility.
\end{proof}
\section{Schemes}
In this chapter we will mainly follow chap 2 of Hartshorne and chap 1 of Eisenbud-Harris.
\subsection{Mar 13th-B: Affine schemes}
\subsubsection*{Motivations}
Serious problems with classical approach occurred in late 1950's
\begin{enumerate}[label=(\arabic*)]
\item Intrinsic definitions (Without embeddings in $\affn^n$ or $\proj^n$)
\item Construction of various algebraic varieties especially Jacobian variety of a curve, especially w.r.t. base field (is the Jacobian of a curve given by equation with coefficients in the same field?)
\item Reduction modulo $p$ of a variety given by equation in $\intg[X_1,..,X_n]$
\end{enumerate}
To attack $(1)$, Serre started from
$$
\begin{aligned}
\left\{\text{alg. set }Y\subset \affn^n \right\}&\llrta \left\{\text{fin.gen. reduced $K$-algebra}\right\}\\
Y&\mapsto \calo(Y)\\
\{\text{maximal ideals in $A$}\}&\mapsfrom A.
\end{aligned}
$$

Grothendieck tried to remove the restriction on the algebras and managed to interpret it geometrically.
$$
\begin{aligned}
\left\{\text{affine schemes }\right\}&\llrta \left\{\text{all commutative rings.}\right\}\\
\end{aligned}
$$

To each ring $A$, we will associate a geometric object called its \textbf{spectrum} denoted $\spec(A)$.

(1) $\spec A$ is a set. 
$\spec A\neq \{\text{ maximal ideals }\}$ because this choice is not functorial. If $A_1\overset{f}{\lrta} A_2$, we want $\spec(A_2)\overset{f^*}\spec(A_1)$ which would have to be $f^*(\scm)=f^{-1}(\scm)\subset A_1$. But $f^{-1}(\scm)$ is \underline{NOT} necessarily maximal.
\begin{ex}
$A$ is an integral domain
$$
\{0\}\subset A\inj Frac(A)\supset\{0\}\text{ maximal }
$$
\end{ex}
\begin{dfn}
$\spec A:=\{\text{ prime ideals $\scp\subset A$ }\}$
\end{dfn}

\underline{Fact}: If $f: A_1\lrta A_2$ is a ring morphism then $\scp\mapsto f^{-1}\scp$ gives map of sets
$$
\spec A_2\lrta \spec A_1
$$
\begin{proof}
$$A_1\overset{f}{\lrta}A_2/\scp$$
$$f^{-1}\scp\mapsto 0$$
 leads to an injective map
 $$
A_1/f^{-1}\scp\inj A_2/\scp
$$, then $A/f^{-1}\scp$ is an integral domain and $f^*(\scp)$ is therefore a prime ideal.
\end{proof}

\begin{dfn}
If $\scp\in\spec A$. the fraction field of $A/\scp$ is called the residue field at $\scp$, denoted $\kappa(\scp)$. 
\end{dfn}
If $a\in A$, then $a$ defines a function
$\tilde{a}:\spec A\lrta\coprod_{\scp\in \spec(A)}\kappa(\scp)$, $\scp\mapsto a\mod \scp$


(2) $\spec A$ as a topological space
\begin{dfn}
For any set $S\subset A$, let $V(S)=\{\scp\in\spec(A)|S\subset \scp\}$:
\end{dfn}
\underline{Note}: 
\begin{enumerate}[label=(\arabic*)]
\item $V(S)=V(\text{ ideals generated by $S$ })$
\item Not always true that $V(S)=V(\text{ finitely many elements})$
\item $V(S)=\{\scp\in\spec A|\forall x\in S, \tilde{x}(\scp)=0\in\kappa(\scp)\}$
\end{enumerate}

\begin{lemma}\ 
\begin{enumerate}[label=(\arabic*)]
\item The sets $V(I)$, $I$ ideal in $A$, from  the closed set s of a topology on $\spec A$ (called the Zariski topology).
\item $V(I)\subset V(J)\Llrta \sqrt{J}\subset \sqrt{I}$
\item If $f: A_1\lrta A_2$ is a ring morphism, then 
$$
f^*:\spec(A_2)\lrta \spec(A_1)
$$
is continuous.
\end{enumerate}
\end{lemma}
\begin{proof}
(1) $\emptyset =V(A)=V(\{1\})$ $\spec A=V(\{0\})$.
$$
\begin{aligned}
\cap_{i\in X}V(I_i)&=\{\scp\in \spec(A)|I_i\subset \scp\text{ for every $i$}\}\\
&=\{\scp\in \spec(A)|\sum I_i\subset \scp\}\\
&= V\left(\sum_{i\in X}I_i\right)
\end{aligned}
$$
$$
\begin{aligned}
V(I)\cup V(J)&=\{\scp\in\spec (A)|I\subset \scp\text{  or } J\subset \scp\}\\
&=\{\scp\in\spec A|I J\subset \scp\}(\text{because $\scp$ prime})\\
&=V(IJ)
\end{aligned}
$$

(2) recall the definition of radicals of an ideal 
$$
\begin{aligned}
\sqrt{I}&:=\{x\in A|\exists k\geq 0, x^k\in I\}
&=\cap_{I\subset \scp,\scp\in\spec A}\scp\\
&=\cap_{\scp \in V(I)}\scp
\end{aligned}
$$
then if $V(J)\subset V(I)$, we get $\sqrt{I}\subset \sqrt{J}$.

Conversely, if $\sqrt{I}\subset \sqrt{J}$ then for $\scp\in V(J)$, then
$I\subset \sqrt{I}\subset\sqrt{J}\subset \scp\Lrta \scp\in V(I)$.

(3)
\end{proof}

\subsection{Mar 16th: Affine schemes, examples and properties.}
Recall

$A$ is a ring with unity
$\spec A=\{\text{ prime ideals in $A$}\}$

closed sets: for a subset $S\subset A$,
$V(S)=V(I:=\text{ ideal generated by $S$})$ $=\{\scp|I\subset \scp\}$

If $A\overset{f}{\lrta} B$ is a ring morphism, then $f^*:\spec(B)\lrta \spec (A)$: $\scp\mapsto f^{-1}(\scp)$ is continuous.

Indeed, let $V(I)\subset \spec A$ be closed,, then $(f^{*})^{-1}(V(I))=\{\scp\in\spec (B)|f^*(\scp)\in V(I)\}=\{\scp\in\spec B|I\subset f^{-1}\scp\}=\{\scp \in \spec B\mid f(I)\subset \scp\}$, therefore
$$
(f^{*})^{-1}V_A(I)=V_B(f(I))
$$

\section*{Examples of $\spec A$}
\begin{ex}
$\spec (\{0\})=\emptyset$

By definition, this is the only ring with $\spec A$ empty.
\end{ex}

\begin{ex}\label{ex:K-algebra}
$K$ algebraically closed field, $\emptyset\neq Y\subset K^n$ affine algebraic set. The corresponding  affine scheme is 
$$
Y^{sc}
=\spec (\calo(Y))$$
in other words
$$
Y^{sc}=\spec (K[X_1,...,X_n]/I(Y)=:A)
$$
Maximal ideals of $\calo(Y)$ are in bijection with points of $Y$ by 
$$
x\mapsto \scm_x=\{f\in\calo(Y|f(x)=0\}
$$
so we get an injective map
$$
Y\overset{\varphi}{\lrta} Y^{sc}
$$
$$
x\longmapsto \scm_x
$$
This map $\varphi$ is continuous.

Let $V(I)\subset Y^{sc}$ be closed and $I\subset \calo(Y)$.
$$
\begin{aligned}
&\varphi^{-1}(V(I))\\
&=\{x\in Y\mid \scm_x\in V(I)\}\\
&=\{x\in Y\mid I\subset\scm_x\}\\
&=\{x\in Y\mid \forall f\in I, f(x)=0\}
\end{aligned}
$$
is a closed algebraic set in $K^n$.

Observe: for every $x\in Y$, the residue field of $\scm_x$ is $A/\scm_x \cong K$ where the function associated to $f\in A$ is given by 
$$
\tilde{f}(\scm_x)=f(x).
$$

The following are equivalent
\begin{enumerate}
\item $Y\overset{\varphi}{\lrta} Y^{sc}$ is surjective
\item every prime ideal in $\calo(Y)$ is maximal
\item $\dim \calo(Y) = 0$.
\end{enumerate}
Consider the case $Y=K$ and $Y^{sc}=\spec (K[X])$ with $\dim Y=1$.
$K[X]$ is a principal ideal domain and $K$ is algebraically closed.
$$
Y^{sc}=\{(X-x)|x\in K\}\cup \{0\}
$$
where $\eta:=\{0\}$ is called the generic point of $Y^{sc}$.

\underline{Claim}: $\{\eta\}$ is not closed in $Y^{sc}$, in fact it is dense
$$
\overline{\{\eta\}}=Y^{sc}.
$$
\end{ex}

\begin{ex}
More generally, Let $A$ be an integral domain and $\eta=\eta_A=\{0\}\in\spec A$.

\underline{Claim}: 
$$
\overline{\{\eta\}}=\spec A
$$

Let $\scp\in\spec A$.
$$
\begin{aligned}
\overline{\{\scp\}}&=\bigcap_{\scp\in V(I)}V(I)\\
&=\bigcap_{I\subset \scp}V(I)\\
&=V(\sum_{I\subset\scp} I )=V(\scp)
\end{aligned}
$$
$$
\overline{\{\scp\}}=V(\scp)=\{Q\in\spec(A)|\scp\in Q\}
$$
So:
\begin{enumerate}
\item $\overline{\{\eta_A\}}=\spec A$ if $A$ is an integral domain.
\item $\{\scp\}$ is closed iff $\scp$ is maximal.
\end{enumerate}
\end{ex}

\begin{dfn}
If $\scp\in\overline{\{Q\}}$, we say that $\scp$ is a \textbf{specialization} of $Q$, and that $Q$ \textbf{specializes to} $\scp$.
\end{dfn}

\begin{ex}
Any point is a specialization of $\eta_A$ if $A$ is integral domain. What is $\kappa(\eta_A)$?
$$
A/\{0\}=A
$$
so $\kappa(\eta_A)=Frac(A)$
\end{ex}

Back to the Example \ref{ex:K-algebra}

$Y=K$, $Y^{sc}=\spec (K[X])$, $\eta=\{0\}$ is dense in $Y^{sc}$, its residue field is $K(X)$.

\begin{rmk}
If $f_1,f_2\in K[X]$ are such that they coincide at $\eta$;
$$
\tilde{f}_1(\eta)=\tilde{f}_2(\eta)
$$
then in fact $  f_1=f_2$ in $K[X]$.
\end{rmk}

We will often encounter situations like ``A property holds at $\eta$ $\Lrta$ it holds at for all $x$ in an open set''

\begin{ex}
$A$ is an integral domain. Any $\emptyset \neq U$ open set in $\spec A$ is dense:
$$
U\cap \{\eta\}\neq \emptyset
$$
so $\eta\in U$, $\Lrta \overline{\{\eta\}}=\overline{U}$
\end{ex}

\begin{ex}
The Zariski topology is \textbf{quasi-compact}: any open covering has a finite subcover. Indeed, suppose
$$
\begin{aligned}
&\bigcap_\alpha V(I_\alpha)=\emptyset\\
\Llrta & V(\sum_\alpha I_\alpha)=\emptyset=V(A)\\
\Llrta & 1\in \sum_\alpha I_\alpha\\
\Llrta & 1=\sum_{j=1}^{m} f_{\alpha_j}, f_{\alpha_j}\in I_{\alpha_j}\\
\Llrta & V(\sum_j I_{\alpha_j})=\emptyset\\
\Llrta & \bigcap_j V(I_{\alpha_j})=\emptyset
\end{aligned}
$$
\end{ex}
\begin{ex}
For any $I\subset A$, $A\overset{\pi}{\lrta} A/I$ induces 
$$
\spec (A/I)\overset{\pi^*}{\lrta}\spec A
$$
which  gives homeomorphism 
$$
\spec (A/I)\cong V(I).
$$
\end{ex}

\begin{ex}
$K$ is a field, not necessarily algebraically closed. Let $J\subset K[X_1,..,X_n]$ be an ideal and $Y=\spec (K[X_1,...,X_n]/J)$. (Want to understand in particular the relation with the case $K$ is algebraically closed.) Fix $L \supset K$  where $L$  is algebraically closed Then we get an injective ring morphism 
$$
K[X]/J\lrta L[X]/JL[X]
$$
hence a map
$$
Y_L:=\spec(L[X]/JL[X])\lrta Y,
$$
where $\spec(L[X]/JL[X])$ is a classical algebraic set (if $J$ is prime).

Take
$Y=\spec (K{X})=\affn^1_K$.

\begin{dfn}
	Let $A$ be any ring. The \textbf{affine $n$-space} $\affn^n_A$ over $A$ is $\spec A[X_1,...,X_n]$.
\end{dfn}
	
	


What is $\affn^1_L\lrta \affn^1_K$?
$$
\begin{aligned}
\affn^1_K&=\{\scp\subset K[X]\text{ prime}\}\\
&=\{0\} \cup \{fK[X]\mid f \text{ irreducible and monic}\}
\end{aligned}
$$
\underline{Check}: the Zariski topology has  closed sets $\emptyset$, $\affn^1_K$, finite sets of closed points. Given $i: K[X]\inj L[X]$, what is 
$\affn^1_L\overset{i^*}{\lrta }\affn^1_K$? We have that
$$
\begin{aligned}
i^*(\eta_L)&=i^{-1}(\{0\})\\
&= \eta_K
\end{aligned}
$$
which means the image of $i^*$ us dense.

Let $x\in L$
$$\begin{aligned}
&i^*(X-x)L[X]\\
&=i^{-1}((X-x)L[X])\\
&=\{f\in K[X]\mid (X-x)|f\text{ in } L[X]\}\\
&=\{f\in K[X]\mid f(x)=0\}
\end{aligned}
$$
\underline{Case 1}: $x$ is transcendental over $K$ 
$$
\Llrta i^*(x)=\{0\}=\eta_K
$$
\underline{Case 2}: $x$ is algebraic over $K$
$$
i^*(x)=f_x
$$
 where $f_x$ is the minimal polynomial $x$ over $K$.

 Observe that $i^*$ is not injective more precisely,
 $$
(i^*)^{-1}(f)=\{\text{ roots of $f$ in $L$}\}
 $$
 where $f$ is irreducible monic.
\end{ex}

\begin{ex}
Given $A,B$ integral domain 
$A\overset{f}{\lrta} B$ is injective iff
$$
f^{*}(\spec B)\subset \spec A
$$ is  dense. The proof is left as an exercise.

\end{ex}

\begin{ex}
$K=\overline{K}$, 

$Y^{sc}$ for $Y=\{(x,y)\in K^2 \mid (xy)=0\}$. ($Y$ is not a variety in this case.)
$$
\affn^2_K\supset V(xy)\cong Y^{sc}=\spec(K[X,Y]/(XY))
$$
Check the points of $Y^{sc}$ are
\begin{align*}
h_x & = \lgl (X-x), Y\rgl\subset K[X,Y]/(XY) \\
v_y & =\lgl X, (Y-y)\rgl
\end{align*}
because $XY=(X-x)Y+xY$.
$h_x$ and $v_y$ are closed points with residue field $K$.  Let
\begin{align*}
\eta_1 & =X K[X,Y]/(XY) \\
\eta_2 & =YK[X,Y]/(XY).
\end{align*}
We have $\{0\}\notin \spec (K[X,Y]/(XY))$ because the ring is not an integral domain.
$$
\begin{aligned}
\overline{\{\eta_1\}}&=\{\eta_1\}\cup \{\scm \text{ maximal s.t. } X\subset \scm\}\\
&=\{\eta_1\}\cup \{v_y \mid y\in K\}.
\end{aligned}
$$
Similarly, we have
$$
\overline{\{\eta_2\}}=\{\eta_2\}\cup\{h_x \mid x\in K\}.
$$
Note $v_0=h_0$ is a specialization of both $\eta_1$ and $\eta_2$.
\end{ex}

\begin{ex}
For  $K=\overline{K}$ consider
 $$\affn^2_K=\{(x, y) \mid (x,y)\in K^2\} \cup \{\eta\}\cup \{fK[X,Y] \mid f \text{ irreducible monic}\}$$ 
 where we identify the maximal ideals $(X-x, Y-y)$ in $K[X,Y]$ with points $(x,y)$. 
Note that prime ideals of height $1$ are principal in a UFD.
$$
\overline{\{fK[X,Y]\}}=\{f K[X,Y]\}\cup \{(x,y)\in K^2|f(x,y)=0\}
$$
For this reason, we denote $\{fK[X,Y]\}$ by $\eta_f$ because it is the generic point of $V(f)$.
\begin{align*}
\overline{\{\eta_f\}} & =\eta_f\cup \text{ classical points on } C_f \\
\kappa(\eta_f) & =K[X,Y]/fK[X,Y]=\kappa(C_f) 
\end{align*}
where $C_f$ is the classical curve.
$\eta_f$ specializes to the point $(x,y)$ on $C_f$.

\end{ex}

\subsection{Mar 20th: }

\begin{ex}
$A=\intg$, $\spec A=\{0\}\cup \{p\intg|p\text{ prime number}\}$.
Recall $\dim (\intg)=1$, with residue fields 
$$
\left\{\begin{aligned}
&K(\eta)=\ratl\\
&K(p\intg)=\intg/p\intg=\bbf_p, \text{  finite field }
\end{aligned}\right.
$$
A statement like `` property  $P$ is true at $\eta$'' $\Lrta $`` It is true on any open set'' means ``a property $P$ true for $\ratl$ is also true for $\mod p$ for $p$ large enough.''

(Topology has closed sets $\emptyset, \spec \intg, V(n\intg)=\{p\intg: p\textbf{ divides }n\}$, where $V(n\intg)$ is a finite set of closed points.)

$$
\intg\lrta \bbf_p\llrta \begin{aligned}
&\spec (\bbf_p)\inj \spec (\intg)\\
& \{0\}\in\bbf_p\mapsto  p\intg
\end{aligned}
$$
$$
\intg\overset{i}{\inj} \ratl\llrta \begin{aligned}
&\spec (\bbf_p)\overset{i^*}{\lrta} \spec (\intg)\\
& \{0\}\in\bbf_p\mapsto  \eta
\end{aligned}.
$$
In particular, the image of $i^*$ is dense in $\spec \intg$.
\end{ex}
\section*{structure sheaf}

Note recall we want
$$
\{\text{affine schemes}\}\llrta \{\text{ commutative rings}\}
$$
$$
\spec A\mapsfrom A
$$
$$
f^*\mapsfrom f
$$
This is functorial but cannot capture the whole category of rings because for instance all rings
$$
A=K[X]/(X^n), n\geq 1
$$
($K$ is a field). We have $\spec A=\{XK[X]\}$, independent of $K$ and $n$. We need to remember what is $K$ and  what is $n$.

We deal with that by defining ``regular functions''
\begin{dfn}
$A$ is a ring. For $U\subset \spec A$ open, we define the ring $\calo(U)$ of ``regular functions on $U$'' by 
$$
\calo(U)=\left.\left\{s:U\lrta \bigsqcup_{\scp\in U}A_\scp\right| \begin{aligned}
& \text{(1) $s(\scp)\in A_\scp$ for $\scp \in U$}\\
&\text{(2)} \forall \scp\in U, \exists V \text{ open  nbhd of } \scp \text{ in } U\\
& \text{ and } a\in A, f\in A, \text{ s.t.} \forall \scq\in V, f\notin \scq, \text{ and } s(\scq)=a/f\in A_\scq
\end{aligned}\right\}
$$
\end{dfn}
Note: if $V\subset U$ open then $s\mapsto s|_V$ is a ring morphism $res^U_V:\calo(U)\lrta \calo(V)$ and $res^U_V=id_{\calo(U)}$. Then the pair $\left((\calo(U))_{U\in\spec A}, (res^U_V)_{U,V\in \spec A}\right)$ is a \textbf{ sheaf of rings } on $\spec A$. 
\begin{dfn}
$X$ is a topological space, $\calc$ a category,
\begin{enumerate}[label=(\arabic*)]
\item A \textbf{$\calc$-presheaf} is sthe data of 
\begin{enumerate}[label=(\alph*)]
\item For every open set $U\subset X$, an object $\calf(U)=\Gamma(U,\calf)$ in $\calc$.
\item For every $V\subset U$ opens in $X$, a $\calc$-morphism $res^U_V: \calf(U)\lrta \calf(V)$
\end{enumerate}
such that given $U$ opens in $X$.
\begin{enumerate}[label=(\roman*)]
\item $res^U_U=id_{\calf(U)}$
\item Given $W\subset V\subset \subset U$ opens in $X$
$$
res^U_W=res^V_W\circ res^U_V
$$
\underline{Notation:} $res^U_V(s)=s|_V$
\end{enumerate}

\item A $\calc$-presheaf is a \textbf{$\calc$-sheaf} if: for any $U\subset X$ open, for every open covering $U=\cup_\alpha V_\alpha$, for any family $(s_\alpha)_\alpha$ with $s_\alpha\in \calf(V_\alpha)$ such that $s_\alpha|_{V_\alpha\cap V_\beta}=s_{\beta}|_{V_\alpha\cap V_\beta}$, there is a unique $s\in \calf(U)$ with $s|_{V_\alpha}=s_\alpha$.
\end{enumerate}
\end{dfn}
\begin{exercise}
Check that the sheaf of regular functions is indeed a sheaf.
\end{exercise}
\begin{dfn}
$A$ a ring. The \textbf{affine scheme} associated to $A$ is $(\spec A,\calo)$ where the first data is endowed with Zariski's topology and the $\calo$ is the structure sheaf.
\end{dfn}

\begin{ex}
$K$ a field, $\spec K=\{\eta\}$
$$
\left\{
\begin{aligned}
&\calo(\spec K)=\{s:\eta\lrta K_{\{0\}}=K,\ (\text{ i.e. } s(\eta)\in K)\} \\
&\calo(\emptyset)=\{0\}
\end{aligned}
\right.
$$
Different K gives different affine schemes.
\end{ex}

\begin{prop}
For $f\in A$, define $U_f=\{\scp\in \spec A|f\notin \scp\}$
\begin{enumerate}[label=(\arabic*)]
	\item $U_f$ is a open ``basic open sets''
	\item We have a canonical isomorphism
	$$
	\left\{
	\begin{aligned}
	& A_f\overset{\psi}{\lrta}\calo(U_f)\\
	& a/f^m\longmapsto (s:\scp\in U_f\mapsto \frac{a}{f^m}\in A_\scp)
	\end{aligned}
	\right.
	$$
\end{enumerate}
In particular, for $f=1$, we get a canonical isomorphism
$$
A=A_1\overset{\sim}{\lrta}\Gamma(\spec A,\calo)
$$
$\Lrta$ the affine scheme of $A$ allows you to recover $A$.
\end{prop}
\begin{proof}
(injectivity)

Suppose $\psi\left(\frac{a}{f^m}\right)=0$. This means that 
$$
\forall \scp\in U_f, \frac{a}{f^m}=\frac{0}{1}\in A_\scp
$$
$\Llrta \forall \scp\in U_f$, $\exists h_\scp\notin \scp,$ $ha=0$. Let $I=\{x\in A|xa=0\}$. $I$ is an ideal and $I\notsubset \scp$ for any $\scp \in U_f$

$\Lrta V(I)\cap U_f=\emptyset$

$\Lrta V(I)\subset V(f)$

$\sqrt{(f)}\subset \sqrt{I}$

$f\in \sqrt{(f)}\in\sqrt{I}$

$\exists k\geq 0, f^ka=0\Lrta a/f^m=0\in A_f$

(Surjectivity): We need the following lemma
\begin{lemma}\ 
\begin{enumerate}[label=(\arabic*)]
\item $U_{f_1}\cap U_{f_2}=U_{f_1f_2}$
\item $U_{f^n}=U_{f}, V(f^n)=V(f)$
\item $U_f$ is quasicompact
\item The open sets $U_f$ forms a basis of the Zariski topology.
\end{enumerate}
\end{lemma}
Consider $\psi:A_f\lrta \calo(U_f)$, let $s\in \calo(U_f)$.

By definition there exists an open covering of $U_f$, $U_f=\bigcup_\alpha V_\alpha$, and elements $a_\alpha, g_\alpha$ such that $\forall \scp\in V_\alpha$, $s(\scp)=\frac{a_\alpha}{g_\alpha}, g_\alpha\notin \scp$.

Using the above lemma,  we may assume  there are finitely many $V_\alpha$ and $V_\alpha=U_{h_\alpha}$.

\underline{Observe}: $\forall \scp\in U_{h_\alpha}=V_\alpha$, $g_\alpha\notin\scp\Llrta \scp\in U_{g_\alpha}$
$$
\begin{aligned}
&U_{h_\alpha}\subset V_{g_\alpha}\\
& \Lrta V(g_\alpha)\subset V(h_\alpha)\\
&\Lrta \sqrt{(h_\alpha)}\subset \sqrt{(g_\alpha)}\\
&\Lrta \exists n_\alpha, h^{n_\alpha}_{\alpha}\in (g_{\alpha})
\end{aligned}
$$
So $h^{n_\alpha}_\alpha=c_\alpha g_\alpha$, Now for $\scp\in U_{h_\alpha}$
$$
\frac{a_\alpha}{g_\alpha}=\frac{a_\alpha c_\alpha }{g_\alpha c_\alpha}=\frac{a_\alpha c_\alpha}{h_\alpha^{n_\alpha}}\in A_\scp
$$
Replacing $a_\alpha$ by $a_\alpha c_\alpha$, $g_\alpha$ by $h^{n_\alpha}{\alpha}$, Using $U_{h_\alpha^{n_\alpha}}=U_{h_\alpha}$, we reduce to the case where $g_\alpha=h_\alpha$ for all $\alpha$.

On $U_{h_\alpha}\cap U_{h_\beta}=U_{h_\alpha h_\beta}$, we have
$$
\forall \scp \in U_{h_\alpha h_\beta}, \frac{a_\alpha}{h_\alpha}=\frac{a_\beta}{h_\beta}\text{  in } A_\scp
$$
$$
\Lrta \exists n(\alpha, \beta), (h_\alpha h_\beta)^{n(\alpha, \beta)}(a_\alpha h_\beta-h_\alpha a_\beta)=0
$$

Take $n$ to be the largest of the finite many $n(\alpha,\beta)$
$$
\Lrta(h_\alpha h_\beta)^{n}(a_\alpha h_\beta-h_\alpha a_\beta)=0
$$
$$
a_\alpha' h'_\beta-a_\beta' h_\alpha'=0
$$
where $a_\alpha'=a_\alpha h_\alpha^n$ and $h'_\alpha=h_{\alpha}^{n+1}$

Note 
$\frac{a_\alpha'}{h_\alpha'}=\frac{a_\alpha}{h_\alpha}$ in $A_\scp$ for all $\scp\in U_{h_\alpha'}=U_{h_\alpha}$.

Now
$$
\begin{aligned}
& \bigcup_\alpha U_{h_\alpha'}=U_f\\
& V(f)=V(\sum (h'_\alpha))\\
&\Lrta \sqrt{f}=\sqrt{\sum(h_\alpha')}\\
& \Lrta f^k =\sum_\alpha h_\alpha' c_\alpha\ \text{ for some } k
\end{aligned}
$$
Define 
$$
a=\sum_\alpha c_\alpha a_\alpha'\in A
$$
Fix $\beta$,
$$
a h_\beta'=\sum_\alpha c_\alpha a_\alpha' h'_\alpha=\sum_\alpha c_\alpha a_\beta' h'_\alpha
=a_\beta' f^k
$$
$$
\Lrta s(\scp)=\frac{a_\beta}{h_\beta}= \frac{a_\beta'}{h_\beta'}=\frac{a
}{f^k}
$$
in $A_\scp $ for any $\scp \in U_{h_\beta}=V_\beta$.

So $\psi(\frac{a}{f^k})|_{V_\beta}=s|_{V_\beta}$ for any $\beta$.
So $\psi(a/f^k)$ and $s$ are elements of $\calo(U_f)$ with restrictions equal on open sets forming a covering of $U_f$, by the uniqueness condition in the definition of sheaf, it follows that $\psi(a/f^k)=s$.
\end{proof}


\begin{proof}(of the lemma)
\begin{enumerate}[label=(\arabic*)]
\item $U_{f_1}\cap U_{f_2}\overset{?}{=}U_{f_1 f_2}$
$$
\begin{aligned}
V(f_1)\cup V(f_2)&=\{\scp\in \spec A|f_1\in \scp \text{ or } f_2\in\scp \}\\
&=\{\scp\in\spec A|f_1f_2\in \scp\}
\end{aligned}
$$
\item $f^n\in \scp \Llrta f\in\scp, n\geq1$
\item Suppose $V(f)\subset \cap_\alpha V(I_\alpha)\Lrta V(\sum I_\alpha)\supset V(f)\Lrta \sqrt{(f)}\subset \sqrt{\sum I_\alpha}$
\end{enumerate}
\end{proof}

\subsection{Mar 23th: Sheaves and stalks}
\begin{ex}
    \begin{enumerate}[label=(\arabic*)]
        \item 
        Let $X$ be a topological space. Then
        $$
            \underline C(U) = \{ f : U \longrightarrow \mathbb C \text{ continuous}\}
        $$
        for $U\subset X$ open is a sheaf. For $X$ a manifold we also have that
        $$
        \underline C^\infty(U) = \{ f : U \longrightarrow \mathbb C \text{ smooth}\}
        $$
        is a sheaf and lastly for $X$ a complex manifold the following is a sheaf:
        $$
        \mathcal H(U) = \{ f : U \longrightarrow U \text{ holomorphic}\}. 
        $$
        \item
        Let $X= \mathbb C^\times$. Then
        $$
        \calf(U) = \{f: U \longrightarrow \mathbb C \text{ holomorphic and } f= g^2 \text{ for some $g$ holomorphic} \}
        $$
        is a pre-sheaf but not a sheaf. A holomorphic function might have a square root locally but not on all of U.
    \end{enumerate}
\end{ex}

\begin{dfn}
    Let $\calf_1, \calf_2$ be $\calc$-pre-sheaves on $X$. A \textbf{morphism} $\calc : \calf_1 \longrightarrow \calf_2$ is a collection of morphisms $\varphi_U: \calf_1(U) \longrightarrow \calf_2(U)$ such that for any $V\subset U$ open we have a commutative square
    $$
    \begin{tikzcd}
    \calf_1(U) \arrow[r, "\varphi_U"] \arrow[d, "res^U_V \text{ for } \calf_1"'] & \calf_2(U) \arrow[d, "res^U_V \text{ for } \calf_1"] \\
    \calf_1(V) \arrow[r, "\varphi_V"] & \calf_2(V)
    \end{tikzcd}
    $$
    A morphism of sheaves we define to be the same as a morphism of pre-sheaves.
\end{dfn}
Note that $\operatorname{Id}_{\calf(U)}: \calf(U) \longrightarrow \calf(U)$ gives a morphism and that composition makes sense, i.e. we have that
$$
(\varphi \circ \psi)_U = \varphi_U \circ \psi_U.
$$ 
Thus we have now defined the category of $\calc$-pre-sheaves and sheaves.

\begin{ex}
    \begin{enumerate}[label=(\arabic*)]
        \item 
        If $X$ is a complex manifold, there are morphisms
        $$
        \mathcal H \longrightarrow \underline C^\infty \longrightarrow \underline C
        $$
        \item
        If $X\subset \reals^n$ is a manifold, then
        $$
        \left\{
        \begin{aligned}
        \underline C^\infty (U) & \longrightarrow \underline C^\infty(U) \\
        f & \longmapsto \partial f / \partial x_1
        \end{aligned}
        \right.
        $$
        is a morphism of sheaves from $\underline C^\infty \longrightarrow \underline C^\infty$.
    \end{enumerate}
\end{ex}

\begin{prop}
    Suppose $\calf$ is a $\calc$-pre-sheaf on $X$. Then there is a unique, up to unique isomorphism, morphism $\sigma: \calf\longrightarrow \calf^\sigma$, (the ``sheafification'' of $\calf$) such that for any morphism of presheaves $\varphi: \calf \longrightarrow \mathcal Y$ there is a unique $\varphi^\sigma$ such that $\varphi = \varphi^\sigma \circ \sigma$. In particular $\hom (\calf, \mathcal Y) = \hom (\calf^\sigma, \mathcal Y)$.
    $$
    \begin{tikzcd}
    \calf \arrow[r, "\varphi"] \arrow[d, "\sigma"'] & \mathcal Y  \\
    \calf^\sigma \arrow{ru}[swap]{\varphi^\sigma}
    \end{tikzcd}
    $$
    If $\calf$ is a sheaf then $\sigma$ is an isomorphism.
\end{prop}

$\calf^\sigma$ is called the sheaf associated to $\calf$. In order to prove the statement, we need another definition.

\begin{dfn}
    Suppose $\calf$ is a $\calc$-presheaf on $X$. The \textbf{stalk} of $\calf$ at $x\in X$ is 
        $$
        \calf_x := \{ (U,s) \mid x \in U\subset X \text{ open}, s \in \calf(U)\} / \sim
        $$
        with 
        $$(U_1, s_1) \sim (U_2,s_2) \quad \Longleftrightarrow \quad \exists V\subset U_1 \cap U_2 \text{ s.t. } s_1|_V = s_2|_V \text{ and } x \in V.
        $$
        This is also called the ``germs of sections of $\calf$ at $x$''.
\end{dfn}

\begin{prop}
    Let $A$ be a ring and consider $\calo_A$ on $\spec A$. Then the following morphism is an isomorphism:
    $$
    \varphi
    \left\{
    \begin{aligned}
    \calo_{A,p} & \longrightarrow A_p \\
    (U,s) & \longmapsto s(p)
    \end{aligned}
    \right.
    $$
\end{prop}

\begin{proof}
    It follows easily from the definitions that $\varphi$ is well defined. For surjectivity, let $a/f\in A_p$, $f\notin p$.  Then we can construct $s$ defined on $U_f$ such that $s(q) = a/f$ in $A_q$ for all $q \in U_f$.
    
    Next, suppose that $s(p)=0$ for some section $(U,s)$. Then we can write $s(q) = a/f$ for any $q\in V$ where $V$ is an open neighbourhood of $p$ in $V$. Since $s(p)=0$, we get $ha=0$ for some $h \notin p$. But then on $V \cap U_h$, $s\equiv 0$. 
\end{proof}

Now we get back to the construction of $\calf^\sigma$. Define
$$
\calf^\sigma(U) := \left\{ 
    s: U \longrightarrow \bigsqcup_{x \in U} \calf_x \left| 
    \begin{aligned}
    & \forall x \in U, s(x) \in \calf_x \text{ and} \\
    & \forall x \in U, \exists V \subset U \text{ open, s.t. } x\in V, \\
    & \exists t \in \calf(V) \text{ s.t. } \forall y \in V, s(y) = t_y 
    \end{aligned}
    \right\} \right.
$$
where $t_y$ denotes the equivalence class $[(V,t)]\in \calf_y$.
Moreover, define $\varphi^\sigma: \calf \longrightarrow \calf^\sigma$ by 
$$
\varphi^\sigma_U(t) = (x \longmapsto t_x)
$$
and for $s \in \calf^\sigma(U)$, $V\subset U$ let 
$$
\res_V^U(s)(y) = s(y) 
$$
for $y\in V$. Finally for a given sheaf $\mathcal Y$, let $\varphi^\sigma_U: \calf^\sigma(U) \longrightarrow \mathcal Y(U)$, such that $s$ maps to the unique $\tilde s \in \mathcal Y(U)$ such that for all $a\in U$, $V\subset U$ and $t \in \calf(V)$ such that $s(y) = t_y$ on $V$, we have $\tilde s|_V = \varphi_V(t)$. Using the sheaf property of $\mathcal Y$, we see that such an $\tilde s \in \mathcal Y(U)$ does exist.

Then $\calf^\sigma$ is a presheaf and $\sigma$ is a morphism. One checks that $\calf^\sigma$ is a sheaf (because it is defined by local conditions) and that the universal property holds.

Given $\calf$ and $\calf^\sigma$, we obtain an isomorphism for all $x$, $\sigma: \calf_x \longrightarrow \calf^\sigma_x$ by
$$
[(U,x)] \longmapsto [(U,\varphi^\sigma_U(s))].
$$

\begin{prop}
    Given sheaves $\calf_1$, $\calf_2$ on $X$ and a morphism $\varphi: \calf_1 \longrightarrow \calf_2$, $\varphi$ is an isomorphism if and only if for every $x\in X$ the induced $\varphi_x: \calf_{1,x} \longrightarrow \calf_{2,x}$, $[(U,s)] \longmapsto [(U, \varphi_U(s))]$ is an isomorphism.
\end{prop}

We omit the proof, it can be found in Hartshorne or Eisenbud.

\begin{rmk}
    \begin{enumerate}[label=(\arabic*)]
        \item 
        This only holds for sheaves not presheaves.
        \item
        The ismorphism $\varphi_x$ need to come from a ``global'' map $\varphi: \calf_1 \longrightarrow \calf_2$.
        \item
        One checks that $\varphi: \calf_1 \longrightarrow \calf_2$ is and isomorphism iff $\varphi_U: \calf_1(U) \longrightarrow \calf_2(U)$ are all isomorphisms. One can define $\varphi$ to be injective if $\varphi_U$ is injective for all $U$. However, the correct definition of surjectivity for $\varphi$ is not equivalent to saying that $\varphi_U$ is surjective for all $U$.
    \end{enumerate}
\end{rmk}

\begin{dfn/thm}
    Let $X,Y$ be topological spaces and $f_X\longrightarrow Y$ be continuous, $\calc$ be a category and $\calf$ be a $\calc$-presheaf on $X$. Define $(f_* \calf)(U)=\calf (f^{-1}(U))$ and $\res_V^U = \res_{f^{-1}(V)}^{f^{-1}(U)}$. Then $f_*\calf$ is a $\calc$-presheaf and is a sheaf is $\calf$ is one.
    $f_*\calf$ is called the \textbf{direct image of $\calf$ on $Y$}.
\end{dfn/thm}

\begin{proof}
    We check that $f_*\calf$ is a sheaf. Let $U\subset Y$ be open, $U \bigcup U_\alpha$ be and open cover for $U$ and let $s_\alpha \in (f_* \calf)(U_\alpha)$ be such that 
    $$
    s_\alpha|U_\alpha\cap U_\beta = s_\beta|U_\alpha \cap U_\beta.
    $$
    Then $s_\alpha \in \calf(f^{-1}(U_\alpha))$ and
    $$
    s_\alpha|f^{-1}(U_\alpha)\cap f^{-1}(U_\beta) = s_\beta|f^{-1}(U_\alpha) \cap f^{-1}(U_\beta).
    $$
    Since $f^{-1}(U) = \bigcup f^{-1}(U_\alpha)$ and $\calf$ is a sheaf, there is a unique $s\in\calf(f^{-1}(U))$ such that $s|f^{-1}(U_\alpha) = s_\alpha$. Hence $s \in (f_*\calf)(U)$, $s|U_\alpha = s_\alpha$. The uniqueness follows from the same kind reasoning.
\end{proof}

\subsection{Mar 27th: Morphism of schemes}
Recall: $\spec A$, Zariski topology $\calo_A$ structure sheaf.

\underline{Observe}: 
$f:A\lrta B$ ring morphism and 
$$
\begin{aligned}
\tilde{f}:&\spec B\lrta \spec A\\
& \scp\longmapsto f^{-1}(\scp)
\end{aligned}
$$
we also get, (Recall $f_*\calf(U)=\calf(f^{-1}(U)))$
$$
\begin{aligned}
\calo(A) &\overset{f^*}{\lrta}  \tilde{f}_*\calo_B \\
\forall U\subset \spec A, &\calo_A(U)\lrta \tilde{f}_*\calo_B(U)=\calo_B(f^{-1}(U))
\end{aligned}
$$
is defined as follows:

To $s\in \calo_A(U), s:U\lrta \sqcup_{\scp\in U}A_\scp$, such that....\\
we associated $t:f^{-1}(U)\lrta \sqcup_{Q\in\tilde{f}^{-1}(U)}B_Q$  such that ...\\
defined 
$$
t(Q)=f(s(\tilde{f}(Q))), \ \ s(\tilde{f}(Q))\in A_{\tilde{f}(Q)}
$$
where $f(a/b)=f(a)/f(b)$.
$$\begin{aligned}
f:&A_{f^{-1}(Q)}\lrta B_Q\\
& \frac{a}{b}\longmapsto \frac{f(a)}{f(b)}
\end{aligned}
$$
One checks that $t\in\calo_B(f^{-1}(U))$ if $s\in \calo_A(U)$. IN other words: $f:A\lrta B$ gives 
$$
(\tilde{f},f^*): (\spec B,\calo_B)\lrta (\spec A,\calo_A)
$$
\begin{dfn}
A \textbf{ringed space} is $(X\calo_X)$, where $X$ is a topological space and $\calo_X$ is a sheaf of rings  on $X$. A \textbf{locally ringed space} is a ringed space where $\calo_{X,x}$ is a local ring for all $x\in X$. (e.g. $\calo_{A,\scp}=A_\scp$, where $A_\scp$ is a local ring with unique maximal ideal $\scp A_\scp$).

A morphism of ringed space $f:(X,\calo_X)\lrta (Y,\calo_Y)$ is a pair
$$
(f,f^*):\left\{\begin{aligned}
&f:X\lrta Y \ \text{  morphism of topological spaces}\\ 
& f^*:\calo_Y\lrta f_*\calo_X\ \text{ morphism of sheaves}
\end{aligned}
\right.
$$ 
\end{dfn}
Ringed space form a category $Id_{(X,\calo_X)}=(Id_X,Id_{\calo_x})$ and 
$$
\left\{\begin{aligned}
& X\overset{f}{\lrta }&Y\overset{g}{\lrta} Z\\
& \calo_Y\overset{f^*}{\rta}f_*\calo_X&\\
&& \calo_Z\overset{g^*}{\lrta}g_*\calo_Y,
\end{aligned}\right.
$$
has composition
$$
(g\circ g,g_*(f^*)\circ g^*)
$$
where $g_*(f^*)$ is the direct image $\calf\lrta g_*\calf$ is a functor from (pre)sheaves on $Y$ to sheaves on $Z$
.
(Any morphism of sheaves $\varphi:\calf_1\lrta \calf_2$ gives a morphism $g_*\calf_1\lrta g_*\calf_2$)

A morphism of locally ringed space $(X,\calo_X)\lrta (Y,\calo_Y)$
 is $(f,f^*)$ $f:X\lrta Y$ is continuous and $\calo_Y\overset{f^*}{\lrta}f_*\calo_X$ such that $f^*$ induces for each $x\in X$ a \underline{local} morphism 
$\calo_{Y,f(x)}\lrta\calo_{X,x}$.

Recall that $A,B$ are local rings. $f: A\lrta B$ is \underline{local} iff $f^{-1}(\scm_B)=\scm_A$. 

\underline{Note}: $f^{-1}(\scm_B)\subset \scm_A$ because if $f(a)\in \scm_B$ $a\notin A^\times\Lrta a\in \scm_A$. So the condition to be local is 
$$
\scm_A\subset f^{-1}(\scm_B)\Llrta f(\scm_A)\subset \scm_B
$$

\begin{dfn}
If $\calo_{Y,f(x)}\lrta \calo_{X,x}$ $f^*$ gives  morphisms 
$$
\calo_Y(U)\overset{f^*_U}{\lrta}\calo_X(f^{-1}(U))
$$
for every $y\in Y$
$$
\calo_{Y,y}\lrta (f_*\calo_X)_y
$$
$$
[(U,s)]\longmapsto [(U,f^*_U(s))].
$$
Take $y=f(x):$
$$
\begin{aligned}
&\calo_{Y,f(x)}\lrta (f_*\calo_X)_{f(x)}\lrta \calo_{X,x}\\
& [(U,s)]\longmapsto [(U,f^*_U(s))]\longmapsto[f^{-1}(U),f^*_U(s)]
\end{aligned}
$$
is the desired morphism.
\end{dfn}
\begin{thm}
\begin{enumerate}[label=(\arabic*)]
\item For any $f: A\lrta B$ the pair $(\tilde{f},\tilde{f}^*)$ is a morphism  of locally ringed spaces $(\spec B,\calo_B)\lrta (\spec A,\calo_A)$
\item Conversely, any morphism of locally ringed spaces $(\spec B,\calo_B)\lrta (\spec A,\calo_A)$ is induced by a morphism of rings.
\item This gives a equivalence of categories
$$
\left( \text{ commutative rings with unity}\right)\overset{\simeq}{\llrta}\left(\text{affine schemes as locally ringed spaces}\right)
$$
$$
\hom_{rings}(A,B)=\hom_{loc.r.sp}(\spec B,\spec A)
$$
\end{enumerate}
\begin{proof}
\underline{Recall} $\calo_{A,\scp}=A_\scp$ and recall $f:A_{f^{-1}(\scq)}\lrta B_\scq$ i.e.
$$
\calo_{A,\tilde{f}(\scq)}\lrta \calo_{B,\scq}
$$
\underline{Claim}: This is exactly the morphism $\calo_{A,\tilde{\scq}}\lrta \calo_{B,\scq}$ induced by $\tilde{f}^*:\calo_A\lrta \tilde{f}^*\calo_B$

\underline{Claim2}: For every $\scq\in\spec B$, 
$$
\begin{aligned}
& A_{f^{-1}(\scq)}\lrta B_\scq\\
&a/b\longmapsto f(a)/f(b)
\end{aligned}
$$
is a local morphism.

We first prove Claim2, it suffices to check $f(\scm_{A_{f^{-1}(\scq)}})\subset \scm_{B_\scq}$
$$
f(a/b)=\frac{f(a)}{f(b)}\in \scq\\
$$
$$
\begin{tikzcd}
\calo_{A,\tilde{f}(\scq)} \arrow[ddd, "\simeq"'] \arrow[rr] &  & (\tilde{f}^*_*\calo_B)_{\tilde{f}(\scq)} \arrow[rr] &  & \calo_{B,\scq} \arrow[ddd, "\simeq"] \\
 & (U,s) \arrow[d, maps to] \arrow[r, maps to] & (U,\tilde{f}^*_*(s)) \arrow[r, maps to] & (\tilde{f}^{-1}(U),\tilde{f}_*^*(s)) \arrow[d, maps to] &  \\
 & s(f^{-1}(\scq))=s(\tilde{f}(\scq)) \arrow[rr, maps to] &  & f(s(\tilde{f}(\scq)))=\tilde{f}^*_*(s)(\scq) &  \\
A_{f^{-1}(\scq)} \arrow[rrrr, "f"] &  &  &  & B_\scq,
\end{tikzcd}
$$
so this indeed works,

(2) Let $(f,f^*):(\spec B,\calo_B)\lrta (\spec A,\calo_A)$ be a  morphism of locally ringed space/ 
$$
f^*:\calo_A\lrta f_*\calo_B
$$
$$
\begin{tikzcd}
\calo_A(\spec A) \arrow[dd, equal] \arrow[r, "f^*_{\spec A}"] & \calo_B(f^{-1}(\spec A)) \arrow[d,equal] \\
 & \calo_B(\spec B) \arrow[d,equal] \\
A \arrow[r] & B.
\end{tikzcd}
$$
Let $\varphi=f^*_{\spec A}$.

\underline{Claim}: The locally ringed morphism induced by $\varphi$ is $(f,f^*)$.

To finish the proof of $(2)$, we need to check that the two constructions are reciprocal bijections.

To check the claim, let $\scq\in \spec(B)$, we have
$$
\begin{tikzcd}
A \arrow[r, "\varphi"] \arrow[d] & B \arrow[d] \\
\calo_{A,f(\scq)} \arrow[r, "f*_\scq"] & B_\scq=\calo_{B,\scq}
\end{tikzcd}
$$
We know:
\begin{enumerate}[label=(\arabic*)]
\item $f^*_\scq$ is local 
$$
\Llrta (f^*_\scq)^{01}(\scm_{B_\scq})=\scm_{A_{f(\scq)}}
$$
\item The diagram commutes, because $f^*$ is a morphism of sheaves so compatible with restriction. This implies $f(\scq)=\varphi^{-1}(\scq)=\tilde{\varphi}(\scq)$. (Indeed. let $\alpha\in\varphi^{-1}(\scq),\beta=\varphi(\alpha)\in\scq\Lrta \alpha\in f(\scq)\Lrta \varphi^{-1}(\scq)\subset f(\scq)$).
$$
\begin{tikzcd}
\alpha \arrow[d, maps to] \arrow[r, maps to] & \beta \arrow[d, maps to] \\
(*) \arrow[r, maps to] & (\bullet\in \scm_{B_\scq}),
\end{tikzcd}
$$
where $(*)$ belongs to $\scm_{A_{f(\scq)}}$ (because the morphism is local)

Conversely, let $\alpha\in F(\scq)$
$$
\begin{tikzcd}
\alpha \arrow[d, maps to] \arrow[r, maps to] & \beta=\varphi(\alpha) \arrow[d, maps to] \\
(\bullet\in \scm_{A_{f(\scq)}}) \arrow[r, maps to] & (*\in \scm_{B_\scq})
\end{tikzcd}
$$
since $\beta$ maps to an element in $\scm_{B_\scq}$, we have $\beta\in\scq$, so $\varphi(f(\scq))\subset \scq\Llrta f(\scq)\subset \varphi^{-1}(\scq)$
\end{enumerate}

Proof of part $(3)$ is left as an exercise.
\end{proof}
\end{thm}
\begin{dfn}
$(X,\calo_X)$ (locally)-ringed space. $U\subset X$ open set.  Define $\calo_U(V)=\calo_X(V)$ for $V\subset U$ open.  Then $(U,\calo_U)$ is a (locally) ringed space. ( in fact $\forall x\in U$, $\calo_{U,x}=\calo_{X,x}$)
\end{dfn}
\begin{dfn}
A \textbf{scheme} $S$ is a locally ringed space $(S,\calo_S)$  which is locally isomorphic to affine schemes, i.e.
 $\forall x\in S\exists U\subset S$  open, $x\in U$, and a ring $A$ such that $(U,\calo_U)$ is isomorphic as locally ringed spaces to $(\spec A,\calo_A)$. We view category of schemes as a subcategory of locally ringed spaces.
\end{dfn}
\subsection*{ Examples of schemes/morphisms}

Let $K$ be a field. Let $S$ be a scheme with morphism $f:S\lrta \spec K$.

\underline{Affine case}: $S=\spec A$
$$
f\llrta (K\lrta A)
$$ 
i.e. $f\llrta$ structure of $K$-algebra on $A$
\begin{ex}
$A=K[X_1,...,X_m]/I$ has  morphism $\spec A\lrta K$. 
\end{ex}

\underline{Global case}: 
$$
f\llrta\left\{\begin{aligned}
& S\overset{continuous}{\lrta}\spec (K)=\eta=\{0\}\\
& \calo_{\spec K}\lrta f_*\calo_S
\end{aligned}\right.
$$
where $\calo_{\spec K}$ consists of 
$$
\emptyset :\calo_{K}(\emptyset)=\{0\}\lrta \{0\}
$$
$$
\{\eta\}:\calo_K(\eta)=K\lrta (f_*\calo_S)(\{\eta\})=\calo_S(S)
$$
therefore
$$
\{S\lrta \spec K\}\llrta \{K\lrta \calo_S(S)\}.
$$


\begin{dfn}
Let $B$ be a scheme, a scheme \textbf{over } $B$ is 
$$
f:S\lrta B
$$
a morphism of schemes.

A morphism of schemes over $B$ is 
$$
\begin{tikzcd}
S_1 \arrow[rd, "f_1"] \arrow[rr, "g"] &  & S_2 \arrow[ld, "f_2"] \\
 & B & 
\end{tikzcd}
$$
so that $f_2\circ g=f_1$.
\end{dfn}

\underline{Global case2}: $K$ is a field , $f:\spec K\lrta S$ corresponds to a point $x=f(\eta)\in S$, $\calo_S\lrta f_*\calo_{\spec K}:$ $$
\forall U,\calo_S(U)\lrta \calo_{\spec K}(f^{-1}(U))=\left\{\begin{aligned}
&\{0\}\text{ if }x\notin U\\
& K\text{ if } x\in U.
\end{aligned}
\right.$$
Compatibility with restrictions show that this is equivalent to
$$
\calo_{S,f(\eta)}=\calo_{S,x}\overset{g}{\lrta}\calo_{K,\eta}=K
$$
such that $g^{-1}(\{0\})=\scm_{\calo_{S,x}}$, i.e.
$g$ passes to the quotient
$$
K_S(x)\lrta K.
$$
Concretely, ``the coordinates of $x$ are in $K^n$''

\subsection{Apr 10th: }
Recall: A scheme $S$ is a  locally ringed space $(S,\calo_S)$,  $(\calo_{S,x})$ are local rings. s.t. $\forall x\in S$, exists an open set $U\in S$ $x\in U$ and a ring $A$ s.t. 
$(U,\calo_{S}\mid_U)\simeq \spec A$.

We will give some examples of morphism of schemes.
\begin{ex}\ 
\begin{enumerate}[label=(\arabic*)]
\item $A, B$ are rings. 
$$
\hom_{Sch}(\spec A,\spec B)=\hom_{Rings}(B,A)
$$
\item $K$ is a field.
$$
[X\lrta \spec K=\{\eta\}]\Llrta [K\lrta \Gamma(X,\calo_X)]
$$
(also for any $x\in X$, we get $\calo_{K,\eta}=K\lrta \calo_{X,x}\lrta \kappa(x)$) so every residue field is an extension of $K$.
\item $$
[\spec(K)\overset{f}{\lrta } X]\Llrta [\text{a point $x=f(\eta)$ and } \calo_{X,x}\overset{f^*}{\lrta } K]
$$
s.t. $\ker(f^*)=\scm_{X,x}$ i.e. $\kappa(x)\inj K$.

I.e. $\hom_{Sch}(\spec(K), X)\cong\{(x,i)|x\in X, i:\kappa(x)\inj K\}$. 

In particular, take $X=\spec(K[X_1,...,X_n]/(f_1,...,f_m))$ then using $(1)$, we get 
$$
\hom_{Sch}(\spec K, X)\simeq \hom_{Rings}(K[X]/I, K).
$$
If we only consider morphism over $\spec K$,
$$
\begin{tikzcd}
\spec K \arrow[rd, "id"] \arrow[rr] &  &X \arrow[ld] \\
 & \spec K & ,
\end{tikzcd}
$$
we look ar $\hom_{K-alg}(K[X]/I ,K)$

$K$-linear $K[X]/I\lrta K$ $\Llrta $ giving $x=(x_1,...,x_n)\in K^n$ s.t. $f_1(x)=...=f_m(x)=0$ so
$$
\hom_{Sch\ over\ K}(\spec K, X)
$$
are the $K$-valued solutions of the equation defining $X$.

\underline{Notation}: Any $S\overset{f}{\lrta }X$ is called an $S$-valued point of $X$.
\item  (restriction of morphisms)
$$
U\subset X\overset{f}{\lrta} Y
$$
where $U$ is open. We want to restrict $f$ to $U$, first $(U,\calo_X|_U)$ is a locally ringed space. (We will see that it is a scheme.)

Let $f|U:(U,\calo_X\mid U)\lrta X$ be defined by 
$$
(f|U)(x)=f(x)\forall x\in U
$$
so $f| U$ is continuous and 
$\calo_Y\overset{f|_U^*}{\lrta }(f|U)_*(\calo_X|U)$ defined by 
$
\forall V\in Y,\text{ open }
$
$$
\calo_Y(V)\lrta (\calo_X|U)((f|U)^{-1} (V))=\calo_X(U\cap f^{-1}(V))
$$
obtained by 
$$
\calo_Y(V)\lrta \calo_X(f^{-1}(V))\overset{\res}{\lrta}\calo_{X}(f^{-1}(U)\cap V).
$$
This is a morphism of ringed spaces. Moreover, we can check that it is a morphism of schemes. On the stalks, the induced morphisms 
$$
\calo_{Y,(f|U)(x)=f(x)}\lrta \calo_{X,x}
$$
are the same as those from $f$ it self. 

\underline{Check} $V\subset U\subset X\Lrta f|V=(f|U)|V$.
\end{enumerate}
\end{ex}
\begin{prop}\label{prop:open_subscheme} Any $U\subset X$, where $X$ is a scheme, $U$ open , is a scheme. 
\end{prop}
\underline{Note}: in general, $U$ is not an affine  scheme even if $X$ is affine.

E.g.
 Let $X=\affn^2_\cplx=\spec(\cplx[X_1,X_2])$, $U=X-\{(0,0)\}$ open, where the point $(0,0)$ corresponds to the maximal ideal $(X_1,X_2)$. $U$ is not  an affine scheme because one can check that 
$$
\begin{tikzcd}
\Gamma(U,\calo_U) \arrow[d, equal] \arrow[r, "\simeq"] & \cplx[X_1,X_2] \arrow[d,equal] \\
\Gamma(U,\calo_X|_U) \arrow[d,equal] & \Gamma(X,\calo_X) \\
\Gamma(U,\calo_X) & 
\end{tikzcd}
$$
This phenomenon is an analogy \textbf{Hartog's Lemma} in complex geometry, which states that we can extend a holomorphic function defined on the complement of a set of codimension at least two on a complex manifold over the missing set~\footnote{This will work more generally in the algebraic setting: you can extend over points in codimension at least $2$ not only if they are ``smooth manifold'', but also if they are mildly singular what we will call normal and is called \boxed{Hartog's\  phenomenon} in general.}.

If $U$ was affine, we would get $U\simeq X$ which is absurd.
\begin{proof}[Proof of Prop~\ref{prop:open_subscheme}]
$x\in U$, $X$ is a scheme, $\Lrta \exists x\in V\subset X$ open s.t. $V=\spec A$ is affine. Then $V\cap U$ is an open neighborhood of $x\in U$, and is  open in $V=\spec A$ so it it suffices to check that an open subset of $\spec(A)$ is a scheme. Recall that the basic open subsets $U_f=\{\scp\in \spec A|f\notin \scp\}$ form a basis of the topology. So we reduces to showing that  $U_f$ is affine. Precisely, $U_f$ is canonically isomorphic to $\spec(A_f)$. (Topologically, we already constructed a homeomorphism $U_f\overset{i}{\lrta} \spec(A_f): \scp\mapsto \scp A_f$).

To deduce the Proposition, it suffices to have an isomorphism of sheaves 
$$
\calo_{A_f}\overset{\simeq}{\lrta} i_*\calo_{U_f}
$$
i.e. for all $V\subset \spec (A_f)$ open an isomorphism 
$$
\calo_{A_f}(V)\overset{\simeq }{\lrta} \calo_{U_f}(i^{-1}(V))
$$
and compatible with restrictions.

\underline{Recall}: $\calo_{A_f}(U)=\left\{g:U\lrta \sqcup_{Q\in U}(A_f)_Q|g\text{ ``locally'' } \frac{a}{b}, a,b\in A_f\right\} $

$$
\calo_{U_f}(i^{-1}(V))=\calo_A(i^{-1}(V))=\left\{\tilde{g}: i^{-1}(V)\lrta \sqcup_{\scp \in A_{\scp}}\left|\tilde{g}=\frac{\tilde{a}}{\tilde{b}}, \tilde{a},\tilde{b}\in A\right.\right\}
$$
The morphism $g\mapsto \tilde{g}$ is given by $\tilde{g}(\scp)=g(\scp A_f)=g(i(\scp))$. This works because $a=\tilde{a}/f^n$ and $b=\tilde{b}/f^m$ so $a.b=f^m\tilde{a}/f^n\tilde{b}$
\end{proof}
\begin{ex}
A discrete valuation ring (DVR) is a local ring $A$ with maximal ideal $\scm_A\subset A$ being a principal ideal generated by $\varpi\in A$ (``uniformizer'')\footnote{$A$ is a the local ring at a closed point of  a non-singular point of a curve}
$A/\scm_A=k$ is the residue field. (Exercise. $A=\{a/b\in \ratl|p\nmid b,a\in \intg\}$, $\scm_A=(p),\varpi =p$ is an example of DVR)

Consider a DVR $A$, $\spec A=\{\eta=\{0\},s\}$, where $s$ is  the ``special point'' $s=(\varpi)=\scm_A$. The open sets are $\emptyset, \spec A, \{\eta\}$, $\{\eta\}$ is open because $\{s\}$ is closed. Structure sheaf
$$
\calo_A(\emptyset)=0,\calo_A(\spec A)=A, \calo_A(\{\eta\})\simeq A_\varpi=K=Frac(A)
$$
(since $A_\varpi=\{\frac{a}{\varpi^n}| a\in A, n\geq 0\}$ and any $b\notin (\varpi) $ is invertible)
$$
\kappa(s)=A/\scm_A=k
$$
$$
\kappa(\eta)=Frac(A/\{0\})=K
$$
$$
\res^{\spec A}_{\{\eta\}}:A\lrta A_\varpi=K
$$
is the inclusion. What is the nature of schemes over $A$?
$$
f:X\lrta \spec(A)
$$
\underline{Topologically}: $X=X_s\sqcup X_\eta$,
$$
f(x)=\left\{\begin{aligned}
&s, x\in X_s\\
& \eta, x\in X_\eta
\end{aligned}\right.
$$
s.t. $f^{-1}(\{\eta\})=X_\eta$ is open in $X$. (topology is determined by an open set $X_\eta\subset X$),

\underline{sheaf-theoretical point}
$$
\calo_A\lrta f_*\calo_X\Llrta \begin{tikzcd}
A=\calo_A(\spec A) \arrow[r, "f^*_A"] \arrow[d, "\res"'] & \calo_X(X) \arrow[d] \\
K=\calo_A(\{\eta\}) \arrow[r, "f^*_\eta"'] & \calo_X(X_\eta)
\end{tikzcd}
$$
such that 
$$
\res^X_{X_\eta}(f^*_A(a))=f^*_\eta(a)(\text{ viewed a elements of }K).
$$
It is locally ringed $\forall x, \calo_{A,f(x)}\lrta \calo_{X,x}$ local $\Llrta \forall x\in X_\eta$, $\calo_{A,\eta}=A_\eta=K\lrta \calo_{X,x}$ (always local) and 
$\forall s\in X_s$, $\calo_A(\spec A)=A=\calo_{A,s}\lrta \calo_{X,x}$, where the equality holds because $\spec A$ is the only open set that contains $s$.
\end{ex}

\begin{lemma}
For any scheme $X$, there is a unique morphism $X\lrta \spec(\intg)$. recall $\dim(\intg)=1$.
\end{lemma}
\begin{proof} adsfd
If $X=\spec A$, then
$$
\hom_{Sch}(\spec A,\spec \intg)=\hom_{Rings}(\intg, A)=\{1\mapsto 1\}
$$
has a unique element. If $X$ is arbitrary, $X=\cup_{i}\spec A_i$ for every $i$, there is a unique $f_i:\spec (A_i)\lrta \spec \intg$. Intuitively, this implies uniqueness $(f,\tilde{f}:X\lrta \spec \intg)\Lrta f|_{\spec(A_i)}=f_i=\tilde{f}|_{\spec(A_i)}$ and thus implies $f=\tilde{f}$. 

The existence comes from
$$
f_i|_{\spec(A_i)\cap \spec(A_j)}=f_j|_{\spec(A_i)\cap \spec(A_j)}.
$$

Indeed
\begin{prop}\label{prop:morphism_of_scheme_determined_by_open_cover}
Given $X,Y$ schemes, $X=\cup_i U_i$ open covering. To give $f:X\lrta Y$ is ``the same'' as giving $f_i|_{U\lrta Y}$ s.t. $f_i|_{U_i\cap U_j}=f_j|_{U_i\cap U_j}$.

 I.e. 
$f\mapsto (f|_{U_i})_i$ gives a bijection the set of morphisms $\hom(X,Y)$ and the set of compatible local morphisms on the open sets
\end{prop}
\begin{proof}[Proof of \ref{prop:morphism_of_scheme_determined_by_open_cover}]
\underline{Surjectivity}: Given $(f_i)_i$,$ f_i:U_i\lrta Y$ satisfying the cocycle relation, construct $f$? 
$$
X\overset{f}{\lrta } Y
$$

\underline{Topologically}: $f(x)=f_i(x)$ if $x\in U_i$ is well-defined since $f_i(x)=f_j(x)$ if $x\in U_i\cap U_j$. $f$ thus defined is continuous (exercise)

\underline{Sheaf-theoretically}: we need $\calo_Y\lrta f_*\calo_X$: $\forall V\subset Y$, $\calo_Y(V)\overset{?}{\lrta}\calo_X(f^{-1}(V))$. Given $s\in \calo_Y(V)$, we get $s_i\in \calo_{U_i}(f_i^{-1}(V))=\calo_X(f_i^{-1}(V))$ and $f^{-1}(V)=\cup_i f_i^{-1}(V)$ and 
$s_i|_{f_i^{-1}(V)\cap f_j^{-1}(V)}=s_j|_{f_i^{-1}(V)\cap f_j^{-1}(V)}$. By the sheaf condition on $\calo_X$, there exists a unique $\tilde{s}\in \calo_X(f^{-1}(V))$ s.t.
$$
\tilde{s}|_{f^{-1}(V_i)}=s_i,\forall i.
$$
The map $s\mapsto \tilde{s}$ is the required
$\calo_Y(V)\lrta \calo_X(f^{-1}(V))\Lrta $ get $\calo_Y\overset{f^*}{\lrta }f_*\calo_X$. It is local because if $x\in U_i\subset X$ the induced morphism satisfies
$$
\begin{tikzcd}
{\calo_{Y,f(x)}} \arrow[r, "f^*"] \arrow[d, equal] & {\calo_{X,x}} \arrow[d, equal] \\
{\calo_{Y,f_i(x)}} \arrow[r, "f_i^*"] & {\calo_{U_i,x}}.
\end{tikzcd}
$$
$f$ is local because $f_i^*$ is local.
\end{proof}
\end{proof}
\subsection{Apr 13th-A: Continue, morphism to affine schemes }
\begin{ex}
\begin{prop}
For any scheme $X$ and any ring $A$, there is a bijection
$$
\hom_{Sch}(X,\spec A)\simeq \hom_{Rings}(A,\calo_X(X))
$$
given by 
$$
X\overset{f}{\lrta}\spec A
$$
$$
\Lrta \calo_A\overset{f^*}{\lrta} f_*\calo_X\Lrta A=\calo_{\spec A}(\spec A)\lrta \calo_X(f^{-1}\spec A)=\calo_X(X)
$$
\underline{Ex}.\begin{enumerate}[label=(\arabic*)]
\item $\hom_{Sch}(X,\spec K)\llrta K\inj c\calo_X(X)$
\item $\hom_{Sch}(X,\spec \intg)\simeq \hom(\intg,\calo_X(X))$ has a unique element. ($\spec \intg$ is the final object in $\mathsf{Sch}$) 
\item $\hom_{Sch}(X,\affn^1_\intg)\simeq\hom(\intg[T],\calo_X(X))$
\end{enumerate}
\end{prop}
\begin{proof}
$$
X=\cup_i U_i, U_i\cong\spec(A_i)\text{ open in } X
$$
$$
\begin{aligned}
\hom_{Sch}(X,\spec A)&=\{(f_i)\mid f_i:U_i\lrta \spec A\text{ s.t. }f_i|_{U_i\cap U_j}=f_j|_{U_i\cap U_j}\}\\
&\cong\{(g_i)\mid g_i:A\lrta A_i,\text{ which are compatible on intersections} \}\\
&=\{(g_i)\mid g_i: A\lrta \Gamma(U_i, \calo_X),\forall a\in A, g_i(a)|_{U_i\cap U_j}=g_j(a)|_{U_i\cap U_j}\}\\
&\simeq\{g|g:A\lrta \calo_X(X)\}\text{ by sheaf condition}\\
&=\hom_{Rings}(A,\calo_X(X))
\end{aligned}
$$
\end{proof}
\underline{Note} in general the dual statement is not true:
$$
\hom_{Sch}(\spec A, X)\neq \hom_{Rings}(\calo_X(X),A)
$$
\underline{Ex}. $X=\proj^1_K$, $\Lrta \calo_X(X)=K$. If $A=K$, then $\hom_{rings}(K,K)=\{id\}$ but 
$\hom(\spec \ratl,\proj^1_\ratl)$ has infinitely many elements.
\end{ex}
\section{Fibred product}
\subsection{Apr 13th-B: Categorical introduction of Fibred product}
This is a notion that makes sense in any category. (Though a specific fibred product may not exist)
\begin{dfn}
$\calc$ a category, $X,Y$ objects of $\calc$, $S$ an object of $\calc$. Assume given
$$
\begin{tikzcd}
 & Y \arrow[d, "f_2"'] \\
X \arrow[r, "f_1"] & S
\end{tikzcd}
$$
We say that an object $Z$ of $\calc$ with morphisms 
$$
\begin{tikzcd}
Z \arrow[r, "\pi_2"] \arrow[d, "\pi_1"'] & Y \arrow[d, "f_2"'] \\
X \arrow[r, "f_1"] & S
\end{tikzcd}
$$
makes the diagram commutes is a \textbf{fibred product} of $X,Y$ over $S$ if it has the universal property
$$
\begin{tikzcd}
T \arrow[rdd] \arrow[rrd] \arrow[rd, "\exists!", dashed] &  &  \\
 & Z \arrow[r, "\pi_2"] \arrow[d, "\pi_1"'] & Y \arrow[d, "f_2"'] \\
 & X \arrow[r, "f_1"] & S
\end{tikzcd}
$$

\underline{Notation}: $Z=X\times_S Y$
\end{dfn}
N.B. This notation is ambiguous because the fibred product depends on $f_1,f_2$. The fibred product is only suitably unique when it is specified with its two projections $\pi_1,\pi_2$.
\begin{ex}
In $\mathsf{Sets}$ fibred products exist and
$$
X\times_S Y=\{(x,y)\in X\times Y|f_1(x)=f_2(y)\}
$$
with $\pi_1(x,y)=x$ and $\pi_2(x,y)=y$
\end{ex}
\begin{proof}
\ \begin{enumerate}[label=(\arabic*)]
\item $f_2\circ \pi_2(x,y)=f_2(y)=f_1(x)=f_1\circ \pi_1(x,y)$ for $(x,y)\in Z$.
\item Let $T$ be a set with $p_1:T\lrta X$ and $p_2:T\lrta Y$ s.t. $$\begin{tikzcd}
T \arrow[rdd,"p_1"] \arrow[rrd,"p_2"] \ar[rd,"f"] &  &  \\
 & Z \arrow[r, "\pi_2"] \arrow[d, "\pi_1"'] & Y \arrow[d, "f_2"'] \\
 & X \arrow[r, "f_1"] & S
\end{tikzcd}$$
define $f(t)=(p_1(t),p_2(t))$, $f_1(p_1(t))=f_2(p_2(t))$, therefore $f(t)\in Z$. So $f$ is a map makes the  above diagram commute. Uniqueness of $f$ is obvious. If there is  another $\tilde{f}(t)=(\tilde{f}_1(t),\tilde{f}_2(t))$ making the above diagram commute, then $\tilde{f}_1(t)=\pi_1\circ \tilde{f}(t)=p_1(t)$ and $\tilde{f}_2(t)=\pi\circ \tilde{f}(t)=p_2(t)$.
\end{enumerate}
\underline{Note}: This construction/definition is a an example of ``universal'' object in the categorical sense. It is universal in the following sense.

Given $X\overset{\pi_1}{\longleftarrow}Z_1\overset{\pi_2}{\lrta} Y$, $X\overset{\tilde{\pi}_1}{\longleftarrow}Z_2\overset{\tilde{\pi}_2}{\lrta} Y$ both fibred products over $S$ there is a unique isomorphism $j:Z_1\lrta Z_2$, s.t. $\tilde{\pi}_1=\pi_1\circ j^{-1}$ and $\tilde{\pi}_2=\pi_2\circ j^{-1}$.
\end{proof}
\begin{ex}
If $\calc=\mathsf{Sets}$, $S=\{*\}$ any 1 element set, the fibred product over $S$ is just the Cartesian product
$$
X\times_S Y=\{(x,y)\in X\times Y|f_1(x)=f_2(y)\}
$$
But the restriction on $f_i$ is just vacuous, the fibred product contains the usual Cartesian product.

(2) Let $X\overset{f_1}{\inj}S \overset{f_2}{\hookleftarrow} Y$ (inclusion of subsets) We can see that the fibred product is isomorphic to the intersection of $X,Y$
$$
\begin{tikzcd}
X\cap Y \arrow[d, hook] \arrow[r, hook] & Y \arrow[d, hook] \\
X \arrow[r, hook] & S
\end{tikzcd}
$$

(3) $$
\begin{tikzcd}
f_2^{-1}(X) \arrow[d, "f_2|_{f^{-1}_2(X)}"'] \arrow[r, hook] & Y \arrow[d, "f_2"] \\
X \arrow[r, "f_1", hook] & S
\end{tikzcd}
$$
\end{ex}
\begin{thm}
In the category $\mathsf{Sch}$ of schemes, arbitrary fibred product exists.
\end{thm}
\underline{Note} This is false in the category of affine algebraic sets over $K$, with $K$ algebraically closed.

\begin{proof}[Proof of theorem]
\underline{Step 1} We prove this for affine schemes.

Assume $X=\spec A$, $Y=\spec B$, $S=\spec R$. Given  a diagram
$$
\begin{tikzcd}
X \arrow[r] & S \\
 & Y \arrow[u]
\end{tikzcd}
$$
in $\mathsf{AffnSch}$, we have a reversed diagram in $\mathsf{Rings}$
$$
\begin{tikzcd}
A &  \\
R \arrow[u] \arrow[r] & B
\end{tikzcd}
$$
Define $Z=\spec(A\otimes_R B)$, and set $A\otimes_R B=:C$. We have 
$$
\begin{tikzcd}
A \arrow[rrr] &  &  & C &  \\
 & a \arrow[r, maps to] & a\otimes 1 &  & 1\otimes b \\
 &  &  &  & b \arrow[u, maps to] \\
R \arrow[uuu] \arrow[rrr] &  &  & B \arrow[uuu] & 
\end{tikzcd}
$$
This diagram is commutative, which guarantees a diagram in $\mathsf{AffSch}$ 
$$
\begin{tikzcd}
Z \arrow[r] \arrow[d] & Y \arrow[d] \\
X \arrow[r] & S
\end{tikzcd}
$$
$$
\begin{tikzcd}
T \arrow[rdd] \arrow[rrd] &  &  \\
 & Z \arrow[d] \arrow[r] & Y \arrow[d] \\
 & X \arrow[r] & S
\end{tikzcd}
$$

\underline{N.B.} $\spec (A\otimes_R B)$ is not easy to describe as a set.


\underline{Step 2} Uniqueness of $X\times_S Y$, when it  exists, is formal.

\underline{Step 3.} If $X\times_S Y$ exists, for any open subset $U\subset X$, $U\times_S Y$ exists and is $\pi_1^{-1}(U)$
$$
\begin{tikzcd}
\pi_1^{-1}(U) \arrow[d] \arrow[r] & X\times_S Y \arrow[d, "\pi_1"] \arrow[r] & Y \arrow[d] \\
U \arrow[r, hook] & X \arrow[r] & S
\end{tikzcd}
$$
\underline{Step 4} $U_i$ affine. If for each $i$, $U-i\times_S Y$ exists, then so does $X\times_S Y$
$$
\begin{tikzcd}
 & Y \arrow[d, "f_2"] \\
\cup_i U_i=X \arrow[r, "f_1"] & S
\end{tikzcd}
$$
If for each $i$, $U_i\times_S Y$ exists, then so does $X\times_S Y$.

Define $V_{i,j}=\pi_{1,i}^{-1}(U_i\cap U_j)\subset U_i\times_S Y$ open. Check that $V_{i,j}=(U_i\cap U_j)\times_S Y$
>>>>>>>>>2

One can glue  the $U_i\times_S Y$ along the isomorphisms. 

\underline{Check} This scheme is $X\times_S Y$

\underline{Step 5.}

step 1+ step 4.

$Y,S$ affine $\Lrta X\times_S Y$ exists.
\end{proof}

\subsection{Apr 17th: Examples and Applications of the Fibred Product}
Recall.
If we have maps
 $X\lrta S$, $Y\lrta S$, a space $Z$ with maps $Z\lrta X, Z\lrta Y$ if the fibred product of $X\lrta S\longleftarrow Y$ if it has the universal property
 $$
\begin{tikzcd}
T \arrow[rdd] \arrow[rrd] \arrow[rd, "\exists!", dashed] &  &  \\
 & Z \arrow[d] \arrow[r] & Y \arrow[d] \\
 & X \arrow[r] & S
\end{tikzcd}
 $$
 $X=\spec A, Y=\spec B, S=\spec R$. The contravariant functor $\spec$ would invert the fiber coproduct of rings to fibred product of schemes.
 $$
X\times_S Y=\spec( A\otimes_R B)
 $$
 Define: $X\times_R Y:=X\times_{\spec R} Y$.

\begin{ex}
Why not product?
For $X,Y$ and schemes, each have a unique map to $\spec \intg$. The fibred product $X\times_\intg Y$ depends only on $X$ and $Y$. ($\spec \intg$ is the final object in $\mathsf{Schemes}$)

$X=\spec \intg[T]$, Krull dimension $2$, $Y=\spec \intg[V]$, dimension $2$. $X\times_\intg Y\neq\spec \intg[T,V]$ Krull dimension $3$.
$$
\dim X\times_\intg Y\neq \dim X+\dim Y.
$$
\end{ex}

\begin{ex}
$K$ a field, $X, Y$ schemes over $K$ $\dim X\times_K Y=\dim X+\dim Y$. But hte set of points of $X\times_K Y$ is not simply a topological product. For example, $X=\affn^1_K, Y=\affn^1_K$, $X\times_K Y=\affn^2_K$, but it true that $X(K)=\hom(\spec K, X)$
$$
X\times_K Y(K)=X(K)\times Y(K)
$$
$$
\hom_{\spec K}(\spec K, X\times_K Y)=\hom_{\spec K}(\spec K, X)\times \hom_{\spec K}(\spec K, Y)
$$
by the universal product of fibred products.
\end{ex}

If $X$ is a scheme over $S$, $T$ is a scheme over S. We can define $X(T)$ as $\hom_S(T,X)$
and call it the $T$-valued points of $X$.
$$
T=\spec R, X(R)
$$
$$
X\times_S Y(T)=X(T)\times Y(T).
$$
If we have the following morphism of schemes
$$
\begin{tikzcd}
X \arrow[rd] &  & Y \arrow[ld] \\
 & S' \arrow[d] &  \\
 & S &, 
\end{tikzcd}
$$
 we have 
 $$
X\times_{S'} Y(T)=X(T)\times_{S'(T)} Y(T).
 $$

$\hom_S(T,X\times_{S'}Y)=$\{ pair $(f_1,f_2)$ of elements $f_1\in \hom_{S}(T,X)$ and $f_2\in \hom_S(T,Y)$  such that $p_1\circ f_1=p_2\circ f_2$\}$=$\{ pair of elements $f_1\in X(T)$ and $f_2\in Y(T)$, $p_1\circ f_1=p_2\circ f_2\in S'(T)$\}
$$
\begin{tikzcd}
T \arrow[rd] \arrow[rdd, "f_1"'] \arrow[rrd, "f_2"] \arrow[rrrddd, dashed, bend right=49] &  &  &  \\
 & X\times_{S'}Y \arrow[d] \arrow[r] & Y \arrow[d, "p_2"] &  \\
 & X \arrow[r, "p_1"] & S' \arrow[rd] &  \\
 &  &  & S
\end{tikzcd}
$$
\begin{ex}Consider
$GL_n(K)$. There exists a scheme $\mathcal{GL}_n$ with $\mathcal{GL}_n(K)=GL_n(K)$.
$\affn^{n^2}\supset V(det)$, $\mathcal{GL}_n$ gives the ``open complement of $V(det)$''. What are the $R$-valued points of $\mathcal{GL}_n$?
$$
\mathcal{GL}_n(R)\neq \{n\times n\text{ matrices over $R$ with } det \neq 0 \}
$$
But
$$
\begin{aligned}
\mathcal{GL}_n(R)&=\{n\times n\text{ matrices over $R$ s.t. }\spec R\lrta \affn^{n^2}\text{ does not intersect }V(det)\}\\
&=\{n\times n\text{ matrices $M$ over $R$ s.t.} det(M) \notin\text{ any prime ideal of }R \}\\
&=\{n\times n\text{ matrices $M$ over $R$ where } det(M)\text{ is invertible}\}
\end{aligned}
$$
\end{ex}

\begin{ex}
Equation
$$
x^3+y^3+z^2=0,
$$
find all solutions in $\intg$. 
$X=\spec \intg[x,y,z]/(x^3+y^3+z^2)$. The set of solutions is $X(\intg)$
\end{ex}

\begin{ex}
$f:X\lrta S$, $\scp$ a point of $S$
$K(\scp)$ residue field of $\scp$. $\spec K(\scp)\lrta S$. Define$K(\scp)\times_S X$ as the fiber of $f$ over $\scp$
$$
\begin{tikzcd}
 & X \arrow[d] \\
\spec K(\scp) \arrow[r] & S
\end{tikzcd}
$$
\end{ex}
\begin{lemma}
The set of points of the fiber is the inverse image of $\scp$ where $f$ is the set of points of $X$. The underlying set of $K(\scp)\times_SX$ maps to the underlying set of $X$.


\end{lemma}

\underline{The relative point of view}
``A parametrized family of varieties''
$y^2=x^3-3x-t$ viewed as a family of algebraic sets in $\affn^2$ with coordinates $X,Y$ parameter $t$. For each %t
, we get an equation in $X,Y$, this defines a curve in $\affn^2$. Consider the morphism
$$
f:\spec k[x,y,t]/(y^2-x^3-3x+t)\lrta \spec K[t].
$$
The fibers of $f$ over closed points are curves in the family.

\underline{Idea from Grothendieck}: view any morphism as a family where elements are the fiber. $\affn^3\cup pt\Lrta \affn^1$, $\affn^3$ to $0$ $pt$ to $1$. Not all maps make  nice families but this point of view is helpfull in general, why?
\begin{itemize}
	\item Fibers of a  family are often simper (e.g. )
	\item Full family are simpler than individual fibers.
\end{itemize}

\begin{ex}
Reduction $\mod p$. $X$ is a scheme over $\intg$. $X\times_\intg \spec \bbf_p$ is a scheme over $\bbf_p$. ``reduction $\mod p$'' of $X$
$X=\spec \intg[x_1,...,x_n]/(f_1,...,f_m)$
$X\times_\intg\spec \bbf_p=\spec \bbf_p[x_1,...,x_n]/(f_1,..,f_m)$. This can be tricky, for example $\spec \intg[T]/T(T+2)$ has no nilpotents (is ``reduced'' scheme) but $\spec \bbf_2[T]/Y(T+2)=\spec \bbf_2[T]/T^2$ has nilpotent. 
\end{ex}
\begin{ex}
$X$ a scheme over $\intg$
$X\times_\intg \spec \ratl$ (or $X\times_\intg \spec \overline{\ratl}$). Given $Y$ over $\spec \ratl$, can we find $X$ over $\spec \intg$ with $X\otimes_\intg \spec \ratl=Y$? If so $X\times_{\spec \intg} \spec \bbf_p$ will give some perspective on $Y$.
\end{ex}
\begin{lemma}
If $Y$ in $\bbf^n_\ratl$ is the vanishing scheme of $f_1,..,f_m$ then this is possible.
\end{lemma}
\begin{proof}
$Y=\spec \ratl[T_1,..,T_n]/(f_1,..,f_m)$, where $f_i$ are polynomials with rational coefficients. We can find $c_1,..,c_m$ positive integes where $c_if_i$ has integer coefficients for all $i$. $X=\spec \intg[T_1,...,T_n]/(c_1f_1,...,c_mf_m)$. Because $c_i^{-1}$ exists in $\ratl$, it produces the same scheme over $\ratl$. 

\end{proof}
However, this is not unique. For example, $Y=\spec \ratl[T]/(T^2/2+1)$. We can take $c=2$ to get $\intg[T]/T^2+2$ and $c=4$ to get $\intg[T]/2T^2+4$. These are not isomorphic fibers over $2$, in fact, they are distinct
$\bbf_2[T]/T^2$ v.s. $\bbf_2[T]$. Worse $T=2U$, $Y=\spec \ratl[U]/(2U^2+1), X=\spec \intg[U]/(2U^2+1)$. Reducetion over $2$ gives $\spec \bbf_2[U]/1=\emptyset$ 

\begin{ex}
(Base change)
$f:X\lrta S$ a morphism, family of schemes.
$$
\begin{tikzcd}
X\times_S T \arrow[d, "f'"'] \arrow[r] & X \arrow[d, "f"] \\
T \arrow[r] & S
\end{tikzcd}
$$
 we can think of $f':X\times_{S}T\lrta T$as some family with different parameter space/ base/
 This process is known as base change. $a\in T$ a point which mapsto $p\in S$
\end{ex}
\subsection{Apr 20th: absent}

\section{Elementary geometry of schemes}
\subsection{Apr 23rd: Some basics of schemes}
\begin{dfn}
$X$ is a scheme. It is called \textbf{connected} if it is connected as a topological space. It is \textbf{irreducible} if it is irreducible as a topological space (it can not be expressed as union of two closed non empty set.)

\underline{Warning:} spearated does not mean $X$ is separated (Hausdorff) as topological space.
\end{dfn}
\begin{dfn}
The dimension of X, denoted $\dim(X)$ is the max number $n$ s.t. there is a chain of closed subsets
$$
Y_0\subsetneq Y_1\subsetneq ...\subsetneq Y_n \subset X.
$$ with each $Y_i$irreducible (with induced topology from $X$).
$$
\dim \spec (A)=\text{Krull dimsnion of $A$}
$$ 
\end{dfn}
[check that $V(I)\subset \spec R$ is irreducible $\Llrta I$ is prime] 

\begin{dfn}
A scheme $X$ is reduced if $\forall U\subset X$ open, $\calo_X(U)$ is reduced (no nilpotents)

And this is equivalent to 
$$
\forall x\in X,\ \  \calo_{X,x} \text{ is reduced.}
$$
\end{dfn}

\begin{dfn}
A scheme $X$ is called \textbf{integral} if for all $U\subset X$ open, $\calo(U)$ is an integral domain.
\end{dfn}
Note that being integral scheme $\not \Llrta$ $\forall x\in X,\calo_{X,x} $ is integral domain.
\begin{lemma}
$X$ integral $\Llrta$ $X$ is reduced and irreducible.
\end{lemma}
\begin{proof}
\begin{itemize}
\item In a scheme $X$ is integral, $\calo_X(U)$ is integral for all open subsets, hence $\calo_X(U)$ is also reduced because integral domain has no nonzero zero divisors.

\item An integral scheme should be irreducible. Assume contrarily $X$ is reducible, and can be written as union of two closed subsets $X=Y\cup Z$. Define the complements $U:=X-Y$ and $V=X-Z$, we know $U,V$ are nonempty opens and their have empty intersection. The structure sheaf $\calo_X(U\cup V)=\calo_X(U)\times \calo_X(V)$ which is not integral in general.
\item Conversely: $X$ reduced + irreducible. Let $U\subset X$ be a open, and assume $\calo_X(U)$ is not integral. (exists $s,tin\calo_X(U)$ such that $st=0$.)

Let $Z_s=\{x\in U| s(x)\in\scm_{X,x}\subset \calo_{X,x}\}$, $Z_t=\{X\in U|t(x\\in\scm_{X,x}\subset \calo_{X,x}$

\underline{Claim}: $Z_t,Z_s$ are closed in $X$. (If $U=\spec A$ is affine, then $s$ corresponds to an element $a\in A$ and
$$
\begin{aligned}
Z_s&=\{\scp\in\spec A| a\in\scp A_\scp\}\\
&=\{\scp\in\spec A|a\in\scp\}\\
&=V(a A)\text{ is  closed}
\end{aligned}
$$

In the general case, it follows that $Z_s\cap \spec A$ is closed for any $\spec A\subset U$ open affine $\Lrta Z_s$ is closed.)

Since $st=0$, we have $s(x)t(x)\in\scm_{X,x}$ for every $x$, so $x\in Z_s\cup Z_t$ for every $x$. $Z_t\cup Z_s=U$.

Since $X$ is irreducible $\Lrta Z_s=U$ or $Z_t=U$. For instance, if $Z_s=U$, then $s|V=0$ nilpotent for every affine $\spec B=V\subset U$ (because $s|V$ corresponds to $a\in A$ which has $U_a=V-V(a)$ is empty set $\Lrta \sqrt{(a)}=\{0\}\Lrta a$ is nilpotent). Since $X$ (hence $U$) is reduced, we get $s|V=0$ for every $V\subset U$ open affine, so by the (sheaf condition) we have $s=0$.
\end{itemize}
\end{proof}
\begin{dfn}
A scheme $X$ is \textbf{locally Noetherian} if there exists an affine open cover of $X$
$\cup_{i\in I} U_i=X$, $\spec A_i=U_i$, with $A_i$ Noetherian. $X$ is \textbf{Noetherian} if there is a  finite such cover.
\end{dfn}
Fact: Hartshone. prop II 3.2
$$
\text{locally Noetherian}\Llrta \forall \spec(A)\subset X \text{ open, } A \text{ Noetherian}
$$

This implies that an affine scheme $\spec A$ is locally Noetherian iff $A$ is Noetherian.

\begin{dfn}
$X\overset{f}{\lrta } Y$ (scheme over $Y$ ) is a morphism \textbf{locally of finite type} $\Llrta$ $\exists Y=\cup_i U_i, U_i=\spec A_i$, such that $\forall i, \exists f^{-1}(U_i)=\cup_i \spec(B_{ij})$ s.t.
$$
\spec(B_{ij})\lrta \spec(A_i)
$$
corresponds to 
$$
A_i\lrta B_{ij}
$$
which makes $B_{ij}$ an $A_i$-algebra of finite type.

$X\lrta Y$ is of finite type if for every $i$ as above, there is a covering with only finitely many $j$.
\end{dfn}
\begin{ex}\ 
\begin{enumerate}[label=(\arabic*)]
\item $K$ a field, $\spec K[X_1,..,X_n]/I$ is Noetherian, of finite type over $K$
$$
\Lrta \spec(K[X]/I)\lrta \spec(K) is of finite type.
$$
\item $\sqcup_{n\geq 0}\affn^n_K\lrta \spec K$ is locally of finite type, not of finite type(over $K$)
\item $\spec (\intg[X_1,..,X_n]/I)\lrta\spec \intg$ is of finite type and Noetherian.
\item $\spec(\ratl)\lrta \spec \intg$ if \textbf{not} of finite type.
\end{enumerate}
\end{ex}
\subsection*{Open and closed subschemes}
\begin{dfn}
$X$ a scheme $U\subset X$ open $(U,\calo_X|U)$ is called an \textbf{open subscheme} of $X$, $j:U\inj  X$ is called an \textbf{open immersion}.
\end{dfn}
\begin{dfn}
(Hartshorne p85) A morphism $Y\overset{f}{\lrta}X$ is a called a \textbf{closed morphism} if 
\begin{enumerate}[label=(\arabic*)]
\item $f$ induces a homeomorphism $Y\lrta f(Y)\subset X$ where $f(Y)$  is closed.
\item
$f^*:\calo_X\rta f_*\calo_Y$ is surjective (surjective at the level of stalks)
\end{enumerate}
\end{dfn}
Intuitively,
$$
\calo_X(U)\lrta \calo_Y(f^{-1}(U))
$$
are not surjective  in general, but  if $s\in(f_*\calo_Y)(U)$, we can find locally  for each $x\in U$ a section  on some open set $V\subset U$ containing $x$ which maps to the restriction of $s$ to $V$.

\begin{dfn}
A \textbf{closed subscheme} of $X$ is an equivalence class of closed immersions modulo


\tikzset{every picture/.style={line width=0.75pt}} %set default line width to 0.75pt        
\centering
\begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
%uncomment if require: \path (0,249.36666870117188); %set diagram left start at 0, and has height of 249.36666870117188


\draw (130,67) node   {$Y$};
\draw (245,68) node   {$X$};
\draw (190,53) node   {$f$};
\draw (188,150) node   {$Y'$};
\draw (146,113) node   {$g$};
\draw (226,117) node   {$f'$};
\draw (335,112) node   {$ \begin{gathered}
f\sim f'\\
\Longleftrightarrow \exists g:Y\overset{\sim }{\longrightarrow } Y'
\end{gathered}$};
\draw    (139.26,80.25) -- (178.74,136.75) ;
\draw [shift={(178.74,136.75)}, rotate = 235.05] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ]   (0,0) .. controls (3.31,-0.3) and (6.95,-1.4) .. (10.93,-3.29)(0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;

\draw    (197.21,136.75) -- (235.79,81.25) ;
\draw [shift={(235.79,81.25)}, rotate = 484.8] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ]   (0,0) .. controls (3.31,-0.3) and (6.95,-1.4) .. (10.93,-3.29)(0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;

\draw    (140.57,67.09) -- (233.98,67.9) ;
\draw [shift={(233.98,67.9)}, rotate = 180.5] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ]   (0,0) .. controls (3.31,-0.3) and (6.95,-1.4) .. (10.93,-3.29)(0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;
\end{tikzpicture}
\end{dfn}
\begin{ex}
Let $X=\spec (A)$ let $I\subset A$ be an  ideal and $\spec(A/I)\overset{f}{\lrta}\spec A$ the canonical morphism. Then it is a closed immersion:

We saw that $\spec A/I\overset{\sim}{\lrta}V(I)\subset \spec(A)$ is a homeomorphism.
$\forall \scp \in V(I)$ the morphism $\calo_{A,\scp}\lrta \calo_{A/I,\scp/I}$ is $A_\scp\lrta (A/I)_{\scp/I}$ which is surjective by elementary localization.
\end{ex}
\begin{prop}
$(1)$
$A$ is a ring. If 
$$
Y\overset{f}{\lrta} \spec A
$$ 
is a closed immersion, there exists an ideal $I\subset A$ such that $f$ is equivalent to $\spec(A/I)\lrta \spec (A)$: There is a commutative diagram where the lower map is the canonical closed immersion.
$$
\begin{tikzcd}
Y \arrow[r, "f"] \arrow[d, "\sim"] & \spec(A) \\
\spec(A/I) \arrow[ru] & 
\end{tikzcd}
$$
(elementary proof in Wedhorn, best proof is to use coherent sheaves)

$(2)$ Consider
$$
\begin{tikzcd}
Z\times_X Y \arrow[r, "\tilde{j}"] \arrow[d] & Y \arrow[d] \\
Z \arrow[r, "j"] & X,
\end{tikzcd}
$$ 
where $j$ is closed immersion. Then $\tilde{j}$ is a closed immersion. (e.g. $Z=\spec \kappa(x)$ where $x\in X$ is a closed point, then $Z\lrta X$ is a closed immersion and hence also $f\spec \kappa(x)\times_X Y\lrta Y$ is a closed immersion)

$(3)$ Note that a closed subscheme of $X$ is not determined by its image in $X$.

e.g. $\spec(A/I)$``$=$''$\spec (A/J)$ iff $\sqrt{I}=\sqrt{J}$ which may give  infinitely many $J$ for  a given $I$.
$n\geq 1$, $\spec K[X]/(X^n)\inj \spec(K[X])$ all have the same image $XK[X]$. Intuitively, it is they are both the point $0$ but ``memorize'' different information of derivatives.
\end{prop}

\begin{prop}
>>>>>>>1
\end{prop}
If $V(I)=Y\subset X=\spec A$, take $\spec A/\sqrt{I}$ which is a reduced closed subscheme with image $V(I)$. [This is called the reduced induced scheme structure on $Y$.]

\subsection{Apr 27th: Projective space and schemes}
\begin{dfn}
$S$ is a scheme, $n\geq 1$ $\proj^n_S=\proj^n_\intg\times_{\spec \intg} S$
\end{dfn}

\section*{Two standard constructions of $\proj^n_\intg$}
\begin{enumerate}[label=(\arabic*)]
\item $\mathsf{Proj}$ of a graded ring (hartshorne p 76)
$$
A=\oplus_{d\geq 0} A_d, ~A_d A_e\subset A_{d+e}
$$
$A_0$ is a ring and each $A_d$ is an $A_0$-module.

\underline{Ex} $A=B[X_1,..,X_n],A_0=B$

To each such $A$, one can associate a scheme $\text{Proj}(A)$ which generalizes classical projective algebraic sets. For $\proj^n_\intg$ we take $A=\intg[X_0,...,X_n]$. Let $A^+:=(X_0,..,X_n)$. The definition of $\text{Proj}(A)=\proj^n_\intg$ is 
$$
\proj^n_\intg=\{P\subset A\mid \text{prime and homogeneous ideal in $A$ such that} P\notsupset A^+\}.
$$

Topologically, the closed sets $V^p(I)=\{P\in\proj^n_\intg|I \subset P\}$ homogeneous and for $U\subset \proj^n_\intg$ open
$$
\calo_{\proj_\intg^n}(U)=\left\{
s:U\lrta \sqcup_{P\in U}A_{(P)}\left| \begin{aligned} &\forall P, s(P)\in A_{(P)},\\
&\text{ and  locally } s(P)=a/b,\\
& \text{ where } a,b \text{ homogeneous  of same degree}
\end{aligned}
\right\}
\right.,
$$
where $A_{(P)}=\{\text{degree $0$ elements in localization of $A$ w.r.t. $S-P$, homogeneous}\}$

\underline{FACTS}:
\begin{enumerate}
\item $\proj^n_\intg$ is  a locally-ringed space
\item $\proj^n_\intg$ is a scheme, more precisely, for each $i\in \{0,...,n\}$, let $U_i=\{P\in \proj^n_\intg|X_i\notin P\}$, then $U_i$ is open and $\cup_i U_i =\proj^n_\intg$(because $P\in \proj^n_\intg$ does not contain $A^+$).

By ``dehomogeneousation'' one has an isomorphism
$$
U_i\overset{\sim}{}\lrta 
\spec(\intg[Y_1,...,Y_n])\simeq \affn^n_\intg$$
\end{enumerate}
\item ``Glueing''

        

\begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
%uncomment if require: \path (0,249.36666870117188); %set diagram left start at 0, and has height of 249.36666870117188

\draw   (308,81) .. controls (328,71) and (325.3,64.9) .. (342.65,96.95) .. controls (360,129) and (378,111) .. (398,141) .. controls (418,171) and (328,171) .. (308,141) .. controls (288,111) and (288,91) .. (308,81) ;
\draw   (153,62) .. controls (173,52) and (211.65,47.95) .. (191.65,67.95) .. controls (171.65,87.95) and (223,92) .. (243,122) .. controls (263,152) and (173,152) .. (153,122) .. controls (133,92) and (133,72) .. (153,62) ;
\draw [color={rgb, 255:red, 239; green, 46; blue, 46 }  ,draw opacity=1 ]   (213.65,96.95) .. controls (199.65,107.95) and (197.65,118.95) .. (184.65,138.95) ;


\draw [color={rgb, 255:red, 45; green, 44; blue, 191 }  ,draw opacity=1 ]   (295,115) .. controls (298.65,111.95) and (302.65,126.95) .. (342.65,96.95) ;


\draw    (223,77) .. controls (263,47) and (263.65,68.95) .. (295.65,74.95) ;
\draw [shift={(295.65,74.95)}, rotate = 192.47] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ]   (0,0) .. controls (3.31,-0.3) and (6.95,-1.4) .. (10.93,-3.29)(0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;

\draw    (295.65,86.95) .. controls (273.65,106.95) and (268.65,118.95) .. (220,107) ;
\draw [shift={(220,107)}, rotate = 373.35] [color={rgb, 255:red, 0; green, 0; blue, 0 }  ]   (0,0) .. controls (3.31,-0.3) and (6.95,-1.4) .. (10.93,-3.29)(0,0) .. controls (3.31,0.3) and (6.95,1.4) .. (10.93,3.29)   ;


\draw (214,49) node   {$X_{1}$};
\draw (223,126) node   {$x$};
\draw (422,103) node   {$X_{2}$};
\draw (323,89) node   {$y$};


\end{tikzpicture}

Glueing constructs $``X_1\cup X_2$ where each point $x$ is ``identified'' with the corresponding point $y$ in $X_2$.
\begin{figure*}[h]
\includegraphics[width=0.2\textwidth]{cocycles.pdf}
\end{figure*}
More generally: we need to take care of intersections
>>>>>>>>>>1
\end{enumerate}
\begin{prop}
Given the glueing datum on $(X_i)_{i\in I}$, there is a scheme $X$ obtained by ``glueing the $X_i$'s along the $U_{ij}$ using $\varphi_{ij}$'s '' given by 
$$
X=\left(\sqcup_{i\in I}X_i\right)/\sim,
$$
where the equivalence relation is each $x\in X_i$ is identified with $\varphi_{ij}(x)\in X_{j}$ for $j\neq i$ if $x\in U_{ij}$, with the quotient topology. The quotient map $\sqcup X_i\overset{f}{\lrta} X$ is open, in particular $f(X_i)\subset X$ is open).

Note: $\sim$ is an equivalence relation because of the cocycle relation: if $y=\varphi_{ij}(x)$, then $x=\varphi_{ij}^{-1}(y)=\varphi_{ji}(y)$. If $y=\varphi_{ij}(x),x\in U_{ij},z=\varphi_{jk}(y), y\in U_{jk}$ and $x\in U_{ik}$, then $\varphi_{ik}(x)=\varphi_{jk}\circ \varphi_{ij}(y)$ so $x\sim y\sim z\Lrta X\sim z$ and with structure sheaf
$$
\calo_X(U)=\{(s_i)_{i\in I}|s_i\in \calo_{X_i}(U\cap X_i) \text{ s.t. } \varphi_{ij}^{\alpha}(s_{j}|U\cap U_{ji}=s_i|U\cap U_{ij}\},
$$
\begin{figure*}[h]
\includegraphics[width=0.3\textwidth]{pic2Aprl27.pdf}
\end{figure*}
we want
$\varphi_j(y)=\varphi_i(\varphi_{ij}^{-1}(y))$
\end{prop}
Note that the projection 
$$
f:\sqcup X_i\lrta X
$$ induces a homomorphism
$X_i\overset{\sim}{\lrta} f(X_i)\subset X$ with open image [$f|X_i$ is injective.]

We identify $X_i$ with $f(X_i)\subset X$ to write $U\cap X_i$ for instance (really it is $f^{-1}(U)\cap X_i$). Then $(X,\calo_X)$ is a ringed space  and there is an isomorphism 
$X_i\lrta f(X_i)$ of ringed spaces, it follows that(since $f(X_i)$ is open) that $X$ is a scheme.

Here we fix $j$,
$$
\calo_{f(X_j)}\lrta f_*\calo_{X_j}
$$
is given by 
$$
(s_i)\mapsto \text{ the unique $s$ section of $\calo_{X_j}$ that coincides with $s_i$ on} X_i\cap X_j=U_{ij}\subset X_i
$$
\underline{Application to } $\proj^n_\intg$. Let $A=\intg[X_0,...,X_n, X_0^{-1},...,X_n^{-1}]$. In $A$, we have subrings $A_i=\intg[\frac{X_0}{X_i},...,\frac{X_n}{X_i}]$. Note $A_i\simeq \intg[Y_1,..,Y_n]$ by 
$$
\begin{aligned}
&\frac{X_0}{X_i}\mapsto Y_1\\
&\frac{X_{i-1}}{X_i}\mapsto Y_{i}\\
&\frac{X_{i+1}}{X_i}\mapsto Y_{i+1}\\
&\frac{X_n}{X_i}\mapsto Y_n
\end{aligned}
$$
Let $X_i=\spec(A_i)$ ($\simeq \affn^n_\intg$), ($0\leq i \leq n$). Let $U_{ij}\subset X_i$ be $\spec(A_i,\frac{X_j}{X_j})=\spec (\intg[\frac{X_0}{X_i},...,\frac{X_n}{X_i},\frac{X_i}{X_j})$ is an open subset in $X_i$.

Note that $B_{ij}=B_{ji}$, the identity $B_{ij}\lrta B_{ji}$ corresponds to an isomorphism 
$$
\varphi_{ij}:U_{ij}\lrta U_{ji}.
$$
Since the ring part is identity, the cocycle condition holds.
\begin{dfn}
$\proj^n_\intg$ is the glued scheme in that case
i.e. covered by $n+1$ open subschemes $\simeq \affn^n_\intg$, it is of finite type, Noetherian, integral ...
\end{dfn}
\begin{dfn}
$S$ is a  scheme, A projective $S-$scheme
$$
X\overset{f}{\lrta} S
$$
is a morphism such that there is a factorization
$$
X\overset{\text{closed immersion}}\inj \proj^n_S\lrta S
$$
for some integer $n\geq 1$.
\end{dfn}

How to concretely construct projective scheme over $K$? Let $K$ be a field,. Let $f\in K[X_0,...,X_n]$ homogeneous. \underline{Goal}: Define the zero set $Y$ of $f$ as a  closed subscheme of $\proj^n_K$. We are going to do it by glueing up the corresponding intersection
$$
Y\cap U_i
$$
We define the dehomogeneousation 
$$
f_i:=f\left(\frac{X_0}{X_i},..,1,..,\frac{X_n}{X_i}\right)\in K[\frac{X_0}{X_i},...,\frac{X_n}{X_i}]=A_i
$$
for $0\leq i\leq n$.
So we get \underline{closed immersions}
$$
Y_i=\spec(A_i/f_i A_i)\inj U_i
$$
Idea: $Y$ is obtained by glueing the $Y_i$ by identify $Y_i\cap U_{ji}$ with $Y_j\cap U_{ji}$ along $\varphi_{ij}$.

Precisely: Let $B_{ij}=K[\frac{X_0}{X_i},...,\frac{X_n}{X_i},\frac{X_i}{X_j}]$,
$$
Y_i\cap U_{ij}=\spec(B_{ij}/f_i B_{ij})
$$
and
$$
Y_i\cap U_{ij}=\spec(B_{ji}/f_j B_{ji})
$$
$$
\begin{tikzcd}
B_{ij} \arrow[r] \arrow[d, equal] & B_{ij}/f_iB_{ij} \arrow[d, "\sim"] \\
B_{ji} \arrow[r] & B_{ji}/f_jB_{ji}
\end{tikzcd}
$$
commutative because $f_i$ and $f_j$ generate the same ideal ub $B_{ij}=B_{ji}$, since
$$
\begin{aligned}
f_j &=\sum_J \alpha_J \left(\frac{X_0}{X_j}\right)^{d_0}\cdots\left(\frac{X_i}{X_j}\right)^{d_i}\cdots \left(\frac{X_n}{X_j}\right)^{d_n}\\
&=\sum_J \alpha_J \left(\frac{X_0}{X_i}\right)^{d_0}\cdots\left(\frac{X_i}{X_i}\right)^{d_i}\cdots \left(\frac{X_n}{X_i}\right)^{d_n}\cdot \left(\frac{X_j}{X_i}\right)^{d_0+\cdots d_n}\\
&= f_i \cdot \left(\frac{X_j}{X_i}\right)^{d_0+\cdots d_n}
\end{aligned}
$$



\subsection{May 4th-A: Projective schemes continued}
Recall: $\proj^n_\intg=$``glueing'' $U_i:=\spec(\intg[
X_0/X_i,..., X_n/X_i])$ along open subsets $U_{ij}=\spec(\intg[...]_{X_j/X_i})$

$f\in K[X_0,...,X_n]$ is non-constant homogeneous polynomial, $\leadsto$``vanishing scheme $Z_f$'' by  glueing the closed subschemes of $U_{i,K}=U_i\times_{\spec(\intg)}\spec (K)$ defined by $f_i=f(X_0/X_i,....,X_n/X_i)$. WE can do this with $f^{(1)},f^{(2)},....,f^{(m)}$ homogeneous of some degrees $\leadsto $ vanishing sets of finitely many homogeneous polynomials.

\underline{Fact}: These ``vanishing sets '' are closed subscheme of $\proj^n_K$ all closed subscheme of $\proj^n_K$ arise in this way.

\underline{Reason}: let $Y$ be this vanishing scheme; it is defined by glueing closed subschemes.
$$
Y_i\overset{\varphi_i}{\inj} U_{i,K}=\affn^n_K
$$
where 
$$
Y_i=\spec(K[X_0/X_i,...,X_n/X_i])/(f_i^{(1)},...,f_i^{(m)}).  
$$
One checks that there is a unique morphism
$$
\varphi:Y\lrta \proj^n_K
$$
such that  $\varphi|Y_i=\varphi_i$. and that $\varphi$ is a closed immersion. (Because every point has one $Y_i$ as an open neighbourhood
and $\varphi_i$ is a closed immersion.)

\begin{ex}
In $\proj^2_\intg$, we have a closed subscheme defined by 
$$
Y^2Z-X^3-XZ^2
$$
and on $U_2=\spec(\intg[X/Z,Y/Z,1])$ it is isomorphic to the closed subscheme of $\affn^2_n=\spec(\intg[U,V])$
$$
\left(\frac{Y}{Z}\right)^2-\left(\frac{X}{Z}\right)^3-\left(\frac{X}{Z}\right)=V^2-U^3-U.
$$
\end{ex}


\section{Divisors}
\subsection{May 4th-B: Weil divisors}
Divisors are the first non-trivial geometric invariants of the schemes and have many applications and forms.
\begin{itemize}
	\item classification of ``hypersurfaces'' in a scheme $X$. (Weil divisors.)
	\item certain sheaves (invertible sheaves of $\calo_X$-modules)
	\item Picard groups $\leadsto$ morphisms of projective spaces.
\end{itemize}

In order to define Weil divisors, the scheme is required to be Noetherian and integral. We usually look at those schemes with nice enough properties so that we don't have to worry about Cartier divisors
\begin{dfn}
Let $X$ be scheme. $X$ is \textbf{regular in codimension one} if for any $x\in X$ where $\dim(\calo_{X,x})=1$, the local ring $\calo_{X,x}$ is regular ($\dim \scm/\scm^2=1$). i.e. each local ring $\calo_{X,x}$ of dimension one is regular.
\end{dfn}

In this section, we require the scheme to be Noetherian integral, separated scheme which is regular in codimension one.
(In general a Noetherian local ring $(A,\scm)$, with $k=A/\scm$ is called regular if the dimension of $A$ is equal to the $\dim_k \scm/\scm^2$  this means $X$ has some minimal ``smoothness'')
\begin{ex}
\ \begin{enumerate}[label=(\arabic*)]
\item Assume, a scheme $X$ if of finite type over a filed $K$, then $X$ is regular in codimension one  if $X$ is ``non-singular'' in the sense analogue of definition of non-singular varieties.
\item $X=\affn_K^n=\spec(K[X_1,..,X_n])$. To say that $\scp\in X$ has dimension one means $\dim \calo_{X,\scp}=1\Llrta $ height of $\scp$ is equal to $1$. Because
$$
\calo_{X,\scp}=K[X_1,...,X_m]_{\scp} 
$$
in which prime ideals are exactly in bijection with prime ideals $\scq\subset \scp$. In $K[X_1,..,X_n]$ a prime ideal of height $1$ is principal ideal generated by $f$ irreducible. We also know that in that case $K[X_1,..,X_n]_{(f)}$ is regular.
\item $\proj^n_K$ is also regular in codimension $1$, because it is a local condition, and we apply $(2)$.
\item Any smooth curve over a field (points of dimension $1$ are closed points.)
\item If $X$ is a singular curve, it is not regular in codimension $1$.
\item $\spec(\intg)$ is also regular in codimension $1$. (the points of dimension $1$ are $p\intg$ and local ring  at $p\intg$ is 
$$
\calo_{\intg,p}=\left\{\frac{a}{b}\in \ratl| a,b \text{ coprime } and p\nmid b\right\}
$$
which is a regular local ring.
\end{enumerate}
\end{ex}
\underline{Convention:} Below in this section, $X$ is Noetherian, integral, regular in codimension $1$. (quasiprojective over affine base)
$$
X\underset{\inj}{\text{\tiny open}} Y\underset{\inj}{\text{\tiny closed }} \proj^n_S\lrta S
$$
In particular, $X$ is of finite type over $S$.

We look at closed subschemes of codimension $1$ in $X$.
\tikzset{every picture/.style={line width=0.75pt}} %set default line width to 0.75pt        

\begin{center}




\tikzset{every picture/.style={line width=0.75pt}} %set default line width to 0.75pt        

\begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
%uncomment if require: \path (0,300); %set diagram left start at 0, and has height of 300

\draw   (140,48) .. controls (160,38) and (391.65,18.85) .. (371.65,38.85) .. controls (351.65,58.85) and (336.65,160.85) .. (356.65,190.85) .. controls (376.65,220.85) and (119.65,225.85) .. (99.65,195.85) .. controls (79.65,165.85) and (120,58) .. (140,48) ;
\draw [color={rgb, 255:red, 149; green, 125; blue, 8 }  ,draw opacity=1 ]   (207,174) .. controls (398.65,94.85) and (96.65,89.85) .. (307,174) ;


\draw [color={rgb, 255:red, 126; green, 211; blue, 33 }  ,draw opacity=1 ]   (261.65,41.85) .. controls (236.65,80.85) and (189.65,117.85) .. (171.65,186.85) ;


\draw [color={rgb, 255:red, 208; green, 2; blue, 27 }  ,draw opacity=1 ]   (151.65,89.85) .. controls (177.65,79.85) and (185.65,77.85) .. (215.65,81.85) ;


\draw [color={rgb, 255:red, 208; green, 2; blue, 27 }  ,draw opacity=1 ]   (189.65,42.85) .. controls (185.65,73.85) and (182.65,89.85) .. (182.65,126.85) ;


\draw [color={rgb, 255:red, 126; green, 211; blue, 33 }  ,draw opacity=1 ]   (266.65,39.85) .. controls (241.65,78.85) and (194.65,115.85) .. (176.65,184.85) ;


\draw    (127.65,144.85) .. controls (167.65,114.85) and (294.65,90.85) .. (334.65,60.85) ;



\draw (91,59) node  [align=left] {{\LARGE $X$}};


\end{tikzpicture}

\end{center}

Regular codimension $1$ $\Lrta$ any such subscheme is a union of irreducible pieces, each of which is of the form $f^n=0$, $(n\geq 1)$ with $\{f=0\}$ being integral.

\begin{dfn}
\ \begin{enumerate}[label=(\arabic*)]
\item  A \textbf{prime (Weil) divisor} $D$ in $X$ is an integral closed subscheme of codimension $1$. (there is no intermediate closed subscheme between $D$ and $X$)
\item The \textbf{group of Weil divisors} on $X$ is the free abelian group generated by  prime divisors.
$$
\sum_{i\in I, finite} n_i D_i
, n_i\in \intg\text{ and } D_i \text{ prime divisors }
$$
It is denoted $\text{Div}(X)$. A divisor $D=\sum_i n_i D_i$ is effective if all $n_i\geq 0$. Intuitively, effective divisor $\sum_i n_i D_i$ corresponds to the closed subscheme union of the $D_i$'s with multiplicity $n_i$.
\end{enumerate}
\end{dfn}
\begin{dfn}
The \textbf{function field} of $X$ is the residue field/local ring at the generic point $\eta$ of $X$. An element $f$ of $K(X)$ is therefore the equivalence class of $(U,s)$ where $U$ is 
an open set $\emptyset \neq U\subset X$ and $s\in \Gamma(U,\calo_X)$.
\end{dfn}
\begin{ex}
$K(\affn^n_K)=K(X_1,...,X_n)=K(\proj^n_K)$
\end{ex}
\begin{lemma}
Let $D$ be a prime divisor, and $\eta_D$ its generic point. Let $\tilde{\eta}_D$ be the image of $\eta_D$ in $X$. The ring 
$\calo_{X,\tilde{\eta}_D}$ is a DVR with fraction field $K(X)$
\end{lemma}
\begin{proof}
\underline{Affine Case}: $D=\spec(A/\scp)$ with $\scp$ prime ideal so that $A/\scp$ is integral. $\eta_D=\{0\}\subset A/\scp$ and $\tilde{\eta}_D=\scp\in \spec(A)$.

$D$ has codimension $1$, $\Llrta$ $\text{ht}(\scp)=1\Llrta \dim \calo_{X,\tilde{\eta}_D}=\dim A_\scp=1$ so by regularity in codimension $1$, $A_\scp$ is a regular local ring of dimension $1$, Noetherian, i.e. it is a DVR $\Llrta $ [maximal ideal is principal. ] Then $K(X)=Frac(A)=Frac(A_\scp)$. 
\end{proof}

Now given $D$ a prime divisor, $f\in K(X)^{\times}$, we denote by $\nu_D(f)$ the valuation at $D$ of $f$, $f\in Frac(\calo_X,\tilde{\eta}_D)$. $(\scm_{X,\tilde{\eta}_D} =(\varpi))$ then $f\in Frac(\calo_{X,\tilde{\eta}_D})$ is of the form $\frac{a}{b}$, $a, b$ in $\calo_{X,\tilde{\eta}_D}$, 
$a=\varpi^n u, n\geq 0, u\in\calo_{X,\tilde{\eta}_D}^\times$ and $b=\varpi^m v, m \geq 0, v\in\calo_{X,\tilde{\eta}_D}^\times$ and $\nu_D(f)=n-m$.

\underline{Intuitively:}
$d=\nu_D(f)\geq 1$ means $f$ has a zero of order $d$ along $D$ ( has degree of vanishing $d$ along $D$). $d\geq -1$ means a pole of order $-d$ (a zero of order $d$ of $1/f$)



\begin{lemma}[Hartshorne II 6.1] If $f\in K(X)^\times$ then $\nu_D(f)=0$ for all but at most finitely many prime divisors $D$.
\end{lemma}
\begin{dfn}
For 
$f\in K(X)^\times$,
$$
div(f)=\sum_{D\text{ prime}} \nu_D(f) D \in \text{Div}(X)
$$
$$
div:K(X)^\times\lrta \text{Div}(X)\text{ group morphism }
$$
The group of all $div(f) $ is called the group of principal divisors. The quotient
$$
\text{Div}(X)/Im(div)=\text{Cl}(X)
$$
is the \textbf{divisor class group } of $X$
\end{dfn}
\begin{proof}[Proof of lemma immediately above]
Let $f\in K(X)^\times$, view it as $f\in \Gamma(U,\calo_X),$ where $\emptyset \neq U=\spec(A)$ is affine. Let $Z=X-U$, closed in $X$, with reduced subscheme structure.

$\{D\text{ prime }\mid D\subset Z \}$ is finite because $X$ (hence $Z$) is  Noetherian.

Example. $f=X^2+3X^2Y+Y^3/(XY)$, $Z=$ union of coordinate axes, each is prime. If $D$ is not in $Z$ then $U\cap D=D_U$ is non-empty, and hence dense in $D$. Claim. $U\cap D$ is a prime divisor in $U$. Then $\nu_{D\cap U}(f)[=\nu_D(f)]\geq 0$ since $f\in \Gamma(U,\calo_X)=A$ and to say that $\nu_{D\cap U}(f)\geq 1$ means $D\cap U\subset V(fA)$ proper closed in $U$. So again this happens for finitely many $D$.

WHy is $U\cap D$ a prime divisors in $U$?
\begin{center}


\tikzset{every picture/.style={line width=0.75pt}} %set default line width to 0.75pt        

\begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
%uncomment if require: \path (0,300); %set diagram left start at 0, and has height of 300

\draw    (196.65,66.25) -- (313.65,64.25) ;
\draw [shift={(313.65,64.25)}, rotate = 539.02] [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ] [draw opacity=0] (8.93,-4.29) -- (0,0) -- (8.93,4.29) -- (8.93,-4.29)    ;


\draw (179,64) node   {$D$};
\draw (186,133) node   {$\emptyset \neq D\cap U$};
\draw (328,65) node   {$X$};
\draw (328,134) node   {$U$};
\draw (181,99) node [rotate=-269.62]  {$\subset $};
\draw (327,95) node [rotate=-269.62]  {$\subset $};
\draw (259,137) node   {$\subset $};
\draw (148,99) node [rotate=-271.46] [align=left] {open};
\draw (350,94) node [rotate=-269.51] [align=left] {open};
\draw (253,49) node  [align=left] {closed};


\end{tikzpicture}

\end{center}
$D\cap U$ is an open subscheme of $D$ then check that $D\cap U\simeq D\times_X U$, so $D\cap U\inj U$ is a closed immersion. Moreover $D\cap U$ is integral because $D$ is integral. One checks that $D\cap U$ is also of codimension $1$
$$
K(U)=k(X)
$$
$$
\Lrta \nu_{D\cap U}=\nu_D
$$
\end{proof}

\subsection{May 8th-A: Divisors continued}

Reminder:
 Let $X$ be a scheme, which is integral regular in codimension one, Noetherian, quasi-projective.

 We defined $Div(X):=$ free Abelian group with basis of the integral codimension 1 subschemes.

 $f\in K(X)^\times$

 $\Lrta div(f)=\sum_D \nu_D(f)D$
 
 $div$ gives a group morphism $K(X)^\times\lrta Div(X)$

\begin{dfn}
$Cl(X)=Div(X)/Im div$ is called the divisor class group.
\end{dfn}
\begin{ex}
\begin{enumerate}[label=(\arabic*)]
\item
Let $X$ be  a smooth curve over a field $K$
$\Lrta$ prime divisors are closed points of $X$, an $f\in K(X)^\times$ can be seen as a non-constant morphism 
$$
f:X\lrta \proj^1_K
$$
and $div(f)=$zero of $f$ with multiplicities or poles of $f$ with multiplicities.

$Cl(X)\llrta$ ``given points $x_1,...,x_m$ and$y_1,...,y_n$  with specified integers of $\nu_1,..,\nu_m\geq 1$ and $\mu_1,...,\mu_n\geq 1$''. Is there an 
$$
f: X\lrta \proj^1_K
$$
s.t. $f$ has zeros at $x_i$ with multiplicities $\nu_i$ and poles at $y_j$ with multiplicities $\mu_j$

$\leadsto$ \textbf{Riemann-Roch Theorem}
\item $X=\affn^1_K=\spec(K[T])$. Prime divisors is in one to one correspondence with irreducible monic polynomials in $K[T]$ and divisor can be identifies to $f_1/f_2$, where $f_1,f_2$ are coprime monic polynomials. BY $\sum n_i D_i\mapsto \prod_i f_i^{n_i}$ 
(This is historically one of the motivating cases)
\item $X=\affn^n_K$ (or $\affn^n_\intg$)
\underline{Claim}: $Cl(X)=0$.
(In fact: prop II 6.2 in Hartshorne If $A$ is, integral domain and integrally closed , then $A$ is $UFD$ $\Llrta Cl(\spec(A))=0$)

Any prime divisor $D$ in $\affn^n_K$ is of the form $V((f))$ for $f\in A$ irreducible, thus $D=\spec(A/(f))$.

 Let $D=\sum n_i D_i$ be a divisor with $n_\geq 1$, $D_i$ distinct. We can define $f_i$ so that
 $$
D_i=\spec(A/(f_i))
 $$
 and let $f=\prod f_i^{n_i}\in K(T_1,...,T_n)^\times=K(\affn^n_K)$.
 Then recall how to compute $div(f)$: $D$ prime divisor, $D=\spec(A/(g))$
 $$
 \begin{aligned}
 \calo_{\affn^n_K,\tilde{\eta}_D}
 &=A_{(g)}\\
 &=\{f_1/f_2\in K(T_1,..,T_n)^\times: g\nmid f_2\}
 \end{aligned}
 $$
 is indeed a DVR with maximal ideal generated by $g$, and $\nu_D(f_1/f_2)=$ the exponent of $g$ $=k$ s.t. 
 $f_1/f_2=f^k u$, with $u\in A_{(g)}^\times$. So $div(f)=\sum n_i D_i=D$ so any $D$ is principal, therefore $Cl(\affn^n_K)=0$

\item $Cl(\spec K)=\{0\}$ has no prime divisors. Consider $L/\ratl$ finite extension. Let $A\subset L$ be the integral closure of $\intg$. Then $\spec(A)$ is regular of codimension one, so 
$
Cl(\spec A)
$
is defined.
This is isomorphic to the ``ideal class group'' $H(L)$ of $L$.

We sketch the reason here.
$$
H(L)=\{\text{fractional ideals}\}/\{\text{ principal ideals}\}
$$
where $\{\text{fractional ideals}\}\simeq\text{free Abelian group generated by prime ideals}$ and  a fractional ideal is principal iff it is associated to a principal ideal.

There are still many open questions: are there infinitely many $L/\ratl$ with $Cl(\spec A)=0$? (i.e. $A$ UFD)

How are $Cl(\spec A)$ distributed when $L/\ratl$ varies? (Cohen-Lenstra Heuristics)

\item $X=\proj^n_K$ with $K$ is a field.

\underline{Fact}: the prime divisors are the closed subschemes associated to a single homogeneous irreducible polynomials $f\in  K[X_0,..,X_n]$.
\begin{thm}
(II 6.4) Define a group morphism from the $\underline{deg}: Div(X)\lrta \intg$
$$
D\longmapsto \underline{deg}(f)
$$ 
where $D$ is the subscheme associated to homogeneous polynomial $f$.
\begin{enumerate}[label=(\alph*)]
\item For all principal divisors $div(f), f\in K(X)$, we have $\underline{deg}(f)=0$.
\item The induced morphism from class groups to $\intg$ 
$$
Cl(X)\overset{\underline{deg}}{\lrta }\intg
$$
is  an isomorphism.
\item $Cl(X)$ is isomorphic to $\intg$ with generator any 
$$
H_i=\proj^n_K-U_i
$$
where $U_i$ is  the canonical affine chart of $\proj^n_K$ corresponding to $X_i$
\end{enumerate}
\end{thm}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item (A function on $\proj^n_K$ has the same number of zeros and poles with multiplicities) We know
$$
K(X)^\times=K(U_0)^\times
$$
where $U_0=\spec(K[X_0/X_0,X_1/X_0,..,X_n/X_0])$. So $K(X)=K(X_0/X_0,...,X_n/X_0)$
So $f\in K(X)^\times$ is of the form $f=f_1/f_2$ where $f_i \in K[X_0/X_0,..,X_n/X_0]$. 

\underline{Key fact}: 
$f$ us also $f=g_1/g_2$ where $g_i$ is homogeneous of degree $deg g_1=deg g_2$ in $K[X_0,..,X_n]$. Then factor $g_1,g_2$ in irreducibles in $K[X_0,..X_n]$, there are homogeneous, say 
$$
f=\prod_i h_i^{n_i}\prod_j k_j^{-m_j}
$$
with $n_i\geq 1, m_j \geq 1$
Then 
$$
div(f)=\sum n_i D_i-\sum m_j E_j
$$
and $D_i$ is the prime divisors of $h_i$, $E_j$ is the prime divisors of $k_j$. (Intuitively, it is clear, but we need a proof)

$\Lrta$
$$
\begin{aligned}
\underline{deg}(div(f))&=\sum n_i \underline{deg}(D_i-\sum m_j \underline{deg}(E_j)\\ 
&(\underline{deg}(D_i)=deg(h_i),\underline{deg}(E_j)=deg(k_j))\\
&=deg(g_1)-deg(g_2)=0.
\end{aligned}
$$
Then we come back to prove the \underline{Key fact}:
$$
f_1=\sum_{\underline{d}}\alpha_{\underline{d}} \left(\frac{X_0}{X_0}\right)^{d_0}\cdots \left(\frac{X_n}{X_0}\right)^{d_n}
$$
e.g.
$$
\begin{aligned}
&\left(\frac{X_1}{X_0}\right)^{2}+37 \left(\frac{X_1}{X_0}\right)^{3}\left(\frac{X_2}{X_0}\right)\\
&=\frac{X_0^2X_1^2+37X_1^3X_2}{X_0^4}\\
&=\frac{1}{X_0^{deg f_1}}\sum_{\underline{d}}\alpha_{\underline{d}} X_0^{deg f_1-\sum_{i=1}^n d_i} X_1^{}d_1\cdots X_n^{d_n}\\
&=\frac{\text{homogeneous degree $deg f_1$}}{X_0^{deg f_1}}\\
\end{aligned}
$$
$$
\Lrta f_2=\frac{\text{homogeneous degree $deg f_2$}}{X_0^{deg f_2}}\\
$$
$$
\Lrta \frac{f_1}{f_2}=\frac{X_0^{ deg f_1}(deg f_1)}{(deg f_2) X_0^{deg f_1}}
$$

\item $\underline{deg}: Cl(X)\lrta \intg$ is surjective because $\underline{deg}(D_0)=1$, $D_0$ associated to $X_0$ and injective because if $deg(D)=0$ write $D=D_1-D_2$ with $D_1,D_2$ effective then $\underline{deg}(D_1)=\underline{deg}(D_2)$. Write 
$D_1=\sum n_i E_i$, where $E_i$ is prime divisors associated to $h_i$. 
$D_2=\sum m_j F_j$, where $F_j$ is prime divisors associated to $k_j$. 


Then let $f=\prod h_i ^{n_i}\prod k_j^{- m_j}\in K(X)^\times$, and as shown above $dic(f)=D_1-D_2=D$ so $D$ is  $0$ in $Cl(X)$.
\item the proof can be found in Hartshorne
\end{enumerate}
\end{proof}
\item Further examples: 
\begin{enumerate}[label=(\alph*)]
\item $X\subset \proj^4_K$ cubic, where $K$ is an algebraic closed field. $X$ is a  surface, smooth, then $Pic(X)\simeq \intg^7$
\item $Y\subset \proj^2_K$ curve of degree $d$. Let $U\subset \proj^3_K-Y$ be the complements, then 
$$
CL(U)\simeq \intg/d\intg
$$
generated by $U\cap H_0$
\end{enumerate}
\end{enumerate}
\end{ex}

\section{Picard group}
\subsection{May 8th-B: Picard group, definitions}
\begin{dfn}
Let $(X,\calo_X)$ be a ringed space. A sheaf of $\calo_X-$ modules is a sheaf
$\calf$ on $X$ so that $\calf(U)$ is a $\calo_X(U)$-module for any open $U$ and for $V\subset U$
$$
\calf(U)\overset{\res}{\lrta}\calf(V)
$$
is linear i.e. given $f\in \calo_X(U), s\in \calf(U)$
$$
\res (f s)=\res(f)\res(s)
$$
\end{dfn}

One defines in an obvious way $\calo_X$-linear morphism of $\calo_X$-modules
[$\forall U, \calf_1(U)\lrta\calf_2(U)$ is $\calo_X(U)$-linear], so ther is a category of $\calo_X$-modules
\begin{ex}
$n\geq 1$, $\calo_X^n:U\lrta \calo_X(U)^n$ is an $\calo_X(U)$-module. 
\end{ex}
\begin{dfn}
An $\calo_X$-moduel $\calf$ is locally free of rank $n\geq 1$ is $\forall x\in X,\exists U $ open nbhd of $x $ s.t.
$$
\calf|_U\simeq \calo_U^u
$$
as $\calo_U$-module.
\end{dfn}

If $\call$ is  locally free of rank $1$, it is called an invertible sheaf.
\begin{prop}
The set $Pic(X)$ of isomorphism class of invertible sheaves on $X$ form s an abelian group with operation induced by 
$$
(\call_1,\call_2)\longmapsto \call_1\otimes_{\calo_X}\call_2
$$
$1=$ class of $\calo_X$

inverse
$$
\call\longmapsto \hom_{\calo_X}(\call,\calo_X)
$$
N.B for $\calf_1,\calf_2$ $\calo_X$-modules, we define
$$
\calf_1\otimes_{\calo_X}\calf_2=\text{ sheaf associated to  the presheaf $U\mapsto \calf_1(U)\times_{\calo_X(U)}\calf_2(U)$}
$$
and
$$
\hom_{\calo_X}(\calf_1,\calf_2)=\text{ sheaf associated to $U\mapsto \hom_{\calo_X(U)}(\calf_1(U),\calf_2(U))$}
$$
\end{prop}


\subsection{May 11th: The twisting invertible sheaf on $\proj^n$}

Recall:
$\calo_X$-modules, locally-free $\calo_X$-modules,

rank $1$ locally free $\Lrta$ invertible sheaves.

\begin{prop}
$Pic(X)=\{\text{iso. class of  invertible sheaves}\}$ is an abelian group with $\call_1\otimes \call_2$
and $1=\calo_{X}$, $\call^{-1}=\phom(\call,\calo_X)$.
\end{prop}
\begin{proof}
What needs to be done (given commutativity/ Associativity of $\otimes$) is
\begin{enumerate}[label=(\arabic*)]
\item if $\call_1,\call_2$ are invertible, so is $\call_1\otimes \call_2$
\item $\call\otimes \calo_X=\call$
\item $\call\otimes \call^{-1}\cong \calo_X$.
\end{enumerate}

$(1)$: If $\call_1|_U\simeq \calo_X|_U$ and $\call_2|_U\simeq \calo_X|_U$,  $(\call_1\otimes\calo_X)|_U\simeq \calo_X|_U\otimes\calo_X|_U\simeq \calo_X|_U$, where the LHS is sheaf associated to presheaf, (given $V\subset U$) $V\longmapsto\call_1\otimes(V)\otimes\call_2(V)$ and the $\calo_X(V)\otimes \calo_X(V)\simeq \calo_X(V)$. So the LHS is the sheaf $V\longmapsto \calo_X(V)$ and $\call_1|_U\otimes \call_2|_U\simeq \calo|_U$ and therefore $\call_1\otimes \call_2$ is invertible.

\underline{Warning!} in general, $\call_1\otimes \call_2(U)\neq\call_1(U)\otimes\call_2(U)$.

$(2)$ For any $U\subset X$, 
$$
\call(U)\otimes\calo_X(U)\overset{\sim}{\lrta}\call(U)
$$
$$
(s,a)\longmapsto as
$$
$\Lrta $ a morphism of presheaves 
$$
[U\mapsto \call(U)\otimes\calo_X(U)]\longmapsto \call
$$
$\Lrta$  a canonical morphism
$$
\call\otimes\calo_X\longmapsto \call
$$
and this is  an isomorphism because on stalks it is 
$$
\call_x\otimes \calo_{X,x}\simeq \call_x
$$
$$
(s,a)\longmapsto as
$$
which is an isomorphism

$(3)$ For any $U\subset X$ we have an isomorphism of modules
$$
\call(u)\otimes\call^{-1}_{pre}(U)\overset{\sim}{\lrta}\calo_X(U)
$$
$$
LHS=\call(U)\otimes\hom_{\calo_X(U)}(\call(U),\calo_X(U))
$$
$$
(s,\lambda)\longmapsto \lambda(s).
$$
After sheafification, we get a morphism
$$
\call\otimes\call^{-1}\lrta \calo_X
$$
which at stalks is an isomorphism.
\end{proof}


\begin{ex}\ 
\begin{enumerate}[label=\boxed{\arabic*}]
\item \underline{Affine case}: $X=\spec A$. Theory of (quasi)-coherent sheaves establishes
 a connection between $A$-modules and $\calo_X$-modules.

Given an $A$-module $M$, we can construct a $\calo_X$-module  $\tilde{M}$ by 
$$
\tilde{M}(U)=\left\{s:U\lrta \sqcup_{x\in U}M_x\left|\begin{aligned}
&\forall x,s(x)\in M_x, \forall x\in U,\exists V\subset U
,\\
&\text{s.t. for } x\in V,\exists m\in M,\exists f\in A,\\ 
&\text{ s.t. } \forall y\in V f\notin y,\  s(y)=\frac{m}{f}\in M_y  
\end{aligned}
\right.\right\}
$$
subexample: $\tilde{A}=\calo_X$ and $\tilde{M}$ is an $\calo_X$-module:
$$
(a\cdot s)(x)=a(x)s(x)
$$
for all $a\in \calo_X(U), s\in \tilde{M}(U)$

\underline{Facts:}

\begin{enumerate}
\item $\Gamma(U_f,\tilde{M})\simeq M_f\lrta $``$f(x)\neq 0$''
\item stalk $\tilde{M}_x= M_x$ localization
\item $\widetilde{M_1\otimes M_2}=\tilde{M_1}\otimes\tilde{M_2}$
\item  [Serre-Swan] Locally-free $\calo_X$-modules is in bijection with vector bundle and  projective $A$-modules.

In practice, $\tilde{M}$ is an invertible sheaf iff $M$ is projective, locally of rank $1$ $M_\scp\cong A_\scp$ (when viewed as $A_\scp$-module)

\underline{Cor}: If $A$ is a UFD, then $Pic(\spec A)=\{0\}$
\end{enumerate}

\item If $X$ has the usual regularity properties, and $D$ is a prime divisor, there is a naturally associated invertible sheaf $\call(D):$ Let $U\subset X$ open small enough, so that $D\cap U$ is given by $f=0$ on $U$, then
$$
\call(D)(U)=\{s\in Frac(\calo_X(U)| s=f^{-1}t, t\in \Gamma(U, \calo_X)\}
$$
 One checks that this is well-defined (it is independent on the choice of $f$)

 Then $\call(D)$ is an invertible sheaf. This extends to a group morphism
 $$
  Div(X)\lrta Pic(X).
 $$
 \item The twisting sheaf on projective space. Let $K$ be a field. We define an important non-trivial invertible sheaf on $\proj^n_K$, $n\geq 1$, denoted 
 $$
\calo(1)=\calo_{\proj^n_K}(1).
 $$

 From the $\Proj$ point of view, where $K[X_0,..,X_n]=:A$
 $$
\proj^n_K=\Proj(A)
 $$
$$
\begin{tikzcd}
M \arrow[d,rightsquigarrow] & \text{graded } A\text{-module} \\
\tilde{M} & \calo_{\Proj(A)}\text{-module}
\end{tikzcd}
$$
Take: 
$$
M=\bigoplus_{k\geq 1}A_k,
$$
where $A_k$ is the homogeneous part of degree $k$.
$\Lrta \tilde{M}=\calo(1)$.

Glueing: $n$,
$$
\proj^n_K=\cup_{i=0} U_i
$$
where $U_i=\spec(B_i)$, $B_i=K[X_0/X_i,...,X_n/X_i]\subset B=[X_0^{\pm },..,X_n^{\pm}]$
glued over $U_{ij}=\spec(B_{ij})$, with $B_{ij}=(B_i)_{X_j/X_i}$ using the isomorphism 
$$
B_{ij}=B_{ji}\subset B.
$$
To define a sheaf $\calf$ on $\proj^n_K$ it suffices to consider sheaves $\calf_i$ on $U_i$, isomorphisms $\varphi_{i,j}\calf_i|_{U_{ij}}\simeq \calf_{j}|_{U_{ij}}$ with the cocycle condition on $\varphi_{i,j}$. We define $\call_i$ on $U_i$ by 
$$
\call_i=\tilde{M}_i
$$
where $M_i=X_i B_i\subset B_i$ as $B_i$-module. We have 
$M_i\simeq B_i$ as $B_i$-module so $\tilde{M}_i\simeq \calo_{\proj^n}|_{U_i}$ we glue the $\call_i$
 over $U_{ij}$ using the isomorphisms 
 $$
B\supset M_{i,\left(\frac{X_j}{X_i}\right)}=M_{j,\left(\frac{X_i}{X_j}\right)}.
 $$
 These identity morphisms glue to an ivertible sheaf $\calo(1)$ on $\proj^n_K$. By \boxed{1}, we have 
 $$
 \Gamma(U_i,\calo(1))\cong \Gamma(U_i,\tilde{M}_i)=M_i=X_i B_i.
 $$
 \begin{prop}
 We have 
 $$
\dim_K \Gamma(\proj^n_{K},\calo(1)=n+1)
 $$
 and $\dim_K\Gamma(\proj^n_K,\calo)=1$. (A basis of $\Gamma(\proj^n_K,\calo(1))$ is given by the ``homogeneous coordinates'')
 \end{prop}
 \begin{proof}
 Using the glueing perspective $s\in \Gamma(\proj^n_K,\calo(1))$ is equivalent to $(s_i), s_i\in \Gamma(U_i,\calo(1))$ with $s_i|_{U_{ij}}=s_j|_{U_{ji}}$ which means 
 $$
 s_i\in M_i=X_i B_i\subset B
 $$
 and $s_i=s_j$ in $B$.
 $\Lrta$ 
 $$
 \Gamma(\proj^n_K,\calo(1))=\bigcap^n_{i=0}X_i B_i\subset B.
 $$
 Similarly,$\Gamma(\proj^n_K,\calo)=\bigcap^n_{i=0} B_i\subset B$. ($\bigcap B_i=K$ because only constant polynomial in 
 $K[X_0/X_i,...,X_n/X_i]$ are allowed.) Let $s\in \bigcap X_iB_i$,
 $$
 \begin{aligned}
 \forall i, s&=X_i g_i(X_0/X_i,...,X_n/X_i)\in A\\
 &=\frac{f_i(X_0,...,X_n)}{X_i^{d_i}}
 \end{aligned}
 $$
 with $X_i\nmid f_i, d_i\geq 0$. Thus, 
 $$
 X_i^{-d_i}f_i=X_j^{-d_j}f_j
 $$
 for all $j$,
 $x_j^{d_j} f_i=X_i^{d_i}f_j$, $\forall i,j;$ since $X_k\nmid f_j, d_i=0$ $\Lrta i,j$ $f_i=f_j$ but $f_i$ is homogeneous of degree $d_{i}+1=1$, so $s\llrta (f)\in$ homogeneous degree $1$. Conversely, any $f$ homogeneous of degree $1$ is in $\bigcap X_i B_i$ $X_i=X_i\cdot 1=X_j\cdot \frac{X_i}{X_j}$ so $\Gamma(\proj^n_K,\calo(1))\overset{\sim}{\lrta}$\{ homogeneous polynomials of degree $1$ in $A$\} $\cong K^{n+1}$ as $K$-vector spaces. 
 \end{proof}
\begin{thm}\label{thm:aut_Proj}
$Aut_{\mathsf{Sch}}(\proj^n_K)\simeq PGL_{n+1}(K)=GL_{n+1}(K)/K^\times I_{n+1}$ given by
$$
g\longmapsto ([x_0:...:x_n]\lrta[\sum_j a_{0j}x_j:...:\sum_j a_{n_j} x_j]) 
$$
with $a_{ij}$ the entries of $g$.  
\end{thm}
This uses
\begin{thm}[Hartshorne II6.16]
\label{thm:Hart_II_6.16}$X$ Noetherian, integral, quasi-projective, every local ring is regular
$\Lrta$ the map $D\longmapsto \call(D)$ gives an isomorphism 
$$
Cl(X)\overset{\simeq}{\lrta}Pic(X)
$$
\begin{proof}[Proof of~\ref{thm:aut_Proj}]
We construct an inverse
$$
Aut(\proj^n_K)\lrta PGL_{n+1}(K)
$$
to the morphism in the statement of~\ref{thm:Hart_II_6.16}. 

\underline{idea}: Any $\gamma:\proj^n_K\overset{\sim}{\lrta}\proj^n_K$ ``acts linearly on $\Gamma(\proj^n,\calo(1))\simeq K^{n+1}$''. Precisely: given $\gamma$ we get an induced isomorphism
$$
\gamma^*\calf\lrta \calf
$$
where as a sheaf $\gamma^*\calf(U)=\calf(\gamma(U))$.
$$
\begin{aligned}
\calf(\gamma(U)&\lrta \calf(U))\\
s&\longmapsto [x\mapsto s(\gamma(x))]
\end{aligned}
$$
in particular, we get 
$$
\gamma^* \calo(1)\lrta\calo(1)
$$
\underline{Key}: $\gamma^*\calo(1)\simeq \calo(1)$. Indeed, $\calo(1)\in Pic(\proj^n_K)\simeq Cl(\proj^n_K)\simeq \intg[H_0]$ corresponds to $[H_0]$, where $H_0$ means the hyperplane where $X_0=0$.
$\gamma^*\calo(1)\in Pic(\proj^n_K)$ s therefore also a generator of $Pic(\proj^n_K)$. However, one checks 
$$
\Gamma(\proj^n_K,\calo(1)^{-1})=\{0\}
$$
so that  $\gamma^*\calo(1)\simeq \calo(1)^{-1}$ is not possible, hence the key claim.

So we get 
$$
\calo(1)\overset{\varphi}{\lrta}\gamma^*\calo(1)\overset{\sim}{\lrta}\calo(1)
$$
$\Lrta$ an isomorphism
$$
K^{n+1}\simeq\Gamma(\proj^n,\calo(1))\overset{\gamma\circ \varphi}{\lrta}\Gamma(\proj^n,\calo(1))\simeq K^{n+1}
$$
$K$-linear in $Gl_{n+1}(K)$. 

$\varphi$ is only defined up to an automorphism of $\calo(1)$:
$\calo(1)\simeq\calo(1)$

\underline{Claim}: 
$$
Aut_{\mathsf{Sheaves}}(\calo(1))\simeq K^{\times}
$$
$$
[s\mapsto \lambda s]\mapsfrom \lambda
$$
$$
\hom_{\mathsf{Sheaves}}(\calo(1),\calo(1))
$$
$$
\calo(1)\overset{f,\sim}{\lrta}\calo(1)
$$
$$
\leadsto \calo(1)\otimes\calo(1)^{-1}\overset{\sim}{\lrta}\calo(1)\otimes\calo(1)
^{-1}
$$
$$
\leadsto
K\simeq \Gamma(\proj^n,\calo)\overset{\sim}{\lrta}\Gamma(\proj^n,\calo)\simeq K.
$$
\end{proof}

\end{thm}
\end{enumerate}
\end{ex}




\end{document}

