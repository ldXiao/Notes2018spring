%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% The Legrand Orange Book
% LaTeX Template
% Version 2.3 (8/8/17)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original author:
% Mathias Legrand (legrand.mathias@gmail.com) with modifications by:
% Vel (vel@latextemplates.com)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
% Compiling this template:
% This template uses biber for its bibliography and makeindex for its index.
% When you first open the template, compile it from the command line with the 
% commands below to make sure your LaTeX distribution is configured correctly:
%
% 1) pdflatex main
% 2) makeindex main.idx -s StyleInd.ist
% 3) biber main
% 4) pdflatex main x 2
%
% After this, when you wish to update the bibliography/index use the appropriate
% command above and make sure to compile with pdflatex several times 
% afterwards to propagate your changes to the document.
%
% This template also uses a number of packages which may need to be
% updated to the newest versions for the template to compile. It is strongly
% recommended you update your LaTeX distribution if you have any
% compilation errors.
%
% Important note:
% Chapter heading images should have a 2:1 width:height ratio,
% e.g. 920px width and 460px height.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[11pt,fleqn]{book} % Default font size and left-justified equations

%----------------------------------------------------------------------------------------

\input{structure} % Insert the commands.tex file which contains the majority of the structure behind the template

\begin{document}

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\begingroup
\thispagestyle{empty}
\begin{tikzpicture}[remember picture,overlay]
\node[inner sep=0pt] (background) at (current page.center) {\includegraphics[width=\paperwidth]{background}};
\draw (current page.center) node [fill=ocre!30!white,fill opacity=0.6,text opacity=1,inner sep=1cm]{\Huge\centering\bfseries\sffamily\parbox[c][][t]{\paperwidth}{\centering Evanescent Tide\\[15pt] % Book title
{\Large  A solution manual by and for stupid student}\\[20pt] % Subtitle
{\huge Vector\_Cat }}}; % Author name
\end{tikzpicture}
\vfill
\endgroup

%----------------------------------------------------------------------------------------
%	COPYRIGHT PAGE
%----------------------------------------------------------------------------------------

\newpage
~\vfill
\thispagestyle{empty}

\noindent Copyright \copyright\ 2013 John Smith\\ % Copyright notice

\noindent \textsc{Published by Publisher}\\ % Publisher

\noindent \textsc{book-website.com}\\ % URL

\noindent Licensed under the Creative Commons Attribution-NonCommercial 3.0 Unported License (the ``License''). You may not use this file except in compliance with the License. You may obtain a copy of the License at \url{http://creativecommons.org/licenses/by-nc/3.0}. Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \textsc{``as is'' basis, without warranties or conditions of any kind}, either express or implied. See the License for the specific language governing permissions and limitations under the License.\\ % License information

\noindent \textit{First printing, March 2013} % Printing/edition date

%----------------------------------------------------------------------------------------
%	TABLE OF CONTENTS
%----------------------------------------------------------------------------------------

%\usechapterimagefalse % If you don't want to include a chapter image, use this to toggle images off - it can be enabled later with \usechapterimagetrue

\chapterimage{chapter_head_1.pdf} % Table of contents heading image

\pagestyle{empty} % No headers

\tableofcontents % Print the table of contents itself

\cleardoublepage % Forces the first chapter to start on an odd page so it's on the right

\pagestyle{fancy} % Print headers again

%----------------------------------------------------------------------------------------
%	PART
%----------------------------------------------------------------------------------------

\part{Preliminaries}

%----------------------------------------------------------------------------------------
%	CHAPTER 1
%----------------------------------------------------------------------------------------

%\include{Chaps/Chap1}
\chapterimage{orange_cat.jpg}
\chapter{Some category theory}

\section{Motivation}

\section{Categories and functors}
\begin{exr}
A category in which each morphism is an isomorphism is called a groupoid. (This notion is not important in what we will discuss. The point of this exercise is to give you some practice with categories, by relating them to an object you know well.)
\begin{enumerate}[label=(\alph*)]
\item A perverse definition of a \textit{group} is: a groupoid with one object. Make sense of this.
\item Describe a groupoid that is not a group.
\end{enumerate}
\end{exr}
\begin{proof}\ 
\begin{enumerate}[label=(\alph*)]
\item Consider a groupoid $\cala$ with only one object $A$. Then we can interpret the composition of morphism as a binary product and $id_A$ as the identity $e$. In this way $\cala$ can be interpreted as a group.
\item We can recall the definition of fundamental groupoid $\Pi(M)$, where objects are points $x\in M$ and morphism $Mor(x,y)$. Or we can artificially construct a category illustrated by the following diagram.
\begin{figure}[h]
\centering\includegraphics[scale=0.5]{Groupoid}
\caption{A nontrivial groupoid}
\end{figure}
\end{enumerate}
\end{proof}

\begin{exr}
If $A$ is an object in a category $\calc$, show that the invertible elements of $\mor(A, A)$ form a group (called the automorphism group of $A$, denoted $\text{Aut}(A)$). What are the automorphism groups of the objects in $\mathit{Sets}$ and $\mathit{Vec}_k$. Show that two isomorphic objects have the same automorphism groups.
\end{exr}
\begin{proof}
For $\text{Sets}$, the the automorphism group of an object $A$ is the group of permutation of the set $A$. For $\text{Vec}_k$, the automorphism group of $V$ is $\text{GL}_k(V)$. 

Consider two isomorphic objects $A,B$ in $\calc$, $\exists f\in \mor(A,B), g\in\mor(B,A)$ s.t. $f\circ g=id_A$ and $g\circ f=id_B$. Consider $h\in\text{Aut}(B)$, then $g\circ h\circ f\in \text{Aut}(A)$ with inverse $g\circ h^{-1} \circ f$. We can check that it is a isomorphism of groups. It has an inverse $[\forall j\in Aut(A),j\longmapsto g\circ j\circ f]$.
\end{proof}

\begin{exr}
Let $(\cdot)^{\vee\vee} : \text{f.d.Vec}_k \lrta \text{f.d.Vec}_k$ be the double dual functor from the category of finite-dimensional vector spaces over k to itself. Show that $(\cdot)^{\vee\vee}$ is naturally isomorphic to the identity functor on $\text{f.d.Vec}_k$. (Without the finite- dimensionality hypothesis, we only get a natural transformation of functors from $\text{id}$ to $(\cdot)^{\vee\vee}$.)
\end{exr}
\begin{proof}
Recall the definition of natural transformation,
\begin{center}
\begin{tikzcd}
F(A) \arrow[d, "m_A"'] \arrow[r, "F(f)"] & F(A') \arrow[d, "m_{A'}"] \\
G(A) \arrow[r, "G(f)"'] & G(A'),
\end{tikzcd}
\end{center}
In the special case where $F=(\cdot)^{\vee\vee}$ and $G=id$
\begin{center}
\begin{tikzcd}
A \arrow[r, "f"]\arrow[d, "m_A"'] & A' \arrow[d, "m_{A'}"]\\
A^{\vee\vee}  \arrow[r, "f^{\vee\vee}"'] & A'^{\vee\vee}
\end{tikzcd}
\end{center}
$$
\begin{aligned}
m_A:&\ A\lrta A^{\vee\vee}\\
&  v\longmapsto v^{\vee\vee}:=[\forall u^\vee\in A^\vee, u^\vee\longmapsto u^\vee(v)],\\
f^{\vee\vee}: &\ A^{\vee\vee}\lrta A'^{\vee\vee}\\
& w^{**}\longmapsto w^{**}\circ f^{\vee}:=[\forall u'^\vee\in A'^\vee: u'^\vee\longmapsto w^{**}(u'^\vee\circ f)], 
\end{aligned}
$$
where we use $u^{**}$ to denote general element in $A^{\vee\vee}$ distinguishing it from the element generated by $v\longmapsto v^{\vee\vee}$. Then we can 
check compatibility (the diagram commutes)
$m_{A'}\circ f\overset{?}{=}f^{\vee\vee}\circ m_A$
$$
\begin{aligned}
\Llrta&\forall u\in A, m_{A'}\circ f (u)\overset{?}{=}f^{\vee\vee}\circ m_A (u)\\
\Llrta&\forall u\in A,\ f(u)^{\vee\vee}= m_{A'}\circ f (u)\overset{?}{=}f^{\vee\vee}\circ u^{\vee\vee}=u^{\vee\vee}f^\vee\\
\Llrta & \forall u\in A, \forall w'^{\vee}\in A'^{\vee},\  f(u)^{\vee\vee}(w'^\vee)\overset{?}{=}u^{\vee\vee}f^{\vee}(w'^\vee)\\
\Llrta & \forall u\in A, \forall w'^{\vee}\in A'^{\vee},\  w'^\vee(f(u))\overset{\checkmark}{=}w'^\vee\circ f(u).
\end{aligned}
$$
The above abstract nonsense are always true for $k$-vector spaces whether it is finite dimension or not, hence it is always a natural transformation. But when we restrict to finite dimensional vector spaces. 
$v^{\vee\vee}=0\Lrta $ it maps all $u^\vee$ to zero, hence $u^\vee(v)=0,\forall u^\vee\Lrta v=0$. $m_A$ is always injective. When $V$ is finite dimension, $\dim(V^{**})\geq \dims(V^*)\geq \dims(V)$, and we get equality when it is finite dimensional. In this case $m_A$ is an isomorphisms. 
\end{proof}
\begin{exr}
$\mathcal{V}$ is the category of finite dimensional vector spaces of the form $k^n$.
Show that $\mathcal{V}\lrta \text{f.d.Vec}_k$ gives an equivalence of categories, by describing an ``inverse'' functor.
\end{exr}
\begin{proof}
The functor $F:\mathcal{V}\lrta \text{f.d.Vec}_k$ is just the inclusion as a sub category. Assume we can simultaneously choose a basis for each vector space. It has an quasi-inverse functor $G$, such that for $n$-dimensional vector space $V$, $ m_A:V\lrta k^n$, $\{e_{V,i}\}\longmapsto $ \{the standard basis of $k^n$\}.

\begin{center}
\begin{tikzcd}
F\circ G(V) \arrow[d, "m_V"'] \arrow[r, "FG(f)"] & F\circ G(V') \arrow[d, "m_{V'}"] \\
id_{Vec}(V) \arrow[r, "id(f)"'] & id_{vec}(V'),
\end{tikzcd}
\end{center}

$$
\begin{aligned}
F\circ G &(V)=k^n\\
m_V: &k^n\lrta V \\ &(k_1,...,k_n)\longmapsto \sum_i k_i e^{V}_i,
\end{aligned}
$$
and for $f:V\lrta V'$ a $k$-linear morphism, $FG(f):k^n\lrta k^m$ is the linear transformation encoded by the matrix $M^f$ such that $f(e^{V}_j)=\sum_i(M^f)_{ij}e^{V'}_i$. It is now quite easy to check the diagram commutes and $m_V$ is an isomorphism.
\end{proof}

\begin{theorem}
We say that a covariant functor $F:\cala\lrta \calb$ is \textbf{essentially surjective} if every object $B$ in $\calb$ is isomorphic to $F(A)$ for some object $A$ in $\cala$. $F$ is an equivalence of categories iff $F$ is fully faithful and essentially surjective.
\end{theorem}
\begin{proof}
$\Lrta$: Assume $F$ is an equivalence of categories with a quasi-inverse $G$. $F\circ G\cong id_\calb$ and $G\circ F\cong id_\cala$. 
\begin{center}
\begin{tikzcd}
F\circ G(B) \arrow[d, "\mu_B"'] \arrow[r, "FG(f)"] & F\circ G(B') \arrow[d, "\mu_{B'}"] \\
id_{\calb}(B) \arrow[r, "id(f)"'] & id_{\calb}(B'),
\end{tikzcd}
\begin{tikzcd}
G\circ F(A) \arrow[d, "\eta_A"'] \arrow[r, "GF(f)"] & G\circ F(A') \arrow[d, "\eta_{A'}"] \\
id_{\cala}(A) \arrow[r, "id(f)"'] & id_{\cala}(A'),
\end{tikzcd}
\end{center}
each is a natural isomorphism. $f\mu_B=\mu_{B'}FG(f)$.

\underline{$F$ is essentially surjective}: It is clear because every $B\in \calb$ we have $B\cong F(G(B))$, where $G(B)$ is an object in $\cala$. Similarly, we have $G$ is essentially surjective.

\underline{$F$ is full}: $\mu_B$ is isomorphism, which means it has an inverse. Then we composite its inverse from right. We get $f=\mu_{B'}\circ FG(f)\circ \mu_B^{-1}$. Similarly we have $FG(f)=\mu_{B'}^{-1}\circ f\circ \mu_{B}$. Then the map $f\longmapsto FG(f)$ is a bijection between $\mor_{\calb}(B,B')$ and $\mor_{\calb}(FG(B),FG(B'))$. In particular, $f\longmapsto FG(f)$ is surjective, hence the map $G(f)\longmapsto FG(f)$. $\tilde{F}:\mor_\cala(G(B),G(B'))\lrta \mor_\calb(FG(B),FG(B'))$ is surjective but by the fact that $G$ is essentially surjective, ( every object in $\cala$ is isomorphic to some $G(B)$). We know $F:\mor_\cala(A,A')\lrta \mor_\calb(F(A),F(A'))$ is surjective.

\underline{$F$ is faithful}: Similarly we have the map: $f\longmapsto GF(f)$ is an isomorphism between  $\mor_{\cala}(A,A')$ and $\mor_{\cala}(GF(A),GF(A'))$. In particular,$f\longmapsto GF(f)$ is injective, hence the map $f\longmapsto F(f)$ is injective (monic) as a map from $\mor_\cala(A,A')$ to $\mor_\calb(F(A),F(A'))$.

$\Llta$: This time, we know $F$ is essentially surjective fully faithful. 

\underline{Construction of quasi-inverse}:
Since $F$ is essentially surjective, for each object $B$ in $\calb$, there is an object $A$ s.t. $F_{ob}(A)\cong B$ (Assume the axiom of choice, we can simultaneously choose such a representative $A$ for each $B$). We denote the isomorphism $j:B\lrta F(A)$ and $j':B'\lrta F(A')$. Then we define the map $G_{ob}:\text{obj}(\calb)\lrta \text{obj}(\cala)$, $G_{ob}(B)=A$. For each morphism $g\in \mor_\calb(B,B')\cong\mor_{\calb}(F(A),F(A'))$, where the second isomorphism is induced by the isomorphisms $F(A)\cong B$ and $F(A')\cong B'$. We can write the corresponding morphism as $j'\circ g\circ j^{-1}$.

Because $F$ is fully faithful there is a unique morphism $f\in \mor_\cala(A,A')$ so that $j'\circ g\circ j^{-1}=F_{mor}(f)$. ($G_{mor}(g)=F_{mor}^{-1}(j'\circ g \circ j^{-1})$) Then we define $G_{mor}:\mor_\calb(B,B')\lrta \mor_{\cala}(A,A')$, $g\longmapsto f$ as above. (Again, by the axiom of choice, we can assign an $f$ for $g\in \mor_{\calb}(B,B')$ simultaneously for all $g,B,B'$). These datum combine together to form a functor $G$. 

 Then it remains to check $FG\cong id_\calb$ and $GF\cong id_\cala$.
\begin{center}
 \begin{tikzcd}
B \arrow[d, "\mu_B"'] \arrow[r, "g"] & B' \arrow[d, "\mu_{B'}"] \\
F\circ G(B) \arrow[r, "FG(g)"'] & F\circ G(B'),
\end{tikzcd}
\end{center}

\underline{$FG\cong id_\calb$}: Because $FG(B)=F(A)\cong B$ by the definition of functor $G$, $\mu_B$ is just the isomorphism $j:B\lrta F(A)$. Also $FG(g)=F(f)=j'\circ g\circ j^{-1}$, so the diagram commutes. We have checked $FG\cong id_\calb$.

\underline{$GF\cong id_\cala$}: For the other natural isomorphism of functors, consider the  following diagram
\begin{center}
 \begin{tikzcd}
A \arrow[d, "\mu_A"'] \arrow[r, "f"] & A' \arrow[d, "\mu_{A'}"] \\
\tilde{A}:=G\circ F(A) \arrow[r, "GF(f)"'] & G\circ F(A')=:\tilde{A'}.
\end{tikzcd}
\end{center}

\begin{center}
\begin{tikzcd}
 & A' \arrow[rr, "F"] \arrow[rrdd, "\mu_{A'}"', dashed, bend right] &  & F(A') \arrow[dd, "G"'] \arrow[rrdd, "h'", bend left] &  &  \\
A \arrow[rr, "F"] \arrow[ru, "f"] \arrow[rrdd, "\mu_A", dashed, bend right] &  & F(A) \arrow[ru, "F(f)"] \arrow[dd, "G"'] \arrow[rrdd, "h", bend left] &  &  &  \\
 &  &  & \tilde{A}':=GF(A') \arrow[rr, "F"] &  & F(\tilde{A}') \arrow[ll, "G", shift left =1.5ex] \\
 &  & \tilde{A}:=GF(A) \arrow[rr, "F"] \arrow[ru, "GF(f)", dashed] &  & F(\tilde{A}) \arrow[ru] \arrow[ll, "G", shift left = 1.5ex] & 
\end{tikzcd}
\end{center}
Notice that $A$ is not necessarily some chosen representative of $\tilde{B}:=F(A)$, we assume the chosen representative of $F(A)$ is $\tilde{A}$ then $GF(A)=\tilde{A}$. In other words, $F(A)\cong F(\tilde{A})$, $A\overset{?}{\cong}\tilde{A}$. For convenience we a give a names to the isomorphisms $h:F(A)\lrta F(\tilde{A})$, $h':F(A')\lrta F(\tilde{A}')$.

In particular $F:\mor_\cala(A,\tilde{A})\lrta \mor_{\calb}(F(A),F(\tilde{A}))$ is fully faithful. There is a morphism $\mu_A\in \mor_{\cala}(A, \tilde{A})$ so that $F(\mu_A)=h$, it is an isomorphism with inverse $\mu_{\tilde{A}}\in \mor(\tilde{A},A)$, $ F(\mu_{\tilde{A}})=h^{-1}$ . ($\mu_A=F_{mor}^{-1}(h)$, $\mu_{\tilde{A}}=F^{-1}_{mor}(h^{-1})$)

Recall the definition of $G_{mor}$, we have $GF(f):=G_{mor}(F_{mor}(f))=F_{mor}^{-1}(h'\circ F_{mor}(f)\circ h^{-1})$, then
$$
GF(f)\circ \mu_A=F_{mor}^{-1}(h'\circ F_{mor}(f)\circ h^{-1}\circ h)=F_{mor}^{-1}(h')\circ F_{mor}^{-1}( F_{mor}(f))=\mu_{A'}\circ f.
$$
Thus, the diagram commutes and $GF\cong id_\cala$.
\end{proof}
\section{Universal properties determine an object up to unique isomorphism}

\begin{exr}
Show that any two initial objects are uniquely isomorphic. Show that any two final objects are uniquely isomorphic.
\end{exr}
\begin{proof}
We only to check for initial object and final object is similarly checked. Assume $T$ and $T'$ are both initial objects in a category $\calc$.
\begin{center}
\begin{tikzcd}
  & T'\ar[dl, "\exists !f", shift left=1ex] \\
T\arrow[ur,"\exists !g", shift left= 1ex] &    
\end{tikzcd}
\end{center}
We know $\exists ! f$ $\exists ! g$ s.t. the diagram commutes. Then we have $g\circ f\in \mor(T,T)$. But by the uniqueness of morphism from $T$ to $T$, $\mor(T,T)=\{id_T\}$. Similarly, we have $g\circ f=T'$, hence $g$ and $f$ are unique isomorphisms.
\end{proof}

\begin{exr}
What are the initial and final objects in \textit{Sets}, \textit{Rings}, and \textit{Top} (if they exist)? How about the category of subsets of a set, and the category of open subsets of a topological space, where the morphisms are inclusion?
\end{exr}
\begin{proof}
\textit{Sets}:$\emptyset$ is the initial object with empty function and any one element set $\{*\}$ is a final object.

\textit{Rings}:$(0)$ is the final object in  and $\intg$ is initial object. Notices that here we mean unital rings so the morphism $\intg\lrta R$ is unique.

\textit{Top}: $\emptyset$ is initial object and one element space $\{*\}$ with discrete topology is final object.  

\textit{Subsets in $S$}: $\emptyset$ is the initial object and $S$ is final object.

\textit{Subspaces in topological space $X$}: $\emptyset$ is initial and $X$ is final.
\end{proof}

\begin{exr}
Show that $\iota:A\lrta S^{-1}A$ is injective if and only if $S$ contains no zerodivisors. 
\end{exr}
In fact the localization of ring has the following properties:
\begin{enumerate}[label=(\alph*)]
\item $\iota(S)\subset (S^{-1}A)^{\times}$
\item $\text{Ker}(\iota)=\{a\in A|sa=0 \text{ for some }s\in S\}$
\item Suppose $A\neq\{0\}.$ Then $\iota$ is injective $\Longleftrightarrow$ $S$ contains no zero divisors.
\item $S^{-1}A=\{0\}$ $\Longleftrightarrow$ $S\ni 0$
\item $\iota$ is isomorphism  $\Longleftrightarrow $ $S\subseteq A^{\times}$
\end{enumerate}

\begin{proof}We can easily check that $\iota$ thus defined is indeed a ring morphism.
\begin{enumerate}[label=(\alph*)]
\item  $s\in S$. $\iota(s)=s/1$ and $s/1\cdot 1/s=1$, then $s$ is a unit in $S^{-1}A$.
\item $a\in \text{Ker}(\iota)=\{b\in A|\frac{b}{1}=\frac{0}{1}\}$ $\Longleftrightarrow$ $\exists t\in S: t(a1-01)=ta=0.$
\item  derived from (a) and (b).
\item $S^{-1} A=\{0\}$ $\Longleftrightarrow$ $\frac{0}{1}=\frac{1}{1}$ $\Llrta$  there exists an element $t\in S$ s.t. $t\cdot1=0$, $\Longleftrightarrow t=0\in S$.
\item ``$\Lrta$'' Suppose $A\neq \{0\}$, then $\iota $ is isomorphism $\Llrta$  $\iota$ is surjective and injective. The surjectivity is equivalent to $\forall \frac{a}{s}\in S^{-1}A: \exists c\in A\ s.t.\ \frac{a}{s}=\frac{c}{1}$ while the injectivity is equivalent to $S$ has no zero-divisors  according to (c). Then we know, $\frac{1}{s}=\frac{c}{1}\Lrta\exists t\in S,\ \text{such that }\  t(s\cdot c-1)=0$, and by the fact $S$ has no zero-divisors  $s\cdot c=1$, which means $S\subseteq A^{\times}$.\\
``$\Llta$'' Assume $A\neq\{0\}$. $S\subseteq A^\times$, then $S$ does not contain any zero divisors. $\forall \frac{a}{s}\in S^{-1}A.$ Because $S\subseteq A^\times$ $ \exists v\in A \text{ s.t. } sv=1$. Then $ \frac{a}{s}=\frac{av}{1}\in \text{Im}(\iota)$, because $a s v=a$.

If $A=\{0\}$, the claim is trivially true.
\end{enumerate}
\end{proof}

\begin{exr}
Verify that $A\lrta S^{-1}A$ satisfies the following universal property: $S^{-1}A$ is initial among $A$-algebras $B$ where every element of S is sent to an invertible element in $B$. (Recall: the data of “an $A$-algebra $B$” and “a ring map $A \lrta B$” are the same.) Translation: any map $A \lrta B $ where every element of $S$ is sent to an invertible element must factor uniquely through $A\lrta S^{-1}A$. Another translation: a ring map out of $S^{-1}A$ is the same thing as a ring map from A that sends every element of $S$ to an invertible element. Furthermore, an $S^{-1}A$-module is the same thing as an $A$-module for which $s\times\cdot : M\lrta M$ is an $A$-module isomorphism for all $s \in S$
\end{exr}
\begin{proof}
\textbf{Claim}:\\
$Hom(S^{-1}{A},{B})\cong \{f:{A}\lrta {B}\text{ s.t. } f(S)\subseteq {B}^{\times}\}$. 
For an element $\tilde{f}\in Hom(S^{-1}{A},{B})$
$$
\tilde{f}\left(\frac{a}{s}\right):=f(a)f(s)^{-1}
$$
$$
f(a):=\tilde{f}\left(\frac{a}{1}\right).
$$
i.e. For every morphism $f:{A}\lrta{B}$ s.t. $f(S)\subseteq {B}^{\times}$, there exists a unique morphism $\tilde{f}:S^{-1}{A}\lrta {B}$ s.t. $f=\tilde{f}\circ\iota$, where $\iota $ is the canonical morphism $\iota:{A}\lrta S^{-1}{A}:a\mapsto \frac{a}{1}$.
\begin{center}
\begin{tikzcd}
S\ar[r,hook] &{A}  \arrow[r,"f"] \arrow[d,"\iota"] & {B} \\
&S^{-1}{A}\arrow[ur,swap,"\exists !\tilde{f}"]  &    
\end{tikzcd}
\end{center}

\underline{Want}: $\forall f$ as above $\exists ! \tilde{f}\text{ s.t. } \tilde{f}\circ\iota=f$

Uniqueness:\\
$\tilde{f}(a/s)=\tilde{f}(a/1)\tilde{f}(s/1)^{-1}=f(a)f(s)^{-1}$.

Existence :\\
Take $\tilde{f}(a/s):=f(a)f(s)^{-1}$, check that it is well defined:
$$
\frac{a}{s}=\frac{a'}{s'}\overset{?}{\Lrta} f(a)f(s)^{-1}=f(a')f(s')^{-1}.
$$
This is guaranteed, $\exists t\in S: as' t=a's t$ $\Lrta (f(a)f(s')-f(a')f(s))f(t)=0$ and $f(t)\in {B}^{\times}\Lrta f(a)f(s')-f(a')f(s)=0$.
\end{proof}

\begin{exr}
We want to define the localization of module $M$ by the universal property. An $A$-module morphism  $\phi: M\lrta S^{-1}M$ being initial among $A$-module maps $M\lrta N$ such that elements of  $S$ act as $A$-module isomorphisms on $N$.
Show that $\phi:M\lrta S^{-1}M$ exists, by constructing something satisfying the universal property. 
\end{exr}
\begin{proof}
We want to find such $\phi:M\lrta S^{-1}M$ that
\begin{center}
\begin{tikzcd}
M\ar[r, "\phi"]\ar[dr, "\alpha"] &{S^{-1}M}  \arrow[d,"\exists!"] \\
&N       
\end{tikzcd}
\end{center}
Define elements of $S^{-1}M$ to be of the form $m/s$ where $m\in M$and $s\in S$, and $m_1/s_1 =m_2/s_2$ if and only if for some $s\in S$, $s(s_2m_1 − s_1m_2) = 0$. Define the additive structure by $(m_1/s_1) + (m_2/s_2) = (s_2m_1 + s_1m_2)/(s_1s_2)$, and the $S^{-1}A$-module structure (and hence the A-module structure) is given by$ (a_1/s_1) · (m_2/s_2) = (a_1m_2)/(s_1s_2)$. And the required $\phi:M\lrta S^{-1}M ,m\longmapsto m/1$.

It is easy to check that $S^{-1}M$ is well-defined $S^{-1}A$-module. We only need to check the universal property. For a given $\alpha:M\lrta N$ such that $s\in S$ act as isomorphism on $N$. we define
$$
\begin{aligned}
\tilde{\alpha}:& S^{-1}M\lrta N\\
& \frac{m}{s}\longmapsto s^{-1}\circ\alpha(m),
\end{aligned}
$$
where $s^{-1}$ means the inverse of the morphism $s\times \cdot: N\lrta N$. Check that $\tilde{\alpha}$ is well-defined. Consider $\frac{m_1}{s_1}\sim \frac{m_2}{s_2}$, $\exists s\in S$ s.t. $s s_1m_2=s s_2m_1$. We want to check $s_1^{-1}\alpha(m_1)=s_2^{-1}\alpha(m_2)$, which is equivalent to $\alpha(s_2 m_1-s_1m_2)=s^{-1}\circ \alpha(s s_2m_1-s s_1m_2)=0$.
It is easy to check that $\tilde{\alpha}\circ \phi=\alpha$.

As for the uniqueness, assume there is another morphism of $A$-module $f:S^{-1}M\lrta N$ s.t. $f\circ \phi=\alpha$.
$$
f\left(\frac{m}{1}\right)=\alpha(m)
$$
$$
f\left(\frac{m}{s}\times s\right)=s f\left(\frac{m}{1}\right)=\alpha(m)
$$
$\Lrta f(m/s)=s^{-1}\circ \alpha(m)$.
\end{proof}
\begin{exr}\ 
\begin{enumerate}[label=(\alph*)]
\item Show that localization commutes with finite products, or equivalently, with
finite direct sums. In other words, if $M_1,...,M_n$ are $A$-modules, describe an isomorphism (of $A$-modules, and of $S^{-1}A$-modules) $S^{-1}(M_1 \times\cdot\cdot\cdot\times M_n) \lrta S^{-1}M_1 \times
\cdot\cdot \cdot\times S^{-1}M_n$.
\item  Show that localization commutes with arbitrary direct sums.
\item Show that “localization does not necessarily commute with infinite products”:
the obvious map $S^{-1}(\prod_i M_i) \lrta  \prod_i S^{-1}M_i$ induced by the universal property of
localization is not always an isomorphism. (Hint: ($1, 1/2, 1/3, 1/4,... ) \in \ratl\times\ratl \times \cdot\cdot\cdot$.)
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item We can induct on $n$ and start by considering only $M_1,M_2$. Recall the universal property of localization:
\begin{center}
\tiny
\begin{tikzcd}
S^{-1}M_1\times S^{-1}M_2 &  &  &  \\
 & S^{-1}(M_1\times M_2) \arrow[lu, "\exists!", dashed] &  & S^{-1}M_2 \arrow[lllu, hook] \\
 &  & M_1\times M_2 \arrow[lu] \arrow[d] \arrow[r] & M_2 \arrow[u] \\
 & S^{-1}M_1 \arrow[luuu, hook] & M_1 \arrow[l] & 
\end{tikzcd}
\begin{tikzcd}
S^{-1}M_1\times S^{-1}M_2 \arrow[rrrd] \arrow[rddd] \arrow[rd, "\exists!", dashed] &  &  &  \\
 & S^{-1}(M_1\times M_2) \arrow[rr, "\exists!"] \arrow[dd, "\exists!"] &  & S^{-1}M_2 \\
 &  & M_1\times M_2 \arrow[lu] \arrow[d] \arrow[r] & M_2 \arrow[u] \\
 & S^{-1}M_1 & M_1 \arrow[l] & 
\end{tikzcd}
\end{center}
The second diagram is derived from the universal property of product. Then we know $S^{-1}(M_1\times M_2)\cong S^{-1}M_1\times S^{-1}M_2$.
Then we can prove inductively for any finite product. Explicitly, we have
$$
\begin{aligned}
&\frac{(m_1,...,m_n)}{s}\longmapsto \left(\frac{m_1}{s},...,\frac{m_n}{s}\right)\\
&\left(\frac{m_1}{s_1},...,\frac{m_n}{s_n}\right)\longmapsto \frac{(...,\prod^n_{j\neq i} s_j m_i,...)}{\prod^n_i s_i}
\end{aligned}
$$
\item $S^{-1}$ commutes with arbitrary direct sum because each element $(m_1,..,m_i,....)\in \oplus_{i\in I}M_i$ there only finitely many $m_i\neq 0$, which can be regraded as a image of an element contained in a finite direct sum. Then we can check $S^{-1}$ commutes with direct sum value-wisely.
\item By the hint, consider $(1, 1/2, 1/3, 1/4,... ) \in \ratl\times\ratl \times \cdot\cdot\cdot$ but $(1, 1/2, 1/3, 1/4,... )$ is not contained in $ (\intg^{\times})^{-1}(\prod \intg)$. Because $ 1\times 2\times 3\times ....\notin \intg^\times$ 
\end{enumerate}
\end{proof}

\begin{exr}
Show that $\intg/(10) \otimes_\intg\intg/(12) \cong \intg/(2)$.
\end{exr}
\begin{proof}
In fact $$\intg/m\intg\otimes_\intg \intg/n\intg\cong \intg/gcd(m,n)\intg.$$
\end{proof}

\begin{exr}
Show that $(\cdot)\otimes_A N$ gives a covariant functor $Mod_A\lrta Mod_A$. Show that $(\cdot)\otimes_A N$ is a right-exact
functor, i.e., given a exact sequence of $A$-module
an exact sequence of ${A}$-modules
\begin{equation*}
\begin{array}{ c c c c c c c c c}
  M' & \overset{f}{\longrightarrow } & M & \overset{g}{\longrightarrow } & M'' & \longrightarrow  & 0.\\
\end{array}
\end{equation*}
Then we have
\begin{equation*}
\begin{array}{ c c c c c c c c c}
  M'\otimes N & \overset{f\otimes 1}{\longrightarrow } & M\otimes N & \overset{g\otimes 1}{\longrightarrow } & M''\otimes N & \longrightarrow  & 0\\
\end{array}
\end{equation*}
 is  exact for arbitrary ${A}$-module $N$.
\end{exr}
\begin{proof}
Obviously $g\otimes 1$ is surjective. We only need to prove the exactness at $M\otimes N$. As for the easier inclusion,
$
\text{Im}(f\otimes 1)\subseteq \text{Ker}(g\otimes 1)
$
because $(g\otimes 1)\circ (f\otimes 1)=(g\circ f)\otimes 1=0$. 
Then it remains to show 
$$
\frac{M\otimes N}{\text{Im}(f\otimes 1)}\overset{\psi}{\lrta}M''\otimes N
$$
is an isomorphism. $\psi $ is induced by $g\otimes 1$,  well defined because $
\text{Im}(f\otimes 1)\subseteq \text{Ker}(g\otimes 1).
$

Now, we construct a two-sided inverse $\varphi$ of $\psi$.
\begin{center}
\begin{tikzcd}
 M''\otimes N  \ar[r,dashed,"\exists \varphi"] & \frac{M\otimes N}{\text{Im}(f\otimes 1)} \\
 M''\times N \arrow[u] \arrow[ur,dashed,"\exists \varphi_0"]& \\
M\times N\arrow[swap,uur,"\varphi_1"]\arrow[u,"g\times 1"] &    
\end{tikzcd}
\end{center}
Consider the map $\varphi_1$, it is the composition of the canonical projection and the defining map of tensor product.
$\varphi_1(x,y)\mapsto x\otimes y+\text{Im}(f\otimes 1)$. Consider $(x'',y)\in M''\times N$, which is the image of $(x,y)$ under $g\times 1$. Then we can define $\varphi_0(x'',y):=\varphi_1(x,y)$. It is well-defined, because if there is another $(x_1,y)$ also map to $(x'',y)$, the difference
$$
x-x_1\in \text{Ker}(g)=\text{Im}(f),
$$
hence $\exists z\in M'$
$x-x_1=f(z)$.
$\Lrta (x-x_1)\otimes y=(f\otimes 1)(z\otimes y)$
Then
$$
\varphi_1(x,y)-\varphi(x_1,y)=(x-x_1)\otimes y+\text{Im}(f\otimes 1)=0.
$$
Then it remains to check $\varphi_0$ is bilinear so that $\varphi_0$ lifts to a $\varphi$ on $M''\otimes N$. Also we  need to check the $\varphi$ is indeed the two-sided inverse of $\psi$.

Consider  $\varphi_0(x'',ay+bv)$ and $\varphi_0(ax''+bw'',y)$. Chose $x$ and $w$ in the preimages $g^{-1}(x'')$ and $g^{-1}(w'')$. By the linearity of $g$, we can safely choose $ax+bw$ in the pre-image of $ax''+bw''$
Knowing that $\varphi_1$ is bilinear (because the defining map of tensor product is bilinear and canonical projection is linear), we have
$$
\begin{aligned}
&\varphi_0(x'',ay+bv)=\varphi_1(x,ay+bv)\\
&=a\varphi_1(x,y)+b\varphi_1(x,v)=a\varphi_0(x'',y)+b\varphi_0(x'',v)
\end{aligned}
$$
and
$$
\begin{aligned}
&\varphi_0(ax''+bw'',y)=\varphi_1(ax+bw,y)\\
&=a\varphi_1(x,y)+b\varphi(w,y)=a\varphi_0(x'',y)+b\varphi_0(w'',y).
\end{aligned}
$$ 
Explicitly, with $x\in g^{-1}(x'')$, 
$$
\varphi(x''\otimes y)=x\otimes y+\text{Im}(f\otimes 1)
$$
and
$$
\psi(x\otimes y+\text{Im}(f\otimes 1))=g(x)\otimes y
$$
$$
\begin{aligned}
&\Lrta\\
&\psi\circ\varphi(x''\otimes y)=g(x)\otimes y=x''\otimes y\\
&\varphi\circ \psi(x\otimes y+\text{Im}(f\otimes 1))=x_1\otimes y+\text{Im}(f\otimes 1)=x\otimes y+\text{Im}(f\otimes 1),
\end{aligned}
$$
where in the last line $x_1$ is another representative in $g^{-1}(x'')$.
\end{proof}

\begin{exr}
We can take this as the definition of the tensor product as follows. It is an $A$-module $T$ along with an $A$-bilinear map $t: M \times N \lrta T$, such that given any $A$-bilinear map $t':M\times N\lrta T'$, there is a unique $A$-linear map $f:T \lrta T'$ such that $t' =f\circ t$.

\begin{center}
\begin{tikzcd}
M\times N\ar[r, "t"]\ar[dr, "t'"] &T  \arrow[d,"\exists! f"] \\
&T'       
\end{tikzcd}
\end{center}
  
Show that $(T,t:M\times N\lrta T)$is unique up to unique isomorphism. Hint: first figure out what “unique up to unique isomorphism” means for such pairs, using a category of pairs $(T, t)$. Then follow the analogous argument for the product.
\end{exr}
\begin{proof}
In fact \textbf{unique up to unique isomorphism} means the desired object has no nontrivial automorphism. If fact Tensor product is not unique, we have $M\otimes N$ and $N\otimes M$ but they are isomorphic up to unique isomorphism.

Then lets consider the category of pairs $(T,t: M\times N\lrta T)$. The objects have been given and the morphism is a tuple $(f, f_{e})$ so that $f$ is  morphism of modules and $f_{e}$ is the induced morphism of \textit{Sets}: $f_e:\text{bi-lin-}\mor(M\times N, T)\lrta \text{bi-lin-}\mor(M\times N, f(T)), t\longmapsto f\circ t$. $(f(T), f_{e}(t))=(f(T), f\circ t)$. It is well defined category and tensor product is the initial object in this category, which must be unique up to unique isomorphism. Or explicitly, we can check
\end{proof}


\begin{exr}
Show that the construction of of tensor product by satisfies the universal property of tensor product.
\end{exr}
\begin{proof}
Form the free module $C:={A}^{M\times N}$, where 
$$
{A}^{(M\times N)}=\left.\left\{\sum_{(x,y)\in M\times N} a_{(x,y)}(x,y)\right|a_{(x,y)}\in {A}, \text{almost all $a_{(x,y)}=0$}\right\}.
$$
For each morphism of $A$-modules: $f:M\times N\lrta P$, there is a morphism $\tilde{f}$ from the the free module to $P$ s.t. $\tilde{f}(\sum a_{(x,y)}(x,y))=\sum a_{x,y} f(x,y)$. This is called the universal property of free module and it is easy to check that $\tilde{f}$ well-defined.
Let submodule $D\subseteq C$, then there is an induced map $\bar{g}:M\times N\lrta C/D$ for defining map $g:M\times N\lrta C$ of the free module. Then we consider a certain submodule $D$ with the following two equivalent definitions
\begin{itemize}
\item $D$ is the smallest submodule for which induced map $\bar{g}:M\times N\lrta C/D$ is bilinear.
\item $D$ it the submodule generated by the following elements
$$
\left\{\left.
\begin{aligned}
&(x+x',y)-(x,y)-(x',y)\\
&(x,y+y')-(x,y)-(x,y')\\
&a(x,y)-(ax,y)\\
&a(x,y)-(x,ay)
\end{aligned}
\right|\forall a\in {A}, \forall x,x'\in M,\forall y,y'\in N
\right\}
$$
\end{itemize}   
The equivalence of two definition can be explained by the definition of ``bilinear maps''. \\
We want to show that $T:=C/D$ is what we are looking for. Consider a  bilinear map $ b:M\times N\rta P$, consider the induced morphism $\tilde{b}$ on free module. Check $ \text{Ker}(\tilde{b})\supseteq D$ or equivalently $ \tilde{b}$ is bilinear.\\
The proof is to just check it by hand, e.g.
$$
\begin{aligned}
&\tilde{b}((x+x',y)-(x,y)-(x',y))\\
&=\tilde{b}((x+x',y))-\tilde{b}((x,y))-\tilde{b}((x',y))\\
&=b(x+x',y)-b(x,y)-b(x',y)\\
&=0(\text{by $b$ is bilinear})
\end{aligned}
$$
\begin{center}
\begin{tikzcd}
C:=A^{(M\times N)} \arrow[r, "\pi"] \arrow[rd, "\tilde{b}"] & T:=C/D \arrow[d, "\exists!\alpha"] \\
M\times N \arrow[u, "g"] \arrow[r, "b"] \arrow[ru, "\bar{g}", controls=
{+(-4,2) and +(-1,0.8)}] & P
\end{tikzcd}
\end{center}
Then we can define the morphism $\alpha: T\lrta P$ by $\alpha((x,y)+D)=\tilde{b}((x,y))=b(x,y)$, which is unique because we have define it value-wisely. We have $b=\alpha\circ \bar{g}$.
\end{proof}

\begin{exr}\ 
\begin{enumerate}[label=(\alph*)]
\item 
If $M$ is an $A$-module and $A \lrta B $ is a morphism of rings, give $B\otimes_A M$ the structure of a $B$-module (this is part of the exercise). Show that this describes a functor $Mod_A \lrta  Mod_B$.
\item  If further $A \lrta C$ is another morphism of rings, show that $B \otimes_A C$ has a natural structure of a ring.
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item $B\otimes_A M$ is naturally an $A$-module. The $B$-action is defined as
$$
b\cdot (b')\otimes_A m:= (bb')\otimes_A M.
$$
This is called \textbf{extension by scalar} and the resulting module is in fact a $(B,A)$-bimodule.

$B\otimes_A$ is indeed a functor. Consider three modules with morphisms $f:N\lrta M$. $g: M\lrta P$
\begin{center}
\begin{tikzcd}
N \arrow[d] \arrow[r, "f"] & M \arrow[d] \arrow[r, "g"] & P \arrow[d] \\
B\otimes_A N \arrow[r, "id\otimes f"] \arrow[rr, "id\otimes g\circ f"', bend right] & B\otimes_A M \arrow[r, "id\otimes g"] & B\otimes_A P
\end{tikzcd}
\end{center}
\item The tensor product of two $A$-algebras is again an $A$-algebra. On $B\otimes_A C$ the multiplication is defined to be 
$$
(b_1\otimes c_1)(b_2\otimes c_2):=(b_1b_2\otimes c_1c_2)
$$
we only need to check that it is compatible with addition and find the identity.
$$
(b\otimes c)\left((b_1\otimes c_1)+(b_2\otimes c_2)\right)=(b\otimes c)\left((b_1\otimes c_1)\right)+(b\otimes c)\left((b_2\otimes c_2)\right)
$$
And $(1_B\otimes 1_C)$ is the unit.
\end{enumerate}
\end{proof}

\begin{exr}\label{chap1exr:localization_extension_of_scalar}
If $S$ is a multiplicative subset of $A$ and $M$ is an $A$-module, describe a natural isomorphism $(S^{-1}A)\otimes_A M \cong S^{-1}M $.
\end{exr}
\begin{proof}
We give directly the morphism and the inverse
$$
\frac{a}{s}\otimes m\mapsto \frac{am}{s}
$$
$$
\frac{1}{s}\otimes m\mapsfrom \frac{m}{s}
$$
\end{proof}
\begin{exr}
Show that tensor products commute with arbitrary direct sums: if $M$ and $\{N_i\}_{i\in I}$ are all $A$-modules, describe an isomorphism
$$
M\otimes (\oplus_{i\in I} N_i) \cong \oplus_{i\in I} (M\otimes N_i)
$$
\end{exr}
\begin{proof}
First, we consider the finite direct sums:
 Consider a map: 
$$
\begin{aligned}
b:M\times (N_1\oplus N_2)&\rta M\otimes N_1 \oplus M\otimes N_2\\
(m,(n_1,n_2))&\mapsto (m\otimes n_1, m\otimes n_2).
\end{aligned}
$$
We can check that $b$ is bilinear, for example 
$$
\begin{aligned}
&b(m+m',(n_1,n_2))\\
&=((m+m')\otimes n_1,(m+m')\otimes n_2)\\
&= (m\otimes n_1+m'\otimes n_1,m\otimes n_2+m'\otimes n_2)\\
&=(m\otimes n_1,m\otimes n_2)+(m'\otimes n_1,m'\otimes n_2)\\
&=b(m,(n_1,n_2))+b(m',(n_1,n_2)).
\end{aligned}
$$
As a result the bilinear map $b$ must factor through $M\otimes (N_1\oplus N_2)$, and we denote the corresponding map $f:M\otimes (N_1\oplus N_2)\rta M\otimes N_1 \oplus M\otimes N_2$.
$$
f(m\otimes (n_1,n_2))=(m\otimes n_1,m\otimes n_2).
$$
We use the terminology \textbf{pure tensor} to name the tensors like $x\otimes y\in M\otimes N$, obviously, $M\otimes N$ is linearly generated by  pure tensors.
We want to show that $f$ is an isomorphism. Need to find the inverse map $g$ of $f$.

define 
$$
\begin{aligned}
g_1:M\otimes N_1&\lrta M\otimes(N_1\oplus N_2)\\
(m\otimes n_1)&\longmapsto m\otimes (n_1,0)
\end{aligned}
$$
similarly, we can construct 
$$
\begin{aligned}
g_2:M\otimes N_2&\lrta M\otimes(N_1\oplus N_2)\\
(m\otimes n_2)&\longmapsto m\otimes (0,n_2)
\end{aligned}
$$
Then, we define $g=g_1\oplus g_2$. We want to show $f\circ g=id, g\circ f=id$.
$$
\begin{aligned}
&f\circ g(m\otimes n,m'\otimes n_2)\\
&=f(m\otimes (n_1,0)+m'\otimes(0,n_2))\\
&=(m\otimes n_1,0)+(0,m'\otimes n_2)\\
&=(m\otimes n_1,m'\otimes n_2)
\end{aligned}
$$
Then $f\circ g=id $ on pure tensors, hence it is identity on all tensors, because $f\circ g$ is linear, and pure tensor generates the whole tensor product module. Hence we can inductively prove tensor product commutes with finite direct sums.

As arbitrary direct sums. 
$$
\begin{aligned}
f: M\otimes(\oplus_{i\in I}N_i)\lrta \oplus_{i\in I} (M\otimes N_i)\\
m\otimes (...,n_i,...)\longmapsto (..., m\otimes n_i,...)
\end{aligned}
$$
also define
$$
\begin{aligned}
g_i:M\otimes N_i\lrta M\otimes (\oplus_{i\in I} N_i)\\
m\otimes n_i\longmapsto m\otimes (0,0,...,n_i,0,...)
\end{aligned}
$$
and $g:=\oplus_{i\in I} g_i$. Then we can see $f\circ g=id$ and $g\circ f =id $ is value-wisely true. 
\end{proof}


\begin{exr}
(FIBERED PRODUCTS OF SETS). Show that in Sets,
$$
T:=X\times_Z Y=\{(x,y)\in X\times Y : \alpha(x)=β\beta(y)\}.$$
\end{exr}
\begin{proof}
$$
pr_X:T\lrta X:(x,y)\in T\longmapsto x
$$
$$
pr_Y:T\lrta X:(x,y)\in T\longmapsto y
$$
$\alpha\circ pr_X=\beta\circ pr_Y$ is tautology.

Now we directly verify that the above constructed set has the universal property required for a fibered product.
\begin{center}
\begin{tikzcd}
W \arrow[rdd, "f"] \arrow[rrd, "g"] \arrow[rd, "\exists !", dashed] &  &  \\
 & X \times_Z Y \arrow[r, "pr_Y"'] \arrow[d, "pr_X"] & Y \arrow[d, "\beta"] \\
 & X \arrow[r, "\alpha"] & Z
\end{tikzcd}
\end{center}
given any object $W $ with maps to $X$ and $Y$ (whose compositions to $Z$ agree)

There is a unique morphism form $W$ to $T=X\times_Z Y$ by 
$$
w\longmapsto (f(w), g(w))
$$
\end{proof}

\begin{exr}
If $X$ is a topological space, show that fibered products always exist in the category of open sets of $X$, by describing what a fibered product is.
\end{exr}
\begin{proof}
In the category of open sets, each morphism is inclusion.
\begin{center}
\begin{tikzcd}
A \times_Z B \arrow[r, "pr_Y", hook] \arrow[d, "pr_X", hook] & B \arrow[d, "\beta", hook] \\
A \arrow[r, "\alpha", hook] & Z
\end{tikzcd}
\end{center}
Here the fibered product is just the intersection of open sets.
\end{proof}
\begin{exr}
If $Z$ is the final object in a category $\calc$ , and $X, Y \in \calc$ , show that ``$X \times_Z Y = X \times Y$'': the fibered product over Z is uniquely isomorphic to the product. Assume all relevant (fibered) products exist.
\end{exr}
\begin{proof}
Look at the diagram
\begin{center}
\begin{center}
\begin{tikzcd}
W \arrow[rdd, "f"] \arrow[rrd, "g"] \arrow[rd, "\exists !", dashed] &  &  \\
 & X \times_Z Y \arrow[r, "pr_Y"'] \arrow[d, "pr_X"] & Y \arrow[d, "\beta"] \\
 & X \arrow[r, "\alpha"] & Z
\end{tikzcd}
\end{center}
\end{center}
Because $Z$ is the final object in $\calc$. The morphism $W\rta Y\rta Z=W\rta Z$, where the later is the unique morphism from $W$ to $Z$. In other words, for any morphism $M\lrta Y$ and $M\lrta X$ (they must agree after composition with $\alpha,\beta$), hence there exists a unique morphism from $W$ to $X \times_Z Y$. (by Universal property of fibered product)

If we omit the sentences in the parenthesis, it is basically the universal property of product $X\times Y$.
\end{proof}

\begin{exr}
If the two squares in the following commutative diagram are Cartesian diagrams, show that the “outside rectangle” (involving $U, V, Y, $ and $Z$) is also a Cartesian diagram.
\begin{center}
\begin{tikzcd}
U \arrow[d] \arrow[r] & V \arrow[d] \\
W \arrow[d] \arrow[r] & X \arrow[d] \\
Y \arrow[r] & Z
\end{tikzcd}
\end{center}
\end{exr}
\begin{proof} We use  diagrams to replace words,
\begin{center}
\begin{tikzcd}
P \arrow[rrddd, "f"'] \arrow[rrrd, "g"] \arrow[rrdd, "\exists!h", dashed] &  &  &  \\
 &  &  & V \arrow[d, "\beta_2"] \\
 &  & W \arrow[d, "pr_Y"] \arrow[r, "\alpha_2=pr_X"] & X \arrow[d, "\beta_1"] \\
 &  & Y \arrow[r, "\alpha_1"] & Z
\end{tikzcd}
\begin{tikzcd}
P \arrow[rrrd, "g"] \arrow[rrdd, "h", dashed] \arrow[rrd, "\exists!", dotted] &  &  &  \\
 &  & U \arrow[d, "pr_W"] \arrow[r, "pr_V"] & V \arrow[d, "\beta_2"] \\
 &  & W \arrow[r, "\alpha_2=pr_X"] & X
\end{tikzcd}
\end{center}
\begin{center}
\begin{tikzcd}
P \arrow[rrddd, "f"'] \arrow[rrrd, "g"] \arrow[rrdd, "\exists!h", dashed] \arrow[rrd, "\exists!", dotted] &  &  &  \\
 &  & U \arrow[d, "pr_W"] \arrow[r, "pr_V"] & V \arrow[d, "\beta_2"] \\
 &  & W \arrow[d, "pr_Y"] \arrow[r, "\alpha_2=pr_X"] & X \arrow[d, "\beta_1"] \\
 &  & Y \arrow[r, "\alpha_1"] & Z
\end{tikzcd}
\end{center}
\end{proof}

\begin{exr}\label{chap1exr:induced_morphism_between_fiberedproductes}
Given morphisms $X_1 \lrta Y, X_2 \lrta Y$, and $ Y \lrta Z$, show that there is a natural morphism $X_1 \times_Y X_2 \lrta  X_1\times_Z X_2$, assuming that both fibered products exist.
\end{exr}
\begin{proof}Again, we use diagrams to formalize the  deduction process
\begin{center}
\begin{tikzcd}
X_1\times_YX_2 \arrow[rdd] \arrow[rrd] &  &  &  \\
 & X_1\times_ZX_2 \arrow[r] \arrow[d] & X_2 \arrow[d] &  \\
 & X_1 \arrow[r] & Y \arrow[rd] &  \\
 &  &  & Z
\end{tikzcd}
\begin{tikzcd}
X_1\times_YX_2 \arrow[rdd] \arrow[rrd] \arrow[rd, "\exists!", dashed] &  &  &  \\
 & X_1\times_ZX_2 \arrow[r] \arrow[d] & X_2 \arrow[rdd] &  \\
 & X_1 \arrow[rrd] & Y &  \\
 &  &  & Z
\end{tikzcd}
\end{center}
\end{proof}

\begin{exr}
Suppose we are given morphisms $X_1,X_2 \lrta Y$ and $Y \lrta  Z$. Show that the following diagram is a Cartesian
\begin{center}
\begin{tikzcd}
X_1\times_YX_2 \arrow[d] \arrow[r] & X_1\times_ZX_2 \arrow[d] \\
Y \arrow[r] & Y\times_ZY
\end{tikzcd}
\end{center}
\end{exr}
\begin{proof} Firstly we show how we get the arrows in the magic diagram, and why that the diagram is indeed commutative:
\begin{center}
\begin{tikzcd}
X_1\times_YX_2 \arrow[rrr] \arrow[ddd,red]\ar[dddrrr,blue, bend right, crossing over] \arrow[rd, red] \arrow[rd, blue, bend left] &  &  & X_2 \arrow[ddd,red] &  &  \\
 & X_1\times_Z X_2 \ar[rrrddd, bend left ,blue, crossing over ] \arrow[d] \arrow[r,red] & X_2 \arrow[d] \arrow[ru,"=", leftrightarrow, red] &  &  &  \\
 & X_1 \arrow[r] \arrow[ld,"="', leftrightarrow] & Z &  &  &  \\
X_1 \arrow[rrr, red]  &  &  & Y\ar[dr,blue, bend right] \arrow[rr, "=", leftrightarrow] \arrow[dd, "="', leftrightarrow] \arrow[rd,red] \arrow[lu] &  & Y \arrow[dd] \\
 &  &  &  & Y\times_ZY \arrow[ru] \arrow[ld] &  \\
 &  &  & Y \arrow[rr] &  & Z
\end{tikzcd}
\end{center}
The red arrows composite to the blue arrow, and the square is indeed commutative. Assume an object $T$, with morphism $T\lrta Y$ and $T\lrta X_1\times_Z X_2$ and they agree upon compositing to $Y\times_Z Y$.
\begin{center}
 \begin{tikzcd}
 & X_1\times_YX_2 \arrow[rrr, "f",blue] \arrow[ddd] \arrow[rd,"k",blue] &  &  & X_2 \arrow[ddd, "b",blue] &  &  \\
 &  & X_1\times_Z X_2 \arrow[d,"c"] \arrow[r, "d"'] \arrow[rrrddd, "g", bend left=60, blue] & X_2 \arrow[d] \arrow[ru, leftrightarrow, "="] &  &  &  \\
 &  & X_1 \arrow[r] \arrow[ld,leftrightarrow,"="] & Z &  &  &  \\
 & X_1 \arrow[rrr] &  &  & Y \arrow[rr,leftrightarrow,"="] \arrow[dd,leftrightarrow,"="] \arrow[rd, "a",blue] \arrow[lu] &  & Y \arrow[dd] \\
T \arrow[rrrru, "j", red] \arrow[rruuu, "i",red] \arrow[ruuuu, "\exists !h", dashed] &  &  &  &  & Y\times_ZY \arrow[ru] \arrow[ld, "p"] &  \\
 &  &  &  & Y \arrow[rr] &  & Z
\end{tikzcd}
\end{center}
The blue arrows form the magic diagram. All the arrow except red and dashed ones are commutative.

In addition, we know $g\circ i=a\circ j$.

Then the verification of universal property can be divided into two steps:
\begin{enumerate}[label=(\alph*)]
\item find a unique morphism $\exists h: T\lrta X_1\times_Y X_2$
\item prove such $h$ form commutative diagram with red and blue arrows.
\end{enumerate}

For part (a): find an $h$.

$\exists i: T\lrta X_1\times_Z X_2$, there exist extension of $i$, $T\lrta X_1$ and $T\lrta X_2$ that agree when composite to $Y$.

$\exists ! h$ such that $f\circ h= d\circ k\circ  h= d\circ i$. Similarly, we have $c \circ k\circ h=c\circ i $.

Part $(b1)$: $k\circ h=i$

$c\circ i $ and $d\circ i$ agree after composite to $Z$. There is a unique morphism $u$ form $T$ to $X_1,\times_Z X_2$ such that $c\circ u$ agrees $d\circ u$ after composite to $Z$. But we already have $k\circ h$ and $i$ satisfies the property of $u$. Hence $k\circ h=i$.

Part $(b2)$: $b\circ f\circ h=j$

We already have $i=k\circ h\Lrta g\circ i=g\circ k\circ h=a\circ j$.

Notice $p\circ a=id_Y$ and $g\circ k=a\circ b\circ f$.

 $j=p\circ a\circ j=p\circ g\circ k\circ h=p\circ a\circ b\circ f\circ h=b\circ f\circ h$.


\end{proof}

\begin{exr}
Show that coproduct for \textit{Sets} is disjoint union. This is why we use the notation $\coprod$ for disjoint union.
\end{exr}
\begin{proof}
We need to verify that disjoint union has has the desired universal property.
\begin{center}
\begin{tikzcd}
P &  &  \\
 & X\coprod Y \arrow[lu, "\exists !", dashed] & Y \arrow[l] \arrow[llu] \\
 & X \arrow[u] \arrow[luu] & 
\end{tikzcd}
\end{center}
$X\inj X\coprod Y$ and $Y\inj X\coprod Y$. Given an object $P$ such that there is morphism  $f:x\lrta P$ and $g:Y\lrta P$. There exists a morphism $u: X\coprod Y\lrta P$ such that $u(x)=f(x),u(y)=g(y)$. This morphism makes the diagram commute and for the diagram to commute, the morphism has to be defined value-wisely, hence is unique.
\end{proof}

\begin{exr}
Suppose $A\lrta B$ and $A\lrta C$ are two ring morphisms, so in particular $B$ and $C$ are $A$-modules. Recall that $B \otimes_A C$ has a ring structure. Show that there is a natural morphism $B \lrta B \otimes_A C$ given by $b  \mapsto b\otimes 1 $. (This is not necessarily an inclusion; see Exercise 1.3.G.) Similarly, there is a natural morphism $C \otimes_A C$. Show that this gives a fibered coproduct on rings.
\end{exr}
\begin{proof}
There is a natural morphism from $B$ to $B\otimes_A C$ by $id_B\otimes 1_c$, It is indeed a ring morphism because $b_1b_2\mapsto (b_1b_2\otimes 1)=(b_1\otimes 1)\cdot (b_2\otimes 1)$ and $b_1+b_2\mapsto ((b_1+b_2)\otimes 1)=(b_1\otimes 1)+ (b_2\otimes 1)$. Similarly, there is a natural ring morphism from $C$ to $B\otimes_A C$. The inner square commutes because
$$
\phi(a)\otimes 1_C=a\cdot 1_B\otimes 1_C=1_B\otimes a\cdot 1_C=1_B\otimes\psi(a).
$$
\begin{center}
\begin{tikzcd}
R &  &  \\
 & B\otimes_A C \arrow[lu, "\exists!", dashed] & C \arrow[l] \arrow[llu, "g"'] \\
 & B \arrow[u] \arrow[luu, "f"] & A \arrow[l, "\phi"] \arrow[u, "\psi"']
\end{tikzcd}
\end{center}
Assume there is an object $R$ in \textit{Rings} such that the outer square commutes. $f\circ \phi=g\circ\psi$, there exists a morphism 
$$
u:B\otimes_A C\lrta R
$$
$$
(b\otimes c)\longmapsto f(b)\cdot g(c).
$$
The resulting diagram commutes, $b\mapsto b\otimes 1\mapsto f(b)g(1)=f(b)$ and $c\mapsto 1\otimes c\mapsto f(1)g(c)=g(c)$.

It is unique, if we assume there is such a morphism that makes the diagram commute/ It must satisfy $u(b\otimes 1)=f(b)$, $u(1\otimes c)=g(c)$ and because it is a ring morphism $u(b\otimes c)=u((b\otimes 1)(c\otimes 1))=u(b\otimes 1)u(1\otimes b)=f(b)g(c)$.
\end{proof}
\begin{exr}
Show that composition of monomorphisms is agian a monomorphism.
\end{exr}
\begin{proof}
Consider a diagram of composition of monomorphisms
\begin{center}
\begin{tikzcd}
W \arrow[rd] \arrow[rrd] \arrow[d, dashed] &  &  \\
Z \arrow[r, "\pi_2"] & X \arrow[r, "\pi_1"] & Y
\end{tikzcd}
\end{center}
Assume $\mu_1,\mu_2:W\lrta Z$ and $\pi_1\circ\pi_2\circ\mu_1=\pi_1\circ\pi_2\circ\mu_2$. Because $\pi_1$ is a monomorphism, $\pi_2\circ \mu_1=\pi_2\circ\mu_2$. Again $\mu_1=\mu_2$ because $\pi_2$ is a monomorphism. This means $\pi_1\circ \pi_2$  is a monomorphism.
\end{proof}

\begin{exr}
Prove that a morphism $\pi: X →\lrta Y$ is a monomorphism if and only if the fibered product $X ×\times_Y X $exists, and the induced morphism $X \lrta  X \times_Y X$ is an isomorphism.
\end{exr}
\begin{proof}
$\pi:X\lrta Y$ is a monomorphism. \underline{Claim}: $X$ itself is the fibered product $X\times_Y X$.
\begin{center}
\begin{tikzcd}
Z \arrow[rdd, "\mu_1"'] \arrow[rrd, "\mu_2"] \arrow[rd, dashed] &  &  \\
 & X \arrow[r, "="] \arrow[d, "="] & X \arrow[d, "\pi"] \\
 & X \arrow[r, "\pi"'] & Y
\end{tikzcd}
\end{center}
Because $\pi$ is monomorphism, $\mu_1=\mu_2$, there is a unique morphism $\mu=\mu_1=\mu_2$ such that the diagram commutes.

For the other direction of the statement. The fibered product exists. The first step is to verify that $pr_1=pr_2$.
\begin{center}
\begin{tikzcd}
X\times_Y X \arrow[rdd, "pr_2"'] \arrow[rrd,bend left, "pr_1"] \arrow[rd, "\exists!=", dotted] &  &  \\
 & X\times_Y X \arrow[d, "pr_1"] \arrow[r, "pr_2"'] & X \arrow[d, "\pi"] \\
 & X \arrow[r, "\pi"'] & Y
\end{tikzcd}
\end{center}
Consider an object $X\times_Y X$ with switched $pr_i$, the unique morphism is just the identity. Hence we have $pr_1=pr_2$.

\begin{center}
\begin{tikzcd}
Z \arrow[rrd, "\mu_2", bend left] \arrow[rdd, "\mu_1"'] \arrow[rd, "\exists !\mu", dashed] &  &  \\
 & X\times_Y X \arrow[d, "pr_1"] \arrow[r, "pr_2"'] & X \arrow[d, "\pi"] \\
 & X \arrow[r, "\pi"'] & Y
\end{tikzcd}
\end{center}
Consider the above diagram. Given an object $Z$ with $\pi\circ\mu_1=\pi\circ \mu_2$. There exists a unique morphism $\mu$ such that $pr_1\circ\mu=\mu_1$ and $pr_2\circ \mu=\mu_2$. But we already proved $pr_1=pr_2$, hence we have $\mu_1=\mu_2$, which means $\pi$ is monomorphism.
\end{proof}


\begin{exr}
We use the notation of Exercise~\ref{chap1exr:induced_morphism_between_fiberedproductes}. Show that if $Y \lrta Z$ is a monomorphism, then the morphism $X_1 \times_Y X_2 \lrta X_1 \times_Z X_2$ you described in Exercise~\ref{chap1exr:induced_morphism_between_fiberedproductes} is an isomorphism. 
\end{exr}
\begin{proof}
Consider such a diagram,
\begin{center}
\begin{tikzcd}
X_1\times_Y X_2\ar[dr, "\exists!u"',dashed, shift right=1.5ex] \arrow[rdd, "pr_1"',bend right] \arrow[rrd, "pr_2",bend left] &  &  &  \\
 & X_1\times_Z X_2\ar[lu,"\exists !v"',dashed] \arrow[d, "pr_1'"] \arrow[r, "pr_2'"'] & X_2 \arrow[d, "\alpha_2"'] \arrow[rdd, "\alpha_2'"] &  \\
 & X_1 \arrow[r, "\alpha_1"] \arrow[rrd, "\alpha_1'"'] & Y \arrow[rd, "\pi"] &  \\
 &  &  & Z
\end{tikzcd}
\end{center}
where $\exists !u$ have been is trivial because $\pi\circ \alpha_1\circ pr_1=\pi\circ \alpha_2\circ pr_2$. We have $pr_1'\circ u=pr_1$ and $pr_2'\circ u=pr_2$

On the other hand $\alpha_1'\circ pr_1'=\pi\circ \alpha_1\circ pr_1'=\pi\circ \alpha_2\circ pr_2'=\alpha_2'\circ pr_2'$, because in our setting $\alpha_1'=\pi\circ \alpha_1$ and $\alpha_2'=\pi\circ \alpha_2$. 

Because $\pi$ is a monomorphism, $\alpha_1\circ pr_1'=\alpha_2\circ pr_2'$.

Then we have a morphism $v: X_1\times_Z X_2\lrta X_1\times_Y X_2$ such that $pr_1\circ v=pr_1'$ and $pr_2\circ v=pr_2'$. 

The composites of $u,v$ also make the diagram commute.
$pr_i'\circ u\circ v=pr_i'$ and $pr_i\circ v\circ u=pr_i$. The only automorphisms have this property is identity. Hence $u,v$ are isomorphisms and mutually inverse. 
\end{proof}

Suppose $A$ is an object of category $\calc$ . For any object $C \in \calc$, we have a set of morphisms $Mor(C,A)$. If we have a morphism $f: B \lrta C$, we get a map of sets
$$
h_A(f):Mor(C, A) \lrta Mor(B, A),
$$
$$
[C\lrta A]\longmapsto[B\overset{f}{\lrta }C\lrta A]
$$
$$
u\longmapsto u\circ f
$$
by composition: given a map from $C$ to $A$, we get a map from $B$ to $A$ by precomposing with $f : B \lrta C$. Hence this gives a contravariant functor $h_A : \calc \lrta \textit{Sets}$. Yoneda’s Lemma states that the functor $h_A$ determines $A$ up to unique isomorphism. More precisely:
\begin{exr}\label{chap1exr:Yoneda}\ 
\begin{enumerate}[label=(\alph*)]
\item 
Suppose you have two objects $A$ and $A'$ in a category $\calc$ , and morphisms in \textit{Sets}
$$
i_C: Mor(C,A)\lrta Mor(C,A')
$$
that commute with the maps $h_A(f)$ (Given $f:C\lrta B$, we have $i_B\circ h_A(f)=h_{A'}(f)\circ i_C$). Show that the $i_C$ (as $C$ ranges over the objects of $C$ )
\begin{center}
\begin{tikzcd}
\mor(C,A) \arrow[d, "h_A(f)"] \arrow[r, "i_C"] & \mor(C,A') \arrow[d, "h_{A'}(f)"] \\
\mor(B,A) \arrow[r, "i_B"] & \mor(B,A')
\end{tikzcd}
\end{center}

 are induced from a unique morphism $g : A \lrta A'$ . More precisely, show that there is a unique morphism $g: A\lrta A'$ such that for all $C \in \calc,i_C $ is $u  \mapsto g\circ u.$
 \item If furthermore the $i_C$ are all bijections, show that the resulting $g$ is an isomorphism.
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item 
Finally we want to find such a diagram so that $i_C=h^C(g)$ for some $g\in \mor(A,A')$, where $h^C$ is the covariant functor defined as $h^C: A\lrta \mor(C,A)$ and $h^C(g)=[u\mapsto g\circ u]$.
\begin{center}
\begin{tikzcd}
 &  &  & \mor(C,A') \arrow[dd, "h_{A'}(f)"] &  &  \\
C \arrow[rr, "h_A"] \arrow[rrru, "h_{A'}"] &  & \mor(C,A) \arrow[dd, "h_A(f)"] \arrow[ru, "i_C"] &  &  &  \\
 &  &  & \mor(B,A') &  & A' \arrow[lluu, "h^C"] \arrow[ll, "h^B"] \\
B \arrow[uu, "f"] \arrow[rr, "h_A"] \arrow[rrru, "h_{A'}"] &  & \mor(B,A) \arrow[ru, "i_B"] &  & A \arrow[ru, "g"] \arrow[lluu, "h^C"] \arrow[ll, "h^B"'] & 
\end{tikzcd}
\end{center}
We know $i_C$ ranges over all $C\in\calc$. In particular, $C$ could equals to $A$. In this case 
$$
i_A:\mor(A,A)\lrta \mor(A,A')
$$
We define $g$ to be
$$
g:=i_A(id_A).
$$
Then we can check that, for $u\in \mor(C,A)$
\begin{equation}\label{chap1eq:}
\begin{aligned}
\text{[}h^C(g)\text{]}(u)&=g\circ u= [h_{A'}(u)](g)=[h_{A'}(u)](i_A(id_A))=[[h_{A'}(u)]\circ i_A](id_A)\\
&\overset{(*)}{=}[i_C\circ h_A(u)](id_A)=i_C([h_A(u)](id_A))=i_C(id_A\circ u)\\
&=i_C(u).
\end{aligned}
\end{equation}
The equality holds because we have the diagram
\begin{center}
\begin{tikzcd}
A \arrow[rd, "h_A"] \arrow[rrrd, "h_{A'}"] &  &  &  \\
 & \mor(A,A) \arrow[dd, "h_A(u)"] \arrow[rr, "i_A"] &  & \mor(A,A') \arrow[dd, "h_{A'}(u)"] \\
C \arrow[uu, "u"] \arrow[rd, "h_A"] \arrow[rrrd, "h_{A'}"'] &  &  &  \\
 & \mor(C,A) \arrow[rr, "i_C"] &  & \mor(C,A')
\end{tikzcd}
\end{center}
We have thus prove the existence of such a $g$. It is unique because $g\circ u=i_C(u)$ for $u\in \mor(C,A)$. If we choose $C=A$ and $u=id_A$, we have $g=i_A(id_A)$.
\item If all $i_C$ are bijective, there is a inverse for each $i_C$, we denote it by $j_C$. If we exchange the roles of $A$ and $A'$, $j_C$ also satisfies a similar commutative diagram, hence $j_C$ is also induced by $h^C(k)$ for a unique morphism $k\in \mor(A',A)$ and $k=j_{A'}(id_{A'})$. The notion is a little bit challenging, lets check that the composite $k\circ g$ and $g\circ k$ are identities. Remember that we prove in Equation~\ref{chap1eq:} that for morphism $u\in \mor(C,A)$, $g\circ u=i_C (u)$. Similarly for morphism $v\in\mor(C,A')$, $k\circ v=j_C(v)$. (This  is what it means for $i_C$, $j_C$ to be induced by $g$, $k$)

$k:=j_{A'}(id_{A'})\in \mor(A',A)$
$$
\begin{aligned}
g\circ k&= i_{A'}(k)=i_{A'}(j_{A'}(id_{A'}))=id_{A'},
\end{aligned}
$$
$g:=i_{A}(id_A)\in \mor(A,A')$
$$
\begin{aligned}
k\circ g&= j_{A}(g)=j_{A}(i_{A}(id_{A}))=id_{A}.
\end{aligned}
$$
Hence the resulting $g$ is also an isomorphism.
\end{enumerate}
\end{proof}

\begin{exr}
\begin{enumerate}[label=(\alph*)]
\item 
Suppose $A$ and $B$ are objects in a category $\calc$ . Give a bijection between the natural transformations $h^A \lrta  h^B$ of covariant functors $\calc \lrta Sets$ and the morphisms $B \lrta A$.
\item 
State and prove the corresponding fact for contravariant functors $h^A$. Remark: A contravariant functor $F$ from $\calc$ to Sets is said to be \textbf{representable} if there is a natural isomorphism
$$
\xi: F\overset{\sim}{\lrta }h_A
$$
Thus the representing object $A $ is determined up to unique isomorphism by the pair $(F, \xi)$. There is a similar definition for covariant functors.
\item \textbf{Yoneda's Lemma} Suppose $F$ is a covariant functor $ \calc \lrta Sets$, and $A \in \calc$ . Give a bijection between the natural transformations $h^A \lrta F$ and $F(A)$.
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item
We have the following diagram, 
\begin{center}
\begin{tikzcd}
 &  &  &  & h_D(A)=h^A(D) \arrow[dd, "\eta_D:=h_D(g)"] &  &  &  \\
A \arrow[rr, red] \arrow[rrrru,red]  &  & h_C(A)=h^A(C) \arrow[rru, "h^A(f)"] \arrow[dd, "\eta_C:=h_C(g)"] &  &  &  &  &  \\
 &  &  &  & h_D(B)=h^B(D) &  &  & D  \arrow[lll, blue] \arrow[llluu,blue] \\
B\arrow[uu, "g"] \arrow[rr,red] \arrow[rrrru,red] &  & h_C(B)=h^B(C) \arrow[rru, "h^B(f)"] &  &  & C\arrow[rru, "f"] \arrow[lll,blue] \arrow[llluu,blue] &  & 
\end{tikzcd}
\end{center}
where red arrows are  contravariant functor $h_C$ and $h_D$, blue arrows are covariant functor $h^A$ and $h^B$. Also for example $h_C(A)=h^A(C)=\mor(A,C)$.

Given a natural transformation $\eta$. Recall the definition of natural transformations, the $\eta_C$ in fact paly the role of $i_C$ in Exercise~\ref{chap1exr:Yoneda}. Hence we have a unique morphism $g:B\lrta A$ such that $\eta_C=h_C(g)$. We also saw that the morphism is uniquely determined by $g=\eta_A(id_A)$

On the other hand, if we are given a morphism $g:B\lrta A$, then the induce maps on each $C$, $h_C(g)$ is indeed a natural transformation. The problem reduce to prove the central black square in the diagram commutes.
$$
h^{B}(f)\circ h_C(g)\overset{?}{=}h_D(g)\circ h^A(f)
$$
which is just, given $u\in\mor(A,C)$
$$
\begin{aligned}
&h^{B}(f)\circ h_C(g)\\
&= h^B(f)\circ [u\mapsto u\circ g]\\
&=[u\mapsto f\circ u\circ g]\\
&=h_D(g)[u\mapsto f\circ u]\\
&=h_D(g)\circ h^A(f)
\end{aligned}
$$
Then bijection between the natural transformations $h^A \lrta  h^B$ of covariant functors $\calc \lrta Sets$ and the morphisms $B \lrta A$
$$
\mor(B,A)\sim \{\text{natural transformation between $h^A$ and $h^B$}\}
$$
$$
g\mapsto h_C(g)
$$
$$
\mor(B,A)\ni \eta_A(id_A)\mapsfrom \eta
$$
\item The dual version of $(a)$ for contravariant functor is essentially the same. We state it here without proof (since it is identical to $(a)$, exchanging the role of $h^A$ and $h_C$...)

Then bijection between the natural transformations $h_A \lrta  h_B$ of contravariant functors $\calc \lrta Sets$ and the morphisms $A \lrta B$
$$
\mor(A, B)\sim \{\text{natural transformation between $h_A$ and $h_B$}\}
$$
$$
g\mapsto h^C(g)=:\xi_C
$$
$$
\mor(A,B)\ni\xi_A(id_A)\mapsfrom \xi
$$

\item All what we have proved is a special case of Yoneda lemma when $F=h^B$. For the proof of general case, the idea is similar.
\begin{center}
\begin{tikzcd}
h^A(A)=\mor(A,A) \arrow[ddd, "\eta_A"'] \arrow[rrr, "h^A(f):\text{[}\_\mapsto f\circ\_ \text{]}"] &  &  & h^A(X)=\mor(A,X) \arrow[ddd, "\eta_X"] \\
 & id_A \arrow[r, maps to] \arrow[d, maps to] & f \arrow[d, maps to] &  \\
 & u \arrow[r, maps to] & \text{[}F(f)\text{]}(u)=\eta_X(f) &  \\
F(A) \arrow[rrr, "F(f)"'] &  &  & F(X)
\end{tikzcd}
\end{center}
where $u:\eta_A(id_A)$.
The diagram means $\eta_X:\mor(A,X)\lrta F(X)$ is uniquely determined by $\eta_A(id_A)$. A natural transformation $\eta$ unique determines one element $u:=\eta_A(id_A)\in F(A)$, and this element uniquely determines the natural transformation $\eta$ itself. We have got the bijection.
$$
\eta\mapsto \eta_A(id_A)
$$
$$
u\mapsto \eta_X(\_)=[F(\_)](u)\in\mor_{Sets}\left(\mor_\calc(A,X),F(X)\right).
$$
We concisely rewrite the theorem, using $\text{Nat}(F,G)$ to denote the natural transformations between two functors(both contravariant or both covariant).
For a covariant functor $F$
$$
F(A)\cong \text{Nat}(h^A,F).
$$

The corresponding statement of contravariant functor.

For contravariant functor $G:\calc\lrta Sets$, there is a bijection between $G(A)$ and $\text{Nat}(h_A,G)$.
$$
G(A)\cong \text{Nat}(h_A,G).
$$

\end{enumerate}

\end{proof}
\section{Limits and colimits}
\begin{exr}
Suppose that the partially ordered set $\cali$ has
an initial object $e$. Show that the limit of any diagram indexed by $\cali$ exists.
\end{exr}
\begin{proof}\underline{Claim}: In the diagram indexed by $\cali$ with an initial object $e$, we have 
$$
\invlim_{i\in\cali}A_i=A_e.
$$
Indeed, $A_e$ has the property that for $m\in \mor_\cali(j,k)$, 
\begin{center}
\begin{tikzcd}
A_e \arrow[d, "f_j:=F(e\rta j)"'] \arrow[rd, "f_k:=F(e\rta k)"] &  \\
A_j \arrow[r, "F(m)"] & A_k
\end{tikzcd}
\end{center}
Then it remains to prove $A_e$ is final among the property. Assume $W$ is another object with $\{g_i\}_{j\in \cali}$ satisfying the property  that for $m\in \mor_\cali(j,k)$, $g_k=F(m)\circ g_j $. In particular, there is one map $g:=g_e:W\lrta A_e$. $g_j=f_j\circ g$ because $f_j=F(e\lrta j)$.

Dually, we have if the index category $\cali$ has a final object $e$. The colimit of any diagram indexed by $\cali$ exists. 
\end{proof}
\begin{exr}
Show that in the category \textit{Sets},
$$
S:=\left\{(a_i)_{i\in\cali}\in\prod_i A_i:F(m)(a_j)=(a_k)\forall m\in \mor(j,k)\in \mor(\cali)\right\}
$$
along with the obvious projection maps to each $A_i$ , is the limit $\invlim_{\cali}A_i$.

Then it remains to check it is final among the property.
\end{exr}
\begin{proof}
$S$ is endowed with $pr_i:S\lrta A_i$, and obviously $pr_k=F(m)\circ pr_j$ because $(a_i)_{i\in\cali}\in S$ satisfies $F(m)(a_j)=(a_k)\forall m\in\mor(j,k)$.

Then it remains to check that $S$ is final among this property. Assume $W$ is another object together with morphism $g_i:W\lrta A_i$ and $g_k=F(m)g_j,\forall m\in\mor(j,k)$. Then there is a morphism from $W$ to $S$, by
$$
W\ni w\longmapsto (g_i(w))_{i\in\cali}
$$
$(g_i(w))_{i\in\cali}\in S$ because $g_k=F(m)g_j,\forall m\in\mor(j,k)$.
\end{proof}
\begin{exr}\ 
\begin{enumerate}[label=(\alph*)]
\item Interpret the statement $\ratl = \dirlim \frac{1}{n}\intg$.
\item Interpret the union of some subsets of a given set as a colimit. (Dually, the intersection can be interpreted as a limit.) The objects of the category in question are the subsets of the given set.
\end{enumerate}
\end{exr}
\begin{proof}\ 
\begin{enumerate}[label=(\alph*)]
\item The index category should be $\cali:=\intg^\times$ with $\mor(n,m)\neq \emptyset$ iff $n|m$ and $\mor(n,np)=\{\times p\} $. There is no final object in this category. And $F$ is a covariant functor from $\cali$ to $\calc:= Mod_\intg$. Such that $A_n=F(n)=\frac{1}{n}\intg$ and $F(n\lrta np): \frac{1}{np}\intg\lrta \frac{1}{n}\intg$ is $1/n\mapsto p/np$. 
\begin{center}
\begin{tikzcd}
\ratl &  \\
\frac{1}{n}\intg \arrow[r, "F(n\rta np)"] \arrow[u, "f_n"] & \frac{1}{np}\intg \arrow[lu, "f_{np}"']
\end{tikzcd}
\end{center}
$\ratl$ is ordinary rational numbers and $f_i$ is just the injection. The diagram indeed commutes and each arrow is a $\intg$-module morphism. 

$\ratl$ is indeed initial among this property. Assume there is an object $W$, together with $g_i:\frac{1}{i}\intg\lrta W$ has the property $g_{np}\circ F(n\rta np)=g_n$. We can define a morphism form $\ratl$ to $W$ by 
$$
g:\ratl\lrta W
$$
$$
\frac{s}{r}\longmapsto s g_r\left(\frac{1}{r}\right)
$$
It is well-defined, i.e., $g(s/r)=g(sa/ra)$, because 
$$
sg_{r}\left(\frac{1}{r}\right)=s g_{ra}\left(\frac{a}{ra}\right)=sa g_{ra}\left(\frac{1}{ra}\right).
$$
Also, $g\circ f_n=g_n$ because $g\circ f_n(t/n)=g_n(t/n).$
\item Given a set $A$, its power set is $P(A)$. $P(A)$ forms a category with objects being the subsets of $A$ and morphism being inclusion. A subset $S\subset P(A)$ is a subcategory of $P(A)$. $S$ is the index category. Let $i$ denote the object in $S$, and $V_i$ denote the corresponding object in $P(A)$. Union of all subsets in $S$
$$
\bigcup_{i\in S} V_i=\dirlim_{i\in S} V_i
$$
``$\cup_{i}V_i$ being colimit'' is just a tautology of ``$\cup_{i}V_i$ is the smallest subset of $A$ that contains each $V_i$''.

Dually, ``$\cap_{i}V_i$ being a limit'' is a tautology of ``$\cap_{i}V_i$ is the largest subset of $A$ that is contained in each of $V_i$.''
\end{enumerate}
\end{proof}
\begin{exr}
Suppose $\cali$ is filtered. (We will almost exclusively use the case where $\cali$ is a filtered set.) Recall the symbol $\coprod$ for disjoint union of sets. Show that any diagram in Sets indexed by $\cali$ has the following, with the obvious maps to it, as a colimit:
$$
S:=\left\{(a_i; i)\in\coprod_{i\in\cali} A_i:\right\}\left/
\left(
\begin{matrix}
& (a_i;i)\sim (a_j;j)\text{if and only if there are $f:A_i\lrta A_k$ and }\\
&\text{$g:A_j\lrta A_k$ in the diagram for which $f(a_i)=g(a_j)\in A_k$}
\end{matrix}
\right)
\right.
$$
\end{exr}
\begin{proof}\ 
\begin{enumerate}[label=(\roman*)]
\item ``$\sim$ is a well-defined equivalence relation'':

 $(a_i;i)\sim (a_i;i)$\checkmark

 $(a_i;i)\sim (a_j;j)\Llrta (a_j;j)\sim (a_i;i)$\checkmark

$(a_i;i)\sim (a_j;j)$ and $ (a_j;j)\sim (a_l;l)\Lrta (a_i;i)\sim (a_l;l)$:
We have to use the definition of filtered category. Consider the following diagram
\begin{center}
\begin{tikzcd}
A_i \arrow[rd, "f_i"] &  &  &  \\
 & A_k \arrow[rd, "h_k"] &  &  \\
A_j \arrow[ru, "f_j"] \arrow[rd, "g_j"] &  & A_{y} \arrow[r, "w"] & A_z \\
 & A_p \arrow[ru, "h_p"] &  &  \\
A_l \arrow[ru, "g_l"] &  &  & 
\end{tikzcd},
\end{center}
where $f_i(a_i)=f_j(a_j)$ and $g_j(a_j)=g_l(a_l)$. Because $\cali$ is a filtered category, there exists $A_{y}$ such that $h_k:A_k\lrta A_{y}$ and $h_p:A_p\lrta A_{k,p}$. 

Now look at $A_j$ and $A_{y}$, because it is a filtered category, there exists $A_z$ such that $A_j\lrta A_z$ and $A_y\lrta A_z$. Moreover given two arrows $h_p\circ g_j:A_j\lrta A_y$ and $h_k\circ f_j:A_j\lrta A_y$, there exits $w:A_y\lrta A_z$ such that $w\circ h_k\circ f_j=w\circ h_p\circ g_j$. In particular, this means 
$$
w\circ h_p\circ g_l(a_l)=w\circ h_p\circ g_j(a_j)=w\circ h_k\circ f_j(g_j)=w\circ h_k\circ f_i(a_i).
$$
Hence $(a_i;i)\sim(a_l;l)$.\checkmark


\item ``$S$ makes the diagram commute'':
\begin{center}
\begin{tikzcd}
S &  \\
A_i \arrow[u, "\iota_i"] \arrow[r, "h"'] & A_j \arrow[lu, "\iota_j"'],
\end{tikzcd}
\end{center}
where $\iota_j$ is the inclusion of $A_j$ into $\coprod A_i$ and then project to $S$.
$$
\iota_j:(a_j)\lrta (a_j;j)/\sim
$$
$$
\iota_j\circ h(a_i)=\iota_i(a_i)
$$
because
$$
\iota_j\circ h(a_i)=(h(a_i);j)/\sim=(a_i;i)/\sim,
$$
where $(h(a_i);j)\sim (a_i;i)$ since $h(a_i)=id_{A_j}h(a_i)$.
\item ``$S$ is initial among this property.''

Assume $W$ is another object together with the maps to make the diagram commute
\begin{center}
\begin{tikzcd}
W &  \\
A_i \arrow[r, "h"'] \arrow[u, "\sigma_i"] & A_j \arrow[lu, "\sigma_j"']
\end{tikzcd}.
\end{center}
Then we have a morphism form $S$ to $W$
$$
q:\frac{(a_i;i)}{\sim}\mapsto \sigma_i(a_i).
$$
This map is well-defined because assume 
$$
(a_i;i)\sim(a_j;j),
$$
we have $\exists A_k$, $f:A_i\lrta A_k$ and $g:A_j\lrta A_k$ such that $f(a_i)=g(a_j)$. Hence we have
$$
\sigma(a_i)=\sigma_k(f(a_i))=\sigma_k(g(a_j))=\sigma(a_j)
$$

$q\circ\iota_i=\sigma_i$ because
$$
q\circ\iota_i(a_i)=q\left(\frac{(a_i;i)}{\sim}\right)=\sigma(a_i).
$$

\end{enumerate}
\end{proof}
\section{Adjoints}
\begin{exr}
For adjoint pair $F:\cala\lrta \calb$ and $G:\calb\lrta \cala$. What it means for there to be a \textbf{natural} bijection between
$$
\mor_{\calb}(F(A),B)\cong \mor_{\cala}(A,G(B))
$$
\end{exr}
\begin{proof}
There exists a bijection $\tau_{AB}$,
$$
\tau_{AB}:\mor_{\calb}(F(A),B)\lrta \mor_{\cala}(A,G(B)),
$$
such that for all $f:A\lrta A'$ in $\cala$. the diagram commutes
\begin{center}
\begin{tikzcd}
\mor_{\calb}(F(A),B) \arrow[d, "\tau_{AB}"'] \arrow[r, "(Ff)^*"] & \mor_{\calb}(F(A'),B) \arrow[d, "\tau_{A'B}"] \\
\mor_{\cala}(A,G(B)) \arrow[r, "f^*"] & \mor_{\cala}(A',G(B)),
\end{tikzcd}
\end{center}
where $(Ff)^*:\mor_{\calb}(F(A),B)\lrta\mor_{\calb}(F(A'),B)$ means the morphism induced by $Ff:F(A)\lrta F(A')$. 
Denote the inverse of $\tau_{AB}$ by $\tau^{-1}_{AB}$. We should have a commutative diagram
\begin{center}
\begin{tikzcd}
\mor_{\calb}(F(A),B) \arrow[r, "g_*"] & \mor_{\calb}(F(A),B') \\
\mor_{\cala}(A,G(B)) \arrow[u, "\tau^{-1}_{AB}"] \arrow[r, "(Gg)_*"] & \mor_{\cala}(A,G(B')) \arrow[u, "\tau^{-1}_{AB'}"'],
\end{tikzcd}
\end{center}
where $(Gg)_*:\mor_\cala(A,G(B))\lrta \mor_\cala(A,G(B'))$ means the morphism induced by $Gg:G(B)\lrta G(B')$. 
\end{proof}
\begin{exr}\label{chap1exr:adjoint_factor}
Show that the map $\tau_{AB}$ has the following properties. For each $A$ there is a map $\eta_A:A\lrta GF(A)$ so that for any $g:F(A)\lrta B$, the corresponding $\tau_{AB}(g):A\rta G(B)$ is given by the composition 
$$
A\overset{\eta_A}{\lrta}GF(A)\overset{Gg}{\lrta} G(B).
$$
Similarly, there is a map $\epsilon_B:FG(B)\lrta B$ for each $B$ so that for  any $f:A\lrta G(B)$, the corresponding map $\tau_{AB}^{-1}(f):F(A)\lrta B$ is given by the composition
$$
F(A)\overset{Ff}{\lrta}FG(B)\overset{\epsilon_B}{\lrta }B.
$$
\end{exr}
\begin{proof}
For $g:F(A)\lrta B$, $Gg:GF(A)\lrta G(B)$. 
\begin{center}
\begin{tikzcd}
\mor_{\calb}(F(A),F(A))) \arrow[ddd, "{\tau_{A,F(A)}}"'] \arrow[rrr, "g_*"] &  &  & \mor_\calb(F(A),B) \arrow[ddd, "\tau_{AB}"] \\
 & id_{F(A)} \arrow[r, maps to] \arrow[d, maps to] & g \arrow[d, maps to] &  \\
 & \tau_{A,F(A)}(id_{F(A)})=:\eta_A \arrow[r, maps to] & \tau_{AB}(g) &  \\
\mor_{\cala}(A,G(F(A))) \arrow[rrr, "(Gg)_*"] &  &  & \mor_\cala(A,G(B))
\end{tikzcd}
\end{center}
We can define $\eta_A:=\tau_{A,F(A)}(id_{F(A)})$. This map have the desired composition property. 

Similarly, for $f:A\lrta G(B)$ we can define $\epsilon_{B}:=\tau_{G(B),B}^{-1}id_{G(B)}$
\begin{center}
\begin{tikzcd}
\mor_{\calb}(FG(B),B)) \arrow[rrr, "(Ff)^*"] &  &  & \mor_\calb(F(A),B) \\
 & \epsilon_B:=\tau_{G(B),B}^{-1}(id_{G(B)} \arrow[r, maps to] & \tau_{AB}^{-1}(f) &  \\
 & id_{G(B)} \arrow[u, maps to] \arrow[r, maps to] & f \arrow[u, maps to] &  \\
\mor_{\cala}(G(B),G(B)) \arrow[uuu, "{\tau_{G(B),B}^{-1}}"] \arrow[rrr, "f^*"] &  &  & \mor_\cala(A,G(B)) \arrow[uuu, "\tau_{AB}^{-1}"']
\end{tikzcd}
\end{center}
\end{proof}

\begin{exr}\label{chap1exr:tensor_hom_adjoint1}
Suppose $M, N$, and $P$ are $A$-modules (where $A$ is a ring). Describe a bijection $\hom_A(M \otimes_A N, P) \llrta \hom_A(M, \hom_A(N, P))$. (Hint: try to use the universal property of $\otimes$.)
\end{exr}
\begin{proof}
Consider a morphism $\omega:M\lrta \hom_A(N,P)$. Given $m\in M$, $\omega(m)\in \hom_A(N,P)$ and $\omega(m)(n)\in P$. We can consider $\tilde{\omega}:M\times N\lrta P$, $\tilde{\omega}:m\times n\mapsto \omega(m)(n)$. $\tilde{\omega}$ is bilinear on $M\times N$. It must factor through $M\otimes_A N$. Denote the morphism $\iota: M\times N\lrta M\otimes_A N$, $\exists ! \bar{\omega}$ s.t. $ \bar{\omega}\circ \iota=\tilde{\omega}$.
The composition gives one direction of bijections,
$$
\alpha_{M,P}:\hom_A(M,\hom_A(N.P))\lrta \hom_A(M\otimes_A N, P)
$$
$$
\hom_A(M,\hom_A(N,P))\ni \omega\mapsto \tilde{\omega}\mapsto \bar{\omega}.
$$ 

The inverse of bijection is clear. Given $\bar{\kappa}\in \hom_A(M\otimes_A N,P)$, the composition $\bar{\kappa}\circ \iota:\hom_A(M\times N,P)$ is a bilinear map from $M\times N$ to $P$. Because $\bar{\kappa} \circ \iota$ is bilinear, given $m\in M$, $\bar{\kappa}\circ \iota(m)\in\hom_A(N,P)$ and this map is linear in $M$. Then we can identify $\bar{\kappa}\circ \iota$ as the morphism $\kappa\in \hom_A(M,\hom_A(N,P))$. This given a morphism 
$$
\beta_{M,P}:\hom_A(M\otimes_A N, P)\lrta \hom_A(M,\hom_A(N.P))
$$
$$
\bar{\kappa}\mapsto \kappa.
$$
$\alpha_{M,P}\circ \beta_{M,P}=id$ and $\beta_{M,P}\circ \alpha_{M,P}=id$ are tautology.
\end{proof}


\begin{exr}\label{chap1exr:tensor_hom_adjoint}
Show that $(\cdot)\otimes_A N$ and $\hom_A(N,\cdot)$ are adjoint functors.
\end{exr}
\begin{proof}
The Exercise~\ref{chap1exr:tensor_hom_adjoint1} already gives the required bijection between $\mor_A(M\otimes_A N, P)$ and $\mor_A(M,\mor_A(N,P))$. The remaining task is to verify that the two diagram commute
\begin{center}
\tiny
\begin{tikzcd}
\hom_A(M\otimes_AN,P) \arrow[rrr, "g_{*}"] \arrow[dd, "{\beta_{M,P}}"'] &  &  & \hom_A(M\otimes N,P') \arrow[dd, "{\beta_{M,P'}}"] \\
 &  &  &  \\
\hom_A(M,\hom_A(N,P)) \arrow[rrr, "{\hom_A(N,g)_*=(g_*)_*}"] &  &  & \hom_A(M,\hom_A(N,P'))
\end{tikzcd}
\end{center}
and given $f:M\lrta M'$, verify that the diagram commutes
\begin{center}
\tiny
\begin{tikzcd}
\hom_A(M'\otimes_AN,P) \arrow[rrr, "(f\otimes_A id_N)^{*}"] \arrow[dd, "{\beta_{M',P}}"'] &  &  & \hom_A(M\otimes N,P) \arrow[dd, "{\beta_{M,P}}"] \\
 &  &  &  \\
\hom_A(M',\hom_A(N,P)) \arrow[rrr, "f^*"] &  &  & \hom_A(M,\hom_A(N,P)).
\end{tikzcd}
\end{center}
It is quite cumbersome to write it out in detail, we only verify the second diagram. We know $f:M\lrta M'$, $(f)\otimes_A N=f\otimes_A id_N$. Given $\bar{\kappa}\in \hom_A(M'\otimes_A N,P)$, we have $f^*\circ \beta_{M',P}(\bar{\kappa})=f^*(\kappa)$ and $f^*(\kappa): m\mapsto \kappa(f(m))$. On the other hand, $(f\otimes_A id_N)^*(\bar{\kappa})=\bar{\kappa}\circ (f\otimes_A id_N)$.
$$
\beta_{M,P}(\bar{\kappa}\circ (f\otimes_A id_N))(m)=[n\mapsto \tilde{\kappa}\circ (f\times_A id_N)(m,n)]=[n\mapsto\kappa(f(m))(n)],
$$
where $\tilde{\kappa}$ is the bilinear map $M\times N\lrta P$. Hence the diagram commute and the two functors indeed form an adjoint pair.
\end{proof}
\begin{exr}
Suppose $B \lrta A$ is a morphism of rings. If $M$ is an $A$-module, you can create a $B$-module $M_B$ by considering it as a $B$-module. This gives a functor $\cdot_B : Mod_A \lrta Mod_B$. Show that this functor is right-adjoint to $· \otimes_B A$. In other words, describe a bijection
$$
\hom_A(N\otimes_B A,M)\cong\hom_B(N,M_B)
$$
functorial in both arguments. 
\end{exr}
\begin{proof}
We directly give the bijection using the exercise~\ref{chap1exr:adjoint_factor}:
$$
\tau_{N,M}:\hom_A(N\otimes_B A, M)\lrta \hom_B(N,M_B)
$$
$$
\phi\mapsto [n\overset{\eta_N}{\longmapsto} (n\otimes_B 1_A)_B\overset{\phi_B}{\longmapsto}\phi(n\otimes 1_A) ],
$$
because we want to construct $\tau_{NM}$ here, we have to construct $\eta_N$ first to avoid circular thinking.
$$
\eta_N: n\mapsto (n\otimes_B 1_{A})_B.
$$
It is easy to check that $\eta_N$ is a well-defined $B$-module morphism.

We can construct the inverse of $\tau_{NM}$.
$$
\tau^{-1}_{NM}:\hom_B(N,M_B)\lrta\hom_A(N\otimes_B A, M) 
$$
$$
\psi\mapsto[n\otimes_B a\overset{\psi\otimes_B id_A}{\longmapsto} \psi(n)\otimes_B a\overset{\epsilon_M}{\longmapsto}  a\psi(n)]
$$

It is easy to verify that the above two morphism of sets are indeed inverse for example
$$
\tau_{NM}\circ \tau_{NM}^{-1}:\psi \mapsto \tau_{NM}([n\otimes_B a\mapsto a\psi(n)])=[n\mapsto \psi(n)]=\psi.
$$
We only need to verify it to be functorial in both arguments. Again, we only verify one of it. Given $f:M\lrta M'$, then the following diagram commutes
\begin{center}
\tiny
\begin{tikzcd}
\hom_A(N'\otimes_B A,M) \arrow[dd, "{\tau_{N',M}}"'] \arrow[rr, "(f\otimes_B id_A)^*"] &  & \hom_A(N\otimes_B A,M) \arrow[dd, "{\tau_{N,M}}"] \\
 &  &  \\
\hom_B(N',M_B) \arrow[rr, "f^*"] &  & \hom_{B}(N,M_B)
\end{tikzcd}
\end{center}
Given $\xi\in \hom_A(N'\otimes_B A,M)$,
$$
(f\otimes_B id_A)^*(\xi)=[n\otimes_B a\mapsto \xi(f(n)\otimes_B a)]\text{ and }\tau_{NM}\circ (f\otimes_B id_A)^*(\xi)=[n\mapsto \xi(f(n)\otimes 1_A)]
$$
and
$$
\tau_{N',M}(\xi)=[n'\mapsto \xi(n\otimes_B 1_A)]\text{ and } f^*\circ \tau_{N',M}(\xi)=[n\mapsto \xi(f(n)\otimes_B 1_A)].
$$
Hence the diagram commutes.
\end{proof}

\begin{exr}
Show that if an abelian semigroup is already a group then the identity morphism is the groupification.
\end{exr}
\begin{proof}
We only need to look at the diagram, $id:G\lrta G$ indeed has the universal property and the morphism is uniquely determined by the value of $\phi$
\begin{center}
\begin{tikzcd}
G \arrow[r, "="] \arrow[rd, "\phi"] & G \arrow[d, "\exists!", dashed] \\
 & G'
\end{tikzcd}
\end{center}
\end{proof}


\begin{exr}
Construct the ``groupification functor'' $H$ from the category of nonempty abelian semigroups to the category of abelian groups. Let $F$ be the forgetful functor from the category of abelian groups $Ab$ to the category of abelian semigroups. Show that $H$ is left-adjoint to $F$.
\end{exr}
\begin{proof}
Following the hint, we can construct the Grothendieck group of Abelian semigroups. $H(S)$ consists of elements $[(a,b)]$ where $(a,b)\sim (c,d)$ iff $\exists e\in S$ s.t. $a+d+e=c+b+e$ or $a+d=c+b$. (notice that, because there is no identity in the semigroup, we have to modify the equivalence relation  a little). The binary operation on it is $[(a,b)]+[(c,d)]=[(a+c,b+d)]$, any $[(a,a)]=:0$ act like an identity and  every equivalence class has a  inverse $[(a,b)]+[(b,a)]=0$. $H(S)$ is often called the Grothendieck group of monoid $S$. We have verified the group structure on it. 


Consider an Abelian group $G$ with a semigroup morphism from $S$ to $G$.
\begin{center}
\begin{tikzcd}
S \arrow[r, "="] \arrow[rd, "\phi"] & H(S) \arrow[d, "\exists!", dashed] \\
 & G
\end{tikzcd}
\end{center}
The semigroup morphism $S\lrta H(S)$ is given by $a\mapsto [(a+e,e)],$ where $e$ is any element in $S$. The unique group morphism from $H(S)$ to $G$ is given by $[(a,b)]\mapsto \phi(a)-\phi(b)$. This morphism is unique because $[(a,b)]=[(a+e,e)]+[(f,b+f)]\mapsto \phi(a+e)+\phi(f)-\phi(e)-\phi(b+f)=\phi(a)-\phi(b)$.

As for the adjoint pair, we want to prove
$$
\mor_{Ab}(H(S),G)\cong\mor_{Abs}(S,F(G)),
$$
where $Ab$ means the category of Abelian groups and $Abs$ being the category of Abelian semigroups.
The universal property has given one direction
$$
\mor_{Abs}(S,F(G))\lrta \mor_{Ab}(H(S),G),
$$
we also know this map is injective. \underline{Want}: this map is surjective. For any $g: H(S)\lrta G$, we can get a canonical morphism of Abelian semigroups $F(H(S))\lrta F(G)$ and notice that $F(S)\lrta F(H(S))$ is already there, we can concatenate these two maps to get a morphism of Abelian semigroups from $S$ to $F(G)$. And this morphism induces $g$.
\end{proof}

\begin{exr}
Suppose $A$ is a ring, and $S$ is a multiplicative subset. Then $S^{-1}A$-modules are a fully faithful subcategory of the category of $A$-modules(via the obvious inclusion $Mod_{S^{-1}A}  \inj  Mod_A$). Then $Mod_A \lrta Mod_{S^{-1}A}$ can be interpreted as an adjoint to the forgetful
$Mod_{S^{-1}A}  \lrta  Mod_A$ . State and prove the correct statements.
\end{exr}
\begin{proof}
This is just a fancy way of presenting the universal property of localization of a module. For an $A$-module $M$ and an $S^{-1}A$-module $N$, we have a bijection
$$
\mor_{S^{-1}A}(S^{-1}M,N)\cong\mor_{A}(M,F(N)).
$$
By the universal property of localization of an $A$-module,  we have an injection
$$
\alpha:\mor_{A}(M,F(N))\inj\mor_{S^{-1}A}(S^{-1}M,N).
$$
We want to prove that it is also a surjection. Notice $M$ is an $A$-submodule of $S^{-1}M$, a given morphism of $A$-modules $f:F(S^{-1}M)\lrta F(N)$ would restrict to an $A$-module morphism $g:M\lrta F(N)$. $g$ would induce $f$ by the universal property. Hence $\alpha$ is surjection.
\end{proof}

\section{Introduction to Abelian categories}
\begin{definition}
Definition. A category $\calc$ is said to be \textbf{additive} if it satisfies the following properties.
\begin{enumerate}[label=(\alph*)]
\item  For each $A, B \in\calc$ , $\mor(A, B)$ is an abelian group, such that composition of morphisms distributes over addition.
$$
f\circ(g+h)=f\circ g+ f\circ h
$$ 
and 
$$
(f+g)\circ h=f\circ h+g\circ h
$$
\item  $\calc$ has a zero object, denoted $0$. 
\item  It has products of two objects, and hence by induction, products of any finite number of objects.
\end{enumerate}
\end{definition}

A kernel of morphism $f:B\lrta C$ is a map $i:A\lrta B$ such that $f\circ i=0$, and that is universal (final) with this property
\begin{center}
\begin{tikzcd}
Z \arrow[rd] \arrow[rrd,"0"] \arrow[d, "\exists!", dashed] &  &  \\
A \arrow[r, "i"] \arrow[rr, "0"', bend right] & B \arrow[r, "f"] & C.
\end{tikzcd}
\end{center}
Because $0$ maps always factor through $0$-objects, we can alternatively define kernel as the limit of the diagram:
\begin{center}
\begin{tikzcd}
 & 0 \arrow[d] \\
B \arrow[r,"f"] & C
\end{tikzcd}
\end{center}
Kernel is the fibered product  $B\times_C 0$. 

Similarly, for cokernel, we can defined it as a map $\pi: C\lrta A$ such that $\pi\circ f=0$, and that is universal (initial) with this property.
\begin{center}
\begin{tikzcd}
Z &  &  \\
A \arrow[u, "\exists!", dashed] & C \arrow[l, "\pi"] \arrow[lu] & B \arrow[l, "f"'] \arrow[llu, "0"'] \arrow[ll, "0", bend left]
\end{tikzcd}
\end{center}
Equivalently cokernel is the colimit of the diagram 
\begin{center}
\begin{tikzcd}
 & 0 \\
C & B \arrow[u] \arrow[l, "f"']
\end{tikzcd}
\end{center}
and in the language of fibered coproduct $\coker f=C\coprod_B 0$.

\begin{exr}
Describe exact sequences
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \im f^{i} \arrow[r] & A^{i+1} \arrow[r] & \coker f^{i} \arrow[r] & 0 \\
0 \arrow[r] & H^i(A^\bullet) \arrow[r] & \coker f^{i-1} \arrow[r] & \im f^{i} \arrow[r] & 0
\end{tikzcd}
\end{center}
\end{exr}



\section{Spectral sequences}

\begin{exr}
 (INFORMATION FROM THE SECOND PAGE). Show that $E^{0,0}_\infty=H^{0}(E^{\bullet})=E^{0,0}_2 $ and the sequence 
 $$
0\lrta E^{0,1}_2\lrta H^1(E^{\bullet})\lrta E^{1,0}_2\overset{d_2}{\lrta} E^{0,2}_2\lrta H^2(E^{\bullet}) 
 $$
is exact.
\end{exr}

\begin{proof}
Spectral sequence has the property that $E^{i,n-i}_{\infty}$ gives a filtration of $H^{n}(E^\bullet)$. Because it is a first quadrant spectral sequence, we have 
$$
H^{0}(E^\bullet)=E^{0,0}_\infty,
$$
and $E^{0,0}_r$ stabilize after page $2$. Hence we have 
$$
H^{0}(E^\bullet)=E^{0,0}_\infty=E^{0,0}_2.
$$
Consider the second page
\begin{center}
\begin{tikzcd}
0 & \vdots & \vdots & \vdots &  &  \\
0 & E^{0,2}_2 & E^{1,2}_2 & E^{2,2}_2 & \adots &  \\
0 & E^{0,1}_2 \arrow[luu] & E^{1,1}_2 \arrow[luu] & E^{2,1}_2 \arrow[luu] & E^{3,1}_2 & \cdots \\
0 & E^{0,0}_2 \arrow[luu] & E^{1,0}_2 \arrow[luu] & E^{2,0}_2 \arrow[luu] & E^{3,0}_2 \arrow[luu] & \cdots \\
0 & 0 & 0 \arrow[luu] & 0 \arrow[luu] & 0 \arrow[luu] & \cdots \\
0 & 0 & 0 \arrow[luu] & 0 \arrow[luu] & 0 \arrow[luu] & \cdots
\end{tikzcd}
\end{center}
There is a exact sequence
$$
0\lrta \ker d^{1,0}_2\lrta E^{1,0}_2\overset{d_2^{1,0}}{\lrta} E^{0,2}_2\lrta \coker (d^{1,0}_2)\lrta 0
$$
$$
\coker d^{1,0}_2=E^{0,2}_2/\im d^{1,0}_2=\ker(d^{0,2}_2)/\im d^{1,0}_2=E^{0,2}_3=E^{0,2}_\infty
$$
$$
\ker d^{1,0}_2=\ker d^{1,0}_2/\im d^{3,-1}_2=E^{1,0}_3=E^{1,0}_\infty
$$
$E^{0,2}_\infty$ injects into $H^{2}(E^\bullet)$, hence we have an exact sequence
$$
0\lrta  E^{1,0}_\infty\overset{\iota}{\lrta} E^{1,0}_2\overset{d_2^{1,0}}{\lrta} E^{0,2}_2\lrta H^{2}(E^\bullet)
$$
On the other hand, $H^{1}(E^\bullet)=E^{0,1}_\infty\oplus E^{1,0}_\infty$, where $E^{0,1}_r$ already stabilize at page $2$. We have a exact sequence
$$
0\lrta E^{0,1}_2\lrta H^{1}(E^\bullet)\overset{\pi}{\lrta} E^{1,0}_\infty\lrta 0.
$$
Then we can concatenate the above tow exact sequences
$$
0\lrta E^{0,1}_2\lrta H^{1}(E^\bullet)\overset{\iota\circ \pi}{\lrta}E^{1,0}_2\overset{d_2^{1,0}}{\lrta} E^{0,2}_2\lrta H^{2}(E^\bullet)
$$
\end{proof}

\begin{exr}
Extend the snake Lemma as follows. Suppose we have a commutative diagram
\begin{center}
\begin{tikzcd}
 & 0 \arrow[r] & X' \arrow[r] & Y' \arrow[r] & Z' \arrow[r] & A' \arrow[r] & \cdots \\
\cdots \arrow[r] & W \arrow[r] \arrow[u] & X \arrow[r] \arrow[u, "a"] & Y \arrow[r] \arrow[u, "b"] & Z \arrow[r] \arrow[u, "c"] & 0 \arrow[u] & 
\end{tikzcd},
\end{center}
where the top and bottom rows are exact. Show that the top and bottom rows can
be “grafted together” to an exact sequence
\begin{center}
\begin{tikzcd}
\cdots \arrow[r] & W \arrow[r] & \ker a \arrow[r] & \ker b \arrow[r] & \ker c \arrow[lld] &  &  \\
 &  & \coker a \arrow[r] & \coker b \arrow[r] & \coker c \arrow[r] & A' \arrow[r] & \cdots
\end{tikzcd}
\end{center}
\end{exr}
\begin{proof}
Like what has been done to snake lemma, we put the diagram into the first page of a spectral sequence. If we choose $d_0=d_\rta$, because each row is exact, the spectral sequence stabilize after page $0$ with all stationary value being $0$.

On the other hand, if we choose $d_0=d_{\uparrow}$, the first page looks like
\begin{center}
\begin{tikzcd}
 & 0 \arrow[r] & \coker a \arrow[r] & \coker b \arrow[r] & \coker c \arrow[r] & A' \arrow[r] & \cdots \\
\cdots \arrow[r] & W \arrow[r] & \ker a \arrow[r] & \ker b \arrow[r] & \ker c \arrow[r] & 0 & 
\end{tikzcd}
\end{center}
At the second pace it should be
\begin{center}
\begin{tikzcd}
0 \arrow[rrd] & ?? \arrow[rrd] & ? \arrow[rrd] & ? & ? \\
? & ? & ? & ?? & 0
\end{tikzcd}
\end{center}
Because the $H(E^\bullet)$ is independent on the choice of filtration, we know each question mark stabilize at page $2$ and should be $0$, which means the two rows in the first page are exact. The $??$ could be nonzero at page $2$, but they should also stabilize to $0$ at page $3$, hence
$??\lrta ??$ in page $2$ is an isomorphism,
$$
\ker (\coker a \rta \coker b)\cong \coker (\ker b\rta \ker c).
$$
Hence, we can concatenate the the two exact sequences to get
\begin{center}
\begin{tikzcd}
\cdots \arrow[r] & W \arrow[r] & \ker a \arrow[r] & \ker b \arrow[r] & \ker c \arrow[lld] &  &  \\
 &  & \coker a \arrow[r] & \coker b \arrow[r] & \coker c \arrow[r] & A' \arrow[r] & \cdots
\end{tikzcd}
\end{center}
\end{proof}

\begin{exr}
(A SUBTLER FIVE LEMMA). By looking at the spectral sequence proof of the Five Lemma, prove a subtler version of the Five Lemma, where one of the isomorphisms can instead just be required to be an injection, and another can instead just be required to be a surjection.
\end{exr}
\begin{proof} Consider the diagram,
\begin{center}
\begin{tikzcd}
F \arrow[r] & G \arrow[r] & H \arrow[r] & I \arrow[r] & J \\
A \arrow[u, "\alpha"] \arrow[r] & B \arrow[u, "\beta"] \arrow[r] & C \arrow[u, "\gamma"] \arrow[r] & D \arrow[u, "\delta"] \arrow[r] & E \arrow[u, "\epsilon"],
\end{tikzcd}
\end{center}
where each row is exact, $\beta, \delta$ are isomorphism and $\alpha$ is an epimorphism (surjection), $\epsilon$ is a monomorphism (injection), then $\gamma$ is an isomorphism. The proof is essentially the same.

If we choose $d_0=d_\rta$, the first page stabilize and each term except the two ??s  are zero. 
\begin{center}
\begin{tikzcd}
0 & 0 & 0 & 0 & ?? \\
?? \arrow[u] & 0 \arrow[u] & 0 \arrow[u] & 0 \arrow[u] & 0 \arrow[u]
\end{tikzcd}
\end{center}
If we choose $d_0=d_\uparrow$, the first page looks like
\begin{center}
\begin{tikzcd}
\coker \alpha=0 \arrow[r] & 0 \arrow[r] & \coker \gamma \arrow[r] & 0 \arrow[r] & \coker \epsilon \\
\ker \alpha \arrow[r] & 0 \arrow[r] & \ker \gamma \arrow[r] & 0 \arrow[r] & \ker \epsilon=0
\end{tikzcd}.
\end{center}
On the second page, the spectral sequence should be
\begin{center}
\begin{tikzcd}
0 \arrow[rrd] & 0 \arrow[rrd] & \coker \gamma \arrow[rrd] & 0 & ?? \\
?? & 0 & \ker \gamma & 0 & 0
\end{tikzcd}
\end{center}
At third page, every entries except ?? should stabilize to $0$, hence $\coker \gamma\cong 0$ and $\ker \gamma\cong 0$
\end{proof}

\begin{exr}
(ANOTHER SUBTLE VERSION OF THE FIVE LEMMA). If $\beta$ and $\delta$ are injective, and $\alpha$ is surjective, show that $\gamma$ is injective. Give the dual statement (whose proof is of course essentially the same).
\end{exr}
\begin{proof}
The proof is essentially the same. We just omit the proof and state the dual

\begin{center}
\begin{tikzcd}
F \arrow[r] & G \arrow[r] & H \arrow[r] & I \arrow[r] & J \\
A \arrow[u, "\alpha"] \arrow[r] & B \arrow[u, "\beta"] \arrow[r] & C \arrow[u, "\gamma"] \arrow[r] & D \arrow[u, "\delta"] \arrow[r] & E \arrow[u, "\epsilon"],
\end{tikzcd}
\end{center}
Each row is exact.
If $\beta$ and $\delta$ are surjective, and $\delta$ is injective, $\gamma$ is surjective. 
\end{proof}

\begin{exr}
Suppose $\mu:A^\bullet\lrta B^\bullet$ is a morphism of complexes. Suppose $C^\bullet$ is the single complex associated to the double complex $A^{\bullet}\lrta B^\bullet$. ($C^\bullet$ is called the mapping cone of $\mu$.) Show that there is a long exact sequence of complexes:
$$
\cdots\lrta H^{i-1}(C^{\bullet})\lrta H^{i}(A^\bullet)\lrta H^{i}(B^\bullet)\lrta  H^{i}(C^\bullet)\lrta H^{i+1}(A^\bullet)\lrta \cdots
$$
\end{exr}
\begin{proof} Consider what it means by a mapping cone. We start with two chainc complex $(A^\bullet,\delta)$ and $(B^\bullet, \pd)$. Consider a double complex $M^{\bullet,\bullet}$ where $M^{i,0}=A^i$, $M^{i,1}=B^i$ and all other entries zero. To guarantee the anti-commutivity of each square, we have to choose $d^{i,0}_\uparrow=(-1)^i \mu^i$ and $d^{i,0}_\rta=\delta^{i}, d^{i,1}_\rta=\pd^i$ , where $d_A$ is the original differential of complex $A^\bullet$. 
\begin{center}
\begin{tikzcd}
\cdots & 0 & 0 & 0 & \cdots \\
\cdots \arrow[r] & B^{i-1} \arrow[u] \arrow[r, "\pd^{i-1}"] & B^i \arrow[u] \arrow[r, "\pd^{i}"] & B^{i+1} \arrow[u] \arrow[r] & \cdots \\
\cdots \arrow[r] & A^{i-1} \arrow[r, "\delta^{i-1}"] \arrow[u, "\mu^{i-1}"] & A^i \arrow[r, "\delta^i"] \arrow[u, "\mu^{i}"] & A^{i+1} \arrow[r] \arrow[u, "\mu^{i+1}"] & \cdots
\end{tikzcd}
\end{center}
The total complex of the double complex is defined to be $(C^\bullet, d)$, with 
$$
C^i:=A^{i+1}\oplus B^{i}
$$
and 
$$
d:=d_\uparrow+d_\rta
$$
\begin{center}
\begin{tikzcd}
\cdots & 0 & 0 & 0 & \cdots \\
\cdots \arrow[r] & B^{i-1} \arrow[u] \arrow[r, "d^{i-1,1}_\rta"] & B^i \arrow[u] \arrow[r, "d^{i,1}_\rta"] & B^{i+1} \arrow[u] \arrow[r] & \cdots \\
\cdots \arrow[r] & A^{i-1} \arrow[r, "d^{i-1,0}_\rta"] \arrow[u, "d^{i-1,0}_\uparrow"] & A^i \arrow[r, "d^{i,0}_\rta"] \arrow[u, "d^{i,0}_\uparrow"] & A^{i+1} \arrow[r] \arrow[u, "d^{i+1,0}_\uparrow"] & \cdots
\end{tikzcd}
\end{center}
It is enough to consider only one filtration. We choose $d_0=d_\rta$. The first page reads
\begin{center}
\begin{tikzcd}
\cdots & 0 & 0 & 0 & \cdots \\
\cdots & H^{i-1}(B) \arrow[u] & H^i(B) \arrow[u] & H^{i+1}(B) \arrow[u] & \cdots \\
\cdots & H^{i-1}(A) \arrow[u, "d_1^{i-1}"] & H^{i}(A) \arrow[u, "d^{i,0}_1"] & H^{i+1}(A) \arrow[u, "d_1^{i+1,0}"] & \cdots \\
\cdots & 0 \arrow[u] & 0 \arrow[u] & 0 \arrow[u] & \cdots
\end{tikzcd}
\end{center}
where $d^{i,0}_1$ is just the induce morphism $\mu^*$. On the second page, we have
\begin{center}
\begin{tikzcd}
0 & 0 & 0 &  &  \\
\cdots & 0 & 0 & 0 & \cdots \\
\cdots & \coker d_1^{i-1,0} \arrow[luu] & \coker d_1^{i,0} \arrow[luu] & \coker d_1^{i+1,0} \arrow[luu] & \cdots \\
\cdots & \ker d_1^{i-1,0} \arrow[luu] & \ker d_1^{i,0} \arrow[luu] & \ker d_1^{i+1,0} \arrow[luu] & \cdots \\
\cdots & 0 & 0 \arrow[luu] & 0 \arrow[luu] & \cdots \arrow[luu]
\end{tikzcd}.
\end{center}
Hence, we know it they will stabilize after page $3$. We have
$$
H^{i}(C^\bullet)=\ker(H^{i}(A^\bullet)\rta H^{i}(B^\bullet))\oplus \coker(H^{i+1}(A^\bullet)\rta H^{i+1}(B^\bullet)).
$$
It can be written as a short exact sequence
$$
0\lrta \coker(H^{i}(A^\bullet)\rta H^{i}(B^\bullet))\lrta H^{i}(C^\bullet)\lrta \ker(H^{i+1}(A^\bullet)\rta H^{i+1}(B^\bullet))\lrta 0.
$$
Thus we have the long exact sequence
$$
\cdots\lrta H^{i-1}(C^{\bullet})\lrta H^{i}(A^\bullet)\lrta H^{i}(B^\bullet)\lrta  H^{i}(C^\bullet)\lrta H^{i+1}(A^\bullet)\lrta H^{i+1}(B^\bullet)\lrta \cdots
$$
There would be some ambiguity depending on whether we choose $C^i=A^i\oplus B^{i-1}$ or $C^i=A^{i+1}\oplus B^i$. In particular, we have if the mapping cone is exact (acyclic) iff $\mu^*$ induce isomorphism between $H(A^\bullet)$ and $H(B^\bullet)$.

\end{proof}

\begin{exr}
Use spectral sequences to show that a short exact sequence of complexes gives a long exact sequence in cohomology.
\end{exr}
\begin{proof} Consider a short exact sequence of differential complex, where each column is exact.
\begin{center}
\begin{tikzcd}
 & 0 & 0 & 0 &  \\
\cdots \arrow[r] & C^{i-1} \arrow[r] \arrow[u] & C^i \arrow[r] \arrow[u] & C^{i+1} \arrow[r] \arrow[u] & \cdots \\
\cdots \arrow[r] & B^{i-1} \arrow[r] \arrow[u] & B^{i} \arrow[r] \arrow[u] & B^{i+1} \arrow[r] \arrow[u] & \cdots \\
\cdots \arrow[r] & A^{i-1} \arrow[r] \arrow[u] & A^{i} \arrow[r] \arrow[u] & A^{i+1} \arrow[r] \arrow[u] & \cdots \\
 & 0 \arrow[u] & 0 \arrow[u] & 0 \arrow[u] & 
\end{tikzcd}
\end{center}
If we choose the filtration such that $d_0=d_\uparrow$, the first page stabilize to $0$. Hence we know in any filtration $E_{\infty}^{p,q}=0$. 

If we choose $d_0=d_\rta$, we have the first page
\begin{center}
\begin{tikzcd}
 & 0 & 0 & 0 &  \\
\cdots & H^{i-1}(C) \arrow[u] & H^i(C) \arrow[u] & H^{i+1}(C) \arrow[u] & \cdots \\
\cdots & H^{i-1}(B) \arrow[u] & H^i(B) \arrow[u] & H^{i+1}(B) \arrow[u] & \cdots \\
\cdots & H^{i-1}(A) \arrow[u] & H^{i}(A) \arrow[u] & H^{i+1}(A) \arrow[u] & \cdots \\
 & 0 \arrow[u] & 0 \arrow[u] & 0 \arrow[u] & 
\end{tikzcd},
\end{center}
with each arrow induced by morphism of complexes.

The second page:
\begin{center}
\begin{tikzcd}
{} & {} & {} &  &  \\
{} & 0 & 0 & 0 &  \\
\cdots & \coker(d_1^{i-1,1}) \arrow[luu] & \coker(d_1^{i,1}) \arrow[luu] & \coker (d_1^{i+1,1}) \arrow[luu] & \cdots \\
\cdots & \ker(d_1^{i-1,1})/\im(d_1^{i-1,0}) \arrow[luu] & \ker (d_1^{i,1})/\im(d_1^{i,0}) \arrow[luu] & \ker(d_1^{i,1})/\im(d_1^{i+1,0}) \arrow[luu] & \cdots \\
\cdots & \ker (d_1^{i-1,0}) \arrow[luu] & \ker(d_1^{i,0}) \arrow[luu] & \ker(d_1^{i+1,0}) \arrow[luu] & \cdots \\
 & 0 & 0 \arrow[luu] & 0 \arrow[luu] & {0} \arrow[luu]
\end{tikzcd}
\end{center}
Then each entries should stabilize to zero either at page $2$ or page $3$, we have
$$
\ker(H^{i}(B)\rta H^{i}(C))\cong im(H^{i}(A)\rta H^{i}(B))
$$
and
$$
\coker(H^{i}(B)\rta H^{i}(C))\cong \ker (H^{i+1}(A)\rta H^{i+1}(B)).
$$
We have the long exact sequence
$$
\cdots\lrta H^{i-1}(C^{\bullet})\lrta H^{i}(A^\bullet)\lrta H^{i}(B^\bullet)\lrta  H^{i}(C^\bullet)\overset{\delta}{\lrta} H^{i+1}(A^\bullet)\lrta H^{i+1}(B^\bullet)\lrta \cdots,
$$
where the connecting morphism $\delta$ is induce by 
$$
H^{i}(C)\overset{\pi}{\lrta}
\coker(H^{i}(B)\rta H^{i}(C))= \ker (H^{i+1}(A)\rta H^{i+1}(B))\overset{\iota}{\inj} H^{i+1}(A).
$$

\end{proof}

%----------------------------------------------------------------------------------------
%	CHAPTER 2
%----------------------------------------------------------------------------------------



\chapterimage{sheaves.jpg}
\chapter{Sheaves}
\section{Motivating example}
\begin{exr}
Prove that $\scm_p:=$\{germs that vanishing at $p$\} is the only maximal ideal in $\calo_p$(Hint: prove that $\calo_p-\scm_p\subseteq \calo_p^{\times}$)
\end{exr}
\begin{proof}In general setting, consider a ring $A$.
The set of non-unit can be written as $\cup\scm_j$, where each $\scm_j$ is a maximal ideal in $A$. $A-\scm\subseteq A^\times\Lrta A-\scm\subseteq A-\cup_j\scm_j\Lrta \scm\supseteq\cup_j\scm_j$, then there is only one maximal ideal. It suffices to prove each element in $\calo_p-\scm_p$ is invertible. 

Use $(f,U)_p$ to denote the equivalent class of $(f,U)$.
$(f,U)_p\in \calo_p-\scm_p\Lrta f(p)\neq 0$, because $f$ is continuous on $U$, there exists an open set $V\subseteq U$, s.t. $f(q)\neq0,\forall q\in V\Lrta (1/f,V)$ is an inverse.
\end{proof}

\begin{exr}
Prove that $\frac{\scm_p}{\scm_p^2}\cong T^*_pX$, $T^*_p X$ is the cotangent bundle of differentiable manifold $X$ at $p$. 
\end{exr}
\begin{proof}Construct explicitly the isomorphism:
$$
(f,V)_p+\scm_p^2\longmapsto df_p=\sum_i\left.\frac{\partial f\circ \varphi^{-1}}{\partial x^i}\right|_p (dx^i)_p,
$$ 
where for a given tangent vector $\delta_p\in T_p X\cong Der_p(C^{1}(X))$ at $p$, $df_p(\delta_p)=\delta_p f\in \reals$ is an $\reals$-linear map. It is well-defined because $h\in \scm_p^2\Lrta d h_p=0$ and $(g,U)\sim (f,V)$, then there exists an open $p\in W\subseteq U\cap V$, s.t. $f|_W-g|_W=0$, $(df_p-dg_p)(\delta)=\delta_p(f)-\delta_p(g)$. Consider a bump function $\phi(x)=1,\forall x\in W'\ni p$ and $\phi(x)=0,\forall x\in U\cap V-W$, then $0=\delta_p(f|_{W'}-g|_{W'})=\delta_p((f-g)\phi|_{W'})=(f(p)-g(p))\delta_p(\phi)+\delta_p(f-g)\phi(p)\Lrta \delta_p(f-g)=0$.

It is surjective because the basis $(dx^j)_p$ can be generated by this map.

Construct the inverse map. Consider a chart of $p$, $(V,\varphi)$ s.t. $\varphi(p)=0\in \reals^n$, and define $x_i$ to be the $i$-th entry of $\phi$
$$
\sum_i a_i (dx^i)_p\longmapsto \left(\sum_i a_i x_i, V \right)+\scm^2_p.
$$
To check this is indeed a inverse, we only need to check (The other direction is tricial)
$$
(f,V)_p+\scm_p^2=\left(\sum_i\left.\frac{\partial f\circ \varphi^{-1}}{\partial x^i}\right|_0 x^i, V'\right)+\scm_p^2.
$$
But, assuming $\varphi(V)$ to be a star-shaped domain in $\reals^n$: 
$$
f\circ\varphi^{-1}(x)= \left(\int_0^1d t\frac{\partial f\circ\varphi^{-1}(t x)}{\partial t}\right)=\sum_ix^i\underbrace{\int_0^1d t\frac{\partial f\circ\varphi^{-1}}{\partial x^i}(t x)}_{:=h_i(x)}.
$$
Though $h_i(x)$ is at most continuous, $\sum_i x^i h_i(x)$ is differentiable and $$
h_i(0)=\left.\frac{\partial f\circ \varphi^{-1}}{\partial x^i}\right|_0
\Lrta h_i(x)-\left.\frac{\partial f\circ \varphi^{-1}}{\partial x^i}\right|_0\in \scm_p
$$
then
$$
\sum_i x^i \left(h_i(x)-\left.\frac{\partial f\circ \varphi^{-1}}{\partial x^i}\right|_0\right)\in \scm_p^2
$$
\end{proof}
\section{Definition of presheaf and sheaf}
\begin{exr}
Verify that the data of a presheaf is precisely the data of a contravariant functor from the category of open sets of $X$ to the category of sets.
\end{exr}
\begin{proof}We use a diagram to replace all the words:
\begin{center}
\begin{tikzcd}
U\ar[loop left] \arrow[d, "\calf"] \arrow[r, hook] & V \arrow[d, "\calf"] \arrow[r, hook] & W \arrow[d, "\calf"] \\
\calf(U)\ar[loop left, "res_{U,U}"] & \calf(V) \arrow[l, "{res_{V,U}}"'] & \calf(W) \arrow[l, "{res_{W,V}}"'] \arrow[ll, "{res_{W,V}}", bend left]
\end{tikzcd}
\end{center}
\end{proof}

\begin{exr}
Show that the following are presheaves on $\cplx$ (with the classical topology), but not sheaves: (a) bounded functions, (b) holomorphic functions admitting a holomorphic square root.
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item Bounded functions $B$ is a presheaf, with the restriction map just the ordinary restriction of functions. But $B$ is not a sheaf because there could be an open cover $\{U_i\}_{i\in I}$(necessarily infinite), for example $U_n:=\{z\in\cplx: n-1< \text{Re}z<n+1\}$, and we can choose $f_n(z):=z$. each is bounded function on the open set, but there is no global bounded function that restricts to them.
\item Holomorphic functions admitting a square roots, in other words, they are of the form $h^2(z)$ where $h(z)$ is a holomorphic function. It is a presheaf with ordinary restrictions and it is not a sheaf because it violate the gluability axiom. Consider $U$ to  be a strip $\{2<|z|<3 \}$ and $U$ is covered by open disks $D_n:=\{|z-5/2e^{i n2\pi/10}|<1\}$, on each open disk, there is a holomorphic square root corresponding to $\sqrt z$. But there is no $\sqrt z$ defined on the strip $U$.
\end{enumerate}
\end{proof}
\begin{exr}
The identity and gluability axioms may be interpreted as saying that $\calf(\cup_{i\in I}U_i)$ is a certain limit. What is that limit?
\end{exr}
\begin{proof}
The index category $\cali$ is the ``subsets index by $I$'' with inclusion being the morphism it is a partially ordered set. Or we can simply denote it by $I$ with $i\leq j$ iff $U_i\inj U_j$. Then $\calf(\cup_{i\in I}U_i)$ can be interpreted as a limit with morphism $\calf(\cup_{i\in I}U_i)\lrta \calf(U_k)$ being the restriction $\res_{\cup_i U_i, U_k}$
$$
\calf(\cup_{i\in I}U_i)=\invlim_{i\in I}\calf(U_i)
$$
\end{proof}
\begin{exr}\ 
\begin{enumerate}[label=(\alph*)]
\item
 Verify that the the following examples are indeed sheaves ( differentiable functions, or continuous functions, or smooth functions, or functions on a manifold or $\reals^n$).
 \item  Show that real-valued continuous functions on (open sets of) a topological space X form a sheaf.
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item All of them are easily seen to be presheaves, we only need to verify they satisfies the identity axiom and gluability axiom of sheaf.

Identity axiom holds for all of them, $\res_{U,U_i}f_1=\res_{U,U_i}f_2,\forall U_i$ means $f_1(p)=f_2(p)\forall p\in U_i,\forall U_i$. Hence $f_1$ and $f_2$ coincide on each point in $U$, they are equal. (This is not true for functions on schemes)

Manifolds are Hausdorff and paracompact, hence endowed with partition of unity. For each over cover $\{U_i\}_{i\in I}$, there is a partition of unity $\{\rho_i\}_{i\in I}$ subordinate to it (each $\rho_i$ is non-negative and continuous, and we can choose it to be smooth if the manifold is smooth). For $\{f_i\in C^{k}(M)\}$ compatible on the intersections, we can define $f=\sum_i \rho_i(x)f_i(x)\in C^{k}(M)$. Such that it restrict to each $f_i$. $C^k(M)$ can be continuous, smooth, or even just plain functions.
(In particular the partition of unity property is included in the notion of fine sheaves. In fact, we don't need partition of unity to prove $(a)$ here.)

\item Continuous functions on a topological space $C(X)$. It is a presheaf. We don't have to worry about the fact that function may be not determined by it's value at points, because here the continuous function means continuous map from $X$ to $\reals$ and is indeed determined valuewise. 

For identity axiom, $f_1(p)=f_2(p)$ at every point in $U$. Then they are equal. 

For gluability axiom, we define $f(p)=f_i(p)$, where $f_i\in C(U_i)$ and $p\in U_i$. Then it remains to prove $f$ is a continuous function on $U$. Recall the definition of continuous function in terms of neighborhoods. Consider $f(p)\in \reals$, for any neighborhood $V$ of $f(p)=f_i(p)$. Because $f_i$ is continuous, there is a neighborhood $p\in W\subset U_i$ such that $f_i(W)\subset V$. $W$ is also an open subset in $U$. $\res_{U,W}f=\res_{U_s,W}\circ \res_{U,U_i}f=\res_{U_i,W}f_i$, hence $f(W)\subset V$. This means $f$ is continuous at every point $p$.
\end{enumerate}
\end{proof}

\begin{exr}
Now let $\calf(U)$ be the maps to $S$ that are locally constant, i.e., for any point $p$ in U, there is an open neighborhood of $p$ where the function is constant. Show that this is a sheaf. (A better description is this: endow $S$ with the discrete topology, and let $\calf (U)$ be the continuous maps $U \lrta S$.) This is called the constant sheaf (associated to $S$); do not confuse it with the constant presheaf. We denote this sheaf $\underline{S}$.
\end{exr}
\begin{proof}
The restriction maps are just the ordinary restrictions. The constant sheaf is indeed a sheaf because it is continuous functions from $U$ to $S$ where $S$ is with discrete topology. The proof is identical. Ae will be explained in the next exercise, in fact by \href{https://en.wikipedia.org/wiki/Pasting_lemma}{pasting lemma}, every presheaf of continuous maps $C(X,Y)$ is in  fact a sheaf. 
\end{proof}

\begin{exr}\label{chap2exr:sheaf_of_continuous_maps}
Suppose $Y$ is a topological space. Show that ``continuous maps to $Y$'' form a sheaf of sets on $X$. More precisely, to each open set $U$ of $X$, we associate the set of continuous maps of $U$ to $Y$. Show that this forms a sheaf.
\end{exr}
\begin{proof}
It is obviously a presheaf and the identity holds true.

As for the gluability. Choose $V$ an open set in $Y$, and the preimage of $f\in C(X,Y)$ defined point wise by $f_i\in C(U_i,Y)$, where $U_i$ is in the subset topology.
$$
f^{-1}(V)=\cup_i f_i^{-1}(V).
$$
Each $f_i^{-1}(V)$ is open set in $U_i$ hence is an open set in $X$.
\end{proof}

\begin{exr}\ 
\begin{enumerate}[label=(\alph*)]
\item 
(sheaf of sections of a map) Suppose we are given a continuous map $\mu : Y \lrta X$. Show that sections of $\mu$ form a sheaf. More precisely, to each open set $U$ of $X$, associate the set of continuous maps $s: U \lrta  Y$ such that $μ\mu\circ s   = id|_U$. Show that this forms a sheaf. 
\item Suppose that $Y$ is a topological group. Show that continuous maps to $Y$ form a sheaf of groups.
\end{enumerate}
\end{exr}
\begin{proof}\ 
\begin{enumerate}[label=(\alph*)]
\item It is a presheaf, and with obvious restriction maps. $s_i:=\res_{U,U_i}s$ and $\mu\circ s_i=id_{U_i}$. 

Given an open cover $\{U_i\}_{i\in I}$ of $U$.

Identity Axiom:  if $s_1,s_2$ agree when restricted to any $U_i$, then they agree point wisely.

Gluability Axiom: if $\{s_i\}_{i\in I}$  are compatible on each intersection. We define $s$ point wisely, we have to check $\mu\circ s=id|_U$. And this can be checked also value-wisely.
\item A topological group is a topological space together with  compatible group structures.

It is presheaf of groups, $s_1,s_2:U\lrta Y$ the multiplication is defined as $s_1 \cdot s_2(p)=s_1(p)\times s_2(p)$. The identity and inverse is also defined point-wisely. 

Given an open cover $\{U_i\}_{i\in I}$.

Identity axiom: if $s_1,s_2$ agree upon restricted to each $U_i$, then they agrees pint-wisely.

Gluability axiom: if $\{s_i\}_{i\in I}$  are compatible on each intersection. We define $s$ point wisely, we have to check $s$ is indeed continuous, and this has been checked in Exercise~\ref{chap2exr:sheaf_of_continuous_maps}.

 In fact, the group structure has nothing to do with whether it is a sheaf of sets.
 What we have to do is just to verify that the sheaf of sets possesses the addition structure of sheaf of groups.
\end{enumerate}
\end{proof}

\begin{exr}
 THE PUSHFORWARD SHEAF OR DIRECT IMAGE SHEAF. Suppose $\pi: X \lrta Y$ is a continuous map, and $\calf$ is a presheaf on $X$. Then define $\pi_*\calf$ by $\pi_*\calf(V)=\calf(\pi^{-1}(V))$, where $V $ is an open subset of $Y$. Show that $\pi_*\calf$ is a presheaf on $Y$, and is a sheaf if $\calf{F}$ is. This is called the \textbf{pushforward} or \textbf{direct image} of $\calf$. More precisely, $\pi_*\calf$ is called the pushforward of $\calf$ by $\pi$.
\end{exr}
\begin{proof}
It is a presheaf:
The new restriction map is induced as 
$$
\res'_{V,W}=\res_{\pi^{-1}V,\pi^{-1}W}.
$$
The functorial property holds
$$
\res'_{V,V}=\res_{\pi^{-1}V,\pi^{-1}V}=id_{\calf(\pi^{-1}(V))}:=id_{\pi_*\calf(V)}
$$
and
$$
\res'_{U,V}\circ \res'_{V,W}=\res_{\pi^{-1}U,\pi^{-1}V}\circ \res_{\pi^{-1}V,\pi^{-1}W}=\res_{\pi^{-1}U,\pi^{-1}W}=\res'_{V,W}.
$$

Now assume $\calf$ is a sheaf.
The open cover $\{V_i\}_{i\in I}$ of $V$ pullback to an open cover $\pi^{-1}(V_i)$ of $\pi^{-1}(V)$.

Identity axiom: $f_1,f_2$ in $\pi_*\calf(V)$ agrees when restricted to any $V_i$, then $f_1,f_2$ as element in $\calf(\pi^{-1}{V})$ agrees when restricted to each $\pi^{-1}(V_i)$. Because $\calf$ is a sheaf, $f_1,f_2$ has to agree in $\calf(\pi^{-1}(V))$, which is equivalent to $f_1,f_2$ agrees in $\pi_*\calf(V)$.

Gluability axiom: if $\{f_i\}_{i\in I}$  are compatible on each intersection. They are also compatible as sections in $\calf(\pi^{-1}V_i)$, because $\calf$ is a sheaf, there is an element $\tilde{f}\in \calf(\pi^{-1}V)$ such that it restricts to each $f_i$. $\tilde{f}$ can be interpreted as an element $f\in \pi_*\calf(V)$.
\end{proof}

\begin{exr}
Suppose $π\pi: X \lrta Y $ is a continuous map, and $\calf$ is a sheaf of sets (or rings or $A$-modules) on $X$. If $ \pi(p) = q$, describe the natural morphism of stalks $(\pi_*\calf)_q \lrta \calf_p$.
\end{exr}
\begin{proof}
First we define the morphism of stalk using the universal property of colimits.
$$
\calf_p=\dirlim\calf(U),
$$
 where the index category is the ``open sets that containing $p$'' and each $\pi_*\calf(V)\cong \calf(\pi^{-1}(V))$
\begin{center}
\begin{tikzcd}
\pi_*\calf_q \arrow[rr, "\exists!", dashed] &  & \calf_p \\
 & \calf(\pi^{-1}V_i) \arrow[ru, "g_i"] \arrow[r] & \calf(\pi^{-1}V_j) \arrow[u, "g_j"] \\
\pi_*\calf(V_i) \arrow[r] \arrow[uu, "f_i"] \arrow[ru, "="] & \pi_*\calf(V_j) \arrow[luu, "f_j"'] \arrow[ru, "="] &
\end{tikzcd}
\end{center}
Because the index category of either colimits is filtered set. We can equivalently define the at the level of disjoint union modulo equivalence. 
$$
\calf_p:=\left\{(f_i; U_i)\in\coprod_{i\in\cali} \calf(U_i):\right\}\left/
\left(
\begin{matrix}
& (f_i;U_i)\sim (f_j;U_j)\text{iff there are $\res_{U_i\rta U_k}:\calf(U_i)\rta \calf(U_k)$}\\
&\text{$\res_{U_j,U_k}:\calf(U_j)\rta \calf(U_k)$ s.t., $f_i|_{U_k}=f_j|_{U_k}\in \calf(U_k)$}
\end{matrix}
\right)
\right.
$$
$$
[(f_i;V_i)]\mapsto [(f_i;\pi^{-1}(V_i))]
$$
It is well defined map because
$$
\res'_{V,W}=\res_{\pi^{-1}V,\pi^{-1}W}.
$$
\end{proof}

\begin{definition}
Ringed spaces, and $\calo_X$-modules. Suppose $\calo_X$ is a sheaf of rings on a topological space $X$. Then $(X,\calo_X)$ is called a \textbf{ringed space}. The sheaf of rings is often denoted by $\calo_X$. This sheaf is called the structure sheaf of the ringed space. Sections of the structure sheaf $\calo_X$ over an open subset $U$ are called \textbf{functions} on $U$. Functions in this sense is not defined point wise, and is not determined by their value at points.
\end{definition}

\begin{exr}
If $(X,\calo_X)$ is a ringed space, and $\calf$ is an $\calo_X$-module, describe how for each $p\in X$, $\calf_p$ is an $\calo_{X,p}$-module.
\end{exr}
\begin{proof} The crucial print is that colimit of product is product of colimit.
\begin{center}
\begin{tikzcd}
 & \calo_X(V)\times \calf(V) \arrow[rr, "\text{action}"] \arrow[ld, "{\res_{V,U}\times\res_{V,U}}"'] \arrow[rdd] &  & \calf(V) \arrow[ld, "{\res_{V,U}}"] \arrow[rdd] &  \\
\calo_X(U)\times \calf(U) \arrow[rr, "\text{action}"] \arrow[rrd] &  & \calf(U) \arrow[rrd] &  &  \\
 &  & \calo_{X,p}\times\calf_p \arrow[rr, "\text{action}"] &  & \calf_p
\end{tikzcd}
\end{center}
At the explicit level,
$$
\calo_{X,p}\times \calf_p\ni([(a_V;V)],[(m_U;U)])=[((a_{W}, m_W);W)]\in (\calo_X\times \calf)_p,
$$
where $W\subset V\cap U$.
and 
$$
\calo_{X,p}\times \calf_p\ni([(a_V;V)],[(m_U;U)])\overset{\text{action}}{\longmapsto}[(a_w\cdot m_W;W)]\in\calf_p.
$$
And it is routine to verify that map defined above indeed gives $\calf_p$ the structure of a $\calo_p$ module.


\end{proof}
\section{Morphism of presheaves and sheaves}
\begin{exr}\label{chap2exr:morphism_of_sheaves_induce_on_stalks}
MORPHISMS OF (PRE)SHEAVES INDUCE MORPHISMS OF STALKS. If $\phi: \calf\lrta \calg $ is a morphism of presheaves on $X$, and $p \in X$, describe an induced morphism of stalks $\phi_p : \calf_p \lrta \calg_p$. Translation: taking the stalk at $p$ induces a functor $Sets_X \lrta  Sets$.
\end{exr}
\begin{proof}
Using the language of colimits,
\begin{center}
\begin{tikzcd}
\calf_q \arrow[rr, "\exists!\phi_p", dashed] &  & \calg_p \\
 & \calg(V_i) \arrow[ru, "g_i"] \arrow[r,"\res_{V_i,V_j}"] & \calg(V_j) \arrow[u, "g_j"] \\
\calf(V_i) \arrow[r,"\res_{V_i,V_j}"] \arrow[uu, "f_i"] \arrow[ru, "\phi(V_i)"] & \calf(V_j) \arrow[luu, "f_j"'] \arrow[ru, "\phi(V_j)"] &
\end{tikzcd}
\end{center}

Using the explicit construction, we can check the map 
$$
\phi_p:[(s;V)]\mapsto [(\phi(V)s;V)]
$$
is well-defined. Assume $(s;V)\sim (s';V')$, there exists $(t;W)$ so that $W\subset V\cap V'\ni p$ and $t=s|_W=s'|_W$.
 We can check $(\res_{V,W}\phi(V)s;W)=(\res_{V'W}\phi(V')s';W)=(\phi(W)t;W)$. Hence $[(\phi(V)s;V)]=[\phi(V')s';V']$.
\end{proof}

\begin{exr}
Suppose $\pi:X\lrta Y$ is a continuous map of topological spaces (i.e., a morphism in the category of topological spaces). Show that pushforward gives a functor $\pi_* : Sets_X \lrta Sets_Y$ . Here $Sets $ can be replaced by other categories. 
\end{exr}
\begin{proof}
We want ot verufy the diagram 
\begin{center}
\begin{tikzcd}
\calf \arrow[r, "\phi",blue] \arrow[d, "\pi_*"',red] & \calg \arrow[d, "\pi_*",red] \\
\pi_*\calf \arrow[r, "\pi_*(\phi)",blue] & \pi_*\calg,
\end{tikzcd}
\end{center}
where $\phi:\calf\lrta \calg$ is a morphism of sheaves and $\pi_*\phi(V)=\phi(\pi^{-1}V)$. 
In detail, it means each square is commutative in the following diagram
\begin{center}
\begin{tikzcd}
 &  & \calf(\pi^{-1}U) \arrow[lld,"\pi_*",red] \arrow[dd, bend left,"\phi", blue] &  \\
\pi_*\calf (U) \arrow[dd, bend right,"\pi_*(\phi)"', blue] &  & \pi^{-1}U \arrow[u] \arrow[rd, hook] \arrow[d] & \calf(\pi^{-1}V) \arrow[lu] \arrow[lld,"\pi_*"', red] \arrow[dd, bend left,"\phi", blue] \\
U \arrow[u] \arrow[rd, hook] \arrow[d] \arrow[rru] & \pi_*\calf(V) \arrow[lu] \arrow[dd, bend right,"\pi_*(\phi)"', blue] & \calg(\pi^{-1}U) \arrow[lld,"\pi_*", red] & \pi^{-1}V \arrow[u] \arrow[d] \\
\pi_*\calg(U) & V \arrow[u] \arrow[d] \arrow[rru] &  & \calg(\pi^{-1}V) \arrow[lu] \arrow[lld,"\pi_*", red] \\
 & \pi_*\calg(V) \arrow[lu] &  & 
\end{tikzcd}
\end{center}
\end{proof}

\begin{exr}
Suppose $\calf$ and $\calg$ are two sheaves of sets on $X$. (In fact, it will suffice that $\calf$ is a presheaf.) Let $\mathpzc{Hom} (\calf , \calf)$ be the collection of data
$$
\mathpzc{Hom}(\calf,\calg)(U):=\mor(\calf|_U,\calg|_U).
$$
Show that this is a sheaf of sets on $X$. (To avoid a common confusion: the right side does not say $\mor(\calf(U),\calg(U))$.) This sheaf is called ``sheaf Hom''. (Strictly speaking, we should reserve Hom for when we are in an additive category, so this should possibly be called ``sheaf Mor''. But the terminology ``sheaf Hom'' is too established to uproot.) It will be clear from your construction that, like Hom, $\mathpzc{Hom}$ is a contravariant functor in its first argument and a covariant functor in its second argument.
\end{exr}
\begin{proof}
Given $\calf$ a presheaf and $\calg$ a sheaf. We ahve to check that $\phom(\calf,\calg)$ is a sheaf of sets on $X$.

First, we check that it is a presheaf:
\begin{center}
\begin{tikzcd}
U \arrow[d] & V \arrow[d] \arrow[l, hook] \\
\phom(\calf,\calg)(U) \arrow[r,"\res_{U,V}"] & \phom(\calf,\calg)(V)
\end{tikzcd}
\end{center}
The $\res_{U,V}$ is induced by 
$$
\res_{U,V}:\phom(\calf,\calg)(U)=\mor(\calf|_U,\calg|_U)\lrta\mor(\calf|_V,\calg|_V)= \phom(\calf,\calg)
$$
$$
\mor(\calf|_U,\calg|_U)\ni\phi\longmapsto \phi|_V,
$$
where $\phi|_V:\calf|_V\lrta \calg|_V$, $\phi|_V(V_i)=\phi(V_i)$. In the later term $V_i$ is regarded as an open subset in $U$. It is easy to see that $\res_{U,U}$ is identity. And it suffices to check that $\res_{V,W}\circ \res_{U,V}=\res_{U,W}$. For an element $\phi$ in in $\phom(\calf,\calg)$, and for $W_i$ open subset in $W$:
$$
\left(\phi|_V\right)|_W(W_i)=\phi|_V(W_i)=\phi(W_i)=\phi|_W(W_i).
$$
This equality is true for arbitrary open sets in $W$ and notice that morphism $\varphi$ of (pre)sheaves is defined by the behavior of $\varphi(W_i)$. We can conclude that it satisfies the functorial property of a presheaf. 

Then given an open cover $\{U_i\}_{i\in I}$ of $U$, we check that sheaf Hom satisfies the two axioms of sheaf.

Identity axiom: Let $\phi_1,\phi_2$ be two morphisms in $\phom(\calf,\calg)(U)$. They agree when restricted to each $U_i$.

\underline{Know}:
$$
\phi_1|_{U_i}=\phi_2|_{U_i},\forall i\in I
$$
which means $\phi_1|_{U_i}(U_{i,j})=\phi_2|_{U_i}(U_{i,j})$ for each open $U_{i,j}\subset U_i$

\underline{Want}:$\phi_1(V)=\phi_2(V)$ for all $V$ open sets in $U$.

In particular, each open set $V$ is covered by $\{U_i\cap V\}_{i\in I}$, then we know 
$$
\phi_1|_{U_i}(U_i\cap V)=\phi_1(U_i\cap V)=\phi_2(U_i\cap V)=\phi_2|_{U_i}(U_i\cap V).
$$
Then we have reduced the problem to verifying that, for $\{V_i\}_{i\in I}$ an open cover of $V$, $\phi_1(V)=\phi_2(V)$ if $\phi_1(V_i)$ agrees with $\phi_2(V_i)$ as morphism of sets for all $V_i$.

Given $f\in\calf(V)$.

\underline{Want}: $g_1:=\phi_1(V)(f)=g_2:=\phi_2(V)(f)$. 

 They restrict to $f_i\in \calf(V_i)$ and $g_{1,i},g_{2,i}\in\calg(V_i)$. Set $g_{1,i},g_{2,i}\in \calg(V_i)$ and
$\phi_1(V_i):f_i\mapsto g_{1,i}$ and $\phi_2(V_i):f_i\mapsto g_{2,i}$ by the definition of morphism of (pre)sheaves. $g_{1,i}=g_{2,i}$ for all $i$ because $\phi_1(V_i)$ and $\phi_2(V_i)$ agree as morphism of sets.

Now, \textbf{because $\calg$ is a sheaf}, $g_1=g_2$. \textbf{It suffices that $\calf$ being only a presheaf rather than sheaf}.

Gluability axiom: Let $\{\phi_i\}_{i\in I}, \phi_i\in \phom(\calf,\calg)(U_i)$ be compatible when they are restricted to intersections. 

\underline{Want}: There exists a $\phi\in \phom(\calf,\calg)(U)$ such that $\phi|_{U_i}=\phi_i$, which means there exists a morphism of sets $\phi(V)$ for each open set $V\subset U$ such that $\phi(U_{i,j})=\phi|_{U_i}(U_{i,j})=\phi_i(U_{i,j})$ for all $U_{i,j}$ open subsets in $U_i$ and the defined morphism of sets $\phi(V)$ indeed determines a morphism of (pre)sheaves.

We construct each $\phi(V)$ explicitly. $V$ is covered by $\{V_i:=U_i\cap V\}_{i\in I}$ and $V_i\cap V_j=U_i\cap U_j\cap V$.

\underline{Know}: $\phi_i|_{U_i\cap U_j}=\phi_j|_{U_i\cap U_j}$. In particular 
$$
\phi_i|_{U_i\cap U_j}(V_i\cap V_j)=\phi_i(V_i\cap V_j)=\phi_j(V_i\cap V_j)=\phi_j|_{U_i\cap U_j}(V_i\cap V_j).
$$
Given $f\in\calf(V)$. $f$ restricts to $f_i\in \calf(V_i)$ and set
$$
g_i:=\phi_i(V_i)(f_i)\in\calg(V_i)
$$
$$
g_i|_{V_i\cap V_j}=\phi_i(V_i)(f_i)|_{V_i\cap V_j}=\phi_i(V_i\cap V_j)(f_i|_{V_i\cap V_j}),
$$
where the second equality holds because each $\phi_i$ is a morphism of (pre)sheaves. Then because $\phi_i|_{U_i\cap U_j}(V_i\cap V_j)=\phi_j|_{U_i\cap U_j}(V_i\cap V_j)
$ and $f_i|_{V_i\cap V_j}=f_j|_{V_i\cap V_j}=f|_{V_i\cap V_j}$ (because $\calf$ is a presheaf)
$$
g_i|_{V_i\cap V_j}=g_j|_{V_i\cap V_j}
$$
$g_i$ are compatible when restricted to intersections. Then, again,  \textbf{because $\calg$ is a sheaf, by gluability}, there is a unique element $g$ to glue to in $\calg(V)$. 

We define $\phi(V):f\mapsto g$, $g$ is constructed as above. 
Then there two things left: 1. verify that $\phi$ is indeed a morphism of (pre)sheaves. 2. verify that $\phi$ to restricts to $\phi_i$.
\begin{center}
\begin{tikzcd}
\calf(V) \arrow[r, "\phi(V)"] \arrow[d, "{\res_{V,W}}"'] & \calg(V) \arrow[d, "{\res_{V,W}}"] \\
\calf(W) \arrow[r, "\phi(W)"] & \calg(W)
\end{tikzcd}
\end{center}
Given an element $f\in\calf(V)$, $g=\phi(V)(f)\in \calg(V)$ is the element to which $\phi_i(V_i)(f|_{V_i})$ glue up. $f$ restricts to $f|_W$, and $g'=\phi(W)(f|_W)\in\calg(W)$ is defined to be the element $g\in \calg(W)$ to which $\phi(W_i)(f|_{W_i})$ glue up, where $W_i=U_i\cap W$. $W_i$ is an open subset of $V_i$ and $\{W_i\}_{i\in I}$ is an open cover of $W$. \underline{Want}: $g'=g|_W$, but we have
$$
g'|_{W_i}=\phi(W_i)(f|_{W_i})=\phi(V_i)(f|_{V_i})|_{W_i}=(g|_{V_i})|_{W_i}
=(g|_W)|_{W_i}.
$$
Then \textbf{because $\calg$ is a sheaf, by identity axiom}, $g'=g|_W$. The above diagram commutes and $\phi$ is a morphism of (pre)sheaves.

On the other hand, by definition of $\phi(V)$,
$$
\phi|_{U_i}(V_i)(f_i)=\phi_i(V_i)(f_i),
$$
but our $V$ is chosen arbitrarily, hence $V_i=V\cap U$ is arbitrary open subsets in $U_i$, which means $\phi|_{U_i}=\phi_i$.

Now $\phom(\_,\calg)$ is a contravariant functor from the the category of sheaves of something to the category of category of sheaves of sets and $\phom(\calf,\_)$ is a covariant functor...
\end{proof}
\begin{remark}
Warning: $\mathpzc{Hom}$ does not commute with taking stalks. More precisely: it is not true that $\mathpzc{Hom} (\calf , \calg)_p$ is isomorphic to $\mathpzc{Hom}(\calf_p , \calg_p )$. 
\begin{center}
\begin{tikzcd}
 & \mor(\calf_p,\calg_p) &  \\
\phom(\calf,\calg)(U) \arrow[d] \arrow[ru] \arrow[rrd] &  &  \\
\phom(\calf,\calg)(V) \arrow[ruu] \arrow[rr] &  & \phom(\calf,\calg)_p \arrow[luu, "\exists!"', dashed]
\end{tikzcd}
\end{center}
There is always a natural morphism from $\mathpzc{Hom} (\calf , \calg)_p$ to $\mathpzc{Hom}(\calf_p , \calg_p )$, because by~\ref{chap2exr:morphism_of_sheaves_induce_on_stalks}, each morphism of sheaves induces a morphism of stalks. The map $\phi\mapsto \phi_p$ is an arrow from $\mathpzc{Hom} (\calf , \calg)(U)$ to $\mathpzc{Hom}(\calf_p , \calg_p )$ and compatible with restriction of $\mathpzc{Hom} (\calf , \calg)$. Then by the definition of colimit, there exists a unique morphism from $\mathpzc{Hom} (\calf , \calg)_p$ to $\mathpzc{Hom}(\calf_p , \calg_p )$. But in general, the morphism is neither injective nor surjective.

Non-examples: Let $H$ to be any nontrivial Abelian group, $X$ be any topological space. Take $\calg$
 to be the constant sheaf $\underline{H}$ and $\calf$ to be the skyscraper sheaf at a point a point $p$ with stalk $H$ at $p$.

\textbf{Then $\phom(\calf,\calg)_p\lrta \hom(\calf_p,\calg_p)$, is not surjective.}
$\phom(\calf,\calg)_p=\{0\}$ and we have $\hom(\calf_p,\calg_p)$ $=\hom(H,H)\neq \{0\}$.

Because $\phom(\calf,\calg)(V)=\{0\}, p\notin V$. Given $f\in\calf(V)$, and $\phi\in\phom(\calf,\calg)$. $\phi(V)(f)\in\calg(V)$ is the section that $\phi(V_i)(f|_{V_i})$ glues to. $\phi(V_i)(f|_{V_i})$ is trivial when $V\not\ni p$. $\calg$ is locally constant, and hence they must glue up to trivial element in $\calg(V)$. 

On the other hand, let $Y=X\backslash p$, and let $Ab_X\ni\calf=\calg$ be the extension by zero of the constant sheaf $\underline{H}$ on $Y$ (i.e. it's the constant sheaf $\underline{H}$ on $V$ and $\calf(U)=0$ if $U\notsubset V$). Then $\calf_p=\calg_p=0$, but $\phom(\calf,\calg)$ contains a natural copy of $\hom(\underline{H},\underline{H})\neq0$ for any $U$, so $\hom(\calf,\calg)_p$ contains a natural copy of $\hom(\underline{H},\underline{H})$, so it's not zero. Hence \textbf{$\phom(\calf,\calg)_p\lrta \hom(\calf_p,\calg_p)$, is not surjective.}
 \end{remark}

 \begin{exr}\ 
 \begin{enumerate}[label=(\alph*)]
 	\item
If $\calf$ is a sheaf of sets on $X$, then show that $\phom(\underline{\{p\}},\calf) \cong \calf$, where \underline{\{p\}} is the constant sheaf associated to the one element set $\{p\}$.
\item 
 If $\calf$ is a sheaf of abelian groups on $X$, then show that $\phom_{Ab_X}(\underline{\intg},\calf)\cong \calf$ (an isomorphism of sheaves of abelian groups).
\item  If $\calf$ is an $\calo_X$-module, then show that $\phom_{Mod_{\calo_X}}(\calo_X,\calf) \cong\calf$ (an iso morphism of $\calo_X$-modules).
\end{enumerate}
 \end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item The one element constant sheaf is just the corresponding constant presheaf, $\underline{\{p\}}(V)=\{p\}$ for all open sets. For each morphism of sheaves $\phi$ in $\phom(\underline{\{p\}},\calf)$, the corresponding morphism of sets $\phi(V):\{p\}\lrta\calf(V)$ defines a unique element $\phi(V)(p)\in\calf(V)$. We can define the morphism of sheaves $ev$
$$
ev(V):\phom(\underline{\{p\}},\calf)(V)\lrta\calf(V) 
$$
$$
\phi(V)\longmapsto \phi(V)(p)
$$
and the following diagram commutes
\begin{center}
\begin{tikzcd}
\phom(\underline{\{p\}},\calf)(U) \arrow[d] \arrow[r, "ev(U)"] & \calf(U) \arrow[d] \\
\phom(\underline{\{p\}},\calf)(V) \arrow[r, "ev(V)"] & \calf(V).
\end{tikzcd}
\end{center}
It has an inverse
$$
ve(V):\calf(V) \lrta \phom(\underline{\{p\}},\calf)(V)
$$
$$
\calf(V)\ni f|_{V}\longmapsto \phi_f(V):[p\mapsto f|_V].
$$
$\phi_f$ determines a morphism of sheaves because $\res_{U,V}(\phi_f)$
$ve$ is well-defined morphism of sheaves because
$p\mapsto p\mapsto f|_U=p\mapsto f|_V\mapsto f|_U$
\begin{center}
\begin{tikzcd}
\phom(\underline{\{p\}},\calf)(U) \arrow[ddd] &  &  & \calf(U) \arrow[ddd] \arrow[lll, "ve(U)"'] \\
 & \phi_f(U)=[f|_U\mapsfrom p] \arrow[d, maps to] & f|_U \arrow[l, maps to] \arrow[d, maps to] &  \\
 & \phi_f|_V(V)=\phi_f(V)=[f|_V\mapsfrom p] & f|_V \arrow[l, maps to] &  \\
\phom(\underline{\{p\}},\calf)(V) &  &  & \calf(V) \arrow[lll, "ve(V)"']
\end{tikzcd}
\end{center}
They are indeed mutually inverse because
$$
ev(V)\circ ve(V):f|_V\mapsto [p\mapsto f|_V]\mapsto [p\mapsto f|_V](p)= f|_V
$$
and
$$
ve(V)\circ ev(V):\phi(V)\mapsto \phi(V)(p)\mapsto [p\mapsto \phi(V)(p)]=\phi(V)
$$

\item  $\underline{\intg}(V) $ is the set of locally constant maps from $V$ to $\intg$. (continuous maps from $V$ to $\intg$ with discrete topology. For $V$ connected $\underline{\intg}(V)= \intg$ and for $V$ with $n$ connected components, $\underline{\intg}(V)=\oplus_i^n\intg$ and the restriction map is just ordinary restriction of functions.) Similarly, we can define a morphism of sheaves of Abelian groups: $ev:\phom_{Ab_X}(\underline{\intg},\calf)\lrta\calf$
$$
ev(V):\phom(\underline{\intg},\calf)(V)\lrta\calf(V) 
$$
$$
\phi(V)\mapsto \phi(V)(1|_V),
$$
where $1|_V$ is the constant map that maps each point in $V$ to $1$. The explicit form of $1|_V$ can be $(1,1...,1)$. Notice that $\phi(V)$ is only morphism of Abelian groups and it is quite legal to map $1$ to $0$. There is a inverse of morphism of sheaves $ve:\calf\lrta \phom(\underline{\intg},\calf)$
$$
ve(V):\calf(V) \lrta \phom(\underline{\intg},\calf)(V)
$$
$$
\calf(V)\ni f|_V\longmapsto \phi_f(V):[\underline{\intg}(V)\ni 1|_V\mapsto f|_V].
$$
We have to mention that $1|_V$ does not generate $\underline{\intg}(V)$ in general but the morphism $\phi_f(V)$ is totally determined by its image of $1|_V$. For example $a\in\underline{\intg}(V)$, we can find an open cover $\{V_i\}_{i\in I}$ such that $a|_{V_i}$ is constant on each $V_i$. $1|_{V_i}$ is still the constant map to $1$. Then $a|_{V_i}=n_i\times 1|_{V_i}$ for some integer $n_i$.
$$
\phi_f(V_i):a|_{V_i}\longmapsto n_i\times \phi_f(V)(1|_{V})|_{V_i}=n_i\times f|_{V_i}\in \calf(V_i)
$$
If $V_i\cap V_j\neq \emptyset$, $a|_{V_i}$ and $a|_{V_j}$ has to agree on $V_i\cap V_j$, and hence $n_i=n_j$, hence
$$
\phi_f(V_i)(a|_{V_i})|_{V_i\cap V_j}=\phi_f(V_j)(a|_{V_j})|_{V_i\cap V_j}.
$$
Then because $\calf$ is  a sheaf, there is a unique section in $\calf(V)$ to glue to, we define it as $\phi_f(V)(a|_V)$. Then it is routine to check 
\begin{center}
\begin{tikzcd}
\phom(\underline{\intg},\calf)(U) \arrow[d] \arrow[r, "ev(U)"] & \calf(U) \arrow[d] \\
\phom(\underline{\intg},\calf)(V) \arrow[r, "ev(V)"] & \calf(V).
\end{tikzcd}
\end{center}
then diagram commutes and $ev$, $ve$ is mutually inverse.
\item $(b)$ is a special case of $(c)$.  Interpret $\phom_{Mod_{\calo_X}}(\calo_X,\calf)(V)$ as a $\calo_X(V)$-module by considering the $\calo_X(V)$-module structure of its image. $\calo_X(V)$ is  ring with unit element $1|_V$.

We can define a morphism of $\calo_X$-modules, $ev$
$$
ev(V):\phom_{Mod_{\calo_X}}(\calo_X,\calf)(V)\lrta\calf(V)
$$
$$
\phi(V)\mapsto \phi(V)(1|_V),
$$
each $ev(V)$ is indeed a morphism of $\calo_X(V)$-modules and it is routine to check $ev$ forms a morphism of $\calo_X$-modules. 
\begin{center}
\tiny
\begin{tikzcd}
\calo_X(U)\times \phom(\calo_X,\calf)(U) \arrow[rd, "id\times ev(U)"] \arrow[dd] \arrow[rrr, "action'"] &  &  & \phom(\calo_X,\calf)(U) \arrow[rd, "ev(U)"] \arrow[dd] &  \\
 & \calo_X(U)\times \calf(U) \arrow[dd] \arrow[rrr, "action"] &  &  & \calf(U) \arrow[dd] \\
\calo_X(V)\times\phom(\calo_X,\calf)(V) \arrow[rd, "id\times ev(V)"] \arrow[rrr, "action'"] &  &  & \phom(\calo_X,\calf)(V) \arrow[rd, "ev(V)"] &  \\
 & \calo_X(V)\times \calf(V) \arrow[rrr, "action"] &  &  & \calf(V),
\end{tikzcd}
\end{center}
where the vertical arrows a restrictions. The $action'$
 is  defined as 
 $$
 a|_V\times \phi(V)\mapsto [1|_V\longmapsto a|_V\phi(V)(1|_V)]
 $$
 and above diagram indeed commutes.

 Then, we  construct inverse of $ev$ by 
$$
ve(V):\calf(V) \lrta \phom_{Mod_{\calo_X}}(\calo_X,\calf)(V)
$$
$$
\calf(V)\ni f|_V\longmapsto \phi_f(V):[\calo_X(V)\ni 1|_V\mapsto f|_V].
$$
$\phi_f(V)$ is uniquely determined by it's image of $1|_V$.
Then it is routine to check 
\begin{center}
\begin{tikzcd}
\phom(\calo_X,\calf)(U) \arrow[d] \arrow[r, "ev(U)"] & \calf(U) \arrow[d] \\
\phom(\calo_X,\calf)(V) \arrow[r, "ev(V)"] & \calf(V).
\end{tikzcd}
\end{center}
then diagram commutes and $ev$, $ve$ is mutually inverse.
\end{enumerate}
\end{proof}

\begin{exr}
Show that $\ker_{pre}\phi$ is a presheaf. (Hint: if $U  \inj V$, define the restriction map by chasing the following diagram:
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \ker_{pre}\phi(V) \arrow[r, hook] \arrow[d, "\exists !"', dotted] & \calf(V) \arrow[r] \arrow[d, "{\res_{V,U}}"] & \calg(V) \arrow[d, "{\res_{V,U}}"] \\
0 \arrow[r] & \ker_{pre}\phi(U) \arrow[r, hook] & \calf(U) \arrow[r] & \calg(U)
\end{tikzcd}
\end{center}
\end{exr}
\begin{proof}
$f|_V\in\ker_{pre}\phi(V)\subset \calf(V)$, $\res_{V,U}\phi(V)(f|_V)=\phi(U)(f|_U)=0$. Hence $f|_U=\res_{V,U}f|_U$ is in the kernel. It must be a \textbf{restriction of restriction map}, because $\ker_{pre}\phi(V)\inj\calf(V)$. Then it suffices to check only the dashed triangle commutes in the following diagram
\begin{center}
\begin{tikzcd}
0 \arrow[r] & \ker_{pre}(\phi)(V) \arrow[r, hook] \arrow[d, "\exists !"', dotted] \arrow[rdd, dotted] & \calf(V) \arrow[r] \arrow[d, "{\res_{V,U}}"] \arrow[rdd, "{\res_{V,W}}"] & \calg(V) \arrow[d, "{\res_{V,U}}"] \arrow[rdd, "{\res_{V,W}}"] &  \\
0 \arrow[r] & \ker_{pre}\phi(U) \arrow[r, hook] \arrow[rd, dotted] & \calf(U) \arrow[r] \arrow[rd, "{\res_{U,W}}"] & \calg(U) \arrow[rd, "{\res_{U,W}}"] &  \\
 & 0 \arrow[r] & \ker_{pre}\phi(W) \arrow[r, hook] & \calf(W) \arrow[r] & \calg(W)
\end{tikzcd}
\end{center}
It commutes because it can be regraded as part of the solid triangle of $\calf(V),\calf(W),\calf(U)$.
\end{proof}

\begin{exr}
Show that the presheaf cokernel satisfies the universal property of cokernels
\end{exr}
\begin{proof}, Given a morphism $\phi:\calf\lrta \calg$ and a morphism of presheaves $\sigma$ from $\calg$ to $\calc$ such that
We need to check that, the composition $\phi\circ \sigma=0$ there is a unique morphism of presheaves from $\coker \phi$ to $\calc$
\begin{center}
\begin{tikzcd}
\calc &  &  \\
\coker \phi  \arrow[u, "\exists!", dashed] & \calg \arrow[l, "\pi"] \arrow[lu] & \calf \arrow[l, "\phi"'] \arrow[llu, "0"'] \arrow[ll, "0", bend left]
\end{tikzcd}
\end{center}
By definition of $\coker \phi$, $(\coker \phi)(V):=\coker (\phi(V))$. Because each $\phi(V)$ is morphism of Abelian groups, each $\coker \phi(V)$ has the universal property and there exists a unique morphism $\psi(V):\coker\phi(V)\lrta \calc(V)$ such that the triangles in the below diagram commute.
\begin{center}
\begin{tikzcd}
\calc(V) &  & \calc(U) \arrow[ll,red] &  &  \\
\coker \phi(V) \arrow[u, "\exists!\psi(V)", dashed,red] &  & \coker\phi(U) \arrow[u, "\exists!\psi(U)", dashed,red] \arrow[ll,red] &  &  \\
 & \calg(V) \arrow[lu, "\pi(V)"] \arrow[luu, "\sigma(V)"'] &  & \calg(U) \arrow[lu, "\pi(U)"] \arrow[ll] \arrow[luu, "\sigma(U)"'] &  \\
 &  & \calf(V) \arrow[lu, "\phi(V)"] \arrow[lluuu, "0"'] \arrow[lluu, "0", bend left] &  & \calf(U) \arrow[lu, "\phi(U)"] \arrow[ll] \arrow[lluuu, "0"'] \arrow[lluu, "0", bend left]
\end{tikzcd}
\end{center}
It remains to check the red square commutes such that $\psi$ indeed determines a morphism of presheaves. Because $\pi(U)$ is an epimorphism. Surjective morphism of when regarded as morphism of sets are always epimorphism in small category. Then the red square has to be commutative.
\end{proof}

\begin{exr}\label{chap2:exr_presheave_section_funcotr_exact}
Show (orobserve) that for a topological space $X$with open set $U$, $\calf  \lrta \calf(U)$ gives a functor from presheaves of abelian groups on $X$, $Ab^{pre}_X$, to abelian groups, \textit{Ab}. Then show that this functor is exact.
\end{exr}
\begin{proof}
The diagram commutes by the definition of morphism of presheaves
\begin{center}
\begin{tikzcd}
\calf \arrow[r, "\phi"] \arrow[d, "\Gamma"'] & \calg \arrow[d, "\Gamma"] \arrow[r, "\psi"] & \calh \arrow[d, "\Gamma"] \\
\calf(U) \arrow[r, "\phi(U)"] & \calg(U) \arrow[r, "\psi(U)"] & \calh(U)
\end{tikzcd}
\end{center}
Taking the section of $U$ gives a functor because

Given a short exact sequence of presheaves
$$
0\lrta \calf\overset{\phi}{\lrta} \calg\overset{\psi}{\lrta} \calh\lrta 0
$$

The section functor $\Gamma(U,\_)$ maps $\calf\mapsto\calf(U)$. $0$ the the $0$-object in the $Ab_X^{pre}$
By definition of $\ker \phi$, $\ker\phi=0$ iff $\ker \phi(V)=0$ for each open set $V$. Similarly $\im \phi=\ker\psi$ iff $\im \phi(V)=\ker\psi(V)$ for all open sets $V$. $\coker \psi=0$ iff $\coker \psi(V)=0$.
This means in particular
$$
0\lrta \calf(U)\overset{\phi(U)}{\lrta} \calg(U)\overset{\psi(U)}{\lrta} \calh(U)\lrta 0
$$
is exact, which means $\Gamma(U,\_)$ is exact functor.
\end{proof}

\begin{exr}\label{chap2:exr2.3.H}
Show that a sequence of presheaves $$
0 \lrta \calf_1 \lrta \calf_2 \lrta ... \lrta \calf_n \lrta0$$
 is exact if and only if
$$0 \lrta \calf_1(U) \lrta \calf_2(U) \lrta ... \lrta \calf_n(U) \lrta0$$ is exact for all $U$.
\end{exr}
\begin{proof}
In~\ref{chap2:exr_presheave_section_funcotr_exact}, we have proved that the short sequence of presheaves
$$
0\lrta \calf\overset{\phi}{\lrta} \calg\overset{\psi}{\lrta} \calh\lrta 0
$$
is exact iff only
$$
0\lrta \calf(U)\overset{\phi(U)}{\lrta} \calg(U)\overset{\psi(U)}{\lrta} \calh(U)\lrta 0
$$ 
is exact. Because each long exact sequence splits into short exact sequences, we are done.

\end{proof}


\begin{exr}\label{chap2exr:kernel_sheaf}
Suppose $\phi: \calf\lrta\calg $ is a morphism of sheaves. Show that the presheaf kernel $\ker_{pre} \phi$ is in fact a sheaf. Show that it satisfies the universal property of kernels.
\end{exr}
\begin{proof}
The $0$-object in sheaves of abelian groups is just the $0$-presheaf (It is a constant presheaf of sets with one element set.)

Given an open set $U$, and an open cover $\{U_i\}_{i\in I}$.

Identity axiom: $k_1,k_2\in\ker_{pre}\phi(U)$ agree when restricted to any  $U_i$. They are regarded as section in $\calf(U)$, hence $k_1=k_2$, because $\calf$ is a sheaf.

Gluability axiom: $\{k_i\in \ker_{pre}(U_i)\}_{i\in I}$ compatible when restricted to intersections $U_i\cap U_j$. Again there is one element $k\in\calf(U)$ to glue to because $\calf$ is a sheaf. It remains to check that $k\in\ker_{pre}(U)$. $\phi(U)(k)|_{U_i}=\phi(U_i)(k_i)=0$, then by $\calg$ being a sheaf, there is a unique section to glue to in $\calg(U)$, which is $0$, therefore $k\in\ker_{pre}(U)$.

As for the universal property, it suffices to check that $\ker_{pre}\phi$ has the universal property in the category of presheaves, because category of sheaf is a full subcategory of presheaves and we have verified that $\ker_{pre} \phi$ is a sheaf.
\begin{center}
\tiny
\begin{tikzcd}
\calc(V) \arrow[d, "\exists!", dashed,red] \arrow[rdd] \arrow[rrddd, "0"] &  & \calc(U) \arrow[ll,red] \arrow[d, "\exists!", dashed,red] \arrow[rdd] \arrow[rrddd, "0"] &  &  \\
\ker\phi(V) \arrow[rd, "\iota(V)", hook] \arrow[rrdd, "0"', bend right] &  & \ker\phi(U) \arrow[ll,red] \arrow[rd, "\iota(U)", hook] \arrow[rrdd, "0"', bend right] &  &  \\
 & \calf(V) \arrow[rd, "\phi(V)"] &  & \calf(U) \arrow[ll] \arrow[rd, "\phi(U)"] &  \\
 &  & \calg(V) &  & \calg(U) \arrow[ll]
\end{tikzcd}
\end{center}
This time the red square commutes because $\iota(V)$ is injective (injective morphism is always monomorphism in small category)
\end{proof}

\begin{exr}
Let $X$ be $\cplx$ with the classical topology, let $\underline{\intg}$ be the constant sheaf on $X$ associated to $\intg$, $\calo_X$ the sheaf of holomorphic functions, and $\calf$ the presheaf of functions admitting a holomorphic logarithm. Describe an exact sequence of presheaves on $X$:
$$0 \lrta \underline{\intg}     \lrta \calo_X   \lrta \calf  \lrta 0$$
where $\underline{\intg} \lrta \calo_X$ is the natural inclusion and $\calo_X \lrta \calf$ is given by $f  \mapsto exp(2\pi if)$. (Be sure to verify exactness.) Show that $\calf$ is not a sheaf.
\end{exr}
\begin{proof}
By~\ref{chap2:exr2.3.H}, we can check 
$$
0 \lrta \underline{\intg}(U)     \lrta \calo_X (U)  \lrta \calf (U) \lrta 0
$$
is exact for any open subset of $\cplx$.

$\lrta \underline{\intg}(U)\lrta \calo_X(U)$ is exact because it is just inclusion.

$\calo_X (U)  \lrta \calf (U) \lrta$ is exact: Choose $g\in \calf(U)$, then $\frac{1}{2\pi i}\log g=h\in\calo_X(U)$ , then $\exp(2\pi h)=g$. This map is thus surjective.

$\lrta \calo_X (U)  \lrta $ is exact. $\ker(f\mapsto \exp(2\pi if))=\im (\underline{\intg}(U)\lrta\calo_X(U))$. Notice here $\calf(U)$ is an Abelian group under multiplication while the other two is under addition. $p\in\ker(f\mapsto \exp(2\pi if))$ means in fact $\exp(2\pi i p)=1$.

$\calf$ is not a sheaf, because it violates the gluability axiom. 

Consider the annulus $U$ around the $0$, covered by open disks. In each disks, we consider the constant functions, we can choose branch cuts according to each disks such that each constant function can have holomorphic logarithms. But they can not glue to an element in $\calf(U)$


\end{proof}
\section{Properties determined at the level of stalks, and sheafification}
\begin{exr}\label{chap2exr2.4.A}
Prove that a section of a sheaf of sets is determined by its germs, i.e., the natural map

$$
\calf (U) \lrta  \prod_{p\in U}\calf_p$$
is injective.
\end{exr}
\begin{proof}
$f_1,f_2\in \calf(U)$, assume they agree when restricted to each points. In particular, for each point $p$, there are open neighborhood $U_p,V_p$ such that $(f_1|_{U_P};U_p)\sim (f_2|_{V_p};V_p)$, which means there is an open neighborhood $W_p$  such that $f_1|_{W_p}=f_2|_{W_p}$. We choose such $W_p$ for each point. $\{W_p\}_{p\in U}$ form an open cover of $U$ and $f_1, f_2$ agree when restricted to each $W_p$. By identity axiom, $f_1=f_2$. We don't need the gluability axiom, thus this claim is also true for separated sheaves.
\end{proof}

\begin{exr}
Show that $\supp(s)$ is a closed subset of X.
\end{exr}
\begin{proof}
For $p\notin \supp (s)$, $s_p=0\in\calf_p$. This means $[(s|_V;V)]=[(0;U)]$, which means there is an open neighborhood $W$ of $p$ such that $s|_W=0$. Then $W\in X-\supp(s)$. This has effectively proved the complement of $\supp (s)$ is  open.
\end{proof}

\begin{exr}\label{chap2:exr2_compatible germs_glue_to_section}
Prove that any choice of compatible germs for a sheaf of sets $\calf$ over $U$ is the image of a section of $\calf$ over $U$.
\end{exr}
\begin{proof}
Suppose $\prod_{p\in U}s_p$ consists of compatible germs. There is an open cover $\{U_i\}_{i\in I}$ and choice of sections $f_i\in\calf(U_i)$ such that $(f_i)_p=s_p$ for all $p\in U_i$, In particular $f_i|_{U_i\cap U_j}=f_j|_{U_i\cap U_j}$ because they agree when restricted to stalks in the intersection. Then by gluability, there is a section $f\in \calf(U)$ such that $f|_p=s_p$ 
\end{proof}

\begin{exr}\label{chap2:exr2.4.D}
If $\phi_1$ and $\phi_2$ are morphisms from a \textbf{presheaf} of sets $\calf$ to a \textbf{sheaf} of sets $\calg$ that induce the same maps on each stalk, show that $\phi_1=\phi_2$.
\end{exr}
\begin{proof}
We temporarily regard $\calg$ as a presheaf. Consider the diagram
\begin{center}
\begin{tikzcd}
\calf(U) \arrow[d, hook] \arrow[r, "\phi(U)"] & \calg(U) \arrow[d, hook] \\
\prod_{p\in U}\calf_p \arrow[r, "\prod \phi_p"'] & \prod_{p\in U}\calg_p
\end{tikzcd}
\end{center}
The diagram by two points: 

1. by the universal property of $\calf_p$ (colimits), each $\phi_p$ makes $\phi_p\circ [\calf(U)\lrta \calf_p]=[\calg(U)\lrta \calg_p]\circ \phi(U)$.

2. By universal property of $\prod_p\calg_p$(product), $\prod_p\phi_p$ makes the above diagram commutes.

We only need to check $\phi(U)$ is uniquely determined by $\phi_p$. Consider an element $f\in \calf(U)$

\underline{Claim}: the image $\prod_p\phi_p(f_p)$ of $\prod\phi_p$ consists of compatible germs. This is true because $\calg$ is a (pre)sheaf and the diagram commutes.

Then there is a unique section $g$ to glue to in $\calg(U)$, and by identity axiom $\phi(U)f=g$. Each $\phi(U)$ is uniquely determined by $\phi_p$ and hence the morphism of presheaves(from a presheaf to a sheaf) $\phi$ is uniquely determined by $\phi_p$ for all points. 

We used only identity axiom here, and this statement is also true when we loosen $\calg$ to be separated presheaves
\end{proof}
\begin{exr}\label{chap2exr2.4.E}
Show that a morphism of sheaves of sets is an isomorphism if and only if it induces an isomorphism of all stalks.
\end{exr}
\begin{proof}
The ``only if'' part is obvious because of the universal property of colimits.

Then we focus on the ``if'' direction.

Previous exercise~\ref{chap2:exr2.4.D} has told us that morphism from a presheaf to a sheaf is uniquely determined by the induced morphism on stalks. We still consider the following diagram but then the problem reduces to the case when $\phi_p$ are isomorphisms and $\calf$ is also a sheaf.
\begin{center}
\begin{tikzcd}
\calf(U) \arrow[d,hook] \arrow[r, "\phi(U)"] & \calg(U) \arrow[d, hook] \\
\prod_{p\in U}\calf_p \arrow[r, "\prod \phi_p"'] & \prod_{p\in U}\calg_p
\end{tikzcd}
\end{center}
Assume each $\phi_p$ is isomorphism, want to prove each $\phi(U)$ is isomorphism.

\underline{Want}: $\phi(U)$ is injective: $f_1,f_2\in\calf(U)$, $\phi(U)f_1=\phi(U)f_2$.

 $f_1,f_2$ restrict to $\prod_p f_{1,p}$, $\prod_p f_{2,p}$ and then map to $\prod_p\phi_p(f_{1,p})$, $\prod_p\phi_p(f_{2,p})$ respectively.

 $\phi(U)f_1=\phi(U)f_2$ also restricts to $\prod_p\phi_p(f_{1,p})$, $\prod_p\phi_p(f_{2,p})$ respectively. $\prod_p\phi_p(f_{1,p})=\prod_p\phi_p(f_{2,p})$, because $\calg(U)\lrta \prod_p\calg_p$ is injective.

Then, because each $\phi_p$ is isomorphism, we have $\prod_p f_{1,p}=\prod_p f_{2,p}$. Then $f_1=f_2$ because $\calf(U)\lrta \prod_p\calf_p$ is injective.

\underline{Want}: $\phi(U)$ is surjective: $g\in\calg(U)$, want to find a preimage $f\in\calf(U)$.

$g\mapsto\prod_pg_p\in\prod_p\calg_p$ consists of compatible germs. And because $\phi_p$ is isomorphism, there is $\prod_pf_p\in \prod_{p\in U}\calf_p$ that maps to $\prod_pg_p$.

\underline{Claim}: $\prod_pf_p$ consists of compatible germs.
$$
\prod_p f_p\mapsto \prod_p g_p
$$
$$
[(f'_{(p)}\in\calf(U_p);U_p)]\mapsto [(\phi(U_p)f'_{(p)};U_p)]
$$
We choose $\{U_p\}_{p\in U}$ a cover fine enough such that $(\phi(U_p)f'_{(p)};U_p)$ form a representative of compatible germs $g_p$. By definition of compatible germs, for every $q\in U_p$, 
$$
\phi(U_p)f'_{(p)}|_q=[(\phi(U_q)f'_{(q)};U_q)]=g_q
$$
which means there exists open $W_{p,q}\subset U_p\cap U_q$ such that
$$
\phi(W_{p,q})f'_{(p)}|_{W_{p,q}}=\phi(W_{p,q})f'_{(q)}|_{W_{p,q}}.
$$
But We already proved that each $\phi(U)$ is injective, we have
$$
f'_{(p)}|_{W_{p,q}}=f'_{(q)}|_{W_{p,q}}.
$$
In particular,
$$
f'_{(p)}|_q=f_q,
$$
which means our choice of representative $[(f'_{(p)}\in\calf(U_p);U_p)]$ satisfies the requirement of compatible germs.

Then by exercise~\ref{chap2:exr2_compatible germs_glue_to_section}, we know there is a section $f\in\calf(U)$ such that $f$ to restricts to $\prod_p f_p$ and such $\phi(U)f=g$ because they agree on stalks.


This exercise are restricted to the case we know the morphism between sheaves.  It does not say that if two sheaves have isomorphic stalks, then they are isomorphic.
\end{proof}

\begin{exr}\ 
\begin{enumerate}[label=(\alph*)]
\item
Show that Exercise~\ref{chap2exr2.4.A} is false for general presheaves.
\item Show that Exercise~\ref{chap2:exr2.4.D} is false for general presheaves.
\item Show that Exercise~\ref{chap2exr2.4.E} is false for general presheaves.
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item Consider a two point set with discrete topology $X=\{p,q\}$. Assume $\calf$ is the presheaf such that  $\calf(X)=\{a,b\}$ and $\calf_p=\{a\},\calf_q=\{b\}$, $\calf_p\times\calf_q=\{(a,b)\}$. There is no injection from $\{a,b\}$ to $\{(a,b)\}$.
\item Still consider a same topological space  $X=\{p,q\}$. $\calf(X)=\{a,b,c\}$ and $\calf_p=\{a\},\calf_q=\{a\}$ and $\calg(X)=\{a,b,c\}$. Consider $\phi_1(X)=id$ and $\phi_2(X)$ switch $b,c$ but fixes $a$. They would  agree on stalks. 
\item Still consider the topological space. $X=\{p,q\}$. $\calf(X)=\{a,b,c\}$ and $\calf_p=\{a\},\calf_q=\{a\}$ and $\calg(X)=\{a,b,c\}$. This time consider the map $\phi(X):a\mapsto a,b\mapsto b,c\mapsto b$, it induces isomorphisms on the stalks but itself is not an isomorphism.
\end{enumerate}
\end{proof}

\begin{exr}
Show that sheafification is unique up to unique isomorphism, assuming it exists. Show that if $\calf$ is a sheaf, then the sheafification is $id:\calf\lrta\calf$.
\end{exr}
\begin{proof}
By universal property, nothing special here.
\end{proof}

\begin{exr}
Assume for now that sheafification exists. Use the universal property to show that for any morphism of presheaves $\phi\calf\lrta\calg$ , we get a natural induced morphism of sheaves $\phi^{sh}:\calf^{sh}\lrta\calg^{sh}$. Show that sheafification is a functor from presheaves on $X$ to sheaves on $X$.
\end{exr}
\begin{proof}
There is a morphism of sheaves form $\calf$ to $\calg^{sh}$,
\begin{center}
\begin{tikzcd}
\calf \arrow[d, "\phi"] \arrow[r] & \calf^{sh} \arrow[d, dashed,"\exists!\phi^{sh}"'] \arrow[dd, dashed, bend left,"\exists!(\psi\circ \phi)^{sh}"] \\
\calg \arrow[r] \arrow[d, "\psi"] & \calg^{sh} \arrow[d, dashed,"\exists!\psi^{sh}"'] \\
\calh \arrow[r] & \calh^{sh}
\end{tikzcd}
\end{center} 
then there exists a unique morphism from $\calf^{sh}$ to $\calg^{sh}$ such that the diagram commutes. Sheafification forms a functor because the morphism from $\calf^{sh}$ to $\calh^{sh}$ is unique, hence $\psi^{sh}\circ \phi^{sh}=(\psi\circ \phi)^{sh}$. 
\end{proof}

\begin{exr}\label{chap2exr.sheafication_is_a_sheaf}
Show that $\calf^{sh}$ (using the tautological restriction maps) forms a sheaf.
\end{exr}
\begin{proof}
$$
\calf^{sh}(U)\subset\prod_{p\in U}\calf_p
$$
as the set of compatible germs. It is a presheaf and the restriction map is induced by
$$
\res_{U,V}:\prod_{p\in U}\calf_p\lrta\prod_{q\in V}\calf_q.
$$
Given an open covering $\{U_i\}_{i\in I}$ of $U$.

Identity axiom: $f_1=\prod_{p\in U}f_{1,p},f_2=\prod_{q\in U}f_{2,q}\in \calf^{sh}(U)$. They agree when restricted to each open. Tautologically, this means $f_{1,q}=f_{2,q}\forall q\in U_i$. It means $f_{1,p}=f_{2,p}\forall p\in U$. And by definition this means $f_1=f_2$.

Gluability axiom: $\{f_i\in \calf^{sh}(U_i)\}$ has the property $f_i|_{U_i\cap U_j}=f_j|_{U_j\cap U_i}$. We can choose $f_p\in\calf_p$ such that $f_p=f_{i,p}\forall p\in U_i\subset U$. These are compatible germs, because $f_{i,p}$ are compatible germs. We can find $s_i\in\calf(U_i)$ such that $s_{i,p}=f_{i,p}=f_p$. Then by definition $\prod_{p\in U}f_p\in \calf^{sh}$. We define the bunch of $\prod_{p\in U}f_p$ to be $f$ and one can check that $f|_{U_i}=f_i$.

In this proof $f_p$ means the $p$-entry of $f$ but not the germ of $f$ at $p$. (We will see they are equal afterwards)
\end{proof}

\begin{exr}
Describe a natural map of presheaves $sh:\calf\lrta \calf^{sh}$.
\end{exr}
\begin{proof}
Consider the natural map, (we extend to presheaves, where it is no longer injective but it is still natural.)
$$
\calf(U)\lrta \prod_{p\in U}\calf_p
$$
$$
\calf(U)\ni s\lrta \prod_{p\in U}[(s;U)]_p,
$$
where $[(s;U)]_p$ means taking the equivalent class of $(s;U)$ at point $p$.
The image of $\calf(U)$ consists of compatible germs, hence lies in $\calf^{sh}(U)$. 
$$
\calf(U)\overset{sh(U)}{\lrta}\calf^{sh}(U)\inj \prod_{p\in U}\calf_p,
$$
we define the map to be $sh(U)$. $sh(U)$ is a well-defined morphism of sets and it preserves the extra structures on the sets.
We just need to prove that $sh(U)$ indeed determines a morphism of presheaf, which reduce to checking the commutativity of the left square in the diagram
\begin{center}
\begin{tikzcd}
\calf(U) \arrow[d] \arrow[r, "sh(U)"] & \calf^{sh}(U) \arrow[d] \arrow[r, hook] & \prod_{p\in U}\calf_p \arrow[d] \\
\calf(V) \arrow[r, "sh(V)"] & \calf^{sh}(V) \arrow[r, hook] & \prod_{q\in V}\calf_q.
\end{tikzcd}
\end{center}
The restriction map $\calf^{sh}(U)\lrta\calf^{sh}(V)$ is just induced by the restriction map $\prod_{p\in U}\calf_p\lrta \prod_{q\in V}\calf_q$. Hence the left square commutes since the outer larger square commutes.
\end{proof}
\begin{exr}
Show that the map $sh$ satisfies the universal property of sheafification.
\end{exr}
\begin{proof}
The unique morphism $\psi$ from $\calf^{sh}$ to $\calg$ is induced at the level of stalks.
\begin{center}
\begin{tikzcd}
\calf \arrow[r, "sh"] \arrow[d, "\phi"'] & \calf^{sh} \arrow[r] \arrow[d, "sh(\phi)"] & \prod_p\calf_p \arrow[d, "\prod_p\phi_p"] \\
\calg \arrow[r, "sh"] & \calg^{sh} \arrow[r] & \prod_p\calg_p
\end{tikzcd}
\end{center}
$sh(\phi)$ is induced by $\prod_{p}\phi_p$. Uniquely determined by the morphism on stalks. We need to prove compatible germs are sent to compatible germs.
$$
\prod_p\phi_p:\prod_pf_p\mapsto\prod_pg_p
$$
Know:$f_p=[(\tilde{s}_p;V_p)]$ such that $\forall q\in V_p$ $f_q=\tilde{s}_p|_q$.

Then, $g_p=\phi_p f_p=[(\phi(V_p)\tilde{s}_p;V_p)]$ any $q\in V_p$ $g_q=\phi_qf_q=[(\phi(V_q)\tilde{s}_q;V_q)]_p=[(\phi(V_q\cap V_p)\tilde{s}_p;V_q\cap V_p)]_q=(\phi(V_p)\tilde{s}_p)_q$.
As a result, we know the above diagram commutes and it remains to check $\calg^{sh}=\calg$ if $\calg$ is a sheaf (We have to check it without the universal property).

Notice that $\calg_p=\calg^{sh}_p$ (by~\ref{chap2:exr_shfification_iso_stalks}), the $sh$ induce isomorphism on stalks, and by Exercise~\ref{chap2exr2.4.E}. $\calg\cong\calg^{sh}$ as sheaves.
\end{proof}

\begin{exr}
Show that the sheafification functor is left-adjoint to the forgetful functor from sheaves on $X$ to presheaves on $X$.
\end{exr}
\begin{proof}$\calc$ is a small category and we denote the category of presheaves of objects in $\calc$ on a topological space $X$ by $\calc^{pre}_X$ and the corresponding category of sheaves by $\calc_X$.
Denote the forgetful  functor $i:\calc_X\lrta \calc_X^{pre}$. Still, we look at the diagram.
\begin{center}
\begin{tikzcd}
\calf \arrow[r, "sh"] \arrow[d, "\phi"'] & \calf^{sh} \arrow[r] \arrow[d, "sh(\phi)"] & \prod_p\calf_p \arrow[d, "\prod_p\phi_p"] \\
\calg \arrow[r, "sh"] & \calg^{sh} \arrow[r] & \prod_p\calg_p
\end{tikzcd}
\end{center}
It says for each morphism of presheaves $\phi:\calf\lrta i(\calg)$, there is a unique morphism of sheaves $sh(\phi):\calf^{sh}\lrta\calg^{sh}$. And in return, for each morphism of sheaves $\psi:\calf^{sh}\lrta\calg$, there is a morphism $i(\psi)$ of presheaves. Hence they establish a bijection
$$
\hom_{\calc^{pr}_X}(\calf,i(\calg))\cong\hom_{\calc_X}(\calf^{sh},\calg)
$$
{\color{red} It is also true that we have the following isomorphism of presheaves of sets, where we have extended sheaf hom to presheaf hom.
$$
\phom(\calf,i(\calg))\cong\phom(\calf^{sh},\calg)
$$
}

\end{proof}

\begin{exr}\label{chap2:exr_shfification_iso_stalks}
Show $\calf\lrta \calf^{sh}$ induces an isomorphism of stalks.
\end{exr}
\begin{proof}
By definition,
$$
\calf^{sh}(U)=\left(\prod_{p\in U}f_p: \text{ for each $p\in U$, $\exists(\tilde{s}_p;V_p)$ representing $f_p$ s.t. $f_q=\tilde{s}_p|_q\forall q\in V_q$}\right)
$$
Consider $\bar{f}=\prod_{p\in U}f_p\in \calf^{sh}(U)$, for each $p\in U$, $\exists(\tilde{s}_p;V_p)$ representing $f_p$ s.t. $f_q=\tilde{s}_p|_q\forall q\in V_q$. And the $\res_{U,V_p}\bar{f}=\prod_{q\in V_p}f_q$. We can define the map
$$
\calf^{sh}_p\ni[(\bar{f}|_{V_p};V_p)]\longmapsto f_p\in \calf_p.
$$
Then map is well-defined. (It is just the projection of the product to $p$-entry.) It has a well-defined inverse $sh_p$:
$$
sh_p:f_p=[(\tilde{s}_p;V_p)]\longmapsto [(\prod_{q\in V_p}\tilde{s}_p|_q;V_p)]
$$
\end{proof}

\begin{exr}
Suppose $\phi: \calf\lrta\calg$ is a morphism of sheaves of sets on a topological space $X$. Show that the following are equivalent.
\begin{enumerate}[label=(\alph*)]
\item
 $\phi$ is a monomorphism in the category of sheaves.
\item $\phi$ is injective on the level of stalks: $\phi_p:\calf_p \lrta \calg_p$ is injective for all $p\in X$.
\item $\phi$ is injective on the level of open sets:$\phi(U):\calf(U)\lrta\calg(U)$  is injective for all open $U\subset X$.
\end{enumerate}
\end{exr}
\begin{proof}
$(a)\Lrta (c)$: Consider the indicator sheaf $\cali_U$. ($\cali_U(V)=\{*\},\forall V\subset U$ and $\cali_U(V)=\emptyset,\forall V\notsubset U$). Assume there are two morphisms of sheafs from $\cali_U$ to $\calf$.
\begin{center}
\begin{tikzcd}
\cali_U \arrow[r, "\psi_2"', bend right] \arrow[r, "\psi_1", bend left] & \calf \arrow[r, "\phi"] & \calg
\end{tikzcd}
\end{center}
$\phi\circ \psi_1=\phi\circ \psi_2$ $\Llrta$ $\phi(V)\circ\psi_1(V)=\phi(V)\circ \psi_2(V),\forall V\subset X$.

$\phi:\calf\lrta \calg$ being a monomorphism implies $\cali_U$ $\Llrta$ $\phi\circ \psi_1=\phi\circ \psi_2\Lrta \psi_1=\psi_2$.

$\Llrta$ $\phi(V)\circ\psi_1(V)=\phi(V)\circ \psi_2(V),\forall V\subset X\Lrta \psi_1(V)=\psi_2(V)\forall V\subset X$.

Notice that in the special case of indicator sheaf. $\psi_i(V)$ is empty function for $V\notsubset U$, then the condition $\phi(V)\circ\psi_1(V)=\phi(V)\circ \psi_2(V)$ is vacuous. The only efficient conditions are $\phi(V)\circ\psi_1(V)=\phi(V)\circ \psi_2(V),\forall V\subset U$, which is equivalent to $\phi(U)\circ\psi_1(U)=\phi(U)\circ \psi_2(U)$ alone, (by definition of morphism of presheaves).

Then the origin statement means
$\phi(U)\circ\psi_1(U)=\phi(U)\circ \psi_2(U)\Lrta \psi_1(U)=\psi_2(U)$. $\psi_i(U)$ are just an injection of $\{*\}$ into $\calf(U)$, which are uniquely determined by their images $f_i:=\psi_i(U)(*)$. This means in particular, $\phi(U)(f_1)=\phi(U)(f_2)\Lrta f_1=f_2$. $f_i$ are initially arbitrary, we know $\phi(U)$ is injective. And $U$ is arbitrarily chosen, we know $\phi(U)$ is injective for all open $U\subset X$.

(This part of proof is also true for presheaves)

$(c)\Lrta (b)$: True because \textbf{filtered colimits preserve finite limits}. Or we can prove it by hand:
$\phi_p(f_{p})=\phi_p(f'_p)$ 
$$
\Llrta \phi(V)f|_V=\phi(V)f'|_V,\exists V\ni p
$$
$$
\Llrta f|_V=f'|_V \exists V\ni p\text{ because $\phi(V)$ is injective}
$$
$$
\Lrta f_p=f_p'
$$

$(b)\Lrta (a)$. Assume $\phi\circ \psi_1=\phi\circ \psi_2$, and this implies $\phi_p\circ \psi_{1,p}=\phi_p\circ \psi_{2,p}$ and we know in the category of sets injection is monomorphism, $\Lrta \psi_{1,p}=\psi_{2,p}$ and then $\psi_{1}=\psi_{2}$ because morphism from a presheaves to a sheaf are determined at the level of stalks~\ref{chap2:exr2.4.D}. 
\end{proof}

\begin{remark}
In the category of presheaves, $(a)\Llrta (c)$ and $(c)\Lrta (b)$.

If furthermore, we restrict to separated presheaves $(a)\Llrta (c)\Llrta (b)$
\end{remark}

\begin{exr}\label{chap2:exr.surj_stalk_epimorphism_sheaf}
Continuing the notation of the previous exercise, show that the following are equivalent.
\begin{enumerate}[label=(\alph*)]
\item
 $\phi$ is an epimorphism in the category of sheaves.
\item $\phi$ is surjective at the level of stalks: $\phi_p$ is surjective for each $p\in X$.
\end{enumerate}
\end{exr}
\begin{proof}
$(a)\Lrta (b)$: Consider the skyscraper sheaf $i_{p,*}S$. 
\begin{center}
\begin{tikzcd}
\calf \arrow[r, "\phi"] & \calg \arrow[r, "\psi_1", bend left] \arrow[r, "\psi_2"', bend right] & i_{*,p}S
\end{tikzcd}
\end{center}
$\phi$ is epimorphism: $\psi_1\circ \phi=\psi_2\circ \phi\Lrta \psi_1=\psi_2$

Suppose $\phi_p$ is not surjective.  There is an element $k_p\in\calg_p$ such that $k_p\notin im(\phi_p)$. Then we can construct $\psi_{1,p}$ and $\psi_{2,p}$ such that they agrees on the image of $\phi_p$ but differs on $k_p$. Then we have
$$
\psi_{1,p}\phi_p=\psi_{2,p}\phi_p,\text{ but } \psi_{1,p}\neq \psi_{2,p}.
$$
Notice that for skyscraper sheaf $q\neq p$, $\psi_{i,q}$ is the unique morphism to final object $\{*\}$ and  hence $\psi_{1,q}\phi_q=\psi_{2,q}\phi_q\forall q\in X$.
Remember that morphism of sheaves are determined at the level of stalks. This means $\phi$ can not be a epimorphism in the category of sheaves.

$(b)\Lrta (a)$: Assume $ \psi_1\circ \phi= \psi_2\circ \phi$, and this implies $\psi_{1,p}\circ \phi_p= \psi_{2,p}\circ \phi_p,\forall p$ and we know in the category of sets surjection is monomorphism, $\Lrta \psi_{1,p}=\psi_{2,p}$ and then $\psi_{1}=\psi_{2}$ because morphism from a presheaves to a sheaf are determined at the level of stalks~\ref{chap2:exr2.4.D}. 
\end{proof}
\begin{remark}
In the category of presheaves of small category, being a epimorphism is equivalent to being surjective at open set level. See \href{https://stacks.math.columbia.edu/tag/00V5}{Stack Project Tag 00V5}.
\end{remark}
\begin{exr}
Show that $\exp: \calo_X \lrta \calo_X^*$ describes $\calo_X^*$ as a quotient sheaf of $\calo_X$. Find an open set on which this map is not surjective.
\end{exr}
\begin{proof}
Exercise~\ref{chap2:exr.surj_stalk_epimorphism_sheaf} says $\calo_X^*$ is a quotient sheaf of $\calo_X$ iff $\exp_p$ is surjective. Locally logarithm is well defined for nonzero holomorphic functions. 
$$
\log f(z)=\int_\gamma\frac{f'(z)}{f(z)} dz,
$$
where $\gamma$ is path from $0$ to $z$ and the definition is not dependent on the choice of paths. And we have 
$$
\exp(\log f)=f
$$
Hence $\exp_p$ is surjective. 

Again, we can not define logarithm on annulus $U$. There is no holomorphic function $f\in\calo_X(U)$ such that $\exp(f)=z\in\calo_X^{*}(U)$.
\end{proof}


\section{Recovering sheaves form a ``sheaf on a base''}
\begin{exr}
How can you recover a sheaf $\calf$ from this partial information on a base of topology?
$$
(\{\calf(B_i)\},\{\res_{B_i,B_j}:B_i\rta B_j\})
$$
\end{exr}
\begin{proof}
As defined in the below text, a sheaf on a base $\{B_j\}$ of $X$, is denoted by $\pzf$. And we can recover a sheaf on $X$ by 
$$
\calf(U):=\left\{\prod_{p\in U}(f_p\in\pzf_p):\forall p\in U,\exists B, p\in B\subset U,\text{ and } s\in \pzf(B), \text{ s.t.} s_q=f_q\forall q\in B\right\}
$$
We will prove $\calf$ is a sheaf and the proof is identical to~\ref{chap2exr.sheafication_is_a_sheaf}
$$
\calf(U)\subset\prod_{p\in U}\pzf_p
$$
as the set of compatible germs. It is a presheaf and the restriction map is induced by
$$
\res_{U,V}:\prod_{p\in U}\pzf_p\lrta\prod_{q\in V}\pzf_q.
$$
Given an open covering $\{U_i\}_{i\in I}$ of $U$.

Identity axiom: $f_1=\prod_{p\in U}f_{1,p},f_2=\prod_{q\in U}f_{2,q}\in \calf(U)$. They agree when restricted to each open. Tautologically, this means $f_{1,q}=f_{2,q}\forall q\in U_i$. It means $f_{1,p}=f_{2,p}\forall p\in U$. And by definition this means $f_1=f_2$.

Gluability axiom: $\{f_i\in \calf(U_i)\}$ has the property $f_i|_{U_i\cap U_j}=f_j|_{U_j\cap U_i}$. We can choose $f_p\in\calf_p$ such that $f_p=f_{i,p}\forall p\in U_i\subset U$. We can find, $p\in B_i\subset U_i$ and  $s_i\in\pzf(B_i)$ such that $s_{i,q}=f_{i,q}=f_q$. Then by definition $\prod_{p\in U}f_p\in \calf$. We define the bunch of $\prod_{p\in U}f_p$ to be $f$ and one can check that $f|_{U_i}=f_i$.

In this proof $f_p$ means the $p$-entry of $f$ but not the germ of $f$ at $p$. (We will see they are equal afterwards)
\end{proof}
\begin{exr}
Verify that $\calf(B) \lrta \pzf(B)$ is an isomorphism, likely by showing that it is injective and surjective (or else by describing the inverse map and verifying that it is indeed inverse).
\end{exr}
\begin{proof}
We can not use exercise~\ref{chap2exr2.4.E} because $\pzf$ is not a sheaf. But we can construct the inverse at the level of stalks.
$$
\calf(B)\lrta \prod_{p\in B}\calf_p
$$
is injective by~\ref{chap2exr2.4.A}. Similarly, 
$$
\pzf(B)\lrta \prod_{p\in B}\pzf_p
$$
is injective, because it has base identity axiom. Elements of $\calf(B)$ are determined by stalks, as are elements of $\pzf(B)$. 

We define the morphism directly
$$
ex:\pzf(B)\lrta \calf(B)
$$
$$
s\mapsto \prod_{p\in B}[(s;B)]_p,
$$
where $[(s;U)]_p$ means taking the equivalence class at point $p$, by definition $\prod_{p\in B}[(s;B)]_p\in \calf(B)$. 

It is injective because this map is identical to $\pzf(B)\lrta \prod_{p\in B}\pzf(B)$. 

It is surjective. Consider $f:=\prod_{p\in B}f_p\in \calf(B)$. By definition, for a point $p$, there exists $B_i$, $s_i\in \pzf(B_i)$ such that $s_i|_q=f_q\forall q\in B_i$. Such $\{B_i\}$ covers $B$ and by base gluability, $\exists s\in\pzf(B)$ such that $s|_{B_i}=s_i$. Then we have $\prod_{p\in B}f_p=\prod_{p\in U}[(s;U)]_p$. 
\end{proof}
\begin{remark}
Similar to sheafification, the sheaf $\calf$ corresponding to a sheaf on a base $\pzf$ is unique up to unique isomorphism in the sense $\calf$ is the initial object in category of sheaves that extend a sheaf on base $B_i$, $\pzf$.
\begin{center}
\begin{tikzcd}
\pzf \arrow[rd, "\gamma"'] \arrow[r, "ex"] & \calf \arrow[d, "\exists!", dashed] \\
 & \calg
\end{tikzcd}
\end{center}
where $\phi,\gamma$ are morphism of ``sheaf on a base $B_i$''(there is a forgetful functor from category of sheaves to category of sheaves on a base $B_i$)

Again, $ex$ is a functor and it is left-adjoint to the forget functor from category of sheaves to category of sheaves on a base $B_i$.

We also know $\calf_p\cong \pzf_p\forall p\in X$. The proof is identical to~\ref{chap2:exr_shfification_iso_stalks}.
\end{remark}

\begin{exr}\label{chap2exr:equivalence_of_sheaves_on_base_and_sheaves}
MORPHISMS OF SHEAVES CORRESPOND TO MORPHISMS OF SHEAVES ON A BASE. Suppose $\{B_i\}$ is a base for the topology of $X$. A morphism $\pzf\lrta\pzg$ of sheaves on the base is a collection of maps $\pzf(B_k) \lrta \pzg(B_k)$ such that the diagram commutes:
\begin{center}
\begin{tikzcd}
\pzf(B_i) \arrow[r] \arrow[d] & \pzg(B_j) \arrow[d] \\
\pzf(B_j) \arrow[r] & \pzg(B_j)
\end{tikzcd}
\end{center}
\begin{enumerate}[label=(\alph*)]
\item Verify that a morphism of sheaves is determined by the induced morphism of sheaves on the base
\item Show that a morphism of sheaves on the base gives a morphism of the induced sheaves
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item  There is a forgetful functor $\iota$ form  $\calc_{X}$ (category of $\calc$-sheaves on $X$) to $\calc_{X}^{B}$ (category of sheaves on a base $B_i$ of the topology of $X$).
Each morphism of sheaves $\psi:\calf\lrta\calg$ induces a morphism $\iota(\psi):\pzf\lrta \pzg$. Recall that $\pzf_p\cong\calf_p$ $\iota(\psi)$ induces same morphism on stalks as $\psi_p$. And a morphism of sheaves is determined by the morphism it induces on stalks~\ref{chap2:exr2.4.D}.
\item
The unique morphism $ex(\phi)$ from $\calf$ to $\calg$ is induced at the level of stalks.
\begin{center}
\begin{tikzcd}
\pzf \arrow[r, "ex"] \arrow[d, "\phi"'] & \calf \arrow[r,hook] \arrow[d, "ex(\phi)"] & \prod_p\pzf_p \arrow[d, "\prod_p\phi_p"] \\
\pzg \arrow[r, "ex"] & \calg \arrow[r,hook] & \prod_p\pzg_p
\end{tikzcd}
\end{center}
$ex(\phi)$ is induced by $\prod_{p}\phi_p$. Uniquely determined by the morphism on stalks. We need to prove compatible germs are sent to compatible germs.
$$
\prod_p\phi_p:\prod_pf_p\mapsto\prod_pg_p
$$
Know:$f_p=[(\tilde{s}_p;B_p)], \tilde{s}_p\in \pzf(B_p)$ such that $\forall q\in B_p$ $f_q=\tilde{s}_p|_q$.

Then, $g_p=\phi_p f_p=[(\phi(V_p)\tilde{s}_p;B_p)]$ any $q\in B_p$ $g_q=\phi_qf_q=[(\phi(B_q)\tilde{s}_q;B_q)]_p=[(\phi(B_q\cap B_p)\tilde{s}_p;B_q\cap B_p)]_q=(\phi(B_p)\tilde{s}_p)_q$.
As a result, we know the above diagram commutes.
\end{enumerate}
\end{proof}
\begin{remark}
The above exercise basically means $ex$ is left-adjoint to $\iota$
$$
\mor_{\calc_X^{B}}(\pzf,\iota(\calg))\cong\mor_{\calc_X}(ex(\pzf),\calg)
$$
\end{remark}

\begin{exr}\label{chap3exr:glue_sheaf}
Suppose $X = \cup_{i\in I}U_i$ is an open cover of $X$, and we have sheaves $\calf_i$ on $U_i$ along with isomorphisms $\phi_{ij}:\calf_i|_{U_i\cap U_j} \lrta \calf_j|_{U_i\cap U_j}$ (with $\phi_{ii}$ the identity) that agree on triple overlaps, i.e.,$ \phi_{jk} \circ \phi_{ij} = \phi_{ik}$ on $U_i\cap U_j \cap U_k$ (this is called the \textbf{cocycle condition}, for reasons we ignore). Show that these sheaves can be glued together into a sheaf $\calf$ on $X$ (unique up to unique isomorphism), such that $\calf_i \cong\calf|_{U_i}$ , and the isomorphisms over $U_i \cap U_j$ are the obvious ones. (Thus we can ``glue sheaves together'', using limited patching information.)
\end{exr}
\begin{proof}
Following the hint, we first construct a base of topology associated to the open cover $\{U_i\}_{i\in I}$.
$$
\omega:=\left\{(B_{i,\alpha})_{\alpha\in A_i,i\in I}\text{: open set in $U_i$}\right\}/\sim,
$$
where $B_{i,\alpha}\sim B_{j,\beta}$ iff $B_{i,\alpha}=B_{j,\beta}$ as open sets in $X$.

It is routine to verify it is really a base of topology. In addition each $\{B_{i,\alpha}\}_{\alpha\in A_i}$ forms a base of $U_i$.

Then we apply the forgetful functor $\iota:\calc_X\lrta\calc_{X}^B$ such that we get $\pzf_i$ as a sheaf on base $\{B_{i,\alpha}\}_{\alpha\in A_i}$ of $U_i$, with the induced restriction map from $\calf_i$.
 $$
\res^B_{B_{i,\alpha},B_{i,\beta}}:=\res^{(i)}_{B_{i,\alpha},B_{i,\beta}},
$$

\underline{Claim}: The ``Atlas'' of the data can form a sheaf on the base $\omega$, we denote it by $\pzf$. To be more concrete, we need to check the compatibility of these objects and morphisms.


\begin{center}
\tiny
\begin{tikzpicture}
\draw (2,2) circle (2cm);
\draw (3,2) circle (2cm);
\draw (2.5,1.43) circle (2cm);
\draw (2.5,1.7) circle (1.2cm);
\draw (2.5,1.7) circle (1cm);
\draw (2.5,1.7) circle (0.8cm);
\end{tikzpicture}
\end{center}

Assume $B_\gamma\subset B_\beta\subset B_\alpha\subset U_i\cap U_j\cap U_k$, we need to check the following diagram commutes (the horizontal arrows are restriction maps in $\pzf_i,\pzf_j,\pzf_k$).
\begin{center}
\tiny
\begin{tikzcd}
\pzf_i(B_\alpha) \arrow[dd, "\phi_{ik}(B_\alpha)"'] \arrow[rd, "\phi_{ij}(B_\alpha)"] \arrow[rr] \arrow[rrrr, bend left] &  & \pzf_i(B_\beta) \arrow[dd, "\phi_{ik}(B_\beta)"'] \arrow[rd, "\phi_{ij}(B_\beta)"] \arrow[rr] &  & \pzf_i(B_\gamma) \arrow[dd, "\phi_{ik}(B_\gamma)"'] \arrow[rd, "\phi_{ij}(B_\gamma)"] &  \\
 & \pzf_j(B_\alpha) \arrow[ld, "\phi_{jk}(B_\alpha)"] \arrow[rr] \arrow[rrrr, bend left] &  & \pzf_j(B_\beta) \arrow[ld, "\phi_{jk}(B_\beta)"] \arrow[rr] &  & \pzf_j(B_\gamma) \arrow[ld, "\phi_{jk}(B_\gamma)"] \\
\pzf_k(B_\alpha) \arrow[rr] \arrow[rrrr, bend right] &  & \pzf_k(B_\beta) \arrow[rr] &  & \pzf_k(B_\gamma) & 
\end{tikzcd}
\end{center}
It commutes because of the cocycle condition.

Then for each equivalence class $[B_{i,\alpha}]\in \omega$, we can define $\pzf([B_{i,\alpha}])=\pzf_i(B_{i,\alpha})/\sim$, where the equivalence relation is just the isomorphism induced by $\phi_{ij}$. The restriction maps are also induced. 



It obviously forms a presheaf on the base $\omega$.

Base identity axiom:
For open sets $B$ in the base, there is $U_i$ containing it. $B=\cup_{i,\alpha\in A'_i}[B_{i,\alpha}]$. The base identity axiom holds because $\pzf_i$ is a sheaf on base of $U_i$. 

Base gluability holds similarly.

By previous theorem and exercises, there is a unique sheaf $\calf$ extending the sheaf on base $\pzf$.

Then it remains to check
$\calf|_{U_i}\cong\calf_i$. Notice that $\calf|_{U_i}([B_{i,\alpha}])=\calf([B_{i,\alpha}])=\pzf_i(B_{i,\alpha})=\calf_i(B_{i,\alpha})$. Recall the forgetful functor $\iota$ from category of sheaves to category of sheaves on a base, $\iota(\calf|_{U_i})\cong \pzf_i=\iota(\calf_i)$. Then $\calf|_{U_i}\cong \calf_i$ due to  exercise~\ref{chap2exr:equivalence_of_sheaves_on_base_and_sheaves}. (category of sheafs on $X$ is equivalent to the category of sheaves on a base of $X$)
\end{proof}


\begin{exr}
Suppose a morphism of sheaves $\pzf\lrta\pzg$ on a base $\{B_i\}$ is surjective for all $B_i$ (i.e., $\pzf(B_i) \lrta \pzg(B_i)$ is surjective for all $i$). Show that the corresponding morphism of sheaves (not on the base) is surjective (or more precisely: an epimorphism).
\end{exr}
\begin{proof}
Recall~\ref{chap2:exr.surj_stalk_epimorphism_sheaf}, we can prove that surjective at the level of a base implies surjective at the level of stalks, which is true.
\end{proof}




\section{Sheaves of Abelian group, and $\calo_X$-modules, form Abelian categories}
\begin{exr}
Show that the stalk of the kernel is the kernel of the stalks: for all$ p \in  X$, there is a natural isomorphism
$$
(\ker(\calf\lrta \calg))_p\cong \ker (\calf_p\lrta \calg_p)
$$
\end{exr}
\begin{proof}
In exercise~\ref{chap2exr:kernel_sheaf}, we showed that the kernel of morphism of sheaves of abelian group is indeed a sheaf. The punchline is \textbf{filtered colimits preserve finite limits} （see \cite[p.~216]{mac1998categories}). There is no simple derivation using only the universal property. We have to prove it by hand. 

Consider the sheaf morphism $\phi:\calf\lrta \calg$.
Assume $[(f,U)]_p\in \ker(\calf\lrta\calg)_p$, where $(f,U)$ is a representative so that $f\in \ker (\phi(U))\in \calf(U)$.  Also $(\phi(U)f)_p=\phi_pf_p=0$, which means $f_p\in \ker(\phi_p)$. This gives a morphism from $\ker(\phi)_p$ to $\ker(\phi_p)$.

Then we construct the inverse. Given $f_p\in \ker(\phi_p)$, $\phi_pf_p=0$. Notice this means $\phi_p[(f';V)]=[(\phi(V)f';V)]=[(0;V)]$. Then there exists an open $W\ni p$ such that $\phi(W)f'|_W=0$. There is a representative of $f_p$ such that $f'|_W\in\ker \phi(W)$. This would mean $f'_p\in\ker(\phi)_p$, and we get a morphism from $\ker(\phi_p)$ to $\ker(\phi_p)$. Then it is routine to check that the two morphisms are mutually inverse.
\end{proof}

\begin{exr}
Show that the stalk of the cokernel is naturally isomorphic to the cokernel of the stalk.
\end{exr}
\begin{proof}
A cokernel in category of sheaves is the sheafification of cokernel in the category of presheaves. By Exercise~\ref{chap2:exr_shfification_iso_stalks}, sheafification induces isomorphism on stalks. then we only need to verify that the stalk of cokernel presheaves is isomorphic to cokernel of the stalks. But notice that 
$$
(\coker_{pre}(\phi))(U)=\coker(\phi(U)).
$$
Then because colimit commute with colimit we have 
$$
\coker_{pre}(\phi)_p\cong \coker(\phi_p).
$$
\end{proof}

\begin{exr}
Suppose $\phi:\calf\lrta \calg$ is a morphism of sheaves of Abelian groups. Show that the image sheaf $\im \phi$ is the sheafification of the image presheaf. Show that the stalk of the image is the image of the stalk.
\end{exr}
\begin{proof}
Recall the definition of images in Abelian category.

The image of a morphism $\phi : \calf \lrta \calg$ is defined as $\im(\phi) = \ker(\coker \phi)$ whenever it exists.

In the category of presheaves of Abelian groups, the kernel presheaves and cokernel presheaves do exists. And we already know $\coker(\phi)=\coker_{pre}(\phi)^{sh}$. We want to prove
$$
\ker_{pre}(\coker_{pre}(\phi))^{sh}=\ker(\coker_{pre}(\phi)^{sh})
$$
The punchline is \textbf{Sheafification commutes with finite limits} and ultimately, it relies on \textbf{filtered colimit commutes with finite limit}

\end{proof}
\begin{remark}
There is no direct simple minded proof based on abstract nonsense because it is not tautology. In the above exercise, sheafification commutes with finite limit in the category we care but its not tautology. If we want to have a try: We have two options, one is to check that $\ker_{pre}(\coker_{pre}(\phi))^{sh}$ satisfies the universal property of $\ker(\coker(\phi))$, another is to check that $\ker(\coker_{pre}(\phi)^{sh})$ satisfies the universal property of sheafification. For example, we try to prove that the sheafification has the universal property of being a kernel.
\begin{center}
\begin{tikzcd}
 & \calh \arrow[rrr, dashed] \arrow[ddd, dashed] &  &  & \calg \arrow[ddd, "\pi"'] \arrow[ldd, "\pi_{pre}"] \\
Z \arrow[rrrru] \arrow[rdd] \arrow[rr, dashed, "does\ not\ exists"'] &  & \calh_{pre} \arrow[ldd] \arrow[rru] \arrow[lu, "sh"] &  &  \\
 &  &  & \coker_{pre}(\phi) \arrow[rd, "sh"] &  \\
 & 0 \arrow[rrr] \arrow[rru] &  &  & \coker(\phi)
\end{tikzcd}
\end{center}
We denote $\calh_{pre}$ as $\ker(\coker_{pre}(\phi))$ and $\calh$ as its sheafification.
$Z\lrta \calg$ compose with $\calg\lrta \coker(\phi)$ to get $0$.
What we need is an arrow from $Z$ to $\calh$, but the universal property of sheafification at best can give us an arrow from $\calh$ to $Z$ and nothing else. We can neither construct the morphism from $Z$ to $\calh_{pre}$ because it would imply $\calh_{pre}=\calh$, which 
\end{remark}
\section{The inverse image sheaf}


%------------------------------------------------





%------------------------------------------------


%------------------------------------------------


%------------------------------------------------



%----------------------------------------------------------------------------------------
%	PART
%----------------------------------------------------------------------------------------

\part{Schemes}

%----------------------------------------------------------------------------------------
%	CHAPTER 3
%----------------------------------------------------------------------------------------
\include{Chaps/Chap3}


\chapterimage{structure_sheaf.jpg}
\chapter{The structure sheaf, definition of schemes}
\section{The structure sheaf of an affine scheme
}
\begin{definition}
Define $\calo_{\spec A}(D(f))$ to be localization of $A$ at the multiplicative set $S$, where
$$
S:=\{\text{All functions that do not vanish outside $V(f)$ (Do not vanish on $D(f))$}\}.
$$
(i.e., those $g\in A$ such that $V(g)\subset V(f)$ or equivalently $D(f)\subset D(g)$)
\end{definition}
In particular, $\calo_{\spec A}(\emptyset)=\{0\}$, where localize at the multiplicative set of functions $g$ such that $V(g)\subset \spec A$. This multiplicative set includes $0$, hence the localization is $\{0\}$ ring.

\begin{exr}\label{chap4exr:4.1.A}
Show that the natural map $A_f \lrta \calo_{\spec A}(D(f))$ is an isomorphism.
\end{exr}
\begin{proof}
In particular, $S_f:=\{1,f,f^2,...\}$ is a multiplicative subset of the multiplicative set $T$ in the definition of $\calo_{\spec A}(D(f))$, where 
$$
T:=\{\text{All functions that do not vanish outside $V(f)$ (Do not vanish on $D(f))$}\}.
$$
$S_f\subset T$.
There is a natural homomorphism 
$$
A\overset{S_f^{-1}}{\lrta}A_f\overset{\tilde{T}^{-1}}{\lrta}\calo_{\spec A}(D(f)), 
$$
where we have denoted the image of $T$ in $A_f$ by $\tilde{T}$. $g\in S\Llrta D(f)\subset D(g)$

$\Llrta T^{-1}g$ is invertible in $A_f$ by Exercise~\ref{chap3exr:inclusion_distinguished_open}.

$\Llrta$ $\tilde{T}\subseteq A_f^\times$

$\Llrta$ $\tilde{T}^{-1}$ is an isomorphism. $A_f\cong \calo_{\spec A}(D(f))$.
\end{proof}

\begin{exr}
Prove the base identity axiom for any distinguished open $D(f)$. 
\end{exr}
\begin{proof}
Consider the $D(f)=\cup_{i\in I}D(f_i)$. We already showed that $\spec A_f\cong D(f)$ as topological spaces~\ref{chap3exr:specA_f_and_specA/I}. If $D(f)=\cup_{i\in I}D(f_i)=\cup_{i\in I}D(f_i)\cap D(f)=\cup_{i\in I}D(f_if)$.

$D(f_i f)\cong\spec A_{ff_i}$ $A_{ff_i}$ is the localization of $A_f$ at the image of $f_i$. $D(f_i f)$ corresponds to the point $[\scq]\in \spec A_f$ such that $\scq\not\in \frac{f_i}{1}$.

Then $D(f)=\cup_{i\in I}D(f_i)\subset \spec A$ $\Llrta$ $\spec A_f=\cup_{i\in I} D(f_i/1)$

$\calo_{\spec A}(D(f))\cong A_f=\calo_{\spec A_f}(\spec A_f)$. The function restricts to $0$ on each $D(f_i)$ iff its restriction to $D(f_i/1)$ vanishes.

Then the problem reduces to the proved case $D(f)=\spec A$.
\end{proof}

\begin{exr}
Alter this argument appropriately to show base gluability for any distinguished open $D(f)$.
\end{exr}
\begin{proof}
Again, we regard $D(f)\cong \spec A_f$. 

Then $D(f)=\cup_{i\in I}D(f_i)\subset \spec A$ $\Llrta$ $\spec A_f=\cup_{i\in I} D(f_i/1)$.

$\calo_{\spec A}(D(f))\cong A_f=\calo_{\spec A_f}(\spec A_f)$.

The base gluability follows from the special case we have proved for $\spec A=D(f)$.
\end{proof}
\begin{exr}
Suppose $M$ is an $A$-module. Show that the following construction describes a sheaf $M$  on the distinguished base. Define $ \tilde{M}(D(f))$ to be the localization of $M$ at the multiplicative set of all functions that do not vanish outside of $ V(f)$. Define restriction maps $\res_{D(f),D(g)}$ in the analogous way to $\calo_{\spec A}$. Show that this defines a sheaf on the distinguished base, and hence a sheaf on $\spec A$. Then show that this is an $\calo_{\spec A}$-module.
\end{exr}
\begin{proof}
Define $\tilde{M}_{\spec A}(D(f))$ to be localization of $M$ at the multiplicative set $S$, where
$$
S:=\{\text{All functions that do not vanish outside $V(f)$ (Do not vanish on $D(f)$}\}.
$$

\underline{Claim}: $\tilde{M}(D(f))\cong M_f$.

 In particular, $S_f:=\{1,f,f^2,...\}$ is a multiplicative subset of the multiplicative set $S$.

 There is a natural homomorphism 
$$
M\overset{S_f^{-1}}{\lrta}M_f\overset{\tilde{S}^{-1}}{\lrta}\tilde{M}(D(f)), 
$$
where we have denoted the image of $S$ in $A_f$ by $\tilde{S}$. $g\in S\Llrta D(f)\subset D(g)$

$\Llrta T^{-1}g$ is invertible in $A_f$ by Exercise~\ref{chap3exr:inclusion_distinguished_open}.

$\Llrta$ $\tilde{S}\subseteq A_f^\times$

$\Llrta$ $\tilde{S}^{-1}$ is an isomorphism. $M_f\cong \tilde{M}(D(f))$.

Define the restriction map:
 $$
 \res_{D(f),D(g)}: \tilde{M}(D(f))\lrta \tilde{M}(D(g))
 $$
 it is the further localization of modules. The restriction does generate a presheaf on distinguished base because of the functorial property of localization.

 Base identity axiom: Consider the special case where $D(f)=\spec A$. Then $\spec A=\cup_{i\in I} D(f_i)$, there is a finite subcover, say $\cup_{i=1,...,n}D(f_i)=\spec A$, i.e., $(f_1,...,f_n)=A$.

 Suppose $m\in M=\tilde{M}(\spec A)$ such that $\res_{\spec A,D(f_i)} m=0$. Then $f_i^{l_i}m=0,\forall i$. We can choose $N\geq \max \{l_i\}$ such that $f_i^N m=0$. Also $(f_1^N,...,f_n^N)=A$ ($\cup_{i}D(f_i^N)=A$), then we know exist $r_i\in A$ s.t. $\sum_i r_i f_i^N=1$
 $$
 m=\sum_i(r_i f_i^N)m=0.
 $$ 
 The restriction map is injective, hence the base identity axiom holds for $D(f)=\spec A$.

 As for general $D(f)$, we can replace $A$ by $A_f$ so that $D(f)=\spec A_f$. The problem reduces to what we have proved.

 Base gluability axiom: Suppose again $\cup_{i\in I}D(f_i)=\spec A$. We assume in addition $I$ is a finite index set. We have elements
$$
\frac{m_i}{f_i^{l_i}}\in M_{f_i}=\tilde{M}(D(f_i))
$$
Letting $g_i=f_i^{l_i}$ to simplify the notation.
$m_i/g_i$ and $m_j/g_j$ agree  when restricted to intersection $D(f_i)\cap D(f_j)=D(g_i)\cap D(g_j)=D(g_ig_j)$, which means
$$
(g_ig_j)^{n_{ij}}(g_jm_i-g_im_j)=0\in A.
$$
By setting $N=\max\{n_{ij}\}$, we have
$$
(g_ig_j)^{N}(g_jm_i-g_im_j)=0\in A.
$$
Set $b_i=m_ig_i^N$ and $h_i=g_j^{N+1}$, the overlap condition simplifies to 
$$
b_ih_j-b_jh_i=0.
$$
Note that $\cup_i D(f_i)=\cup_i D(h_i)=\spec A$ implies that $\exists r_i\in A$ s.t., $\sum_i r_i h_i=1$. Define 
$$
r=\sum_i r_i b_i.
$$
Then 
$$
rh_j=\sum_i r_i b_i h_j=\sum_i r_i  h_i b_j=b_j
$$
$$
 g_j^{N}(g_jr-m_j)=g_j^{N}(f^{l_j}_jr-m_j)=0
$$
$$
\res_{\spec A,D(f_j)}r=\frac{r}{1}=\frac{m_j}{f_j^{l_j}}\in \tilde{M}(D(f_j)),\forall j
$$

For infinite index set $I$, choose a finite subset $\{1,..,n\}\subset I$ with $\spec A=\cup_i D(f_i)$, we can construct $r$ as above. We will show that for $z\in I-\{1,...,n\}$, $r$ restricts to desired element $m_z\in M_{f_z}$. Repeat the entire process for $\{1,...,n,z\}$ in place of $\{1,..,n\}$ and we get a $r'\in M$ which restricts to $m_i\in M_{f_i}$ for $i=1,..,n$. Then by identity axiom $r=r'$. Hence $r$ restricts to $m_z$ as desired.

We have checked the base gluability in the special case $D(f)=\spec A$. For general $D(f)$, we can replace $A$ with $A_f$ so that $D(f)=\spec A_f$ and the problem reduces to the special case we have solved above.

We have up to now proved that $\tilde{M}$ is a sheaf on the distinguished base. We can recover form it a sheaf on $\spec A$.

Observe that $\tilde{M}(D(f))=M_f$ which is automatically an $A_f$-module ($\calo_{\spec A}$-module). $\tilde{M}$ is $\calo_{\spec A}(D(f))$-module on the distinguished base. And this would also extend to a $\calo_{\spec A}$-module.
\end{proof}





\section{Visualizing schemes II: nilpotents}
\section{Definition of schemes
}

\begin{exr}
Describe a bijection between the isomorphisms $\spec A \lrta \spec A$ and the ring isomorphisms $A' \lrta A$. Hint: the hardest part is to show that if an isomorphism $\pi: \spec A\lrta \spec A'$ induces an isomorphism $\pi^\#:A' \lrta A$, which in turn induces an isomorphism $\rho: \spec A \lrta  \spec A'$, then $π\pi = \rho$. First show this on the level of points; this is (surprisingly) the trickiest part. Then show $\pi = \rho$ as maps of topological spaces. Finally, to show $\pi = \rho$ on the level of structure sheaves, use the distinguished base. Feel free to use insights from later in this section, but be careful to avoid circular arguments. Even struggling with this exercise and failing (until reading later sections) will be helpful.
\end{exr}

\begin{proof}
For simplicity, we replace the notion of topological space $\spec A,\spec A'$ by $X,X'$ respectively. 
Recall what it means by an isomorphism of schemes. An isomorphism of ringed space
$$
\pi:X\cong X' (\text{homeomorphism})
$$
and 
$$
\pi_*\calo_{X}\cong \calo_{X'} (\text{sheaf isomorphism}).
$$

$A=\calo_X(\pi^{-1}(X'))=\pi_*\calo_{X}(X')=\calo_{X'}(X')=A'$. It induces an morphism
$$
\pi^\#:A'\lrta A
$$
$$
\calo_{X'}(X')\ni a'\mapsto a'\in \pi_*\calo_X(X'). 
$$
This $\pi^\#$ in turn would induces a isomorphism $\rho:\spec A\lrta \spec A'$. 
$$
\rho:[\scp]\mapsto [(\pi^\#)^{-1}\scp]
$$

We need to show that $\pi=\rho$. 
$$
\pi:[\scp]\mapsto ?
$$
TO BE ADDED
\end{proof}

\begin{exr}\label{chap4exr:iso_scheme_sidginguished_open}
Suppose $f \in A$. Show that under the identification of $D(f)$ in $\spec A$ with $\spec A_f$, there is a natural isomorphism of ringed spaces $$(D(f), \calo_{\spec A}|_{D(f)}) \cong (\spec A_f, \calo_{\spec A_f} ).$$ Hint: notice that distinguished open sets of $\spec A_f$ are already distinguished open sets in $\spec A$.
\end{exr}
\begin{proof}
By exercise~\ref{chap3exr:specA_f_and_specA/I}, we know $\spec A_f\subset \spec A$ and the Zariski topology on $\spec A_f$ is the subspace topology induced by Zariski topology of $\spec A$. Hence $D(f)\cong \spec A_f$ as topological spaces. In particular, the distinguished base of $\spec A_f$ is induced by  distinguished base of $\spec A$ intersects with $D(f)$. Specifically,
$$
D(f)\cap D(f_i)\cong D(f_i/1)\subset \spec A_f
$$
 On the other hand, by exercise~\ref{chap4exr:4.1.A}, We know $A_f\cong \calo_{\spec A}(D(f)).$ We need to verify that $\calo_{\spec A_f}\cong \calo_{\spec A}|_{D(f)}$
 $$
 \begin{aligned}
 \calo_{\spec A}|_{D(f)}(D(f)\cap D(g))&=\calo_{\spec A}(D(f)\cap D(g))=\calo_{\spec A}(D(fg))\cong A_{fg}\\
 &=(A_f)_{g/1}=\calo_{\spec A_f}(D(g/1)).
 \end{aligned}
 $$
 Because $f$ is invertible in $A_f$. $D(g/f^n)=D(g/1)\cap D(1/f^n)=D(g/1)\cap D(1/1)=D(g/1)$. ( All distinguished open in $\spec A_f$ are of the form.) We know the two sheaves coincide on the distinguished base, which means they are isomorphic.
\end{proof}

\begin{exr}\label{chap4exr:open_subscheme}
If $X$ is a scheme, and $U$ is any open subset, prove that $(U, \calo_X|_U)$ is also a scheme.
\end{exr}
\begin{proof}
Recall the definition of scheme, at any point $x\in X$, there is an open neighborhood $V$ such that $(V,\calo_X|_V)$ is an affine scheme. Assume $(V,\calo_X|_V)\cong (\spec A,\calo_{\spec A})$. This isomorphism says the subset topology on $V$ coincides with the Zariski topology. $U\cap V$ is also an open set in $\spec A$. 

\underline{Claim}: There exists $x\in D(f)\subset U\cap V$ such that $(D(f),\calo_X|_{D(f)})$ is an affine scheme.

Such $D(f)$ always exists because distinguished open form a base of Zariski topology and $D(f)$ can be regarded as open set in $X$. On the other hand, $\calo_X|_{D(f)}=(\calo_X|_U)|_{D(f)}=(\calo_X|_V)|_{D(f)}\cong (\calo_{\spec A})|_{D(f)}\cong \calo_{\spec A_f}$. The last isomorphism by~\ref{chap4exr:iso_scheme_sidginguished_open} 

In $(U,\calo_X|_U)$, there is an open $U\supset D(f)\ni x$ such that
$$
(D(f),(\calo_{X}|_U)|_{D(f)})\cong (\spec A_f,\calo_{\spec A_f}).
$$
which means $(U,\calo_X|_U)$ is also a scheme.
\end{proof}

\begin{exr}
Show that if $X$ is a scheme, then the affine open sets form a base for the Zariski topology.
\end{exr}
\begin{proof}
$x\in X$, and $U$ is an open neighborhood of $x$. We need to verify that there is an affine open set $x\in W\subset U$. 

In Exercise~\ref{chap4exr:open_subscheme}, we proved that $(U,\calo_X(U))$ is open subscheme of $(X,\calo_X)$. Then for each $x\in U$, there is an affine open set $W$ \textbf{in $U$}. But the Zariski topology of $U$ is just the subset topology induced by the Zariski topology of $X$. We know $W$ is also a open set in $X$. Finally, $\calo_X|_W=(\calo_X|_U)|_W$. $W$ is an affine open in $X$ iff $W$ is an affine open in X.  
\end{proof}

\begin{exr}
The disjoint union of schemes is defined as you would expect: it is the disjoint union of sets, with the expected topology, with the expected sheaf.
\begin{enumerate}[label=(\alph*)]
\item Show that the disjoint union of a finite number of affine schemes is also an affine scheme.
\item (a first example of a non-affine scheme) Show that an infinite disjoint union of (nonempty) affine schemes is not an affine scheme. 
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item In Exercise~\ref{exr:nonconnected_scheme}, we see that for finite index set $I$:
$$
\coprod_{i\in I}\spec A_i\cong\spec \prod_i A_i
$$
and we need to describe the structure sheaf and verify that
$$
\calo_{\coprod_i \spec A_i}\cong \calo_{\spec \prod_i A_i}.
$$

 Consider the inclusion map $\iota_i: \spec A_i\inj \coprod_i\spec  A_i$
$$
\calo_{\coprod_i\spec  A_i}:= \prod_i (\iota_{i})_*\calo_{\spec A_i}
$$
For $U=\coprod_i U_i\subset \coprod \spec A_i$,
$$
\left(\prod_i (\iota_{i})_* \calo_{\spec A_i}\right)(U)=\prod_i \calo_{\spec A_i}(\iota_i^{-1}U)=\prod_{i}\calo_{\spec A_i}(U_i).
$$ 
On the other hand, the structure sheaf $\calo_{\spec \prod_i A_i}$ has the down to earth definition. We need to verify that they agree on $D(f)$ for $f=(f_1,..f_i,..)\in \prod_i A_i$. It is not hard to check 
$$
D(f)=\coprod_i D(f_i).
$$
$$
\calo_{\spec \prod_i A_i}(D(f))=(\prod_i A_i)_f\overset{?}{=}\prod_i (A_i)_{f_i}=\prod_i\calo_{\spec A_i}(D(f_i))=\calo_{\coprod_i \spec A_i}(D(f))
$$
The equality under question mark need to be checked. We just verify the universal property directly.
\begin{center}
\begin{tikzcd}
R &  &  \\
 & (A\times B)_{(f,g)} \arrow[lu, "\exists u", dashed] & B_g \arrow[l, "\beta"] \arrow[llu, "\phi"'] \\
 & A_f \arrow[u, "\alpha"'] \arrow[luu, "\psi"] & 
\end{tikzcd}
\end{center}
where 
$$
\alpha:\frac{a}{f^n}\mapsto \frac{(a,g^n)}{(f,g)^n}
$$
$$
\beta:\frac{b}{g^m}\mapsto \frac{(f^m,b)}{(f,g)^m}
$$
Given $\phi$ and $\psi$, there is a unique morphism $u$ to make diagram commute.
$$
u:\frac{(a,b)}{(f,g)^k}\mapsto \psi\left(\frac{a}{f^k}\right)\phi\left(\frac{b}{g^k}\right)
$$
\item Exercise~\ref{chap3exr:affine_scheme_quasicompact} shows that the topological space of affine scheme is quasicompact but the infinite disjoint union of affine scheme has infinite many connected components hence can't be quasicompact. For example the cover $\cup_i \spec A_i$ does not have finite subcover.
\end{enumerate}
\end{proof}

\begin{exr}
Show that the stalk of $\calo_{\spec A}$ at the point $[\scp]$ is the local ring $A_\scp$.
\end{exr}
\begin{proof}
$$
\calo_{\spec A,[\scp]}=\dirlim_{[\scp]\in U}\calo_{\spec A}(U)
$$
without loss of generality, we can assume each $U$ is a distinguished open $D(f)$ for some $f$. $D(f)\ni [\scp]$ iff $f\notin \scp$ or equivalently $f\in S_\scp=A-\scp$. 

\underline{Claim}: 
$$
\calo_{\spec A,[\scp]}=\dirlim_{[\scp]\in D(f)}\calo_{\spec A}(D(f))=A_\scp,
$$
The index category is now a subset of distinguished base which contain $[\scp]$ and the morphism are inclusions.
\begin{center}
\begin{tikzcd}
A_\scp \arrow[rrr, dashed] &  &  & R \\
 &  &  &  \\
 & \calo_{\spec A}(D(f))=A_f \arrow[r] \arrow[rruu, "\phi_f"] \arrow[luu, "l_f"] & \calo_{\spec A}(D(g))=A_g \arrow[ruu, "\phi_g"] \arrow[lluu, "l_g"'] & 
\end{tikzcd}
\end{center}
If there is a ring $R$ with all morphisms from $A_f$ to it. The image of all $f\in S_\scp$ is invertible in $R$, equivalently, $S_{\scp}\subset R^\times$. Then there is a morphism from $A$ to $R$ by universal property of localization.

Equivalently we have general formula
$$
S^{-1}M=\dirlim_{f\in S}M_f.
$$
The index category is now the partially ordered set $S$, with $f\geq g$ iff $f\in \sqrt{(g)}$, see~\ref{chap3exr:inclusion_distinguished_open} 
\end{proof}
\begin{exr}\label{chap3exr:locally_ringed_space_function_value}\ 
\begin{enumerate}[label=(\alph*)]
\item If $f$ is a function on a locally ringed space $X$, show that the subset of $X$ where $f$ vanishes is closed. (Hint: show that if $f$ is a function on a ringed space $X$, show that the subset of $X$ where the germ of $f$ is invertible is open.)
\item Show that if $f$ is a function on a locally ringed space that vanishes nowhere, then $f$ is invertible.
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item $f$ is a function on a ringed space $X$ ($f\in\Gamma(X,\calo_X)$). A germ of $f$ at $p$ is denoted $f_p$, assume $f_p$ is invertible. $\exists g_p\in\calo_{X,p}$ such that $f_pg_p=1\in\calo_{X,p}$, which means $\exists U\ni p$ open such that $(f|_U)(g|_U)=1\in \calo_X(U)$. Then all $f_q$ is invertible for $q\in U$. This means the set in $X$ where germ of $f$ is invertible is open.  In the case of locally ringed space, the complement of subset where $f$ vanishes is just the set where germ of $f$ is invertible. (We don't have good notion of function vanishing on general ringed space.)
\item $f$ vanishes nowhere, then the germ of $f$ is invertible everywhere. Notice that $\{f_p\}_{p\in X}$ consists of compatible germs, then their inverse $\{g_p\}_{p\in X}$ also consists of compatible germs. Check it by hand: for each $g_p,p\in X$, there is an open $V_p\subset X$, and  $\tilde{g}_p\in \calo_X(V_p)$ such that $g_q=\tilde{g}_p|q$. We can just choose $\tilde{g}_p$ to be the representative in the equality $f_pg_p=1$. And by Exercise~\ref{chap2:exr2_compatible germs_glue_to_section}. There is a unique global section to glue to and we name it $g\in\calo_X(X)$. Finally, $fg=1$, because $f_pg_p=1_p=1,\forall p\in X$ by~\ref{chap2exr2.4.A}.
\end{enumerate}
\end{proof}
\section{Three examples}
\begin{exr}
Show that you can glue an arbitrary collection of schemes together. Suppose we are given:
\begin{itemize}
\item  schemes $X_i$ (as $i$ runs over some index set $I$, not necessarily finite), 
\item open subschemes $X_{ij} \subset  X_i$ with $X_{ii} = X_i$,
\item isomorphisms $f_{ij} : X_{ij} \lrta X_{ji}$ with $f_{ii}$ the identity
such that
\item  (the cocycle condition) the isomorphisms ``agree on triple intersections'', i.e., $f_{ik}|_{X_{ij}\cap X_{ik}} = f_{jk}|_{X_{ji}\cap X_{jk}} \circ  f_{ij}|_{X_{ij}\cap X_{ik}}$ (so implicitly, to make sense of the right side, $f_{ij}(X_{ik} \cap X_{ij}) \subset  X_{jk}$).
\end{itemize}
(The cocycle condition ensures that $f_{ij}$ and $f_{ji}$ are inverses. In fact, the hypothesis that $f_{ii}$ is the identity also follows from the cocycle condition.) Show that there is a unique scheme $X$ (up to unique isomorphism) along with open subsets isomorphic to the $X_i$ respecting this gluing data in the obvious sense. (Hint: what is $X$ as a set? What is the topology on this set? In terms of your description of the open sets of $X$, what are the sections of this sheaf over each open set?)
\end{exr}
\begin{proof}
Confer Exercise~\ref{chap3exr:glue_sheaf} so see that we can glue together sheaves on an open cover. The part of structure sheaf on $X$ is constructed similarly. 

The isomorphism of schemes $f_{ij}:X_{ij}\lrta X_{ji}$ can be considered as a homeomorphism  of  topological spaces $f_{ij}:X_{ij}\lrta X_{ji}$ (abuse notion here) together with an isomorphism of sheaves: $h_{ij}:\calo_{X_j}|_{X_{ji}}\lrta (f_{ij})_*\calo_{X_i}|_{X_{ij}}$.

The cocycle condition on topological space still means
$$f_{ik}|_{X_{ij}\cap X_{ik}} = f_{jk}|_{X_{ji}\cap X_{jk}} \circ  f_{ij}|_{X_{ij}\cap X_{ik}}$$
and for structure sheaves it means
$$(f_{ik}^{-1})_*h_{ik}|_{X_{ij}\cap X_{ik}} = (f_{jk}^{-1})_*h_{jk}|_{X_{ji}\cap X_{jk}} \circ (f_{ij}^{-1})_* h_{ij}|_{X_{ij}\cap X_{ik}}$$

For the topological space
$$
X=\coprod_i X_i/\sim,
$$
where $x\sim y$ iff $x\in X_{ij}, y\in X_{ji}$ and $f_{ij}x=y$ for some $i,j$. $X$ is endowed with quotient topology. Denote the quotient map $\pi:\coprod_i X_i\lrta X$
$$
\tau_X=\{U\subset X:\pi^{-1}(U)\in\tau_{\coprod_i X_i}\}.
$$
Then $X_i\overset{\iota_i}{\inj} \coprod_j X_j\overset{\pi}{\lrta}X$ and we denote the composition $g_i:=\pi\circ \iota_i$. $U_i:=g_i(X_i)$ form an open cover of the topological space $X$. $g_i$ is a homeomorphism. The structure sheaf $\calo_{X_i}$ push forward to $\calo_{U_i}:=g_{i*}\calo_{X_i}$ on $U_i$.

Given $x\in X_{ij}$, $g_i(x)=g_j(f_{ij}x)$ because $x\sim f_{ij}x$. Then we can identify $g_i(X_{ij})$ and $g_j(X_{ji})$ as $U_{ij}=U_i\cap U_j$. The cocycle condition of topological homeomorphisms means simply that we can identify $g_{i}(X_{ij}\cap X_{ik})=g_{j}(X_{ji}\cap X_{jk})=g_{k}(X_{kj}\cap X_{ki})$ as $U_{ijk}=U_i\cap U_j\cap U_k$. The sheave isomorphism $h_{ij}$ induces isomorphism of sheaves on $U_{ij}$:
\begin{center}
\begin{tikzcd}
\calo_{X_j}|_{X_{ji}} \arrow[rr, "h_{ij}"] \arrow[dd, "(g_{j})_*"'] &  & (f_{ij})_*\calo_{X_i}|_{X_{ij}} \arrow[dd, "(g_j)_*"] \\
 &  &  \\
(g_j)_*\calo_{X_j}|_{X_{ji}}=\calo_{U_j}|_{U_{ij}} \arrow[rr, "\phi_{ji}"] &  &\calo_{U_i}|_{U_{ij}}=(g_{j})_*(f_{ij})_*\calo_{X_i}|_{X_{ij}},
\end{tikzcd}
\end{center}
where we have used $g_j\circ f_{ij}=g_i$. Also notice that $g_i$ are isomorphism on $X_i$. 
$$
\begin{aligned}
\phi_{ji}&=(g_j)_*h_{ij} (g_j^{-1})_*\\
&= (g_j)_* (f_{ij})_* (f_{ij}^{-1})_*h_{ij} (g_j^{-1})_*\\
&=(g_i)_* (f_{ij}^{-1})_*h_{ij} (g_j^{-1})_*\\
\end{aligned}
$$
Then the cocycle relation translate to the standard cocycle relation in~\ref{chap3exr:glue_sheaf}, $ \phi_{jk} \circ \phi_{ij} = \phi_{ik}$ on $U_i\cap U_j \cap U_k$. Then we can glue up and get a sheaf $\calo_X$ such that $\calo_X|_{U_i}=\calo_{U_i}=g_{i*}\calo_{U_i}$
\end{proof}

\begin{exr}
Show that affine line with doubled origin is not affine scheme.
\end{exr}
\begin{proof}
Denote the affine line with doubled origin by $X$. $X$ is constructed by gluing $X_1:=\affn^1_k=\spec k[u]$ and $X_2:=\affn^1_k=\spec k[t]$ along $X_{12}=\spec [u,1/u]$ and $X_{21}=\spec [t,1/t]$. They glue up by isomorphism $X_{12}\cong X_{21}$, $u\llrta t$. Denote the quotient map $\pi:X_1\coprod X_2\lrta X$.

For an open set $W\subset X$
$$
\calo_X(W)=\calo_{X_1}(\pi^{-1}(W)\cap X_1)\times_{\calo_{X_1}(\pi^{-1}(W)\cap X_1\cap X_2)=\calo_{X_2}(\pi^{-1}(W)\cap X_1\cap X_2)}\calo_{X_2}(\pi^{-1}(W)\cap X_2),
$$
where the notion means fibered product.

We have 
$$
\begin{aligned}
\Gamma(X,\calo_X)&=\calo_{X_1}(\pi^{-1}(X)\cap X_1)\times_{\calo_{X_1}(\pi^{-1}(X)\cap X_{12})=\calo_{X_2}(\pi^{-1}(X)\cap X_{21})}\calo_{X_2}(X\cap X_2)\\
&=\calo_{X_1}(X_1)\times_{\calo_{X_1}(X_{12})=\calo_{X_2}(X_{21})}\calo_{X_2}(X_2)\\
&=k[u]\times_{k[u,1/u]=k[t,1/t]}k[t]\\
&=k[t]
\end{aligned}
$$
The structure sheaf of $X$ is identical as a single affine line. Then $X$ can not be affine because, $X\not\cong \spec \calo_X(X)$.
\end{proof}
\begin{exr}\label{chap4exr:affine_doubled_origin}
Do the same construction with $\affn^1$ replaced by $\affn^2$. You will have defined the affine plane with doubled origin. Describe two affine open subsets of this scheme whose intersection is not an affine open subset.
\end{exr}
\begin{proof}
$X$ is constructed by gluing $X_1=\affn^2=\spec k[s,t]$ and $X_2=\affn^2=\spec k[u,v]$ along
$$
X_{12}=D(s)\cup D(t)=\spec k[s,t,1/s]\cup \spec k[s,t,1/t]
$$ and  
$$
X_{21}=D(u)\cup D(v)=\spec k[u,v,1/u]\cup \spec k[u,v,1/v]
$$ via $s\llrta u, t\llrta v$. (or we can exchange the role of $s,t$, which will not cause any change)
$$
\calo_X(W)=\calo_{X_1}(\pi^{-1}(W)\cap X_1)\times_{\calo_{X_1}(\pi^{-1}(W)\cap X_1\cap X_2)=\calo_{X_2}(\pi^{-1}(W)\cap X_1\cap X_2)}\calo_{X_2}(\pi^{-1}(W)\cap X_2),
$$
In particular,
$$
\begin{aligned}
\Gamma(X,\calo_X)&=\calo_{X_1}(\pi^{-1}(X)\cap X_1)\times_{\calo_{X_1}(\pi^{-1}(X)\cap X_{12})=\calo_{X_2}(\pi^{-1}(X)\cap X_{21})}\calo_{X_2}(X\cap X_2)\\
&=\calo_{X_1}(X_1)\times_{\calo_{X_1}(X_{12})=\calo_{X_2}(X_{21})}\calo_{X_2}(X_2)\\
&=k[s,t]\times_{k[s,t]=k[u,v]}k[u,v]\\
&=k[s,t],
\end{aligned}
$$
where we know $\calo_{X_1)}=k[s,t]$ from example 4.4.1

$U_1=\pi(X_1)$ and $U_2=\pi(X_2)$ are affine open but their intersection $U_{12}=\pi(X_{12})=\pi(X_{21})$ is the affine plain without origin, which is not affine.
\end{proof}

\begin{exr}
Check that the gluing of projective space $\proj^n$ satisfies the cocycle relation, as painlessly as possible. 
\end{exr}
\begin{proof}
The ``Charts'' of projective space
$$
X_i:=\spec k[x_{0/i},x_{1/i},...,x_{n/i}]/(x_{i/i}-1),
$$
$$
X_{ij}:=D(x_{j/i})\subset X_i
$$
$$
X_{ij}\cap X_{ik}=D(x_{j/i})\cap D(X_{k/i})=D(x_{j/i}x_{k/i})\subset X_i
$$
and we have the isomorphism
$$
\begin{aligned}
f_{ij}:X_{ij}&\lrta X_{ji}\\
x_{k/i}&\longmapsto x_{k/j}/x_{k/i}.
\end{aligned}
$$
The cocycle relation on triple intersection should be
$$
f_{ik}|_{X_{ij}\cap X_{ik}} = f_{jk}|_{X_{ji}\cap X_{jk}} \circ  f_{ij}|_{X_{ij}\cap X_{ik}}.
$$
Notice that 
$$
X_{ij}=\spec k[x_{0/i},x_{1/i},...,x_{n/i}, x_{j/i}^{-1}]/(x_{i/i}-1),
$$
and
$$
X_{ij}\cap X_{ik}=\spec k[x_{0/i},x_{1/i},...,x_{n/i}, x_{j/i}^{-1},x_{k/i}^{-1}]/(x_{i/i}-1)
$$
$$
\begin{aligned}
&f_{jk}\circ f_{ij}: \\
&\spec k[x_{0/i},x_{1/i},...,x_{n/i}, x_{j/i}^{-1},x_{k/i}^{-1}]/(x_{i/i}-1)\lrta \spec k[x_{0/k},x_{1/k},...,x_{n/k}, x_{j/k}^{-1},x_{i/k}^{-1}]/(x_{k/k}-1)\\
& f_{jk}\circ f_{ij}:x_{l/i}\mapsto x_{l/j}/_{i/j}\mapsto (x_{l/k}/x_{j/k})/(x_{i/k}/x_{j/k})=x_{l/k}/x_{i/k}=f_{ik}(x_{l/i})
\end{aligned}
$$
\end{proof}

\begin{exr}
Show that the only functions on $\proj^n_k$ are constants ($\Gamma(\proj^n_k,\calo)\cong k$), and hence that $\proj^n_k$ is not affine if $n > 0$.
\end{exr}
\begin{proof}
Consider two open sets $X_i$ and $X_j$ defined in last exercise. Also, we denote $\proj^n_k$ by $X$.
$$
\Gamma(X_i\cup X_j,\calo_X)=\calo_{X_i}(X_{i})\times_{\calo_X(X_{ij})=\calo_X(X_{ji})}\calo_{X_{j}}(X_{j})
$$
polynomials in $\calo_{X_i}(X_i)$ and $\calo_{X_j}(X_j)$ that agree on the intersection $X_{ij}$. 
$$
f\in k[x_{0/i},x_{1/i},...,x_{n/i}]/(x_{i/i}-1)
$$
and
$$
g\in k[x_{0/j},x_{1/j},...,x_{n/j}]/(x_{j/j}-1)
$$
agree when restricted to $X_{ij}$.
$$
f(x_{0/i},x_{1/i},...,x_{n/i})=g\left(\frac{x_{0/i}}{x_{j/i}},\frac{x_{1/j}}{x_{j/i}},...,\frac{x_{n/j}}{x_{j/i}}\right)\in \spec k[x_{0/i},x_{1/i},...,x_{n/i}, x_{j/i}^{-1}]/(x_{i/i}-1)
$$
Then $x_{j/i}$ can not appear in $f$.
$h\in\calo_X(X)$ can restrict to any pair of open sets and agree on the intersection, then must be constant. This solution is intuitive, but  a more rigorous statement is: Given $\omega$ be the base of topology by choosing the open sets contained in a single $X_i$.
$$
\calo_X(U)=\invlim_{B\in\omega, B\subset U} \calo_X(B)
$$
and then check the universal property of $k$.

\end{proof}

\begin{exr}
Show that if $k$ is algebraically closed, the closed points of $\proj^n_k$ may be interpreted in the traditional way: the points are of the form $[a_0,...,a_n]$, where the $a_i$ are not all zero, and $[a_0,...,a_n]$ is identified with $[\lambda a_0,...,\lambda a_n]$ where $\lambda \in k^\times$.
\end{exr}
\begin{proof}
The closed point in $X:=\proj^n_k$ is a point $p\in X$ which is also closed subset of $X$. $X$ is a scheme, for each $x$, we can find an open set $X_i\ni x$ and $X_i,\calo_X|_{X_i}$ is an affine scheme. We can choose $X_i$ as in the former exercise. The closed point in $X$ is also a closed point in $X_i$. By Nullstellensatz, the closed point (maximal ideal) in $k[t_1,...,t_n]$ is exactly of the form $(t_1-a_1,...,t_n-a_n)$, where $k$ is algebraically closed. In this case
$$
\scm=(x_{0/i}-a_0,..,x_{i-1/i}-a_{i-1},x_{i/i}-a_i,x_{i+1/i}-a_{i+1},...,x_{n/i}-a_{n}). \ \ x_{i/i}=a_i=1
$$ 
The same closed point can be identified in another open set $X_j$ as
$$
(x_{0/j}-b_0,..,x_{j-1/j}-b_{j-1},x_{j/j}-b_j,x_{j+1/j}-a_{j+1},...,x_{n/j}-a_{n}),  \ \ x_{j/j}=b_i=1,
$$
$(b_0,..,b_j=1,..,b_n)=\frac{1}{a_j}(a_0,...,a_i=1,...,a_n)$. This justifies our identification of closed point as $[a_0,...,a_n]$
\end{proof}


\section{Projective schemes, and the \textit{Proj} construction
}
\begin{exr}
Consider $\proj^2_k$, with projective coordinates $x_0, x_1$, and $x_2$. (The terminology ``projective coordinate'' will not be formally defined until \S 4.5.8, but you should be able to solve this problem anyway.) Think through how to define a scheme that should be interpreted as $x^2_0 + x^2_1 - x^2_2 = 0$ ``in $\proj^2_k$ ''.
\end{exr}
\begin{proof}
In the open set $X_2$, there is an affine scheme cut out by $x_{0/2}^2+x_{{}1/2}^2-1=0$. It is a closed subset in $\spec k[x_{0/2},x_{1/2}]$ and can be identified as $\spec k[x_{0/2},x_{1/2}]/(x_{0/2}^2+x_{1/2}^2-1)$ as shown in~\ref{chap3exr:specA_f_and_specA/I}.

In all three open charts, we can find
$$
V_0:=\spec k[x_{1/0},x_{2/0}]/(1+x_{1/0}^2-x_{2/0}^2),
$$
$$
V_1:=\spec k[x_{0/1},x_{2/1}]/(x_{0/1}^2+1-x_{2/1}^2),
$$
$$
V_2:=\spec k[x_{0/2},x_{1/2}]/(x_{0/2}^2+x_{1/2}^2-1)
$$
$$
V_{01}=\spec k[x_{1/0},x_{2/0},x_{1/0}^{-1}]/(1+x_{1/0}^2-x_{2/0}^2)
$$
$$
V_{10}=\spec k[x_{0/1},x_{2/1},x_{0/1}^{-1}]/(x_{0/1}^2+1-x_{2/1}^2)
$$
and so on.
We find that the gluing isomorphisms of $X_i$ induces well behaved isomorphisms on $V_i$
$$
g_{01}:V_{01}\lrta V_{10}
$$
induced by 
$$
f_{10}:x_{1/0}\mapsto x_{1/1}/x_{0/1}, x_{2/0}\mapsto x_{2/1}/x_{0/1},
$$
where $x_{i/i}$ are dummy variables that equals $1$. $f_{01}$ induces well-defined morphism of the quotient rings because 
$$
\begin{aligned}
f_{01}:(1+x_{1/0}^2-x_{2/0}^2)\lrta &(1+(x_{1/1}/x_{0/1})^2+(x_{2/1}/x_{0/1})^2)\\
&=(1/x_{0/1})^2(x_{0/1}^2+1-x_{2/1}^2)\\
&=(x_{0/1}^2+1-x_{2/1}^2)
\end{aligned}
$$
$g_{ij}$ also satisfies the cocycle relation because $f_{ij}$ does.

Hence $V_i$ glue up to a closed subscheme in $\proj^2_k$

\end{proof}

\begin{exr}
More generally, consider $\proj^n_A$, with projective coordinates $x_0,..., x_n$. Given a collection of homogeneous polynomials $f_i \in A[x_0,...,x_n]$, make sense of the scheme ``cut out in $\proj^n_A$ by the $f_i$.''
\end{exr}
\begin{proof}
Given a homogeneous polynomial $f_i\in A[x_0,...,x_n]$, we can consider map $x_j\rta x_{j/j}=1$ and $x_{k}\rta x_{k/j}$ so that we get a polynomial in $F_{i,(j)}\in A[x_{i/j},...]$ which no longer homogeneous. Then we can construct the closed subset in affine chart $X_i$ 
$$
U_{i,(j)}:=\spec A[x_{1/j},...,x_{n/j}]/(x_{j/j}-1, F_{i,(j)})
$$
and
$$
U_{i,(j);k,(l)}=\spec A[x_{1/j},...,x_{n/j},x_{l/j}^{-1}]/(x_{j/j}-1, F_{i,(j)}, F_{k,(j)})
$$
$$
U_{k,(l);i,(j)}=\spec A[x_{1/l},...,x_{n/l},x_{j/l}^{-1}]/(x_{l/l}-1, F_{i,(l)}, F_{k,(l)}).
$$
Again the gluing map of $X_i$ 
$$
h_{jl}:x_{m/j}\mapsto x_{m/l}/x_{j/l}
$$
would induce well-defined morphism on the quotient ring. Because 
$$
h_{jl}:F_{k,(j)}\mapsto \frac{1}{x_{j/l}^{n_{jl}}}F_{k,(l)},
$$
where $n_{jl}$ is the degree of $x_{l;j}$ in $F_{k,(j)}$. Denote the induced morphism $g_{i,(j);k,(l)}$. We can similarly verify that the induced morphism satisfies the cocycle relation because $h_{jl}$ does.
$$
g_{i,(j);k,(l)}=g_{p,(j);k,(l)}\circ g_{i,(j);p,(l)}
$$
 Hence we can glue the affine schemes to get a closed subscheme in $\proj^n_A$.
\end{proof}

\begin{exr}\label{chap4exr:homogeneous_ideal_characterization}\ 
\begin{enumerate}[label=(\alph*)]
\item Show that an ideal $I$ is homogeneous if and only if it contains the degree $n$ piece of each of its elements for each $n$.
\item Show that the set of homogeneous ideals of a given $\intg$-graded ring $S_\bullet$ is closed under sum, product, intersection, and radical.
\item 
Show that a homogeneous ideal $I \subset S_\bullet$ is prime if $I\neq S_\bullet$, and if for any homogeneous $a, b \in  S_\bullet$, if $ab \in I$, then $a \in I$ or $b \in I$.
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item Want:``$I$ is homogeneous ideal'' $\Llrta$ ``$I$ contains each degree $n$ piece of each element for each degree''

 $\Lrta$:  A homogeneous ideal $I$ is generated by homogeneous elements $\{a_i\in S_{n(i)}\}_{i\in I}$, where $n(i)$ is the degree of $a_i$. A general element looks like $b=\sum_i s_i a_i$. $s_i$ are not necessarily homogeneous, but we can decompose $s$ into homogeneous pieces and verify that homogeneous pieces of $b$ are still generated by $a_i$ which are contained in $I$.

 $\Llta$: $b=\sum_n b_n\in S$, where $b_n$ is homogeneous of degree $n$. We can simply choose the generating set to be the homogeneous pieces of each of the element in $I$. Then $I$ is generated by homogeneous elements. Then we can decompose $I$ as $\oplus_{n\in\intg}I_n$. And $S/I$ has a natural $\intg$-grading.
 \item $I,J$ are homogeneous ideals in $S_\bullet$. It is easy to verify that the $I+J$, $I\cdot J$ and $I\cap J$ are generated by homogeneous elements. As for radicals, 
 $$
 L=\sqrt{I}
 $$
 $x\in L\Llrta x^n\in L$. $x=\sum_{i\in\intg} x_i$ only finitely many of $x_i$ are not zero. Assume d the highest degree of $x$, $deg\  x_d$ is larger than any other homogeneous piece.  Specifically, $x_d^n\in I$ which means $x_i\in L$. Then $x-x_d\in L$, we can induct on this procedure until we find each homogeneous piece of $x$ is contained in $L$. Which means $I$ is homogeneous by $(a)$.
 \item The only if direction is trivial. We only need to check the if direction.

Consider general elements $x=\sum_i^d x_i$ and $y=\sum_i^{k} y_j$, they are finite sums by definition. We can check
$$
\sum_i^d x_i\cdot \sum_j^k y_j=\sum_n\sum_{i+j=n}x_i y_j.
$$
Assume neither $x$ nor $y$ is contained in $I$. Then at least one $x_d$ and $y_k$ are not in $I$. Assume $d,k$ to be maximal with this property.

We can subtract from $x$ the part $\sum_{n>d}x_n$ such that $\tilde{x}=x-\sum_{n>d}x_n\notin I$. Similarly, set $\tilde{y}=y-\sum_{m>k}y_m\notin I$. Then we have $\tilde{x}\tilde{y}\in I$ and the leading homogeneous piece being $x_dy_k$. Then $x_d y_k\in I$, $\Lrta x_d$ or $y_k\notin I$. Contradiction.
\end{enumerate}
\end{proof}

\begin{exr}\ 
\begin{enumerate}[label=(\alph*)]
\item
Show that a graded ring $S_\bullet$ over $A$ is a finitely generated graded ring (over $A$) if and only if $S_\bullet$ is a finitely generated graded $A$-algebra, i.e., generated over $A = S_0$ by a finite number of homogeneous elements of positive degree. (Hint for the forward implication: show that the generators of $S_+$ as an ideal are also generators of $S_\bullet$ as an algebra.)
\item Show that a graded ring $S_\bullet$ over $A$ is Noetherian if and only if $A = S_0$ is Noetherian and $S_\bullet$ is a finitely generated graded ring.
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item $\Lrta$: $S_\bullet$ is  a finitely generated graded ring over $A$, which means $S_0=A$ and the irrelevant ideal $S_+$ is finitely generated ideal. Such a graded ring is naturally an $A$-algebra. Assume $S_+$ is finitely generated by as $(s_{1,1},...,s_{n,m_{j}})$ each of degree higher than $s_{i,k}, k\leq m_j$ is of degree $i$. Then a general element in $S_1$ can be expressed as
$$
\sum_j^{m_1} a_j s_{1,j}.
$$
Each element in $S_2$ can be expressed as
$$
\sum_{j}^{m_2}a_{j}s_{2,j}+\sum_{j,k}^{m_1}b_{jk}s_{1,j}s_{1,k}.
$$
And it will also work for any degree, which means $S$ is generated as polynomial $A[s_{i,j}]$ (quotient some relations).

$\Llta$ If a graded ring $S_\bullet$ is finitely generated as an $A$-algebra ($S_0=A$), $S_+=S_\bullet -A$ is finitely generated.
\item $\Llta$: By (a), $S_\bullet$ being a finitely generated graded ring with $S_0=A$ means $S_\bullet$ is finitely generated $A$-algebra. Grading is only an extra structure on $S$, we can proceed by Hilbert basis theorem. If $A$ is Noetherian, the finitely generated $A$-algebra is Noetherian.

$\Lrta$: Graded ring $S_\bullet$ is Noetherian, then every ideal of $S_\bullet$ is finitely generated, specifically, $S_+$ is finitely generated. On the other hand $S_\bullet/S_+\cong A$, is a homomorphic image of a Noetherian ring. Hence $A$ must also be Noetherian.
\end{enumerate}
\end{proof}

\begin{exr}\label{chap4exr:interpreation_projS}
Suppose $f \in S_+$ is homogeneous.
\begin{enumerate}[label=(\alph*)]
\item Give a bijection between the prime ideals of $((S_\bullet)_f)_0$ and the homogeneous prime ideals of $(S_\bullet)_f$. Hint: Avoid notational confusion by proving instead that if $A$ is a $\intg$-graded ring with a homogeneous invertible element $f$ in positive degree, then there is a bijection between prime ideals of $A_0$ and homogeneous prime ideals of $A$. Using the ring map $A_0 \lrta A$, from each homogeneous prime ideal of $A$ we find a prime ideal of $A_0$. The reverse direction is the harder one. Given a prime ideal $P_0 \subset A_0$, define $P \subset A$ (a priori only a subset) as $\oplus Q_i$, where $Q_i \subset A_i$, and $a\in Q_i$ if and only if $a^{\deg f}/f^i\in P_0$ . Note that $Q_0 =P_0$. Show  that $a\in Q_i$ if and only if $a^2\in Q_{2i}$; show that if $a_1,a_2 \in Q_i$ then $a^2_1 +2a_1a_2 +a^2_2 \in Q_{2i}$ and hence $a_1 + a_2 \in Q_i$; then show that $P$ is a homogeneous ideal of $A$; then show that $P$ is prime.
\item Interpret the set of prime ideals of $((S_\bullet)_f)_0$ as a subset of $\Proj S_\bullet$.
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item Follow the hint, we avoid the notation trouble by working in  a $\intg$-graded ring $A$ with invertible  homogeneous element $f$ with $\deg f>0$.

\underline{Claim}: There is a bijection between prime ideals of $A_0$ and homogeneous prime ideal of $A$.

There is a natural inclusion $\iota:A_0\inj A$. For a given homogeneous prime ideal $P$ in $A$ we can find a prime ideal $\iota^* P\in A_0$ which is just $P\cap A_0$ which is a prime ideal in $A_0$.

The reverse direction is harder. Consider a prime ideal $P_0\in A_0$, define $P\subset A$ as $P=\oplus Q_i$, where $Q_i\subset A_i$ and a homogeneous element $a\in Q_i$ iff $a^{\deg f}/f^i\in P_0$. Note that $P_0=Q_0$.

\underline{Want}: $P$ is an ideal.
Indeed, for $a\in P$, $b\in A$. $a=\sum_i a_i$, $b=\sum_j b_j$, where each $a_i\in Q_i$ and $b_j\in A_j$. $a_i b_i\in A_{2i}$.
$$
\frac{(a_i b_j)^{\deg f}}{f^{i+j}}=\frac{a_i^{\deg f}}{f^i}\frac{b_i^{\deg f}}{f^j}\in P_0.
$$
Then product is contained in $P_0$ because $a_i^{\deg f}{f^i}\in P_0$ and $b_j^{\deg f}{f^j}\in A_0$ and $P_0$ is a prime ideal in $A_0$. Then we have 
$$
\frac{(a_i b_j)^{\deg f}}{f^{i+j}}\in Q_{i+j}.
$$
Similarly, we can prove $a\cdot b=\sum_i a_i\cdot \sum_i b_i\in P$. 

\underline{subclaim}: $a\in Q_i$ iff $a^2\in Q_i$. 
 one direction is clear and we only need to prove the only if part.
 $$
 \frac{(a^2)^{\deg f}}{f^{2i}}=\frac{(a)^{\deg f}}{f^{i}}\frac{(a)^{\deg f}}{f^{i}}\in P_0\Lrta \frac{(a)^{\deg f}}{f^{i}}\in P_0
 $$
 because $P_0$ is prime ideal.

On the other hand, given $a_1,a_2\in Q_i$
 We have $P$ is an ideal in $A$. We know $a_1^2+2a_1a_2+a_2^2\in Q_{2i}$. Hence by the subclaim, $a_1+a_2\in Q_i$.

Then we know $P$ is closed under summation and multiplication by $A$. ($P$ is an ideal.)

\underline{Want}: $P$ is homogeneous ideal. Recall~\ref{chap4exr:homogeneous_ideal_characterization}, part $(a)$, we only need to prove that $P$ contains  the homogeneous piece of each of its element of each degree. Assume $a\in P$ then $a=\sum_i a_i$ and $a_i\in Q_i$ by definition of $P$. We know $P$ is homogeneous ideal.

\underline{Want}: $P$ is a prime ideal in $A$. See~\ref{chap4exr:homogeneous_ideal_characterization}, part $(c)$. A homogeneous ideal is prime iff it is prime for homogeneous elements. Suppose $a\in A_i, b\in A_j$ and we have $ab\in Q_{ij}$, then by definition
$$
\frac{a^{\deg f}}{f^i}\frac{b^{\deg f}}{f^j}\in P_0
$$
then either $a\in Q_i$ or $b\in Q_j$ because $P_0$ is prime ideal.

We still need to prove that this indeed gives a bijection. The map $\alpha:I\lrta I\cap A_0$ as described above and the map $\beta: P_0\mapsto P$. $\alpha\circ \beta:P_0\mapsto P_0$. $\beta\circ \alpha:I\mapsto I\cap A_0\mapsto? I$.

$$
\beta(I\cap A_0)\supset I
$$
because $x\in I_j$ then $x^{\deg f}/f^j\in I\cap A_0$.

For the reverse inclusion, consider an element $y\in\beta(I\cap A_0)_j$ then by definition $y^{\deg f}/f^j\in I\cap A_0$, then $y^{\deg f}=y^{\deg f}/f^j\cdot f^j\in I_{j\deg f}$ $\Lrta y\in I_j$ because $I$ is prime ideal.

\item We have proved there is bijection between ``prime ideals in $((S_\bullet)_f)_0$'' and homogeneous prime ideals in $(S_\bullet)_f$. Recall the property of localization, there is a one to one homogeneous prime ideals in $(S_\bullet)_f$ and homogeneous prime ideals in $S_\bullet$ that does not intersect $\{f,f^2,...\}\subset S_+$. (Localization preserves the homogeneity of prime ideals.) In particular, these homogeneous prime ideals do not contain $S_+$, therefore they can be interpreted as subset in $\Proj S_\bullet$.
\end{enumerate}
\end{proof}
\begin{exr}\label{chap4exr:projective_affine_open_chart_localization}
Show that $D(f)$ ``is'' (or more precisely, ``corresponds to'') the subset $\spec((S_\bullet)_f)_0$ you described in Exercise~\ref{chap4exr:interpreation_projS}. For example, the $D(x_i)$ are the standard open sets covering projective space.
\end{exr}
\begin{proof}
$D(f)$ is the projective distinguished open set and
$$
\begin{aligned}
D(f)&=\Proj S_\bullet -V(f)\\
&=\{\text{Homogeneous prime ideals that do not contain $f$ or $S_+$}\}\\
&=\{\text{Homogeneous prime ideal that do not contain $f$}\} (f\in S_+)
\end{aligned}
$$
And we have the correspondences:
$$
\begin{aligned}
&\{\text{Homogeneous prime ideals in $S_\bullet$ that do not contain $f$}\}\\
&\llrta (\text{by localization  property})\\
&\{\text{Homogeneous prime ideals in $(S_\bullet)_f$}\}\\
&\llrta (\text{by Exercise~\ref{chap4exr:interpreation_projS}})\\
&\{\text{Prime ideals in $((S_\bullet)_f)_0$}\}\\
&=\spec ((S_\bullet)_f)_0
\end{aligned}
$$
\end{proof}

\begin{exr}
Verify that the projective distinguished open sets $D(f)$ (as $f$ runs through the homogeneous elements of $S_+$) form a base of the Zariski topology.
\end{exr}
\begin{proof}
As in the affine case, the closed set of Zariski's topology is of the form
$$
V(T)=V(\overline{T}).
$$
where $I:=\overline{T}$ is a homogeneous ideal generated by $T$. $\overline{T}\subset S_+$. 

It forms a topology
$$
\cap_i V(J_i)=V(\sum_i J_i)
$$
and 
$$
V(I)\cup V(J)=V(I\cdot J)
$$
and
$$
IV(J)=\sqrt{J}
$$
both are well-defined because \{homogeneous ideals\} is closed under intersection, product, addition and taking radicals.

\underline{Claim}: $\{D(f)\}$ where $f$ is homogeneous element in $S_+$ form a base of the topology.

Given a point $[P]$ in an open set $\Proj S_\bullet-V(I)$ , $P$ is a homogeneous prime ideal in $S_\bullet$ that does not contains $I$. We can find $f\in I\backslash P$. Then by definition 
$$
V(f)\supset V(I)
$$
and
$$
D(f)\subset \Proj S_\bullet-V(I).
$$
Also $P$ does not contain $f$, hence $D(f)\ni [P]$.

Which means $D(f)$ as $f$ ranges over $S_+$ form a base of the Zariski's topology.
\end{proof}

\begin{exr}\label{chap4exr:4.5.H}
Fix a graded ring $S_\bullet$.
\begin{enumerate}[label=(\alph*)]
\item Suppose $I$ is any homogeneous ideal of $S_\bullet$ contained in $S_+$, and $f$ is a homogeneous element of positive degree. Show that $f$ vanishes on $V(I)$ (i.e.,$V(I) \subset V(f)$) if and only if $f^n ∈ I$ for some $n$. (Hint: Mimic the affine case~\ref{exr:vanishing_set_radical},) In particular, as in the affine case (Exercise~\ref{chap3exr:inclusion_distinguished_open}), if $D(f) \subset D(g)$, then $f^n \in (g)$ for some $n$, and vice versa. (Here $g$ is also homogeneous of positive degree.)
\item If $Z \subset \Proj S_\bullet$, define $I(Z) \subset S_+$. Show that it is a homogeneous ideal of $S_\bullet$. For any two subsets, show that $I(Z_1 \cup Z_2) = I(Z_1) \cap I(Z_2)$.
\item For any subset $Z \subset \Proj S_\bullet$, show that $V(I(Z)) = \overline{Z}$.
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item 
If $f^n\in I $ for some $n$, then $f\in P$ for all $P$ homogeneous prime containing $I$ because $P$ is prime. Then $f$ vanishes on $V(I)$.

For the reverse direction, $f$ vanishes on $V(I)$, $V(I)\subset V(f)$. It means all homogeneous prime ideals that containing $I$ but not $S_+$ contains $f$:
$$
f\in \cap_{P\supset I, P\notsupset S_+} P.
$$
Notice when $f$ is homogeneous of positive degree, $f\in S_+$, $f$ is automatically contained in any homogeneous prime that contains $S_+$. the condition $f$ vanishes on $V(I)$ in fact is equivalent to 
$$
f\in\cap_{P\supset I}P.
$$

Note that $I$ itself is homogeneous.

\underline{Claim}: The radical of a homogeneous ideal $I$ is the intersection of all homogeneous prime ideal that contains $I$.

In general, we use $P$ to denote homogeneous prime
$$
\cap_{P\supset I}P\supset \cap_{\scp\supset I}\scp.
$$
For the reverse inclusion, consider $\scp^h$ to be the the homogeneous ideal generated by the homogeneous element of $\scp$. $\scp^h\subset \scp$ is prime on homogeneous elements then $\scp^h$ is homogeneous prime ideal by~\ref{chap4exr:homogeneous_ideal_characterization}. If $\scp$ is any prime containing $I$, then $\scp^h$ also contains $I$, because $\scp^h$ contains the homogeneous elements of $I$, and $I$ as a homogeneous ideal is generated by these homogeneous elements. 
We have
$$
\cap_{P\supset I} P\subset \cap_{\scp\supset I}\scp^h\subset \cap_{\scp\supset I}\scp .
$$
Then we know the intersection of homogeneous primes that containing a homogeneous ideal $I$ is just the radical of $I$.
$$
f\in\cap_{P\supset I}P=\cap_{\scp\supset I}\scp=\sqrt{I}.
$$

Hence exists $n\geq 0$ such that $f^n\in I$.
\item $I(Z)$ is defined to be the element of $S_\bullet$ that vanishes on all of $[P]\in Z$. $Z\subset \Proj S_\bullet$, means each $[P]\in Z$.
 $P$ is homogeneous prime that does not contain $S_+$.

  $f\in I(Z)$ $\Llrta$ $f\in \cap_{[P]\in Z}P$.

  Denote the degree $i$ piece of $f$ by $f_i$. $f\in\cap_{[P]\supset Z}P\Lrta f_i\in P$ $\forall [P]\in Z$, because each $P$ is homogeneous, this in turn means $f_i\in I(Z)$. $I(Z)$ contains each homogeneous piece of each element in it, which implies that $I(Z)$ is a homogeneous ideal. 

  For two subsets $Z_1$ and $Z_2$ in $\Proj S_\bullet$,
  $$
  f\in I(Z_1\cup Z_2)
  $$ 
  $$
  \Llrta
  f\in P,\forall [P]\in Z_1\cup Z_2
  $$
  $$
  \Llrta
  f\in P,\forall [P]\in Z_1\text{ AND }f\in Q,\forall [Q]\in Z_2 
  $$
  $$
  \Llrta f\in I(Z_1) \cap I(Z_2)
  $$
  \item ``$V(I(Z))\supset \overline{Z}$'':
By definition, $V(I(Z))$ is closed set. And $Z\subset V(I(Z))$, because $[P]\in Z, I(Z)=\cap_{[Q]\in Z}Q$ $I(Z)\mod P=0,\Lrta I(Z)\subset P\Lrta [P]\in V(I(Z))$. Closure $\overline{Z}$ is the smallest closed set that contains $Z$, therefore $\overline{Z}\subset V(I(Z))$.

 ``$V(I(Z))\subset \overline{Z}$'': We need to verify that open neighborhood of each point in $V(I(Z))$ intersects with $Z$. Consider a point $[Q]\in V(I(Z))$, we have $Q\supset I(Z)$. Assume  a non-empty distinguished open $D(f)$ contains $[Q]\Llrta f\notin Q \Lrta f\notin I(Z)\Lrta$ $f $ does not vanish on every point in $Z$, $\exists[P]\in Z$, s.t. $f\notin P\Llrta$ $D(f)\ni [P]$, therefore $D(f)\cap V(I(Z))\neq \emptyset$. Hence $V(I(Z))\subset \overline{Z}$.

\end{enumerate}
\end{proof}

\begin{exr}
Fix a graded ring $S_\bullet$, and a homogeneous ideal $I$. Show that the following are equivalent.
\begin{enumerate}[label=(\alph*)]
\item $V(I) = \emptyset$.
\item For any $f_i$ (as $i$ runs through some index set) generating $I$, $\cup_i D(f_i)=\Proj S_\bullet$. 
\item $\sqrt{I}\supset S_+$.
\end{enumerate}
\end{exr}
\begin{proof}
$(a)\Lrta (b)$: Assume $I$ is finitely generated by $\{f_i\}_{i\in J}$. $V(I)=\emptyset$, means $\forall [P]\in \Proj S_\bullet$, $P\notsupset I$. For each $[P]\in \Proj S_\bullet$, $P\not\ni f_i$ for some $f_i\in I$ $\Lrta [P]\in D(f_i)$ for some $f_i$, which means $\Proj S_\bullet \subset \cup_{i\in J} D(f_i)\subset \Proj S_\bullet$.

$(b)\Lrta (c)$: $\Proj S_\bullet = \cup_{i\in J} D(f_i)$ means each homogeneous prime ideal that does not contain $S_+$ in $S_\bullet$ does not contain $I$. The contrapositive says each homogeneous prime ideal contain $I$ would contain $S_+$:
$$
\cap_{P\supset I} P\supset S_+.
$$
By Exercise~\ref{chap4exr:4.5.H}, we know $\sqrt{I}=\cap_{P\supset I} P$ for homogeneous ideal $I$.

$(c)\Lrta (a)$, 
$$
\sqrt{I}=\cap_{P\supset I} P\supset S_+
$$
means for each point $[P]\in \Proj S_\bullet$, $P$ does not contain $I$. $\Lrta$ $[P]\notin V(I)$.

$\Lrta V(I)=\emptyset$.
\end{proof}

\begin{exr}
Suppose some homogeneous $f\in S_+$ is given. Via the inclusion
$$
D(f) = \spec((S_\bullet)_f)_0  \inj \Proj S_\bullet
$$
of Exercise~\ref{chap4exr:projective_affine_open_chart_localization}, show that the Zariski topology on $\Proj S_\bullet$ restricts to the Zariski topology on $\spec((S_\bullet)_f)_0$
\end{exr}
\begin{proof}
We can compare the closed subsets of these two topological space. Consider a subset $I\subset ((S_\bullet)_f)_0$
$$
\begin{aligned}
((S_\bullet)_f)_0\supset V'(I)&=\{ [\scp]\in\spec ((S_\bullet)_f)_0: I\subset \scp\}\\
&\llrta\{[P]\in \Proj (S_\bullet)_f: I^{h}\subset P\}\\
&(I^h\text{ is the homogeneous ideal generated by $I$.})\\
&\llrta\{[Q]\in \Proj S_\bullet: \iota^*(I^h)\subset Q, Q\not\ni f\}\\
&(\iota^*(I^h)\text{ denote the preimage of $I^h$ under localization})
\end{aligned}
$$
where we use $\scp$ to denote ordinary prime ideal and $P$ to mean homogeneous prime ideal. Also $\iota:S_\bullet\inj (S_\bullet)_f$ is the standard inclusion of localization.
$$
\begin{aligned}
((S_\bullet)_f)_0\supset V'(D)
&\llrta\{[Q]\in \Proj S_\bullet: \iota^*(I^h)\subset Q, Q\not\ni f\}\\
&\llrta \{[Q]\in \Proj S_\bullet: Q\supset \iota^*(I^h)\}\cap\{[Q]\in\Proj S_\bullet:Q\not\ni f\}\\
&=V(\iota^*(I^h))\cap D(f)
\end{aligned}
$$

For illustration, consider previous example
$S:=k[x_0,x_1,x_2]$, $S_{x_0}:=k[x_0,x_1,x_2,x_0^{-1}]$, $(S_{x_0})_0:=k[x_1/x_0,x_2/x_0]$. $I=(1+x_{1/0}^2-x_{2/0}^2)_0$ and $I^h=(1+x_{1/0}^2-x_{2/0}^2)$.
$$
V'(I)=V_0:=\spec k[x_{1/0},x_{2/0}]/(1+x_{1/0}^2-x_{2/0}^2),
$$
$\iota^*(I^h)=(x_0^2+x_1^2-x_2^2)$.
$$
V'(I)\llrta D(x_0)\cap V((x_0^2+x_1^2-x_2^2))
$$
\end{proof}


\begin{exr}
If $f, g \in S_+$ are homogeneous and nonzero, describe an isomorphism between $\spec((S_\bullet)_{fg})_0$ and the distinguished open subset $D(g^{\deg f}/f^{\deg g})$ of $\spec((S_\bullet)_f)_0$.
\end{exr}
\begin{proof}
Recall that 
$$
\spec((S_\bullet)_{fg})_0\cong D(fg)\subset \Proj S_\bullet
$$
Then problem reduce to describe the intersection of $D(fg)$ with $\spec ((S_\bullet)_f)_0$.
$$
\begin{aligned}
\spec ((S_\bullet)_{fg})_0&= \{[\scq]\in \spec ((S_\bullet)_{fg})_0:\}\\
&\llrta \{[Q]\in \Proj (S_\bullet)_{fg}\}\\
&\llrta \{[Q]\in\Proj S_\bullet:Q\not\ni fg\}\\
&\llrta \{[Q]\in\Proj S_\bullet:Q\not\ni f\} \cap \{[Q]\in\Proj S_\bullet: Q\not\ni g\}\\
&\llrta \{[P]\in \Proj (S_\bullet)_f: P\not\ni \frac{g}{1}\}\\
&\llrta\{ [\scp]\in\spec ((S_\bullet)_f)_0: \scp\not\ni\frac{g^{\deg f}}{f^{\deg g}}\}
\end{aligned}
$$
We only have to explain the last bijection. $\scp=P\cap ((S_\bullet)_f)_0$ and if $P\not\ni g/1$, we have $\scp\not\ni g^{\deg f}/f^{\deg g}$. For the reverse direction, we have to recall the construction in~\ref{chap4exr:interpreation_projS}, $g/1\notin P_{\deg g}$ iff $g^{\deg f}/f^{\deg g}\notin \scp=P_0$.
\end{proof}

Before finishing the definition, we have to collect some results about graded ring here in order to construct the isomorphism of sheaves on intersections.
\begin{theorem}
\label{lemma-standard-open}
Let $S_\bullet$ be a graded ring. Let $f \in S_\bullet$ homogeneous of positive degree.
\begin{enumerate}
\item If $g\in S$ homogeneous of positive degree
and $D(g) \subset D(f)$, then
\begin{enumerate}
\item $f$ is invertible in $(S_\bullet)_g$, and
$f^{\deg(g)}/g^{\deg(f)}$ is invertible in $S_{(g)}$,
\item $g^e = af$ for some $e \geq 1$ and $a \in S$ homogeneous,
\item there is a canonical $S_\bullet$-algebra map $(S_\bullet)_f \to (S_\bullet)_g$,
\item there is a canonical $(S_\bullet)_0$-algebra map $((S_\bullet)_{f})_0 \to ((S_\bullet)_{g})_0$
compatible with the map $(S_\bullet)_f \to (S_\bullet)_g$,
\item the map $((S_\bullet)_{f})_0 \to ((S_\bullet)_{g})_0$ induces an isomorphism
$$
(((S_\bullet)_{f})_0)_{g^{\deg(f)}/f^{\deg(g)}} \cong ((S_\bullet)_{g})_0,
$$
\item there are compatible canonical $S_\bullet)_{f}$ and $((S_\bullet)_{f})_0$-module
maps $(M_\bullet)_f \to (M_\bullet)_g$ and $((M_\bullet)_f)_0 \to ((M_\bullet)_g)_0$ for any graded $S_\bullet$-module $M_\bullet$,
and
\item the map $((M_\bullet)_{f})_0 \to((M_\bullet)_{g})_0$ induces an isomorphism
$$
(((M_\bullet)_{f})_0)_{g^{\deg(f)}/f^{\deg(g)}} \cong ((M_\bullet)_{g})_0.
$$
This is a horrible notation, where the first and third subscripts means grading while second and forth means localizations. 
\end{enumerate}
\item Any open covering of $D_{+}(f)$ can be refined to a finite
open covering of the form $D_{+}(f) = \bigcup_{i = 1}^n D_{+}(g_i)$.
\item Let $g_1, \ldots, g_n \in S$ be homogeneous of positive degree.
Then $D_{+}(f) \subset \bigcup D_{+}(g_i)$
if and only if
$g_1^{\deg(f)}/f^{\deg(g_1)}, \ldots, g_n^{\deg(f)}/f^{\deg(g_n)}$
generate the unit ideal in $S_{(f)}$.
\end{enumerate}
\end{theorem}\label{chap4thm:graded_ring_localization_iso}
\begin{proof}
We only prove $1.(a)-1.(e)$ and the remaining part can be found at \href{https://stacks.math.columbia.edu/tag/01M4}{Stack Project 26.8}.

\begin{enumerate}[label=(\alph*)]
\item
$f$ is is invertible in $(S_\bullet)_g$ by~\ref{chap3exr:inclusion_distinguished_open}. And $f^{\deg g}/g^{\deg f}$ is an invertible element an element in $((S_\bullet)_g)_0$ because it is not contained in any prime ideal in $((S_\bullet)_g)_0$. ($f/1$ is not contained in any prime ideal in $(S_\bullet)_g$ because $f/1$ is invertible.)
\item Then the inverse of $f$ in $(S_\bullet)_g$ can be written as $a'/g^d$ and $fa'/g^d=1/1$. We can replace $a'$ by its homogeneous part $a''$ and $(fa''-g^d)/1=0/1$ $g^k(fa-g^d)=0$. Then after  defining $a:=a''g^k$, we get $fa=g^e$, for $e=k+d$.
\item The morphism exists by universal property of localization. It maps $b/f^n$ to $a^nb/g^{ne}$. 

\item This clearly induce a map of the degree $0$ ring, $((S_\bullet)_f)_0\to ((S_\bullet)_g)_0$.
\item We need to look the ring morphism $((S_\bullet)_f)_0\to ((S_\bullet)_g)_0$ in detail. It is induced by 
$$
\phi:\left(\frac{b}{f^n}\right)_0\mapsto \left(\frac{a^n b}{g^{ne}}\right)_0
$$
In particular
$$
\frac{g^{\deg f}}{f^{\deg g}}\mapsto \frac{a^{\deg g}}{g^{e\deg g-\deg f}}
$$
Because $g^{\deg f}/f^{\deg g}$ is invertible in $(S_\bullet)_0 $, it induces a morphism
$$
\tilde{\phi}:(((S_\bullet)_f)_0)_{g^{\deg f}/f^{\deg g}}
\lrta ((S_\bullet)_g)_0
$$
$$
\begin{aligned}
\left(\frac{b}{f^n}\right)_0/\left(\frac{g^{\deg f}}{f^{\deg g}}\right)^m&\mapsto \phi\left(\frac{b}{f^n}\right)_0/\phi\left(\frac{g^{\deg f}}{f^{\deg g}}\right)^m\\
&=\left(\frac{\left(a^nb/g^{ne}\right)}{\left(a^{\deg g}/g^{e\deg g-\deg f}\right)^m}\right)_0\\
&=\left(\frac{a^{n-m\deg g}b}{g^{m\deg f-me\deg g+ne}}\right)_0\\
&=\left(\frac{b}{g^{m\deg f}f^{n-m\deg g}}\right)_0
\end{aligned}
$$
This morphism is surjective because $f$ is invertible in $(S_\bullet)_g$. Then we can look at the kernel of this ring morphism. If
$$
\left(\frac{b}{g^{m\deg f}f^{n-m\deg g}}\right)_0=0,
$$
It means exactly the degree $0$ part of $b/f^n$ is zero. Hence we have the isomorphism.
\end{enumerate}
\end{proof}

\begin{exr}
By checking that these gluings behave well on triple overlaps (see Exercise~\ref{chap3exr:glue_sheaf}), finish the definition of the scheme $\Proj S_\bullet$ .
\end{exr}
\begin{proof}
$D(f)$ give an open cover of the topological space of $X:=\Proj S_\bullet$. We identify the $\calo_{X,f}$ to be the structure sheaf of $\spec ((S_\bullet)_f)_0$: $\calo_{\spec ((S_\bullet)_f)_0}$.

$D(f)\cap D(g)=D(fg)$, we have the isomorphism of sheaves:
$$
\phi_{f,g}:\calo_{X,f}|_{D(fg)}\lrta \calo_{X,g}|_{D(fg)}.
$$
$$
\calo_{\spec ((S_\bullet)_f)_0}|_{D(g^{\deg f}/f^{\deg g})}\lrta \calo_{\spec ((S_\bullet)_g)_0}|_{D(f^{\deg g}/g^{\deg f})}
$$
We want to verify the cocycle relation on $D(fgh)$. We verify the cocycle relation on a base of topology. The distinguished base of $\spec (S_\bullet)_{fgh})_0$ is also induced by distinguished open in $\Proj S_\bullet$.

\underline{Want}:
$$
\phi_{f,h}(D(fghk))=\phi_{g,h}(D(fghk))\circ \phi_{f,g}(D(fghk)),\forall k\text{ homogeneous in $S_+$}.
$$
Notice that sheaf morphism is commutative with restriction maps. It suffices to check
$$
\phi_{f,h}(D(fgh))=\phi_{g,h}(D(fgh))\circ \phi_{f,g}(D(fgh)).
$$
$$
\begin{aligned}
\calo_{X,f}(D(fg))
&=\calo_{\spec ((S_\bullet)_f)_0}({D(g^{\deg f}/f^{\deg g})})\\
&=((S_\bullet)_f)_0)_{g^{\deg f}/f^{\deg g}},
\end{aligned}
$$
\underline{Claim}:
$$
((S_\bullet)_f)_0)_{g^{\deg f}/f^{\deg g}}\cong ((S_\bullet)_{fg})_0
$$
This isomorphism is already discussed in Theorem~\ref{chap4thm:graded_ring_localization_iso}.
We have the isomorphisms
$$
((S_\bullet)_f)_0)_{(gh)^{\deg f}/f^{\deg g+\deg h}}\cong ((S_\bullet)_{fgh})_0.
$$
Similarly, we have other two isomorphisms and the $\phi_{f,h}(D(fgh))$ is the composition of these ring isomorphism
\begin{center}
\tiny
\begin{tikzcd}
 &  &  &  & \calo_{X,h}(D(fgh))=((S_\bullet)_h)_0)_{(fg)^{\deg h}/h^{\deg f+\deg g}} \arrow[ldd] \\
 &  &  &  &  \\
\calo_{X,f}(D(fgh))=((S_\bullet)_f)_0)_{(gh)^{\deg f}/f^{\deg g+\deg h}} \arrow[rrr] \arrow[rrrrdd, "\phi_{fg}(D(fgh))"'] \arrow[rrrruu, "{\phi_{f,h}(D(fgh))}"] &  &  &  ((S_\bullet)_{fgh})_0 &  \\
 &  &  &  &  \\
 &  &  &  & \calo_{X,g}(D(fgh))=((S_\bullet)_g)_0)_{(fh)^{\deg g}/g^{\deg f+\deg h}} \arrow[luu] \arrow[uuuu, "{\phi_{g,h}(D(fgh))}"']
\end{tikzcd}
\end{center}

This means we can legally glue the structure sheaf of distinguished opens and there is a unique way to define the structure sheaf of $\Proj S_\bullet$.
\end{proof}

\begin{exr}
(Some will find this essential, others will prefer to ignore it.) (Re)interpret the structure sheaf of $\Proj S_\bullet$ in terms of compatible germs.
\end{exr}
\begin{proof}
We have to first discuss what the stalk of the structure sheaf $\calf:=\calo_{\Proj S_\bullet}$ is.

By definition
$$
\calf_{[P]}=\dirlim_{[P]\in U} \calf(U),
$$
where $[P]\in \Proj S_\bullet$ and $P$ is a homogeneous prime in $S_\bullet$.
Assume $[P]\in D(f)$ for a homogeneous element $f\in S_\bullet$, we define the structure sheaf on $D(f)$ to be the structure sheaf of $\spec ((S_\bullet)_f)_0$. $P$ corresponds to an ordinary prime $\scp\in ((S_\bullet)_f)_0$.

Recall the form of stalks of a affine scheme, we have the isomorphism
$$
\calf_{[P]}\cong (((S_\bullet)_f)_0)_\scp=:(S_{(f)})_\scp.
$$
This notation is terrifying, the second subscript means localize at an element and the forth subscript means localize at a prime $\scp$. And we will abbreviate it a little by writing $((S_\bullet)_f)_0$ as $S_{(f)}$, do not confuse it with localize at a prime ideal $(f)$. 

For an open set $U\subset\Proj S_\bullet$, $U$ is covered by $\{D(g)\}_{g\in G}$. Each stalk at $[P]$ should be interpreted as the equivalence class
$$
\calf_{[P]}:=\coprod_{(g,\scp)\in P}(S_{(g)})_{\scp_g}/\sim_{[P]}
$$
where $(g,\scp)\in P$ means $D(g)\ni [P]$ and $P\cap S_{(g)}=\scp$.
$$
(S_{(g)})_{\scp}\ni s_{g,\scp}\sim_{[P]} s_{f,\scq}(S_{(f)})_{\scq_f}\text{ iff } (g,\scp)\in P, (f,\scq)\in P\text{ and }
 s_{q,\scp}/1= s_{f,\scq}/1\in S_{(fg)}.
$$
Then we can interpret the sections in $\calf(U)$ via compatible germs
$$
\left\{\prod_{[P]}s_{[P]}\in\prod_{[P]\in U} \calf_{[P]}: \begin{matrix}
&\forall [Q]\in U, \exists D(f)\ni [Q] \text{ and }\tilde{s}\in S_{(f)}\text{ s.t. }\\
&\tilde{s}|_\scq/\sim_{[K]}=s_{[K]},\forall (f,\scq)\in K,\forall [K]\in D(g)\cap U
\end{matrix}
 \right\}
$$
where $\tilde{s}|_\scq$ means taking $\tilde{s}/1\in (S_{(f)})_\scq$.
\end{proof}

\begin{exr}
Check that defining $\proj^n_A$ as $\Proj A[x_1,...,x_n]$ agrees with our earlier construction by patching up specific affine schemes. (How do you know that the $D(x_i)$ cover $\Proj A[x_0,...,x_n]$?)

\end{exr}
\begin{proof}
We have already checked the new definition $\Proj A[x_1,..,x_n]$ is compatible with patching up all $D(f)$. $D(x_i)$ is only a special case. We only need to check $D(x_i)$ indeed covers $\Proj$
$V(x_i)=\Proj A[x_1,...,x_n] -D(x_i)$ and
$$
\cap_i^n V(x_i)=V\left(\sum_i^n (x_i)\right)=V((x_1,...,x_n))
$$
But $(x_1,...,x_n)$ is $S_+$ in the case $S_\bullet=A[x_1,..,x_n]$.
We have 
$$
\Proj A[x_1,..,x_n]-\cup_i D(x_i)=\cap_i V(x_i)=V(S_+)=\emptyset.
$$
\end{proof}

\begin{exr}
Suppose that $k$ is an algebraically closed field. We know from Exercise 4.4.F that the closed points of $\proj^n_k$ , are in bijection with the points of classical projective space. With our new definition of projective space, a point of classical projective space corresponds to a homogeneous prime ideal of $k[x_0,...,x_n]$. Which homogeneous prime ideal is it?
\end{exr}
\begin{proof} Assume $a_0\neq 0$,
$[a_0,...,a_n]$ corresponds to $(x_{1/0}-a_1/a_0,...,x_{n/0}-a_n/a_0)$ in the affine chart $D(x_0)$.

$(x_{1/0}-a_1/a_0,...,x_{n/0}-a_n/a_0)\subset (k[x_0,...,x_n]_{x_0})_0$ would corresponds to a homogeneous prime ideal in $k[x_0,...,x_n]$, as shown in~\ref{chap4exr:homogeneous_ideal_characterization}. We can construct the homogeneous prime by constructing it degree by degree and we omit the process and only list the final result (because we know it)
$$
\left(x_1-\frac{a_1}{a_0}x_0,...,x_n-\frac{a_n}{a_0}x_0\right)
$$
\end{proof}

\begin{exr}
If $S_\bullet$ is generated in degree $1$, and $f \in S_+$ is homogeneous, explain how to define $V(f)$ ``in'' $\Proj S_\bullet$ the vanishing scheme of $f$. 
(Warning: $f$ in general isn’t a function on $\Proj S_\bullet$ ). Hence define $V(I)$ for any homogeneous ideal $I$ of $S_+$.
\end{exr}
\begin{proof}
It is customary to define the topological space of $V(f)$ as the the homogeneous prime ideals containing $f$. The trouble is how define the structure sheaf on $V(f)$. 

In the affine case $V(I)=\spec A/I$. In the projective space assume $I$ or $f$ homogeneous, we can still define the vanishing scheme to be
$$
\Proj S_\bullet/I,\ \ \ \Proj S_\bullet/(f),
$$
which are topologically homeomorphic to $V(I)$ and $V(f)$ in $\proj S_\bullet$.


These two are well-defined schemes,
the subtlety lies in how to interpret them as subschemes of $\Proj S_\bullet$. These would be a long story and the key word is closed subscheme.
\end{proof}

\begin{exr}
Suppose $k$ is algebraically closed. Describe a natural bijection between one-dimensional subspaces of $V$ and the closed points of $\proj V$. Thus this construction canonically (in a basis-free manner) describes the one-dimensional subspaces of the vector space $V$.
\end{exr}
\begin{proof}
We define $\proj V$ to be $\Proj (\sym^\bullet V^\vee)$ and we already know $\sym^\bullet V^\vee\cong k[x_0,...,x_n]$, where $x_0,..,x_n$ form a basis  of $V^\vee$.

$\sym^\bullet V^\vee$ can be naturally regarded as functions on $V$ by sending $x_i$ to $x_i(v)$.

A closed point in $\Proj k[x_0,...,x_n]$ is of the form $[a_0,...,a_n]$ or $\left(x_1-\frac{a_1}{a_0}x_0,...,x_n-\frac{a_n}{a_0}x_0\right)$. We can define the corresponding one dimensional vector space by 
$$
\left\{v\in V: \left(x_1-\frac{a_1}{a_0}x_0,...,x_n-\frac{a_n}{a_0}x_0\right)v=0\right\}.
$$
In return, we can define the closed point to be the ideal of functions in $\sym^\bullet V^\vee$ that vanishes on the one dimensional linear space.
This gives a natural bijection.
\end{proof}
\chapter{Some properties of schemes}
\section{Topological properties}
\begin{exr}
Show that $\proj^n_k$ is irreducible.
\end{exr}
\begin{proof}
In this case $S_\bullet=k[x_1,..,x_n]$ and $S_+=(x_1,...,x_n)$.
Assume $\proj^n_k$ can be written as union of two proper closed subsets: $V(I_1)\cup V(I_2)$, where $I_1,I_2$ are two homogeneous ideal in $k[x_1,..,x_n]$, also we require $I_1,I_2$ not contain $S_+$.

$(0)$ is still a homogeneous prime ideal in $k[x_1,..,x_n]$ because it is integral domain and it does not contain the irrelevant ideal. W.l.o.g, assume $V(I_1)\ni [(0)]$, which means $I_1\subset (0)\Lrta I_1=(0)$. But $V(I_1)=V((0))=\Proj S_\bullet=\proj^n_k$, which contradicts the assumption that $V(I_1)$ is a proper closed subset.
\end{proof}

\begin{exr}\label{chap5exr:bijection_closed_generic_point_scheme}
Exercise~\ref{chap3exr:bijection_closed_subsets_points_affine} showed that there is a bijection between irreducible closed subsets and points for affine schemes (the map sending a point $p$ to the closed subset $\overline{\{p\}}$ is a bijection). Show that this is true of schemes in general.
\end{exr}
\begin{proof}
Given a scheme $X$, we want a bijection
$$
\begin{aligned}
X&\lrta \{Z\subset X:Z\text{ closed irreducible}\}\\
z&\longmapsto \overline{\{z\}}.
\end{aligned}
$$ 
We already showed this bijection exists for affine schemes. This map can be naturally extended to general scheme, with the Zariski topology.

We only need to show 
\begin{itemize}
\item $\overline{\{z\}}$ is irreducible in $X$, and
\item $\overline{\{z\}}\neq\overline{\{x\}}$ if $z\neq x$, and
\item Each irreducible closed subset in $X$ is of the form.
\end{itemize}

Each $\{z\}$ is irreducible in $X$, the closure of a irreducible subset is irreducible by~\ref{chap3exr:irreducible_subset_dense_open_irreducible_closure}.

If $\overline{\{z\}}=\overline{\{x\}}$, they are covered by some affine open subsets $U_i$. By definition of closure, each $U_i$ contain $z,x$. $\overline{\{z\}}\cap U_i=\overline{\{z\}}\cap U_i$ are the closure of $z,x$ in the subset topology of $U_i$, they are irreducible in $U_i$ because $\{z\},\{x\}$ are irreducible in $U_i$ with subset topology. Then because the bijection exists in affine schemes, there is a unique generic point corresponding to $\overline{\{z\}}\cap U_i$, $z=x$ in $U_i$, which means $z=x$ in $X$.

Given an irreducible subset $Z\subset X$. Let $U$ be an affine open subset such that $Z\cap U\neq \emptyset$. $Z\cap U$ is an open set in $Z$ with subspace topology on $Z$. By~\ref{chap3exr:irreducible_subset_dense_open_irreducible_closure}, $Z\cap U$ is dense and irreducible in $Z$, with subspace topology. Then it is also irreducible in $U$ with subspace topology on $U$. Hence it corresponds to a unique generic point in $U$. $\exists z\in U\cap Z$ s.t. $Z\cap U=\overline{\{z\}}'$ is the closure of $z$ in $Z\cap U$. However, we already know $Z\cap U$ is dense in $Z$, therefore $\overline{\{z\}}=Z$.

We have established to bijection between the irreducible closed subsets and generic points of the irreducible closed subsets.
\end{proof}


\begin{exr}
Prove that if $X$ is a scheme that has a finite cover $X = \cup_{i=1}^n \spec A_i$ where $A_i$ is Noetherian, then $X$is a Noetherian topological space (We will soon call a scheme with such a cover a \textbf{Noetherian scheme}) Hint: show that a topological space that is a finite union of Noetherian subspaces is itself Noetherian.
\end{exr}
\begin{proof}
We have shown in~\ref{chap3exr:Noetherian_rings_Noetherian_topological_spaces} that affine scheme corresponding to a Noetherian ring is Noetherian topological space.

It suffices to check finite union of Noetherian subspaces $X=\cup_i^nX_i$ is itself Noetherian.

A topological space is called Noetherian if it satisfies the descending chain condition for closed subsets. Given an descending chain of closed subsets in $X$.
$$
Z_1\supset Z_2\supset\cdots\supset Z_k\supset \cdots
$$
$Z_k=\cup_i^n(X_i\cap Z_k)$, $X_i\cap Z_k$ would give a descending chain of closed subsets in the subspace $X_i$ with subspace topology on $X_i$. Each would stabilize after $m_i$. Choose $m=\max\{m_i\}_{1\leq i\leq n}$, the descending chain $\{Z_k\}=\{\cup_i^n(X_i\cap Z_k)\}$ would also stabilize after $m$.
\end{proof}


\begin{exr}\label{chap5exr:quasicompact_scheme_union_affine_subschemes}
Show that a scheme $X$ is quasicompact if and only if it can be written as a finite union of affine open subschemes. (Hence $\proj^n_A$ is quasicompact for any ring $A$.)
\end{exr}
\begin{proof}
One direction is easy, if a scheme $X$ can be written as union of affine open subschemes $X_i$. Given a open cover of $X$, its intersection with affine open subschemes also given an open cover of $X_i$.
 Affine open subscheme is quasicompact, we can select a finite subcover of these intersection covers, and the union gives a finite subcover of the initial cover.

 For the reverse direction, consider a quasicompact scheme $X$. By definition, for each point $x$, there is an affine open subscheme $U_x$ contain $x$. These affine open subscheme give an open cover of $X$. $\cup_{x\in X}U_x$, we can select a finite subcover $\cup_{x\in I}U_x$ of $X$. Then the scheme $X$ is the union $\cup_{x\in I}U_x$. Then $X$ can be written as a finite union of affine open subschemes.

 In particular, $\proj^n_A$ is quasicompact.
\end{proof}

\begin{exr}\label{chap5exr:quasicompact_scheme_have_closed_points}
QUASICOMPACT SCHEMES HAVE CLOSED POINTS. Show that if $X$ is a quasicompact scheme, then every point has a closed point in its closure. Show that every nonempty closed subset of $X$ contains a closed point of $X$. In particular, every nonempty quasicompact scheme has a closed point.
\end{exr}
\begin{proof}
We already showed that $\overline{\{z\}}$ is a irreducible subset in $X$. Hence it suffices to show only every nonempty closed subset of a quasicompact scheme $X$ contains a closed point of $X$. 

Given a closed subset $Z\subset X$. Observe that a point $p\in Z$ is closed in $Z$ iff $p$ is closed in $X$. 

$X$ is a finite union of affine opens $\cup_i^nU_i$ by
~\ref{chap5exr:quasicompact_scheme_union_affine_subschemes}. Consider a finite sub-collection of $\{U_i\}_{1\leq i\leq n}$ that intersects with $Z$, w.l.o.g, we assume it is $\{U_i\}_{1\leq i\leq m}$. Then a point $p\in Z$ is closed iff $p$ is closed in each $\{U_i\}_{1\leq i\leq m}$ that contains $z$.

A closed point in $U_1$ corresponds to maximal ideals in $\spec A_1$. $Z\cap U_1$ is not empty, hence contains at least one $[\scp]$ and $\overline{\{[\scp]\}}\subset Z\cap U_1$. $\scp$ is contained in a maximal ideal $\scm$. $[\scm]\in \overline{\{[\scp]\}}$, which means there is at least one closed point in $Z\cap U_1$.

We can find a closed point (in $U_1$)  $z_1\in Z\cap U_1$. If $z_1$ is also closed in other $U_i$, we are done. 

If not, we can find in $\overline{\{z_1\}}\cap U_2$ a closed point $z_2$ such that $z_2$ is closed in $U_2$. $z_2\notin U_1$ because if $z_2\in U_1$, $\overline{\{z_1\}}\cap U_1\neq \emptyset$, which means $z_1$ is not closed point in $U_1$ in the first place. 

If $z_2$ is closed in all $U_i$ (besides $U_1$ ) that contains it, we are done. If not, assume $z_2$ is not closed point in $U_3$. $\overline{\{z_2\}}\subset \overline{\{z_1\}}$. We can find $z_3\in \overline{\{z_2\}}\cap U_3$, $z_3$ can't lie in $U_1$ or $U_2$, because it would imply $z_1$ not close point in $U_1$, $z_2$ not close point in $U_2$.

We can induct on these process until we find $z_m$ is closed in all $U_i$ that contains it. The process would terminate because we started with a finite cover with affine opens. 

Any closed subset in quasicompact scheme contains a closed point. In particular, a quasicompact scheme contains a closed point and the closure of each point in a quasicompact scheme contains a closed point.
\end{proof}

\begin{exr}\label{chap5exr:characterization_quasiseparatedness}
Show that a scheme is quasiseparated if and only if the intersection of any two affine open subsets is a finite union of affine open subsets.
\end{exr}
\begin{proof}
The $\Lrta$ direction is trivial, affine open subsets are quasicompact, if the scheme is quasiseparated, then the intersection of any two affine open subsets $A,B$ would be quasicompact and by~\ref{chap5exr:quasicompact_scheme_union_affine_subschemes} this intersection should be finite union of affine open subsets in $A\cap B$. Because $A\cap B$ is endowed with subspace topology of $X$, $A\cap B$ is also finite union of affine open subsets in $X$.

For the reverse direction. In a scheme any quasicompact subset is a finite union of affine open subsets, $Y=\cup_i^n U_i$ and $Z=\cup_{j}^m V_j$. Then the intersection of $Y$ and $Z$ should be 
$$
Y\cap Z=\cup_{1\leq i\leq n,1\leq j\leq m} U_i\cap V_j.
$$
If each $U_i\cap V_j$ can be written as finite union of affine open subsets, $Y\cap Z$ can be written as finite union of affine open subsets, which is equivalent to $Y\cap Z$ is quasicompact by~\ref{chap5exr:quasicompact_scheme_union_affine_subschemes}
\end{proof}

\begin{exr}
Show that affine schemes are quasiseparated.
\end{exr}
\begin{proof}
We have to firstly characterize a quasicompact open subset in $\spec A$.
(Do not try to characterize all affine opens in an affine scheme in general, it is difficult. The hint seems to be a trap)

Any open subset $U$, in $\spec A$ can written as a union of distinguished base. If in addition this set is quasicompact, we can write it as a finite union of $D(f_i)$.

$$
Y\cap Z=\cup_i^nD(f_i)\cap \cup_j^mD(g_j)=\cup_{1\leq i\leq n,1\leq j\leq m}D(f_i)\cap D(g_j)=\cup_{1\leq i\leq n,1\leq j\leq m}D(f_ig_j)
$$
which can be written as a finite union of affine opens. Then $Y\cap Z$ is quasicompact by~\ref{chap5exr:quasicompact_scheme_union_affine_subschemes}.

Then intersection of any two quasicompact opens is also quasicompact. Affine scheme is quasiseparated.
\end{proof}

\begin{exr}\label{chap5exr:characterization_quasicompact_And_quasiseparated}
Show that a scheme $X$ is quasicompact and quasiseparated if and only if $X$ can be covered by a finite number of affine open subsets, any two of which have intersection also covered by a finite number of affine open subsets.
\end{exr}
\begin{proof}
$\Lrta$ direction: $X$ can be written as a finite union of affine open subsets because $X$ is quasicompact by~\ref{chap5exr:quasicompact_scheme_union_affine_subschemes}. If in addition $X$ is quasiseparated, each intersection of these affine opens can be written as a finite union of affine open subsets by~\ref{chap5exr:characterization_quasiseparatedness}.

$\Llta$ direction: Assume $X$ can be written as a finite union of affine open subsets such that each pairwise intersection can be written as finite union of affine open subsets. Then $X$ is quasicompact by~\ref{chap5exr:quasicompact_scheme_union_affine_subschemes}. 

The quasiseparatedness part of the reverse direction is tricky. It can be cleanly proved using the diagonal morphism arguments, as shown in the first answer to this
\href{https://math.stackexchange.com/questions/9809/quasiseparated-if-finitely-covered-by-affines-in-appropriate-way}{StackExchange question}. We will give a more topological proof here.

Notice that we have proved affine schemes are quasicompact and quasiseparated. The specified affine opens are quasicompact and quasiseparated in the subspace topology. Given $Z$, $Y$ two quasicompact subsets in $X$. Each is covered by finitely many of specified affine opens.
$$
Z\cap Y=\cup_i(Z\cap Y\cap U_i)=\cup_i(Z\cap U_i)\cap (Y\cap U_i)
$$

\underline{Claim}: $Z\cap U_i$, $Y\cap U_i$ are quasicompact in $U_i$ for all $i$.

If we have the claim, we know $(Z\cap U_i)\cap (Y\cap U_i)$ is quasicompact because $U_i$ is quasiseparated. And a finite union of quasicompact space is always  quasicompact. Hence we are done.

Then the problem reduces to prove the claim:

\underline{proof of the claim}: $Z$ is quasicompact in $X$, therefore can be written as finite union of affine opens $Z=\cup_k Z_k$.
$$
Z=\cup_{k,i}(Z_k\cap U_i)
$$
$Z_k$ is affine open we can choose a distinguished base of $W_{k,i,\alpha}:=D(f_{k,i,\alpha})$, each $W_{k,i,\alpha}$ is quasicompact.

$Z_k\cap U_i$ is an open set in $Z_k$, hence can be written as union of $W_{k,\alpha}$ (not necessarily finite). We have
$$
Z=\cup_{k,i}(Z_k\cap U_i)=\cup_{k,i}\cup_{\alpha\in L_{ki}}W_{k,i,\alpha},
$$
where $L_{ki}$ is not finite in general. But because $Z$ is quasicompact, there is a finite subcover, we can choose a finite subset $F_{ki}$ for each $L_{ki}$ so that
$$
Z=\cup_{k,i}\cup_{\alpha\in F_{ki}}W_{k,i,\alpha}.
$$
(Now $\cup_{\alpha\in F_{ki}}W_{k,\alpha}$ no longer cover $Z_k\cap U_i$ in general)
Intersect it with $U_i$, we get
$$
Z\cap U_1=\cup_{k,i}\cup_{\alpha\in F_{ki}}W_{k,i,\alpha}\cap U_1.
$$
The condition that ``$U_i\cap U_j$ can be written as a finite union of affine opens $\cup_{l\in M_{ij}}V_{ij;l}$ '' would be used in the next step, where $M_{ij}$ is a finite index set depending on $i,j$.
$$
Z\cap U_1=\cup_{k,i}\cup_{\alpha\in F_{ki}}W_{k,i,\alpha}\cap U_1\overset{(*)}{=}\cup_{k,i}\cup_{\alpha\in F_{ki}}W_{k,i,\alpha}\cap U_1\cap U_i=\cup_{k,i}\cup_{\alpha\in F_{ki}}\cup_{l\in M_{1i}} W_{k,i,\alpha}\cap V_{1i;l}.
$$
where $(*)$ holds because each $W_{k.i.\alpha}\subset U_i$. $W_{k,i,\alpha}$ and $ V_{1i;l}$ are quasicompact subset in $U_i$ and their intersection is quasicompact because $U_i$ is quasiseparated. $Z\cap U_1$ is finite union of quasicompact subsets, therefore is compact. We proved the claim there fore the quasiseparatedness part of the reverse direction.
\end{proof}

\begin{exr}\label{chap5exr:Proj_A-scheme_quasicompact_quasiseparated}
Show that all projective $A$-schemes are quasicompact and quasiseparated. 
\end{exr}
\begin{proof}
By definition a projective $A$-scheme $X$ is defined to be $\Proj S_\bullet$, where $S_\bullet$ is a finitely generated graded ring over $A$. A graded ring is finitely generated iff $S_+$ is finitely generated. Assume $S_+=(x_1,...,x_n)$, where each $x_i$ is homogeneous, we can consider an open cover of $X$:
$$
D(x_i).
$$
We already showed that $D(x_i)$ is affine open subset that is isomorphic to $\spec ((S_\bullet)_{x_i})_0$.

$$
D(x_i)\cap D(x_j)=D(x_ix_j).
$$

In summary, $X=\Proj S_\bullet$ can be covered by a finite union of affine open subsets and each intersection of these affine open subsets can be written again as finite union of affine open subsets. Then we can conclude that $X=\Proj S_\bullet$ is quasicompact and quasiseparated by~\ref{chap5exr:characterization_quasicompact_And_quasiseparated}.
\end{proof}

\begin{exr}
Let $X = \spec k[x_1, x_2,...]$, and let $U$ be $X - [\scm]$ where $\scm$ is the maximal ideal $(x_1,x_2,...)$. Take two copies of $X$, glued along $U$ (``affine $\infty$-space with a doubled origin'', see Example 4.4.5 and Exercise~\ref{chap4exr:affine_doubled_origin}  for ``finite-dimensional'' versions). Show that the result is not quasiseparated.
\end{exr}
\begin{proof}
We glue two copies of $\spec k[x_1,x_2,...]$ $X,X'$along the open
$$
U:=\spec k[x_1,x_2,...]-[\scm],
$$
and denote the resulting scheme as $\affn^\infty_{(2)}$.
We showed in Exercise~\ref{chap3exr:affine_scheme_quasicompact}(b) that $U$ is not quasicompact in $\spec k[x_1,x_2,...]$.

Denote the the quotient map $\pi:X\coprod X'\lrta \affn^\infty_{(2)}$.
$\affn^\infty_{(2)}$ is equipped with quotient topology, which make the quotient map continuous. The images $\pi(X)$ and $\pi(X')$ in $\affn^\infty_{(2)}$ are quasicompact $\spec B$ is quasicompact for any ring $B$. And $\pi (U)$ is not quasicompact because $\cup_{i\in\intg}\pi(D(x_i))$ is an open cover of $\pi(U)$ with no finite subcover.

$\pi(X)\cap \pi(X')=\pi(U)$. Intersection of two quasicompact open subsets is not quasicompact, therefore $\affn^\infty_{(2)}$ is not quasiseparated.
\end{proof}

\section{Reducedness and integrality}

\begin{exr}\label{chap5exr:reducedness_stalk_local}
(REDUCEDNESS IS A stalk-local PROPERTY, I.E., CAN BE CHECKED AT STALKS). Show that a scheme is reduced if and only if none of the stalks have nonzero nilpotents. Hence show that if $f$ and $g$ are two functions (global sections of $\calo_X$) on a reduced scheme that agree at all points, then $f = g$.
\end{exr}
\begin{proof}
``$\Lrta$'': A scheme $X$ is reduced  then $\calo_X(U)$ is reduced for all open subsets $U\subset X$. Assume $[(f\in \calo_X(U);U)]\in\calo_{X,p}$ is nilpotent, which means $f|_V^n=0\in\calo_X(V)$ for some open neighborhood $V$ of $p$. But $\calo_X(V)$ is reduced ring, $\Lrta f|_V=0$ and $[(f\in \calo_X(U);U)]=0$, which implies there is no non-zero nilpotents in $\calo_{X,p}$.

``$\Llta$'': Given $f\in\calo_X(U)$, assume $f^n=0$. Then its image to stalks are also nilpotent. The condition that stalks are reduced implies the image of $f$ to each stalk is zero. By~\ref{chap2exr2.4.A}, we know the morphism 
$$
\calo_X(U)\lrta \prod_{p\in U}\calo_{X,p}
$$
is injective, therefore we know $f=0\in\calo_X(U)$.

We have to clarify what it means by ``agree on all points''. It means given any affine open subset $U$, $(U,\calo_X(U))\cong (\spec A,\calo_{\spec A})$, $f|_U\equiv g|_U\mod \scp,\forall [\scp]\in \spec A$. 
$$
f|_U\equiv g|_U\mod \scp
$$
means $f|_U\equiv g|_U$ divers only by a nilpotent. Because $\calo_X(U)$ is reduced, we have $f|_U=g|_U$. $f,g$ agree when restricted to a base of topology, then $f,g$ have same germs on each stalks which means $f=g$.
\end{proof}
\begin{remark}
We should have mentioned  this before. When $f=g+n$, where $n\in\sqrt{(0)}$, they are generally not equal when taking germs
$$
\frac{n}{1}\neq \frac{0}{1}\in A_\scp.
$$
For example, $A=k[x,\epsilon]/(\epsilon^2)$, $f=x^2,g=x^2+\epsilon$. $\epsilon/1\neq 0/1\in A_{(\epsilon)}$.
\end{remark}

\begin{exr}\label{chap5exr:reduced_ring_reduced_affine_scheme}
If $A$ is a reduced ring, show that $\spec A$ is reduced. Show that $\affn^n_k$ and $\proj^n_k$ are reduced.
\end{exr}
\begin{proof}
 
We state a stronger version: 

\textbf{$\spec A$ is reduced scheme iff $A$ is a reduced ring.}

One direction is already contained in the definition of reduced scheme.

For the other direction, we prove an algebraic fact. Any localization of a reduced ring is reduced.

 Given any multiplicative subset $S\subset A$. Assume $a/s\in S^{-1}A$ is nilpotent $(a/s)^n=0$, there exists $t\in S$ s.t. $ta^n=0\in A$, but then we have $(ta)^n=0\in A$ and $A$ being reduced, hence $ta=0$. $\Lrta a/s=0\in S^{-1}A$.

Exercise~\ref{chap5exr:reducedness_stalk_local} also translate to: $A$ is reduced iff $A_\scp$ is reduced for all $[\scp]\in\spec A$. We will give a algebraic proof here. Remember that taking radical is commutative with localization, $\mathfrak{N}(A)_\scp=\mathfrak{N}(A_\scp)$. Also notice that being zero is a local property for $A$-modules, each $A_\scp$ begin reduced implies $\mathfrak{N}(A)$  is zero.

We even have a stronger version: $A$ is reduced iff $A_\scm$ is reduced for all maximal ideals in $A$. (Because the ``being zero'' local property of $A$-module says an $A$ module $M$ is zero iff $M_\scm$ is zero module for all maximal ideals in $A$.)

But note that being reduced can not be checked only on closed points for general schemes, we need quasicompactness, see Exercise~\ref{chap5exr:quasicompact_scheme_reducedness_closed_point} below.


Then $\affn^n_k$ is reduced because $k[x_1,...,x_n]$ is reduced. On the other hand, $\proj^n_k$ is reduced because it can be covered by $\affn^n_k$ and hence each stalk is reduced.
\end{proof}



\begin{exr}
Show that  $\left(k[x, y]/(y^2, xy)\right)_x$  has no nonzero nilpotent elements.
(Possible hint: show that it is isomorphic to another ring, by considering the geometric picture. Exercise~\ref{chap3exr:3.2.L} may give another hint.) Show that the only point of $\spec k[x, y]/(y^2 , xy)$ with a nonreduced stalk is the origin.

\end{exr}
\begin{proof}
Geometrically $\spec \left(k[x, y]/(y^2, xy)\right)_{\bar{x}}=$ the distinguished open $D([x])$ in $\spec k[x, y]/(y^2, xy)$. It is equivalent to the non-vanishing loci of $x$ in $V(y^2,xy)$ in the affine plain, which is the affine line with origin removed. This geometric picture gives us some intuition

\underline{Claim}:
$$
\left(k[x, y]/(y^2, xy)\right)_{\bar{x}}=k[x]_{x},
$$
where $\bar{x}$ is the image of $x$ in the quotient ring. A general element in $k[x, y]/(y^2, xy)$ is of the form
$$
p(\bar{x})+a\bar{y},
$$
where $p$ is a polynomial in $k[x]$, $a$ is a constant in $k$ and $\bar{x}\bar{y}=0$ and $\bar{y}^2=0$.
A general element in $\spec \left(k[x, y]/(y^2, xy)\right)_{\bar{x}}$ is of the form
$$
\frac{p(\bar{x})}{\bar{x}^n}.
$$
$\bar{y}/1=0$ because $\bar{x}\bar{y}=0$.
 There is a well-define ring morphism
$$
\frac{p(\bar{x})}{\bar{x}^n}\mapsto \frac{p(x)}{x^n},
$$
Which is obviously an isomorphism.

$k[x]_x$ is reduced because $k[x]$ is reduced. We then know there is no nonzero nilpotents in $\left(k[x, y]/(y^2, xy)\right)_{\bar{x}}$.

Consider the ring of $\spec \left(k[x, y]/(y^2, xy)\right)$. The prime ideals of this ring corresponds to prime ideals in $k[x,y]$ that contains $(y^2,xy)$. Hence a general prime ideal in this ring is of the form $(\bar{x}-a, \bar{y})$. 
When $a\neq 0$, $\bar{x}\notin (\bar{x}-a,\bar{y})$. $\bar{x}$ is invertible in $\left(k[x, y]/(y^2, xy)\right)_{(\bar{x}-a,\bar{y})}$, hence it is further localization of $\left(k[x, y]/(y^2, xy)\right)_{\bar{x}}$ and should be reduced.

When $a=0$, we focus on the ring
$$
\left(k[x, y]/(y^2, xy)\right)_{(\bar{x},\bar{y})}.
$$
The multiplicative set consists of elements like $b(\bar{x})+c\bar{y}$, where $b(\bar{x})$ is a polynomial of $\bar{x}$ and the constant term $b_0\neq 0$. $\bar{y}(b\bar{x}+c\bar{y})^n=b_0^n\bar{y}\neq 0$, therefore $\bar{y}/1\neq 0/1$. And $\bar{y}/1$ is nilpotent.

$\left(k[x, y]/(y^2, xy)\right)_{(\bar{x},\bar{y})}$ contains at leas one nonzero nilpotent $\bar{y}/1$, hence is nonreduced.
\end{proof}


\begin{exr}\label{chap5exr:quasicompact_scheme_reducedness_closed_point}
If $X$ is a quasicompact scheme, show that it suffices to check reducedness at closed points. Hint: Do not try to show that reducedness is an open condition (see Remark 5.2.2). Instead show that any nonreduced point has a nonreduced closed point in its closure, using Exercise~\ref{chap5exr:quasicompact_global_section_vanishes_on_point_nilpotent}. (This result is interesting, but we won’t use it.)
\end{exr}
\begin{proof}
Follow the hint, we prove the contrapositive: If a quasicompact scheme is not reduced then at least one of its closed points has non-reduced stalk.

By definition, we know if $X$ is not reduced then at least one of its stalk is not reduced by~\ref{chap5exr:reducedness_stalk_local}. Denote this non-reduced point by $p$, then there is a closed point $z\in \overline{\{p\}}$ by~\ref{chap5exr:quasicompact_scheme_have_closed_points}. (I suppose the hint in the body of this problem is wrong). The stalk $\calo_{X,p}$ is a localization of the stalk $\calo_{X,z}$ at closed point. $\calo_{X,p}$ is not reduced, therefore $\calo_{X,z}$ is also non-reduced.
\end{proof}



\begin{exr}\label{chap5exr:quasicompact_global_section_vanishes_on_point_nilpotent}
Suppose $X$ is quasicompact, and $f$ is a function that vanishes at all points of $X$. Show that there is some $n$ such that $f^n = 0$. Show that this may fail if $X$ is not quasicompact. (This exercise is less important, but shows why we like quasicompactness, and gives a standard pathology when quasicompactness doesn’t hold.)
\end{exr}
\begin{proof}
$f$ is a global section on a quasicompact scheme $X$ that vanishes at each point. 

$X$ is quasicompact and can be written as a finite union of affine open subschemes $\cup_i U_i$, where each $U_i\cong \spec A_i$. We then have $f|_{U_i}\calo_X(U_i)=A_i$. $f|_{U_i}$ vanishes on each point $[\scp]\in \spec A_i$ and hence is an element in the nilpotent $\mathfrak{A_i}$, $\Lrta f_{U_i}^{n_i}=0$ for some $n_i\in\intg$. There are only finitely many such affine opens, we can choose $n:=\max_i\{n_i\}$ and then $f^n|_{U_i}=0\in \calo_X(U_i)$ and there is only one element $0$ to glue to in the global section.

For the counterexample when $X$ is not quasicompact, we follow the hint and consider the union of infinite disjoint union of $\spec A_n$, where $A_n=k[\epsilon]/(\epsilon^{n})$. Each $\spec A_n$ consists of only one point $[(\epsilon)]$. Consider the function $f=\coprod_n \epsilon$. We know $f$ vanishes at each each point but is not nilpotent in the global section.
\end{proof}

\begin{exr}\label{chap5exr:integral=irreducible+reduced}
Show that a scheme $X$ is integral if and only if it is irreducible and reduced. (Thus we picture integral schemes as: ``one piece, no fuzz'')
\end{exr}
\begin{proof}
In a scheme $X$ is integral, $\calo_X(U)$ is integral for all open subsets, hence $\calo_X(U)$ is also reduced because integral domain has no nonzero zero divisors.

An integral scheme should be irreducible. Assume contrarily $X$ is reducible, and can be written as union of two closed subsets $X=Y\cup Z$. Define the complements $U:=X-Y$ and $V=X-Z$, we know $U,V$ are nonempty opens and their have empty intersection. The structure sheaf $\calo_X(U\cup V)=\calo_X(U)\times \calo_X(V)$ which is not integral in general.


For the reverse direction, we would use the hint~\ref{chap3exr:locally_ringed_space_function_value}.

\underline{Claim}: Any open subset $U$ in a irreducible space $X$ is irreducible with the subset topology.

For any other nonempty open subset $U\subset X$. By~\ref{chap3exr:irreducible_subset_dense_open_irreducible_closure}, $U$ is dense in $X$. Assume $U$ is reducible and can be written as $(Y\cap U)\cup (Z\cap U)=(Y\cup Z)\cap U$, where $Y,Z$ are nonempty proper closed subsets in $X$. 
We also know $Y\cup Z\supset U$. Hence $\overline{Y\cup Z}=\overline{Y}\cup \overline{Z}=Y\cup Z\supset \overline{U}=X$, which means $X$ is reducible, contradiction. 

Given $f,g\in\calo_X(U)$ and $fg=0\in\calo_X(U)$. Recall~\ref{chap3exr:locally_ringed_space_function_value}, the set where $f,g$ vanishes is closed. (Notice here vanishes means $f_pg_p\in\scm_p$). $U$  could be covered by the closed set $V$ $f$ vanishes and the closed set $W$ where $g$ vanishes. Then because $X$ is irreducible, we know $W$ or $V$ must be the whole space $X$. Assume $f$ vanishes on every point in $X$, we know $f=0\in \calo_X(U)$ because $U$ is a reduced scheme~\ref{chap5exr:reducedness_stalk_local}.
\end{proof}

\begin{exr}
Show that an affine scheme $\spec A$ is integral if and only if $A$ integral domain.
\end{exr}
\begin{proof}
The ``only if'' direction is obvious, because $\Gamma(\spec A,\calo_{\spec A})=A$.


Consider the ``if'' direction. We simply have $\spec A$ is irreducible if $A$ is an integral domain by~\ref{chap3exr:Integral_domain_irreducible}. Also an integral domain is always reduced ring, hence $\spec A$ is  reduced by~\ref{chap5exr:reduced_ring_reduced_affine_scheme}. We know $\spec A$ is irreducible and reduced if $A$ is integral domain, hence $\spec A$ is integral by~\ref{chap5exr:integral=irreducible+reduced}.
\end{proof}


\begin{exr}\label{chap5exr:generic_point_integral_scheme_function_field}
Suppose $X$ is an integral scheme. Then $X$ (being irreducible) has a generic point $\eta$. Suppose $\spec A$ is any nonempty affine open subset of $X$. Show that the stalk at $\eta$, $\calo_{X,\eta}$ is naturally identified with $K(A)$, the fraction field of $A$. This is called the \textbf{function field} $K(X)$ of $X$. It can be computed on any nonempty open set of $X$, as any such open set contains the generic point. The reason for the name: we will soon think of this as the field of \textit{rational functions} on $X$
\end{exr}
\begin{proof}
Suppose $X$ is an integral scheme. $X$ is itself irreducible closed and hence corresponds to a unique generic point by~\ref{chap5exr:bijection_closed_generic_point_scheme}. This generic point $\eta$ is contained in any open subset of $X$. Specifically, it is contained in affine open $U:=\spec A$ and corresponds to $[(0)]\in \spec A$, where $A$ is an integral domain. $\calo_{X,\eta}\cong A_{[(0)]}=K(A)$, where localization at the prime ideal $(0)$ is isomorphic to the fraction field $K(A)$.
\end{proof}

\begin{exr}
Suppose $X$ is an integral scheme. Show that the restriction maps $\res_{U,V}: \calo_X(U) \lrta \calo_X(V)$ are inclusions so long as $V\neq \emptyset$. Suppose $\spec A$ is any nonempty affine open subset of $X$ (so $A$ is an integral domain). Show that the natural map $\calo_X(U) \lrta  \calo_{X,\eta} = K(A)$ (where $U$ is any nonempty open subset) is an inclusion.
\end{exr}
\begin{proof}
In fact, the first question relies on the second. Because we have the composition of maps
$$
\calo_X(U)\overset{\res_{U,V}}{\lrta}\calo_X(V)\lrta\calo_{X,\eta},
$$
it suffices to prove $\calo_X(U)\lrta \calo_{X,\eta}$ is injective. ($\res_{U,V}$ has to be injective because its composition with an injection is again an injection.)

\underline{Claim}: $\calo_X(U)\lrta K(X)$ is injective.

Assume a section $f\in\calo_X(U)$ and $f_\eta=0$. \underline{Want}: $f=0\in \calo_X(U)$. It suffices to prove that $f_\eta\Lrta f|_W=0$ for all affine open subsets contained in $U$. 

For an affine open $W=\spec A$, the natural morphism
$$
\calo_X(W)\lrta \calo_{X,\eta}=K(A)
$$
as shown in~\ref{chap5exr:generic_point_integral_scheme_function_field}. This map must be the canonical inclusion because the stalk at $[(0)]$ is a further localization of any $A_f=\calo_{\spec  A}(D(f))$.

We have prove both questions.
\end{proof}

\section{Properties of schemes that can be checked ``affine-locally''}
\begin{exr}
Show that locally Noetherian schemes are quasiseparated.
\end{exr}
\begin{proof}
In a locally Noetherian scheme, each affine open is isomorphic to $\spec A$ for some Noetherian ring $A$. By~\ref{chap5exr:characterization_quasiseparatedness}, we can check whether any intersection of two affine open can be written as finite union of affine opens.

Given $U=\spec A$ and $V=\spec B$ for $A,B$ Noetherian rings, consider then intersection $U\cap V$.  By proposition 5.3.1, we know $U\cap V$ can be written as union of open sets such that are simultaneously distinguished open subschemes in $\spec A$ and $\spec B$. But notice by~\ref{chap3exr:open_subset_Noetherian_space_quasicompact} that open subset of Noetherian space is quasicompact, we can cover $U\cap V$ with finitely many simultaneous distinguished opens, which are affine opens.

We don't need Prop 5.3.1 to prove this statement but it is more clear to see which of the affine opens are selected.
\end{proof}


\begin{exr}\label{chap5exr:Noetherian_scheme_finite_irreducible_compoenents}
Show that a Noetherian scheme has a finite number of irreducible components. (Hint: Proposition 3.6.15.) Show that a Noetherian scheme has a finite number of connected components, each a finite union of irreducible components.
\end{exr}
\begin{proof}
\underline{Claim}: The underline topological space of a Noetherian scheme is Noetherian.

Note that a Noetherian scheme is locally Noetherian and quasicompact, we know a Noetherian scheme $X$ can be covered by finitely many Noetherian affine subschemes.

\underline{subclaim}: A finite union of Noetherian subspace is also Noetherian.

We can prove the subclaim directly by checking the descending chain condition on closed subsets. Given a chain $V_0\supset V_1\supset \cdots$, each $V_i$ can be covered by finitely many $U_j$, where $U_j$ is Noetherian subsapce. It renders a descending chain of closed subset in $U_j$ with subset topology, hence will stabilize after $n_j$. Choose $N=\max\{n_j\}$, we have $V_n=\cup_n (V_N\cap U_j)$ would stabilize when $n\geq N$.


Then in particular, we know a Noetherian scheme is Noetherian topological space and by Prop 3.6.15, we know it has only finitely many irreducible components.


Exercise~\ref{chap3exr:topology_irreducible_components_connected_components} already showed that connected components in topological space $X$ are unions of irreducible components of $X$. But in the case of Noetherian scheme, there are only finitely many irreducible components, hence $X$ is the union of finitely many connected components and each connected component is union of finitely many irreducible components.
\end{proof}

\begin{exr}\label{chap5exr:Noetherian_scheme_integral_stalk}
Show that a Noetherian scheme $X$ is integral if and only if $X$ is nonempty and connected and all stalks $\calo_{X,p}$ are integral domains. Thus in ``good situations'', integrality is the union of local (stalks are integral domains) and global (connected) conditions.
\end{exr}
\begin{proof}
We follow the hint and recall Exercise~\ref{chap5exr:integral=irreducible+reduced} says integral $=$ irreducible $+$ reduced. Note that ``being reduced'' is stalk-local~\ref{chap5exr:reducedness_stalk_local}. 

$\Lrta$ direction is easy:

``Irreducible'' alone guarantees that $X$ is connected. And also note that localization of integral domain is also integral domain because $\frac{a}{s}\frac{b}{t}=\frac{0}{1}\Lrta \exists r\in S, rab=0\Lrta ab=0$.

We want to prove the reverse direction under Noetherian hypothesis.

Each stalk being integral domain alone implies each stalk is reduced, hence the scheme $X$ is reduced.

\underline{Want}: under Noetherian hypothesis, connected $+$ stalks being integral domain $\Lrta$ $X$ is irreducible.

$X$ is Noetherian, we know each connected component is union of finitely many irreducible components. We know $X$ is  connected and hence $X$ is the union of finitely many irreducible components, and some of the pair-wise intersections of these irreducible components are nonempty to make sure their union is  connected.

Assume $Y,Z$ are two of these irreducible components and their intersection is non-empty. $p\in Y\cap Z$. \underline{Claim}: $\calo_{X,p}$ is not integral domain.

Choose an affine open $U\ni p$, $U=\spec A$ is the union of $U\cap Y$ and $U\cap Z$, $U$ is not irreducible and $A$ is not integral domain~\ref{chap3exr:Integral_domain_irreducible}. Assume $U\cap Y=V(\scq_1)$ and $U\cap Z=V(\scq_2)$, where $\scq_1,\scq_2$ are two prime ideals in $A$, they should be minimal prime because there is a bijection~\ref{chap3exr:irreducible_components_minimal_pirmes_bij} between the minimal primes and irreducible components in $\spec A$. $V(\scq_1)\cap V(\scq_2)=V(\scq_1+\scq_2)$. $p=[\scp]\in V(\scq_1+\scq_2)\Lrta \scq_1+\scq_2\subset \scp$. The stalk at $p$, is $\calo_{X,p}=A_\scp$. Then there are at least two minimal prime ideals in $A_\scp$, therefore $A_\scp$ can not be integral domain.

In short, we have
\textbf{the minimal primes in $\calo_{X,p}$ is in one to one correspondence with the irreducible components that pass through $p$}.

The only possibility is that $X$ is irreducible. Combined with our proof that $X$ is reduced, we know $X$ is integral scheme.
\end{proof}

\begin{exr}\label{chap5exr:quasiprojective=>finite_type;Open_subschem_of_Noetherian_projective_scheme_is_of_finite_type}\ 
\begin{enumerate}[label=(\alph*)]
\item (quasiprojective implies finite type)
If $X$ is a quasiprojective $A$-scheme (Definition 4.5.9), show that $X$ is of finite type over $A$. If $A$ is furthermore assumed to be Noetherian, show that $X$ is a Noetherian scheme, and hence has a finite number of irreducible components.
\item Suppose $U$ is an open subscheme of a projective $A$-scheme. Show that $U$ is locally of finite type over $A$. If $A$ is Noetherian, show that $U$ is quasicompact, and hence quasiprojective over $A$, and hence by (a) of finite type over $A$. Show this need not be true if $A$ is not Noetherian. Better: give an example of an open subscheme of a projective $A$-scheme that is not quasicompact, necessarily for some non-Noetherian $A$.
\end{enumerate}
\end{exr}
\begin{proof}\ 
\begin{enumerate}[label=(\alph*)]
\item a quasiprojective $A$-scheme $X$ is a quasicompact open subscheme of projective $A$-scheme $Y$.

A projective $A$-scheme is of the form $Y:=\Proj S_\bullet$, where $S_\bullet$ is finitely generated graded ring over $A$. It is locally of finite type over $A$. Because it is covered by affine open sets $\spec ((S_\bullet)_f)_0$, where $(S_\bullet)_f$ is finitely generated over $A$ because it is generated by $\{S_\bullet, 1/f\}$ hence its degree zero piece is finitely generated over $A$.

Recall the Affine Communication Lemma~5.3.2 and also check that ``being finite over $A$'' is indeed an affine-local property. Then $Y=\cup_{i\in I}\spec B_i$ and $\spec B_i$ is of finite generated algebra over $A$, $\Lrta$ any affine open $U\subset X$ is of finite type over $A$. In particular $X$ can be cover covered by affine open $\spec_{j\in J} B_j$, where $B_j$ is finitely generated $A$-algebra, therefore $X$ is of locally finite type over $A$. In addition $X$ is quasicompact, we know $X$ is of finite type over $A$.

If $A$ is furthermore assumed to be Noetherian, then each affine open of $X$ is isomorphic to $\spec B_i$, where $B_i$  is Noetherian because $B_i$ is finitely generated over a Noetherian ring $A$, hence is also Noetherian by Hilbert basis theorem. Then it has finite number of irreducible components by~\ref{chap5exr:Noetherian_scheme_finite_irreducible_compoenents}.

\item For same reasons, an open subscheme in a scheme of locally of finite type over $A$ is locally of finite type over $A$, therefore any open subscheme $U$ of a projective $A$-scheme $Y$ is locally of finite type over $A$.

If $A$ is Noetherian, we know $U$ is locally Noetherian. Also notice that a projective $A$-scheme is quasicompact and quasiseparated by~\ref{chap5exr:Proj_A-scheme_quasicompact_quasiseparated}. 

\textbf{A projective $A$-scheme over a Noetherian ring $A$ is a Noetherian scheme.} 


By~\ref{chap3exr:open_subset_Noetherian_space_quasicompact}, an open subset of a Noetherian topological space is quasicompact. We know $U$ is quasicompact and locally Noetherian, hence is Noetherian. $U$ is also quasiprojective and of finite type over $A$.

As for the counterexample. Consider the silly example 4.5.11, $\Proj A[T]\cong\spec A$, where $x_0=T$ is of degree $1$. Also recall~\ref{chap3exr:affine_scheme_quasicompact}, $\spec A$ can have non-quasicompact open subscheme.
\end{enumerate}
\end{proof}
\begin{remark}\label{chap5rmk:open_subscheme_Noetherian}
The part of (locally)Noetherian and quasicompactness does not depend on (Projective), hence we have in general:

\textbf{
Any open or closed subscheme of a (locally) Noetherian scheme is
(locally) Noetherian.}
\end{remark}

\begin{exr}\ 
\begin{enumerate}[label=(\alph*)]
\item
Showthat $\spec k[x_1,...,x_n]/I$ is an affine $k$-variety if and only if $I \subset k[x_1,...,x_n]$ is a radical ideal.
\item Suppose $ I \subset  k[x_0,...,x_n]$ is a radical graded ideal. Show that $\Proj k[x_0,...,x_n]/I$ is a projective $k$-variety. (Caution: The example of $ I = (x_0^2, x_0x_1,...,x_0x_n)$ shows that $\Proj k[x_0,...,x_n]/I$ can be a projective $k$-variety without $I$ being radical.)
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item $X:=\spec k[x_1,...,x_n]/I$ is of finite type over $k$.

$k$ is Noetherian, $\spec k[x_1,...,x_n]/I$ is a projective $k$-scheme. We know open subscheme of a projective $A$-scheme over a Noetherian ring is of finite type over $A$ by Exercise~\ref{chap5exr:quasiprojective=>finite_type;Open_subschem_of_Noetherian_projective_scheme_is_of_finite_type}.

\underline{Want}:
$\spec k[x_1,...,x_n]/I$ is reduced iff $I$ is radical ideal.

Recall~\ref{chap5exr:reduced_ring_reduced_affine_scheme}, an affine scheme $\spec A$ is reduced iff $A$ is reduced.
The nilradical of $k[x_1,...,x_n]/I$ is just $\sqrt{I}$. We know $k[x_1,...,x_n]/I$ is reduced iff $I$ is radical.
\item We define projective $k$-variety to be reduced $k$-scheme. $\Proj k[x_1,...,x_n]/I$ is automatically of finite type over $k$ by~\ref{chap5exr:quasiprojective=>finite_type;Open_subschem_of_Noetherian_projective_scheme_is_of_finite_type}. 

We know $I$ is radical homogeneous ideal, then $S_\bullet:=k[x_1,...,x_n]/I$ is a reduced graded ring, hence $((S_\bullet)_f)_0$ is reduced and so is any further localizations. We have checked any stalks of $\Proj k[x_1,...,x_n]/I$ is reduced ring, hence it is a reduced projective $k$-scheme, i.e., a projective $k$-variety.
\end{enumerate}
\end{proof}

\begin{exr}
Show that a point of a locally finite type $k$-scheme is a closed point if and only if the residue field of the stalk of the structure sheaf at that point is a finite extension of $k$. Show that the closed points are dense on such a scheme (even though it needn't be quasicompact, cf. Exercise~\ref{chap5exr:quasicompact_scheme_have_closed_points}).
\end{exr}
\begin{proof}
We have a stronger version, for a locally finite type $k$-scheme $X$, the followings are equivalent:
\begin{enumerate}[label=(\alph*)]
	\item the point $p\in X$ is closed point
	\item the field extension $k\inj K(\calo_{X,p})$  is finite
	\item the field extension $k\inj K(\calo_{X,p})$ is algebraic
\end{enumerate}
$p$ is contained in an affine open subset $U=\spec A$ of $X$, where $A$ is a $k$-algebra and it corresponds to a maximal ideal $\scm$ in $A$. By Hilbert Nullstellensatz, $K(\calo_{X,p})\cong A/\scm$ is a finite field extension of $k$.

A finite field extension is automatically an algebraic field extension. These proves $(a)\Lrta (b),(c)$.

For $(c)\Lrta (a)$, $p$ is a point in $\spec A$, and $\scp$ is the corresponding prime ideal. $K(\calo_{X,p})\cong Frac(A/\scp)$ is algebraic over $k$, (It is integral over $k$, hence the integral domain $A/\scp$ is integral over $k$.) Recall a lemma in commutative algebra, Lemma 1.9 in~\cite{gortz2010algebraic}. Or one can use directly \cite[\href{http://stacks.math.columbia.edu/tag/00GS}{Lemma 00GS}]{stacks-project}

$B$ is integral over $A$, and both of them are integral domains. Then
${A}$ is a field $\Llrta$ ${B}$ is a field.

We know then $A/\scp$ is a field, therefore $\scp$ is a maximal ideal ideal, which means $p$ is a closed point.


\underline{Claim}:Let $k$ be a field. Let $X$ be a $k$-scheme locally of finite type. Let $U$ be a non-empty affine open subset of $X$. Then any closed point of $U$ is a closed point of $X$.

In an affine open subset $U\subset X$, the residue field at a closed point $p$ is finite field extension of $k$, which means it is also a closed point in $X$.

Hence, there is a closed point in each  affine open, therefore the closed point is dense in $X$.
\end{proof}

\begin{exr}
Suppose $X$ is a reduced, finite type $\cplx$-scheme. Define the corresponding complex analytic prevariety $X_{an}$. (The definition of an analytic prevariety is the same as the definition of a variety without the Hausdorff condition.) 
\end{exr}
\begin{proof}
It would be a long story, \textbf{To Be Added}. The major reference should be Chapter$4-5$ of ~\cite{neeman2007algebraic}
\end{proof}


\begin{exr}
Finish the proof of Proposition 5.3.3(a).
\end{exr}
\begin{proof} $A=(f_1,...,f_n)$.
It remains to show that, given a strictly increasing chain of ideals $I_1\subsetneq I_2\subsetneq \cdots$ in $A$, we can construct a strictly increasing chain of ideals in $A_{f_i}$ by
$$
I_{i,1}\subset I_{i,2}\subset \cdots,
$$
where $I_{i,j}=I_j\otimes_A A_{f_i}$. It suffices to show that for each $j$,
$$
I_{i,j}\subsetneq I_{i,j+1},
$$
for some $i$. (Notice that this does mean there is a strictly increasing chain is some $A_{f_i}$)
But it means there is  at least a chain $I_{i,1}\subset I_{i,2}\subset \cdots,$ not stabilize in the Noetherian ring $A_{f_i}$, contradiction.

Each $I_{i,j}$ could be interpreted as localization of the $A$-module $I_j$ at $f_i$ by~\ref{chap1exr:localization_extension_of_scalar}

\underline{Claim}:
$A=(f_1,...,f_n)$. Consider an $A$-module $M$, it is zero iff $M_{f_i}=0$ for all $f_i$. 

We only need the part: $\forall f_i, M_{f_i}=0\Lrta M=0$. Assume $M_{f_i}=0$ for all $i$, choose $m\in M$, exists $n_i\geq 0$ s.t., $f_i^n m=0$. On the other hand $1=\sum_{i=1}^nr_i f_i$, choose $N\geq \sum_{i=1}^n n_i+1$. $1\cdot m=1^Nm=(\sum_i r_i f_i)^N=\sum_i a_i f_i^{n_i}m=0$. Hence $M=0$.

Or equivalently, we can prove it by observing that each $M_{\scp}$ is further localization of some $M_{f_i}$. All $M_{f_i}=0$ implies all $M_\scp=0$, which in return implies $M=0$~\cite[\href{http://stacks.math.columbia.edu/tag/00HN}{Lemma 00HN}]{stacks-project}.

We apply the above claim to $I_{j+1}/I_j\neq0$, therefore we have for each $j$,
$$
I_{i,j+1}/I_{i,j}\neq 0
$$
for some $i$.
\end{proof}

\begin{exr} In text, we want to prove the proposition 

``Given $A=(f_1,...,f_n)$, then $A$ is a finitely generated $B$-algebra iff each $A_{f_i}$ is a finitely generated $B$-algebra.''

with some ``partition of unity argument''.
Make this argument precise.
\end{exr}
\begin{proof}
One direction is clear, $\spec A_{f_i}$ is generated by $A,1/f_i$. If $A$ is a finitely generated $B$-algebra, so is $A_{f_i}$.

$A$ is generated by $f_i$. $1=\sum_i c_i f_i$ for $c_i\in A$. $A_{f_i}$ is finitely generated as $B$-algebra and we assume its generators are $\{r_{ij}/f_i^{k_j}\}$. 

\underline{Claim:}$\{f_i\}\cup \{c_i\}\cup \{r_{ij}\}$ generate $A$ as a $B$-algebra.

$r$ is an element in $A$ and restricts to $r/1\in A_{f_i}$, which could be written as
$$
\sum_j b_{ij} \frac{r_{ij}}{f_{i}^{k_{ij}}}=\frac{\sum_j b_{ij}r_{ij}f_i^{K_{ij}} }{f_i^{Q_{i}}}=:\frac{P_i(r_{ij},f_i)}{g_i},
$$
where  we define $P_{i}:=\sum_j b_{ij}r_{ij}f_i^{K_{ij}}\in B[r_{ij},f_i]$ and $g_i:=f_i^{Q_i}$ for simplicity. 

$P_i/g_i$ and $P_j/g_j$ would agree on $A_{g_ig_j}$, which means
$$
(g_i g_j)^{m_{ij}}(P_i g_j-P_j g_i)=0.
$$
By taking $m=\max\{m_{ij}\}$, (the indexing set is finite), we can simplify the notation
$$
(g_i g_j)^{m}(P_i g_j-P_j g_i)=0,
$$
for all $i,j$.

Let $T_i:=g_i^m P_i$ and $h_j:=g_j^{m+1}$, we have
$$
T_i h_j-T_j h_i=0.
$$

Now, because $D(f_i^n)=D(f_i)$, we have $\spec A=\cup_i D(h_i)$ and this implies $1=\sum_i s_i h_i$, where each $s_i$ can be written as a polynomial of $c_i,f_i$.
Define 
$$
r':=\sum_i s_i T_i.
$$
$r'$ restricts to each $T_i/h_i$, because 
$$
r'h_j=\sum_i {s_i T_i}h_j=\sum_i s_i h_i T_j=T_j.
$$
In other words, it restricts to each 
$$
\sum_j b_{ij} \frac{r_{ij}}{f_{i}^{k_{ij}}}
$$
and by the identity axiom $r=r'$, which can be expressed as a polynomial in $B[\{f_i\}\cup \{c_i\}\cup \{r_{ij}\}]$

\end{proof}


\section{Normality and factoriality}
\begin{exr}
Show that integrally closed domains behave well under localization: if $A$ is an integrally closed domain, and $S$ is a multiplicative subset not containing $0$, show that $S^{-1}A$ is an integrally closed domain.
\end{exr}
\begin{proof}
Assume $x\in K(A)$ is integral over $S^{-1}A$. It satisfies a monic polynomial
$$
x^n+\frac{a_{n-1}}{s_{n-1}}x^{n-1}+\cdots +\frac{a_{0}}{s_0}=0.
$$
Define $s:=\prod_i s_i$ and if multiply the above equation by $s^n$, we get a polynomial of $sx$ with coefficients in $A$. Because $A$ is integral closed, we know $sx\in A$, hence $x\in S^{-1}A$, which means $S^{-1}A$ is integral closed.
\end{proof}


\begin{exr}
Show that a Noetherian scheme is normal if and only if it is the finite disjoint union of integral Noetherian normal schemes.
\end{exr}
\begin{proof}
$\Lrta$ direction: A Noetherian scheme $X$ is normal at least implies each stalks of this scheme is integral. Recall each connected component is open subscheme and open subscheme of Noetherian scheme is Noetherian (Remark~\ref{chap5rmk:open_subscheme_Noetherian}).

 By~\ref{chap5exr:Noetherian_scheme_integral_stalk}, each connected component of $X_i$ is a integral scheme. Also by~\ref{chap5exr:Noetherian_scheme_finite_irreducible_compoenents}, a Noetherian scheme has only finitely many connected components.

Then we know $X$ is a disjoint finite union of integral Noetherian normal schemes.

$\Llta$ direction is clear. Because normality is stalk-local, we know a finite union of integral Noetherian normal schemes is normal and it is Noetherian because it can be covered by finite Noetherian affine opens. 
\end{proof}

\begin{exr}
If $A$ is an integral domain, show that $A = \cap A_\scm$, where the intersection runs over all maximal ideals of $A$.
\end{exr}
\begin{proof}
If we interpret them as subsets in $K(A)$, we have clearly
$$
A\subset \cap A_\scm.
$$
As for the reverse direction, we claim:
$$
K(A)\backslash A\subset K(A)\backslash \cap A_\scm.
$$
If nonempty, pick $s\in K(A)\backslash A$, we can construct the ideal of denominators of $s$
$$
I_s:=\{r\in A:rs\in A\}
$$
$I_s\neq A$ because $1\notin I_s$. Then $I_s\subset \scm$ for some maximal ideal. $s\notin A_\scm$.
\end{proof}

\begin{exr}\label{chap5exr:5.4.D}
One might naively hope from experience with unique factorization domains that the ideal of denominators is principal. This is not true. As a counterexample, consider our new friend $A = k[w, x, y, z]/(wz - xy)$ (which we first met in Example 4.4.12, and which we will later recognize as the cone over the quadric surface), and $w/y = x/z \in K(A)$. Show that the ideal of denominators of this element of $K(A)$ is $(y, z)$.
\end{exr}
\begin{proof}
Denote the element $s:=w/y=x/z$. we easily check that $(y,z)\subset I_s$.

Assume $t\in I_s$, we have 
$$
tw/y=tx/z\in A,
$$
hence $tw=ya$. Then $t$ can not contain monomials in $w,x$. Furthermore, $t$ can not contain terms with only $w,x$ because $w^nx^m$ can not be a multiple of $y$. As a result, $t\in (y,z)$.
\end{proof}

\begin{exr}\label{chap5exr:localization_of_UFD}
Show that any nonzero localization of a unique factorization domain is a unique factorization domain.
\end{exr}
\begin{proof}
Recall the definition of a UFD. A UFD is an integral domain in which every non-zero element $x$ of $R$ can be written as a product of irreducible elements and a unit and this product is unique up to order of irreducible elements and units. 

An equivalent characterization is ``an integral domain $R$ in which every non-zero element can be written as a product of unit and  prime elements of $R$''.

We prove the statement based on the second characterization. $S\subset R$ is a multiplicative set and let $T$ be the set of all prime elements that divides an element of $S$, and let $M$ be the set of all prime element not in $T$.

\underline{Claim}: $p\in T$ iff image of $p$ in $S^{-1}R$ is a unit.

Indeed, if $p\in T$, then there exists $s\in S$, such that $p|s$; Let $x\in R$ with $px=s$. Then
$$
\frac{p}{1}\cdot\frac{x}{s}=\frac{ps}{s}\cdot \frac{x}{s}=1_{S^{-1}R}.
$$

For the ``if'' part, consider $p/1$ a unit, there is an inverse $v/s$, $\exists t\in S$ s.t., $pvt=st$, $pv=s$ because $0\notin S$ and $R$ is integral domain.

\underline{Claim}: if $p\in M$, then $p/1\in S^{-1}R$ is prime.

Assume $p/1|(a/s)(b/t)$, $(p c)/(r)=(ab)/(st)$, because $R$ is iintegral domain, $pcst=ab r$. Then we know $p|ab$ or $p|r$ because $p$ is prime, but we assumed $p\nmid s\forall s\in S$. Then we have $p|a$ or $p|b$ because $p$ is prime, which means $p/1|a/s$ or $p/1|b/t$ in return.

Now given $a=up_1^{b_1}\cdots p_r^{b_r}q_1^{c_1}\cdots q_t^{c_t}$ be a prime factorization of $a$, where $p_i\in T$ and $q_j\in M$. We have
$$
\frac{a}{s}=\frac{u}{s}\left(\frac{p_1s}{s}\right)^{b_1}\cdots \left(\frac{p_rs}{s}\right)^{b_r}\left(\frac{q_1s}{s}\right)^{c_1}\cdots \left(\frac{q_ts}{s}\right)^{c_t}.
$$
Then we know each $a/s\in S^{-1}R$ can be factorized into product of a unit and prime elements.

This proof is a improved version of~\href{https://math.stackexchange.com/q/140596}{This Answer}, in that we don't need to verify the uniqueness of factorization.
\end{proof}

\begin{exr}
Show that unique factorization domains are integrally closed. Hence factorial schemes are normal, and if $A$ is a unique factorization domain, then $\spec A$ is normal. 
\end{exr}
\begin{proof} Assme $R$ is a UFD, denote the fraction field by $K(R)$.
Let $x\in K(R)^{\times}$, say $x=r/s$, $gcd(x,s)=1$, $r,s\in R, s\neq 0$. Suppose $\exists a_1,..,a_n\in R$ s.t.,
$$
x^n+a_1 x^{n-1}+...+a_n=0.
$$
Then after multiplying it by $s^n$, set
$$
r^n=-(a_1 r^{n-1}s+a_2 r^{n-2}s^2+...+a_n s^n)
$$
$\Lrta s|r^n$, $gcd(r^n,s)=1,\Lrta s\in R^\times\Lrta x\in R$.

Then we have ``all stalks of a scheme $X$ are UFD'' $\Lrta$ ``all stalks of a scheme $X$ are normal'', which means factorial schemes are normal. 

If $A$ is a UFD,  each stalk  is a localization of $A$ is  therefore UFD by~\ref{chap5exr:localization_of_UFD} . $\spec A$ is factorial $\Lrta$ $\spec A$ is normal.
\end{proof}

\begin{exr}
Show that the following schemes are normal: $\affn^n_k$ , $\proj_k^n$ , $\spec \intg$. (As usual, k is a field. Although it is true that if A is integrally closed then A[x] is as well, this is not an easy fact, so do not use it here.)
\end{exr}
\begin{proof}
$\spec \intg$ is normal because $\intg$ is UFD.

$\affn^n_k=\spec k[x_1,..,x_n]$, where the polynomial ring over a field $k$ is UFD.

$\proj^n_k=\Proj k[x_0,...,x_n]$ can covered by $k[x_{0/i},...,x_{n/i}](x_{i/i}-1)$, which are UFDs, there fore we know each stalk is UFD. Then we know $\proj^n_k$ is factorial and hence normal.
\end{proof}

\begin{exr}\label{chap5exr:handy_characterization_normal_scheme}
Suppose $A$ is a unique factorization domain with $2$ invertible, and $z^2 - f$ is irreducible in $A[z]$.
\begin{enumerate}[label=(\alph*)]
\item Show that if $f \in A$ has no repeated prime factors, then $\spec A[z]/(z^2 - f)$ is normal. Hint: $B := A[z]/(z^2 - f)$ is an integral domain, as $(z^2 - f)$ is prime in $A[z]$. Suppose we have monic $F(T)\in B[T]$ so that $F(T) = 0$ has a root $\alpha$ in $ K(B)\backslash \ K(A).$ Then by replacing $F(T)$ by $\bar{F}(T)F(T)$, we can assume $F(T) \in A[T]$. Also, $\alpha = g+hz$ where $g,h \in K(A).$ Now $\alpha$ is the root of $Q(T) = 0$ for monic $Q(T) = T^2 - 2gT + (g^2 - h^2f) \in K(A)[T]$, so we can factor $F(T) = P(T)Q(T)$ in $K(A)[T]$. By Gauss’s lemma, $2g, g^2 - h^2f \in A$. Say $g = r/2$, $h = s/t$ ($s$ and $t$ have no common factors, $r, s, t \in A$). Then $g^2 - h^2f = (r^2t^2 - 4s^2f)/4t^2$. Then $t$ is invertible.
\item Show that if $f \in A$ has repeated prime factors, then $\spec A[z]/(z^2 - f)$ is not normal.
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item In fact, the hint already gives the detailed solution. We only write here some further explanations.

$A[z]/(z^2-f)$ is integral domain because $z^2-f$ is irreducible and hence is prime element in UFD.

$B$ is equivalent to formally adjoining a pair of roots $\pm \sqrt{f}$. We can take the ``conjugate'' of a monic $F(T)$ be mapping the coefficients $a+b\sqrt{f}$ to $a-b\sqrt{f}$ and we denote the conjugate polynomial $\bar{F}(T)$. Then $\bar{F}(T)F(T)\in A[T]$.

Assume $\alpha\in K(B)\backslash K(A)$ is a root of $F(T)=0$ hence a root of $\bar{F}(T)F(T)=0$,  We replace $F(T)$ by $\bar{F}(T)F(T)$ from now on. \underline{Want}: $\alpha$ is contained in $B$.

The root $\alpha$ can be written as $g+hz$ or equivalently ($g+h\sqrt{f}$), where $g,h\in K(A)$.

Then $\alpha$ is the root of $(T-g-h\sqrt{f})(T-g+h\sqrt{f})=T^2-2gT+g^2-h^2f\in K(A)[T]$, so we can factor $F(T)$ as $P(T)Q(T)\in K(A)[T]$. Recall Gauss' lemma for UFD:

\textbf{Given $A$ is a UFD, and $K(A)$ its fraction field. $F(T)\in A[T]$, if it factors in $K(A)[T]$, then it factors in $A[T]$.} 

Then we know $2g, g^2-h^2f\in A$. Because $2$ is invertible in $A$, we know $g\in A$ hence $h^2f\in A$. Assume $h=r/s$ and $gcd(r,s)=1$, we have $r^2f/s^2\in A$, because $f$ is square free, the only possibility is $s\in A^\times$. Then we know $h\in A$, therefore $\alpha=g+hz=g+h\sqrt{f}\in B$.

We have proved that $B=A[z]/(z^2-f)$ is integral closed, therefore $\spec A[z]/(z^2-f)$ is normal.
\item Assume $f\in A$ has repeated prime factors. 

\underline{Want}: $B:=A[z]/(z^2-f)$ and $B_\scp$ is not integral closed for some $\scp\in \spec B$. By Proposition 5.4.2, it is equivalent to prove $B$ is not integral closed.

\underline{Want}:$F(T)\in B[T]$, find an root of $F(T)=0$, $\beta\in K(B)\backslash K(A)$ s.t., $\beta\notin B$.

Like in $(a)$, we can restrict to the case $F(T)\in A[T]$. Assume $p$ is the repeated prime element in $f$, i.e, $p^2|f$.

We can choose the polynomial $F(T):=T^2-1/p^2 f$, $\sqrt{f}/p$ is a root of $F(T)$ in $K(B)$ and is not an element in $B$.
\end{enumerate}
\end{proof}

\begin{exr}\label{chap5exr:normal_schemes_examples}
Show that the following schemes are normal:
\begin{enumerate}[label=(\alph*)]
\item  $\spec\intg[x]/(x^2-n)$ where $n$ is a square-free integer congruent to $3$ modulo $4$. Caution: the hypotheses of Exercise~\ref{chap5exr:handy_characterization_normal_scheme} do not apply, so you will have to do this directly. (Your argument may also show the result when $3$ is replaced by $2$. A similar argument shows that $\intg[(1+\sqrt{n})/2]$ is integrally closed if $n \equiv 1 (\mod 4)$ is square-free.)
\item
 $\spec k[x_1,...,x_n]/(x^2_1+x_2^2+\cdots+x^2_m)$ where $\char k\neq 2, n\geq m\geq 3$.
\item $\spec k[w, x, y, z]/(wz - xy)$ where $\char\ k\neq  2$. This is our cone over a quadric surface example from Example 4.4.12 and Exercise~\ref{chap5exr:5.4.D}. Hint: Exercise 5.4.J may help. (The result also holds for $\char k = 2$, but don’t worry about this.)
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item $\intg[x]/(x^2-n)\cong B:=\intg[\sqrt{n}]$. Assume a monic polynomial $P(T)\in B[T]$, we can take the conjugate $\bar{P}(T)$ and $\bar{P}(T)P(T)\in \intg[T]$. W.l.o.g, we can set $P(T)\in \intg[T]$. Assume $\alpha=g+h\sqrt{n}\in K(B)\backslash \ratl$ is a root of $P(T)=0$, where $g,h\in \ratl$. $\alpha$ is also a root of $G(T)= T^2 - 2gT + (g^2 - h^2n) \in \ratl[T]$. $P(T)=R(T)G(T)$.

Again, by Gauss's lemma, we have $G(T)\in \intg[T]$.
$$
2g\in \intg
$$
and
$$
g^2-h^2n\in \intg
$$
Assume $g=k/2$ and $h=r/s$, $k,r,s\in\intg$, we have
$$
\frac{k^2}{4}-\frac{r^2n}{s^2}\in \intg
$$
$n=4e+3$ and $k=2q$ or $k=2q+1$. The later case is ruled out. If $k=2q+1$,  the equation reduces to
$$
\frac{1}{4}-\frac{r^2n}{s^2}=m\in \intg
$$
Then we know $r^2 n=s^2/4 +ms^2$ and
$gcd(r,s)=1$ and $n$ is square-free, we know $4|s^2$, assume $s^2=4t^2$, therefore
$$
3r^2\equiv t^2\ (\mod 4), 
$$
where $gcd(r,t)=1$. We know $r,t$ are coprime and have same parity. $r$ and $t$ can't be both even number and have to be both odd. Assume $r=2u+1$ and $t=2v+1$, then the equation reduces to
$$
3\equiv 1\ (\mod 4).
$$
We get the contradiction. As a result, $k=2q$ and $r^2n/s^2\in\intg$, which means $s=1$. $g,h\in \intg$ $\beta=g+h\sqrt{f}\in B$.

The identical argument works when $n$ congruent to $2$ modulo $4$.

\item $\char k\neq 2$, then $2$ is invertible in $k$. For example, in the case
$k[x_1,x_2,x_3]/(x_1^2+x_2^2+x_3^2)$, regard $k[x_1,x_2,x_3]$ as $A[x_1]$, where $A=k[x_2,x_3]$, $A$ is a UFD, $2$ is invertible in $A$, $x_2^2+x_3^2$ is square-free in $A$, and $x_1^2+(x_2^2+x_3^2)$ is irreducible in $A[x_1]$. We can now use~\ref{chap5exr:handy_characterization_normal_scheme} to prove that $k[x_1,x_2,x_3]/(x_1^2+x_2^2+x_3^2)$ is integrally closed. The identical argument can be used to prove for arbitrary $n\geq m\geq 3$.
\item We can diagonalize the quadratic form $wz-xy$.
$$
wz-xy=\left(\frac{w+z}{2}\right)^2-\left(\frac{w-z}{2}\right)^2-\left(\frac{x+y}{2}\right)^2+\left(\frac{x-y}{2}\right)^2.
$$
Then it reduces to a special case of $(b)$ above.

\end{enumerate}
\end{proof}
\begin{exr}
Suppose $k$ is an algebraically closed field of characteristic not $2$. (The hypothesis that $k$ is algebraically closed is not necessary, so feel free to deal with this more general case.)
\begin{enumerate}[label=(\alph*)]
\item Show that any quadratic form in $n$ variables can be ``diagonalized'' by changing coordinates to be a sum of at most $n$ squares.
\item Show that the number of squares appearing depends only on the quadratic. For example, $x^2 + y^2 + z^2$ cannot be written as a sum of two squares.
\end{enumerate}
\end{exr}
\begin{proof}
In linear algebra courses, we have discussed the diagonalization of real symmetric matrices and Hermitian matrices. This exercise is a simple generalization to fields with non-2 characteristics.
\begin{enumerate}[label=(\alph*)]
\item Consider a quadratic form 
$$
Q_{n}(\mathbf{x}):=\sum_{1\leq i,j\leq n}a_{ij}x_ix_j,
$$
with coefficients in $k$.
Follow the hints, we can induct on $n$. We firstly prove for $n=2$,
$$
Q_2(\mathbf{x})=a_{11}x_1^2+2a_{12}x_1x_2+a_{22}x_2^2.
$$
Assume $a_{11},a_{22}=0$ and $2a_{12}\neq 0$ (which means $a_{12}\neq 0$ because $\char k\neq 2$), we have $Q_{2}(\mathbf{x})=a_{12}(x_1+x_2)^2-a_{12}x_1^2-a_{12}x_2^2$. Else, one of $a_{11},a_{22}\neq 0$, w.l.o.g, $a_{11}\neq 0$, we get $Q_2(\mathbf{x})=a_{11}(x_1-a_{12}a_{11}^{-1}x_2)^2+(a_{22}-a_{12}^2/a_{11})x_2^2$.

Assume now all $Q_n$ can be diagonalized, consider a quadratic form $Q_{n+1}$, it can be written as 
$$
Q_{n+1}(\mathbf{x},x_{n+1})=P_{n}(\mathbf{x})+2c_{1,n+1}x_1x_{n+1}+...+2c_{n,n+1}x_nx_{n+1}+c_{n+1,n+1}x_{n+1}^2.
$$
Up to reordering, we require $c_{n+1,n+1}\neq 0$.
By induction hypothesis, we can write $P_n(\mathbf{x})$ as $\sum_{i=1}^n b_{ii}y_i^2$, with with possibility all $b_{ii}=0$ and $\mathbf{y}=A^{-1}\mathbf{x}$, where $A$ is a linear transforamtion.
$$
\begin{aligned}
Q_{n+1}(\mathbf{x},x_{n+1})&=\mathbf{y}^{T}B\mathbf{y}+2\sum_{i=1}^n\sum_{j=1}^n A_{ij}c_{i,n+1}y_jx_{n+1}+c_{n+1,n+1}x_{n+1}^2\\
&=\mathbf{y}^{T}B\mathbf{y}+2\sum_{j=1}^n \tilde{c}_{j,n+1}y_jx_{n+1}+c_{n+1,n+1}x_{n+1}^2,
\end{aligned}
$$ 
where $\tilde{c}_{j,n+1}:=\sum_{i=1}^nA_{ij} c_{i,n+1}$.
$$
\begin{aligned}
Q_{n+1}(\mathbf{x},x_{n+1})
&=c_{n+1,n+1}\left(x_{n+1}^2+\sum_{j=1}^n\frac{\tilde{c}_{j,n+1}}{c_{n+1,n+1}}y_j\right)^2+\sum_{i=1}^n\left(b_{ii}-\frac{c_{j,n+1}^2}{c_{n+1,n+1}}\right) y_i^2.
\end{aligned}
$$ 
There are at most $n+1$ terms.
\item Given a quadratic form $Q(\mathbf{x})=\mathbf{x}^{T}M\mathbf{x}$, under a transformation of basis, $\tilde{\mathbf{x}}=A \mathbf{x}$, we can write $Q(\tilde{\mathbf{x}})=\tilde{\mathbf{x}}^T \tilde{M} \tilde{\mathbf{x}}$, where 
$$
\tilde{M}=A^{T}M A.
$$
Assume $\mathbf{v}$ is in the null space of $M$, then $A^{-1}v$ is  in the null space of $\tilde{M}$, because $A$ is a non-degenerate matrix, we know the dimension of  null space is invariant under the change of basis. Hence, the rank of matrix $M$ is preserved under the base change. For quadratic forms, the rank is just the number of independent square terms.
\end{enumerate}
\end{proof}

\begin{exr}
(RINGS CAN BE INTEGRALLY CLOSED BUT NOT UNIQUE FACTORIZATION DOMAINS, ARITHMETIC VERSION). Show that $\intg[\sqrt{-5}]$ is integrally closed but not a unique factorization domain.
\end{exr}
\begin{proof}
This is a classical counter-example.

 $A:=\intg[\sqrt{-5}]$ is integrally closed by~\ref{chap5exr:normal_schemes_examples}. 

 It is not unique factorization domain because for example $6=2\times 3$ and $6=(1-\sqrt{-5})(1+\sqrt{-5})$.
\end{proof}
\section{The crucial points of a scheme: Associated points and primes}
%---------------------------------------------------------------------------------------

\part{Morphisms}
\chapter{Morphisms of schemes}
\part{``Geometric'' properties: Dimension and smoothness}

\part{Quasicoherent sheaves}

\part{More}

%----------------------------------------------------------------------------------------
%	BIBLIOGRAPHY
%----------------------------------------------------------------------------------------

\chapter*{Bibliography}
\addcontentsline{toc}{chapter}{\textcolor{ocre}{Bibliography}}

%------------------------------------------------

\section*{Articles}
\addcontentsline{toc}{section}{Articles}
\printbibliography[heading=bibempty,type=article]

%------------------------------------------------

\section*{Books}
\addcontentsline{toc}{section}{Books}
\printbibliography[heading=bibempty,type=book]

%----------------------------------------------------------------------------------------
%	INDEX
%----------------------------------------------------------------------------------------

\cleardoublepage
\phantomsection
\setlength{\columnsep}{0.75cm}
\addcontentsline{toc}{chapter}{\textcolor{ocre}{Index}}
\printindex

%----------------------------------------------------------------------------------------

\end{document}
