%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% The Legrand Orange Book
% LaTeX Template
% Version 2.3 (8/8/17)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original author:
% Mathias Legrand (legrand.mathias@gmail.com) with modifications by:
% Vel (vel@latextemplates.com)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
% Compiling this template:
% This template uses biber for its bibliography and makeindex for its index.
% When you first open the template, compile it from the command line with the 
% commands below to make sure your LaTeX distribution is configured correctly:
%
% 1) pdflatex main
% 2) makeindex main.idx -s StyleInd.ist
% 3) biber main
% 4) pdflatex main x 2
%
% After this, when you wish to update the bibliography/index use the appropriate
% command above and make sure to compile with pdflatex several times 
% afterwards to propagate your changes to the document.
%
% This template also uses a number of packages which may need to be
% updated to the newest versions for the template to compile. It is strongly
% recommended you update your LaTeX distribution if you have any
% compilation errors.
%
% Important note:
% Chapter heading images should have a 2:1 width:height ratio,
% e.g. 920px width and 460px height.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[11pt]{book} % Default font size and left-justified equations

%----------------------------------------------------------------------------------------

\input{structure} % Insert the commands.tex file which contains the majority of the structure behind the template

\begin{document}

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\begingroup
\thispagestyle{empty}
\begin{tikzpicture}[remember picture,overlay]
\node[inner sep=0pt] (background) at (current page.center) {\includegraphics[width=\paperwidth]{background}};
\draw (current page.center) node [fill=ocre!30!white,fill opacity=0.6,text opacity=1,inner sep=1cm]{\Huge\centering\bfseries\sffamily\parbox[c][][t]{\paperwidth}{\centering Evanescent Tide\\[15pt] % Book title
{\Large  A solution manual by and for stupid student}\\[20pt] % Subtitle
{\huge Vector\_Cat }}}; % Author name
\end{tikzpicture}
\vfill
\endgroup

%----------------------------------------------------------------------------------------
%	COPYRIGHT PAGE
%----------------------------------------------------------------------------------------

\newpage
~\vfill
\thispagestyle{empty}

\noindent Copyright \copyright\ 2013 John Smith\\ % Copyright notice

\noindent \textsc{Published by Publisher}\\ % Publisher

\noindent \textsc{book-website.com}\\ % URL

\noindent Licensed under the Creative Commons Attribution-NonCommercial 3.0 Unported License (the ``License''). You may not use this file except in compliance with the License. You may obtain a copy of the License at \url{http://creativecommons.org/licenses/by-nc/3.0}. Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \textsc{``as is'' basis, without warranties or conditions of any kind}, either express or implied. See the License for the specific language governing permissions and limitations under the License.\\ % License information

\noindent \textit{First printing, March 2013} % Printing/edition date

%----------------------------------------------------------------------------------------
%	TABLE OF CONTENTS
%----------------------------------------------------------------------------------------

%\usechapterimagefalse % If you don't want to include a chapter image, use this to toggle images off - it can be enabled later with \usechapterimagetrue

\chapterimage{chapter_head_1.pdf} % Table of contents heading image

\pagestyle{empty} % No headers

\tableofcontents % Print the table of contents itself

\cleardoublepage % Forces the first chapter to start on an odd page so it's on the right

\pagestyle{fancy} % Print headers again

%----------------------------------------------------------------------------------------
%	PART
%----------------------------------------------------------------------------------------

\part{Preliminaries}

%----------------------------------------------------------------------------------------
%	CHAPTER 1
%----------------------------------------------------------------------------------------
\include{Chaps/Chap1}
%----------------------------------------------------------------------------------------
%	CHAPTER 2
%----------------------------------------------------------------------------------------

\include{Chaps/Chap2}




%------------------------------------------------





%------------------------------------------------


%------------------------------------------------


%------------------------------------------------



%----------------------------------------------------------------------------------------
%	PART
%----------------------------------------------------------------------------------------

\part{Schemes}

%----------------------------------------------------------------------------------------
%	CHAPTER 3-5
%----------------------------------------------------------------------------------------
\include{Chaps/Chap3}

\include{Chaps/Chap4}

\include{Chaps/Chap5}
%---------------------------------------------------------------------------------------

\part{Morphisms}
%----------------------------------------------------------------------------------------
%	CHAPTER 6-10
%----------------------------------------------------------------------------------------
\chapter{Morphisms of schemes}
\section{Introductions}
\section{Morphism of ringed space}
\begin{definition}
A \textbf{morphism of ringed spaces $\pi:X\lrta Y$}  is a continuous map of topological spaces along with a map $\calo_Y\lrta \pi_*\calo_X$, which we think of as a ``pullback map''.
\end{definition}
\begin{exr}\label{chap6exr:glue_morphisms_of_ringed_spaces}
(Glue morphisms of ringed spaces). Suppose $(X,\calo_X)$ and $(Y,\calo_Y)$ are ringed spaces, $X=\cup_i U_i$ is an open cover of $X$, and we have morphisms of ringed spaces $\pi_i:U_i\lrta Y$ that ``agree on overlaps'', i.e. $\pi_i\mid_{U_i\cap U_j}=\pi_{j}|_{U_i\cap U_j}$. Show that there is a unique morphism of ringed space $\pi:X\lrta Y$ such that $\pi|_{U_i}=\pi_i$.
\end{exr}
\begin{proof}[Sol]
Denote the morphisms of ringed spaces as $(\pi_i,\tilde{\pi}_i)$
The topological part has been shown in Exercise~\ref{chap2exr:sheaf_of_continuous_maps}, which says continuous maps from a topological space $X$ to $Y$ forms sheaf.

Suppose the topological part glue to a unique continuous map $\pi$. We denote pushforward sheaves by $\pi_*\calo_X$. Given an open set $V\subset Y$, on the open set level
$$
\pi_{i,*}\calo_{U_i}(V)=\calo_{U_i}(\pi_i^{-1}(V))=\calo_X((\pi|_{U_i})^{-1}(V))=\calo_X(\pi^{-1}(V)\cap U_i)
$$
For each element $f\in \calo_Y(V)$
$\pi_i(V)(f)\in\calo_X(\pi^{-1}(V)\cap U_i)$ are compatible, thus glue to a unique element in $\calo_X(\pi^{-1}(V))=\pi_*\calo_X(V)$. As discussed before, we can value-wisely define the morphism $\tilde{\pi}(V)$ and it is easy to check thus defined $\tilde{\pi}(V)$ is well-defined ring morphism and that $\tilde{\pi}$ forms a sheaf morphism. 
$(\pi,\tilde{\pi})$ forms the desired morphism of ringed spaces.
\end{proof}
\begin{exr}
$\calo$-module push forward. Given a morphism of ringed spaces $\pi:X\lrta Y$, show that sheaf push forward induces a functor $\mathsf{Mod}_{\calo_X}\lrta \mathsf{Mod}_{\calo_Y}$.
\end{exr}
\begin{proof}
Given a $\calo_X$-module $\calf$, and  a morphism of ringed spaces $(\pi,\tilde{\pi}):X\lrta Y$. The $\calf$ as a sheaf of abelian groups automatically pushforward to $\pi_*\calf$. It suffices to check the $\calo_Y$-module structure on $\pi_*\calf$.
$$
\begin{tikzcd}
\calo_Y(U)\times\pi_*\calf(U) \arrow[d, "{\res_{U,V}\times\res_{U,V}}"] \arrow[r,"{\tilde{\pi}(U)\times id}"] & \pi_*\calo_{X}(U)\times\pi_*\calf(U) \arrow[d, "{\res_{U,V}\times\res_{U,V}}"]\arrow[r] & \pi_*\calf(U) \arrow[d,"{\res_{U,V}}"] \\
\calo_Y(V)\times\pi_*\calf(V) \arrow[r,"{\tilde{\pi}(V)\times id}"] & \pi_*\calo_{X}(U)\times\pi_*\calf(U) \arrow[r] & \pi_*\calf(U)
\end{tikzcd}
$$
The right square commutes because $\pi_*\calf$ is a $\pi_*\calo_X$-module. The right square commutes by the definition of morphism of ringed spaces, therefore the outer square commutes, which indicates the $\calo_Y$-module structure.

We still denote the functor $\pi_*$. It remains to check the commutative diagram
$$
\begin{tikzcd}
\calf \arrow[d, "\pi_*"] \arrow[r, "\phi"] & \calg \arrow[d, "\pi_*"] \arrow[r, "\psi"] & \calh \arrow[d, "\pi_*"] \\
\pi_*\calf \arrow[r, "\pi_*(\phi)"] & \pi_*\calg \arrow[r, "\pi_*(\psi)"] & \pi_*\calh,
\end{tikzcd}
$$
where $\pi_*(\phi)(V)$ is defined to be $\phi(\pi^{-1}(V))$ and $\pi_*(\psi\circ \phi)(V)=\psi\circ \phi(\pi^{-1}(V))=\psi(\pi^{-1}(V))\circ \phi(\pi^{-1}(V)) =\pi_*(\psi)\circ \pi_*(\phi) (V)$
This works for all opens,  we thus have $\pi_*(\psi\circ \phi)=\pi_*(\psi)\circ \pi_*(\phi)$.

It still remains to check $\pi_*$ is a well defined morphism of $\calo_Y$ modules, but the procedure is similar. We just omit it.
\end{proof}

\begin{exr}
Given a morphism of ringed spaces $\pi:X\lrta Y$ with  $\pi(p)=q$, show that there is a map of stalks $(\calo_Y)_q\lrta (\calo_X)_p$
\end{exr}
\begin{proof}[Sol]
A morphism of ringed spaces $\pi:X\lrta Y$ consists of the data $(\pi,\tilde{\pi})$ where
$$
\tilde{\pi}:\calo_Y\lrta \pi_*\calo_X
$$
Exercise~\ref{chap2exr:morphism_of_sheaves_induce_on_stalks} shows that it induces a morphism on the stalks $\calo_{Y,q}\lrta(\pi_*\calo_X)_{q}$.

On the other hand Exercise~\ref{chap2exr:Pushforward_induces_morphism_stalks} says the pushforward induces a morphism on the stalks $(\pi_{*}\calo_X)_{q}\lrta\calo_{X,p}$ if $\pi(p)=q$

The composition of the above two morphisms gives the desired map.
\end{proof}
\begin{exr}\label{chap6exr:ring_morphism_induces_morphisms_ringed_spaces}
Suppose $\pi^\#:B\lrta A$ is a morphism of rings. Define a morphism of ringed space $\pi:\spec A\lrta \spec B$ as follows. The map of topological spaces was given by Exercise~\ref{exr:spec_functor}. To describe a morphism of sheaves $\calo_{\spec B}\lrta \pi_*\calo_{\spec A}$ on $\spec B$, it suffices to describe a morphism of sheaves on the distinguished base of $\spec B$. On $D(f)\subset \spec B$, we define
$$
\calo_{\spec B}(D(g))\lrta \calo_{\spec A}(\pi^{-1}D(g))=\calo_{\spec A}(D(\pi^\#g))
$$
by $B_g\lrta A_{\pi^\# g}.$ verify that this makes sense (e.g., is independent of $g$), and that this describes a morphism of sheaves on the distinguished base. (This is the third in a series of exercises. We saw that a morphism of rings induces a map of sets in 3.2.9, a map of topological spaces in Exercise~\ref{exr:spec_functor}, and now a map of ringed spaces here. )
\end{exr}
\begin{proof}[Sol]
We have shown that $A_f\cong \calo_{\spec A}(D(f))$ in Exercise 4.1.A.
Choose another representative of $D(g)$, say $h$. Then we  know $\sqrt{(h)}=\sqrt{(g)}$, which means $h$ is invertible in $B_g$ and $g$ is invertible in $B_h$. i.e. 
$$
B_g\cong B_h
$$
It also means $\pi^\#(h)$ is invertible in $(\pi^\#(g))$ and $\pi^\#(g)$ is invertible in $(\pi^\#(h))$, i.e.
$$
A_{\pi^\#(g)}=A_{\pi^\#(h)}.
$$
Then this map is indeed independent on the choice of representative of $D(g)$.
$$
\calo_{\spec B}(D(g))=B_g\lrta \pi_*\calo_{\spec A}(D(g))=A_{\pi^\#(g)}
$$
gives a well-defined morphism of sheaves.
\end{proof}
\begin{exr} (Not all map of affine ringed spaces are induced by ring morphisms).
Recall (Exercise 3.4.K) that $\spec k[y]_{(y)}$ has two points, $[(0)]$ and $[(y)]$, where the second point is closed, and he first is not. Describe a map of ringed spaces $\spec k(x)\lrta \spec k[y]_{(y)}$ sending the unique point of $\spec k(x)$ to the closed point $[(y)]$, where pullback map on global sections sends $k$ to $k$ by the identity, and sends $y$ to $x$. Show that this map of ringed spaces is not of the form described in  Exercise~\ref{chap6exr:ring_morphism_induces_morphisms_ringed_spaces}.
\end{exr}
\begin{proof}[Sol]
Denote $B:=k[y]_{(y)}$ and $A:=k(x)$.
The exotic choice  topologically sends the unique point $\eta=[(0)]$ in $\spec k(x)$ to the closed point $[(y)]$. These topological space discrete, making it a continuous map.  The only open sets on $\spec A$ are $\{[(0)],[(y)]\},\{[(0)]\}$ and $\emptyset$.
$$
\phi:\spec A=\{\eta\}\lrta \spec B=\{[(0)],[(y)]\}
$$
$$
\phi_*\calo_{\spec A}(\{[(0)],[(y)]\})=\calo_{\spec A}(\eta)=A
$$
$$
\phi_*\calo_{\spec A}(\{[(0)]\})=\calo_{\spec A}(\emptyset)=\{0\}
$$
where $\{0\}$ is the final object in $\mathsf{Rings}$. The corresponding maps on
$$
\tilde{\phi}(\{[(0)],[(y)]\}):B\lrta A (k\mapsto k, y\mapsto x),
$$
$$
\tilde{\phi}(\{[(0)]\}):B\lrta 0 .
$$
This does not corresponds to a ring morphism as in Exercise~\ref{chap6exr:ring_morphism_induces_morphisms_ringed_spaces}. Assume by contradiction it is, then $\{[(0)]\}=D(y)$ and $\phi^\#$ has been given by the morphism on global sections. However $\phi^\#(y)=x$ and $A_{\pi^\#(y)}=A_x=A\neq 0$.
\end{proof}
\section{From locally ringed spaces to morphisms of schemes}
In this section we will use the notion $\pi^\#$ to denote the induced morphism on stalks.
\begin{exr}
Show that morphisms of locally ringed spaces glue (cf. Exercise~\ref{chap6exr:glue_morphisms_of_ringed_spaces}). (Hint: your solution to Exercise~\ref{chap6exr:glue_morphisms_of_ringed_spaces} may work without change.)
\end{exr}
\begin{proof}[Sol]
Without change of the proof, we only need to check the glued morphism of ringed spaces is in fact a morphism of locally ringed spaces.

This is easy because for each pair of points $p,q,\pi(p)=q$, we can check that
$$
\tilde{\pi}_{p}=\tilde{\pi_i}_{p}
$$
simply because $\tilde{\pi}$ restricts to $\tilde{\pi}_i$. Each $\pi_i$ induces local morphisms on stalks, therefore $\pi$ also induces local morphisms on stalks.
\end{proof}
\begin{exr}
\ \begin{enumerate}[label=(\alph*)]
\item Show that $\spec A$ is a locally ringed space.
\item Show that the morphism of ringed spaces $\pi:\spec A\lrta \spec B$ defined by a ring morphism $\pi^\#:B\lrta A$ is a morphism of locally ringed spaces.
\end{enumerate}
\end{exr}
\begin{proof}[Sol]
\begin{enumerate}[label=(\alph*)]
\item $\spec A$ is a locally ringed space because we have shown in Exercise~\ref{chap4exr:affine_scheme_stalk_localization} that
$$
\calo_{\spec A,\scp}=A_\scp
$$
and $A_\scp$ is a local ring with maximal ideal $\scp A_\scp$.
\item In Exercise~\ref{chap6exr:ring_morphism_induces_morphisms_ringed_spaces}, we have given explicitly on the distinguished base. We only need to show that the maps on stalks indeed send maximal ideals to maximal ideals.

Given two prime ideals $\scq\subset B$ and $\scp\subset A$, $\pi([\scp])=[\scq]$ means $(\pi^{\#})^{-1}(\scp)=\scq$, recall that pull back of ideals preserve prime ideals. This means the $\pi^\#(B-\scq)\subset A-\scp$ and hence composition map $B\lrta A_\scp$ sends $B-\scq$ into invertible element in $A_\scp$.  
$$
\begin{tikzcd}
B \arrow[d] \arrow[r] \arrow[rd] & A \arrow[d] \\
B_\scq \arrow[r, "\phi", dashed] & A_\scp
\end{tikzcd}
$$
There is a ring morphism from $B_\scq$ to $A_\scp$ by universal property of localization. 
$$
\phi:
\frac{b}{s}\mapsto \frac{\pi^\#(b)}{\pi^\#(s)}.
$$
We use $\phi$ to avoid abuse of notations.

We want to show that
$$
\phi(\scq B_\scq)\subset \scp A_\scp.
$$
This is true because 
$$
\phi\left(\sum_i q_i \frac{b_i}{s_i}\right)=\sum_i \frac{\pi^\#(q_i b_i)}{\pi^\#(s_i)}\in \scp A_\scp.
$$ 
\end{enumerate}
\end{proof}
\begin{proposition}
If $\pi:\spec A\lrta \spec B$ is a morphism of locally ringed spaces then it is the morphism induced by the map $\pi^\#:B=\Gamma(\spec B,\calo_{\spec B})\lrta \Gamma(\spec A,\calo_{\spec A})=A.$
\end{proposition}
\begin{exr}\label{chap6exr:equivalent_defs_morphisms_of_schemes}
Show that  a morphism of schemes $\pi:X\lrta Y$ is a morphism of ringed spaces that looks locally like morphisms of affine schemes. Precisely, if $\spec A$ is an affine open subset of $X$ and $\spec B$ is an affine open subset of $Y$, and $\pi(\spec A)\subset \spec B$, then the induced morphism of ringed spaces is a morphism of affine schemes. (In case it helps, note: if $W\subset X$ and $Y\subset Z$ are both open embeddings of ringed spaces, then any morphism of ringed spaces $X\lrta Y$ induces a morphism of ringed spaces $W\lrta Z$, by composition $W\lrta X\lrta Y\lrta Z$.) Show that it suffices to check on a set $(\spec A_i,\spec B_i)$ where the $\spec A_i$ form an open cover of $X$ and the $\spec B_i$ from an open cover of $Y$.
\end{exr}
\begin{proof}[Sol]
By affine open subset, we mean an open subscheme which is affine. There is an open embedding from $\spec A$ to $X$. In particular, the $\calo_X|_{\spec A}=\calo_{\spec A}$. By definition,  ``morphism of schemes'' is a morphism of locally ringed spaces. Restricting to the affine opens, the morphism of schemes induces a morphism of locally ringed spaces from $\spec A$ to $\spec B$. By proposition above, we know it is induced by a ring morphism $B\lrta A$.


On the other hand, given the set $(\spec A_i,\spec B_i)$, s.t. $\pi(\spec A_i)\subset\spec B_i$ and $A_i, B_i$ covers $X, Y$ respectively. 
The morphism of affine schemes $\spec A_i\lrta \spec B_i$ induces morphism of locally ringed spaces $\spec A_i\lrta Y$ by composition. 
We have checked that morphism of locally ringed spaces glue, hence there is a morphism of locally ringed spaces from $X\lrta Y$. This criterion is valid.
\end{proof}
\begin{exr}
Show that the category of rings and the opposite category of affine schemes are equivalent.
\end{exr}
\begin{proof}[Sol]
We give a pair of functors which are reciprocal quasi-inverse.
$$
\spec ,\Gamma,
$$
where $\Gamma$ is the global section functor, both are contravariant.
$$
\begin{tikzcd}
B \arrow[r, "\spec"] \arrow[d, "\pi'"] & \spec B \arrow[r, "\Gamma"] \arrow[d, "{(\pi,\tilde{\pi})}"] & B \arrow[d, "\pi^\#"] \\
A \arrow[r, "\spec"] & \spec A \arrow[r, "\Gamma"] & A
\end{tikzcd}
$$
The above diagram is easy to verify and wesee from it
$$
\Gamma\circ \spec =Id_{\mathsf{Rings}}
$$

$$
\begin{tikzcd}
(U,\calo_U)\cong \spec B \arrow[r, "\Gamma"] \arrow[d] & B \arrow[r, "\spec "] \arrow[d] & \spec B \arrow[d] \\
(V,\calo_V)\cong\spec A \arrow[r, "\Gamma"] & A \arrow[r, "\spec"] & \spec A
\end{tikzcd}
$$
This means
$$
\spec\circ \Gamma\cong Id_{\mathsf{Affn}}.
$$
Because both of them are contravariant functors, this indicates a equivalence of categories between $\mathsf{Rings}$ and $\mathsf{Affn}^{op}$.

\end{proof}
\begin{exr}
(This exercise can give you some practice with understanding morphisms of schemes by cutting up into affine open sets.) Make sense of the following sentence: ``$ \affn^{n+1}_k\backslash \{0\}\lrta \proj^n_k$ given by 
$$
(x_0,x_1,...,x_n)\mapsto[x_0,x_1,...,x_n]
$$
is a morphism of schemes.''
(Can you generalize to the case where $k$ is replaced by a general ring $B$?)
\end{exr}
\begin{proof}[Sol]
$\affn^{n+1}_k\backslash \{0\}$ can be covered by affine opens like
$$
\spec A_i\simeq D(x_i),\ \ \  A_i:= k[x_0,...,x_n]_{x_i}.
$$
On the other hand $\proj^{n}_{k}$ can be covered by affine opens
$$
\spec B_i\simeq \affn^{n}_{k}, B_i:=k[x_{0/i},...,x_{k/i},...,x_{n/i}]/(x_{i/i}-1)\cong k[y_0,...,y_{n-1}].
$$
We denote the morphism 
$$
f:(x_0,...,x_n)\mapsto [x_0,...,x_n]
$$
and observe that $f_i:=f|_{D(x_i)}$ maps $D(x_i)$ into $\spec B_i$. Locally, it is a morphism of affine scheme induced by 
$$
B_i\lrta A_i,
$$
$$
x_{k/i}\mapsto \frac{x_{k}}{x_i}, x_{i/i}\mapsto 1
$$
which is a well-defined ring morphism.

Then it suffice to check that behaves well when we glue up the affine charts. It is equivalent to check that
$$
f_i|_{D(x_i)\cap D(x_j)}=f_j|_{D(x_i)\cap D(x_j)}.
$$
Note that $D(x_i)\cap D(x_j)=D(x_i x_j)=\spec A_{ij}=\spec k[x..]_{x_i x_j}$ and both $f_i|_{D(x_i)\cap D(x_j)}$ and $f_j|_{D(x_i)\cap D(x_j)}$ map into $$\spec B_{ij}:=\spec k[x_{0/i},...,x_{n/i}, 1/x_{j/i}]/(x_{i/i}-1)$$ and $$\spec B_{ji}=\spec k[x_{0/j},...,x_{n/j},1/x_{i/j}]/(x_{j/j}-1)$$.
The above two are isomorphic by the map $x_{k/j}=x_{k/i}/x_{j/i}$.
$
f_i|_{D(x_i)\cap D(x_j)}
$
is induced by
$$
\spec B_{ij}\mapsto \spec A_{ij}
$$
$$
x_{k/i}\mapsto \frac{x_k x_j}{x_i x_j},1/x_{j/i}\mapsto \frac{x_i^2}{x_j x_i}
$$
Together with the isomorphism above, $f_i|_{D(x_i)\cap D(x_j)}$ can be identified with $f_j|_{D(x_i)\cap D(x_j)}$.
\end{proof}
\begin{exr}\label{chap6exr:morphism_of_schemes_bijection_morphisms_of_global_sections}
Show that morphism $X\lrta \spec A$ are in natural bijection with ring morphisms $A\lrta \Gamma(X,\calo_X)$.
\end{exr}
\begin{proof}[Sol.]
The bijection
$$
\hom_{\mathsf{Sch}}(X,\spec A)\simeq \hom_{\mathsf{Rings}}(A,\Gamma(X,\calo_X))
$$
is explicitly
$$
[f:X\lrta \spec A]\longmapsto [A=\calo_{\spec A}(\spec A)\lrta \calo_X(f^{-1}\spec A)=\calo_X(X)],
$$
where the later is induced by 
$$
f^*:\calo_X\lrta f_*\calo_X.
$$

Consider $X$ covered covered by a collection of affine opens $X=\cup_i U_i$ with each $U_i\simeq\spec A_i$
$$
\begin{aligned}
\hom_{\mathsf{Sch}}(X,\spec A)&=\{(f_i)\mid f_i:U_i\lrta \spec A\text{ s.t. }f_i|_{U_i\cap U_j}=f_j|_{U_i\cap U_j}\}\\
&=\{(g_i)\mid g_i: A\lrta \Gamma(U_i, \calo_X),\forall a\in A, g_i(a)|_{U_i\cap U_j}=g_j(a)|_{U_i\cap U_j}\}\\
&\simeq\{g|g:A\lrta \calo_X(X)\}\text{ by sheaf condition}\\
&=\hom_{\mathsf{Rings}}(A,\calo_X(X))
\end{aligned}
$$
\end{proof}
\begin{exr}
Show that this definition of $A$-scheme given in \S $6.3.7$ agrees with the earlier definition of \S $5.3.6$.
\end{exr}
\begin{proof}[Sol.]
Def 1: In \S 5.3.6, the $A$-scheme is defined to be scheme whose ring of sections over any  open sets is an $A$-algebra and the restriction maps are morphisms of $A$-algebras.

Def 2: In \S 6.3.7, the $A$-scheme is defined to be simply a scheme $X$ with  a morphism $X\lrta \spec A$. 

$Def 2\Lrta Def 1$: Consider an open subsets $U\subset V\subset X$, $(V,\calo_X|_V)\overset{\iota}{\inj}(X,\calo_X)$. Compositing with the morphism of schemes $X\lrta \spec A$, we know there is a morphism of schemes from $V$ to $\spec A$. By Exercise~\ref{chap6exr:morphism_of_schemes_bijection_morphisms_of_global_sections}, $\calo_X|_V(V)=\calo_X(V)$ is an $A$-algebra. 

Morphism $\calo_X(V)\lrta\calo_X(U)$ is a morphism of $A$-algebras because
$$
\begin{tikzcd}
U \arrow[r, hook] \arrow[rd] & V \arrow[d] & \calo_X(U) & \calo_X(V) \arrow[l, "\res"] \\
 & \spec A &  & A \arrow[u] \arrow[lu]
\end{tikzcd}
$$
the later diagram gives the correct meaning of morphism of $A$-algebras.

$Def1\lrta Def2$: BY definition 1, in particular $\Gamma(X,\calo_X)$ is an $A$-algebra, again by Exercise~\ref{chap6exr:morphism_of_schemes_bijection_morphisms_of_global_sections}, there is a morphism of schemes between $X$ and $\spec A$.
\end{proof}


\begin{exr}
If $S_\bullet$ is a finitely generated graded $A$-algebra, describe a natural ``structure morphism'' $\Proj S_\bullet\lrta \spec A$.
\end{exr}
\begin{proof}[Sol.]
By Exercise~\ref{chap6exr:morphism_of_schemes_bijection_morphisms_of_global_sections}, the structure morphism corresponds to the morphism of rings
$$
A\lrta S_\bullet : a\mapsto a\times 1.
$$

Recall that $\Proj S_\bullet$ is covered by  affine charts $D(f)=\spec ((S_\bullet)_f)_0$ for each homogeneous $f\in S_+$, where the $((S_\bullet)_f)_0$ is the zero piece of the localization $(S_\bullet)_f$. A morphism $A\lrta S_\bullet$ naturally induces a morphism $A\lrta ((S_\bullet)_f)_0$ and this gives a collection of compatible morphism from $\phi_f:A\lrta \Gamma(D_f, \calo_{\Proj S_\bullet})$. These $\phi_f$ in turn defines a compatible collection of morphism of schemes $\spec ((S_\bullet)_f)_0\lrta \spec A$. And they glue up to a morphism of schemes $\Proj S_\bullet\lrta \spec A$.

Sections on general open sets in $\Proj S_\bullet$ could be quite nasty, please refer to~\ref{chap4exr:structure_sheaf_of_projective_schemes} for a detailed description of structure sheaf on $\Proj S_\bullet$.
\end{proof}
\begin{exr}
Show that $\spec \intg$ is the final object in the category of schemes. In other words, if $X$ is any scheme, there exists a unique morphism to $\spec \intg$. (Hence the category of schemes is isomorphic to the category of $\intg$-schemes.) If $k$ is a field, show that $\spec k$ is the final object in the category of $k$-schemes.
\end{exr}
\begin{proof}[Sol.]
Simple words: $\intg$ is the initial object in the category $\mathsf{Rings}$ and $k$ it the initial object in the category in the category $k-\mathsf{Alg}$ and then argue by~\ref{chap6exr:morphism_of_schemes_bijection_morphisms_of_global_sections}.
\end{proof}

\begin{exr}\label{chap6exr:morphism_of_schemes_stalk_to_X}
\ \begin{enumerate}[label=(\alph*)]
\item Suppose $p$ is a point of a scheme $X$. Describe a canonical (choice-free) morphism $\spec \calo_{X,p}\lrta X$. (Hint: do this for affine $X$ first. But then for general $X$ be sure to show that your morphism is independent of choice.)
\item Define a canonical morphism $\spec \kappa(p)\lrta X$. This is often written $p\lrta X$; one gives $p$ the obvious interpretation as a scheme, $\spec \kappa(p)$
\end{enumerate}
\end{exr}
\begin{proof}[Sol.]
\begin{enumerate}[label=(\alph*)]
\item For affine $X=\spec A$, consider the point $\scp$. There is a morphism of rings 
$$
\calo_X(X)=A\lrta A_\scp=\calo_{X,\scp}
$$
which gives a morphism
$$
\spec \calo_{X,\scp}\lrta X.
$$

For general case, a point $p\in X$, we can find an affine open neighborhood $U_i$ of $p$ so that $U=\spec B$. There is a morphism
$$
\spec \calo_{X,p}\lrta \spec B\lrta X.
$$
We must show that the composition map $\spec \calo_{X,p}\lrta X$ is independent of the choice of affine open $U$. Consider the $V$ is another affine open that contains $p$, we can check that restriction of the injections $U\inj X$ and $V\inj X$ to $U\cap V\inj X$ would agree. For quasiseparated scheme, the intersection $U\cap V$ is finite union of affine opens again, and the proof is finished here by picking the affine open that contains $p$ and in $U\cap V$. 

For non-quasiseparated schemes, we can still check that $U\cap V$ is a union of affine open charts (not necessarily finite). The process is the same.
 
\item $\kappa(p)$ is a field and $\spec \kappa(p)$ is a one point set. Each residue field $\kappa(p):=\calo_{X,p}/\scm_p$, there is a canonical morphism of rings $\calo_{X,p}\lrta \kappa(p)$ and therefore induces a canonical morphism of affine schemes
$$
\spec \kappa(p)\lrta \spec \calo_{X,p}.
$$
Together with the morphism described in $(a)$, we have the canonical morphism
$$
\spec \kappa(p)\lrta X.
$$
\end{enumerate}
\end{proof}
\begin{exr}
Suppose $X$ is a scheme, and $(A,\scm)$ is a local ring. Suppose we have a scheme morphism $\pi:\spec A\lrta X$ sending $[\scm]$ to $p$. Show that any open set containing $p$ contains the image of $\pi$. Show that there is a bijection between $\mor(\spec A,X)$ and 
$$
\{p\in X,\text{ local homomorphisms }\calo_{X,p}\lrta A\}.
$$
\end{exr}
\begin{proof}[Sol.]
In order to show that the image lies in an affine open subscheme of $X$, we need to prove the following two topological facts:
\begin{enumerate}
\item Any continuous map preserves the relations of specialization/generalization
\item If $p\in X$ is a point. Then any open neighborhood $U\ni x$ contains all the generalization of $p$ in $X$.
\end{enumerate}
The first of which can be checked in \cite[Tag 0060]{stacks-project} (Also check the general definition of specialization and generalization in topological spaces). The first point implies that $p$ is a closed point in $X$.

The second point is easy to prove. Though $[\scm]$ is close point, it is not necessarily true that $\pi([\scm])$ is closed. In general we only know $\overline{\pi(\scm)}\supset \pi(\overline{[\scm]})$. Given point $p$ and an open neighborhood $U$ containing it. We recall the definition of $q\in X$ is a  generalization of $p$: $p\in \overline{\{q\}}$. $p$ is in the closure of $\{q\}$, thus any open neighborhood of $p$ would contain $q$. 

Because $[\scm]$ is the only closed point in $\spec A$, all point of $\spec A$ would be a generalization of $[\scm]$, which means $\pi(\spec A)$ is contained in any open neighborhood of $p=\pi([\scm])$.\footnote{We can not simply argue by ``$U$ would contain the image of generic point $\pi(\eta)$ of $\spec A$''. The subtle stuff here is that $U$ might do not contain $\overline{\{\pi(p)\}}$. In general for continuous map $\pi$, $\pi(\overline{S})\subset \overline{\pi(S)}$.}

The above proof finishes the first question.

This implies that the morphism $\pi:\spec A\lrta X$, with $(A,\scm)$ being local and $\pi([\scm])=p$, would factor through $\spec \calo_{X,p}\lrta X$.

Take an affine open neighborhood $X\supset \spec B$ of $p$. Thus $p$ can be identified as a prime ideal in $B$. We denote it by $p=[\scp]\in\spec B$. $\spec A\lrta X$ would factor as $\spec A\lrta\spec B$, which corresponds to a ring morphism $\phi:B\lrta A$. The preimage of $\scm$ is some the prime ideal $\scp\in B$. Recall that $A-\scm$ is the set of units in local ring.  $\phi$ sends the invertible elements into $A-\scp$, by the universal property of localization $B\lrta A$ factors through the localization $B_\scp$, where $B_\scp=\calo_{X,p}$ and the morphism $\calo_{X,p}\lrta A$ is local morphism. It does not depends on the choice of $\spec B$, because they are induced by the same morphism of ringed spaces cf~\ref{chap6exr:equivalent_defs_morphisms_of_schemes}. $\pi:\spec A\lrta X$, uniquely determines a data of $\{p\in X,\text{a local morphism } \calo_{X,p}\lrta A\}$. This given is injectivity in the second question. The surjectivity is derived from Exercise~\ref{chap6exr:morphism_of_schemes_stalk_to_X} which says the morphism $\spec \calo_{X,p}\lrta X$ is canonical.
\end{proof}

\begin{exr}
\ \begin{enumerate}[label=(\alph*)]
\item Show that a morphism of schemes $X\lrta Y$ induces a map of $Z$-valued points $X(Z)\lrta Y(Z)$.
\item Note that morphisms of schemes $X\lrta Y$ are not determined by their underlying map of points. (Give an example) Show that are determined by their induced maps of $Z$-valued points, as $Z$ varies over all schemes. 
\end{enumerate}
\end{exr}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item 
A morphism of schemes $f:X\lrta Y$ would induce a map
$$
\begin{aligned}
X(Z):=\mor(Z,X)
\lrta \mor(Z,Y)=:Y(Z)\\
[Z\rta X]\longmapsto [Z\rta X\overset{f}{\rta} Y]
\end{aligned}
$$
\item For example choose $Z$ to the final object $\spec \intg$ in $\mathsf{Sch}$. Any morphism between $X,Y$ would induces a map between one point sets, which gives a non-example. 

Then we will reprove the Yoneda's Lemma in the context of schemes. Pick $Z=X$, $f:X\lrta Y$ would induce a map between $\mor(X,X)\lrta \mor(X,Y)$, where $id_X\in \mor(X,X)$ is mapped to $f\in \mor(X,Y)$. $f$ is determined by the induces map on Hom sets.
\end{enumerate}
\end{proof}

\begin{exr}
\ \begin{enumerate}[label=(\alph*)]
\item Suppose $B$ is a ring. If $X$ is a $B$-scheme, and $f_0,...,f_n$ are $n+1$ functions on $X$ with no common zeros, then show that $[f_0,..,f_n]$ gives a morphism of $B$-scheme $X\lrta \proj^n_B$.
\item Suppose $g$ is nowhere vanishing function on $X$, and $f_i$ are as in part $(a)$. Show that the morphisms $[f_0,...,f_n]$ and $[gf_0,...,g f_n]$ to $\proj^n_B$ are the same.
\end{enumerate}
\end{exr}
\begin{proof}[Sol.]
\ \begin{enumerate}[label=(\alph*)]
\item Recall that $\proj_B^n=\Proj B[x_0,...,x_n]$. We consider an open over of $X=\cup_{f_i} X_{f_i}$ where $X_{f_i}$ is open set of $X$ where $f_i\neq 0$ and $\proj^n_B$ is covered by the canonical affine charts $U_i:=spec B[x_{0/i},...,x_{n/i}]$. We hope to define a morphism $\pi:X\lrta\proj^n_B$ so that it induces a morphism of schemes
$$
X_{f_i}\lrta \spec B[x_{0/i},...,x_{n/i}]
$$
and then verify that they agree on the overlaps.
 We do not need $X_{f_i}$ to be affine. By Exercise~\ref{chap6exr:morphism_of_schemes_bijection_morphisms_of_global_sections}, it suffices to construct the morphism of rings
$$
B[x_{0/i},...,x_{n/i}]\lrta \Gamma(X_{f_i},\calo_{X}).
$$

One the obvious choice of $B$-algebra morphism is
$$
\pi_i:x_{k/i}\longmapsto \frac{f_k}{f_i}.
$$
{\color{red} A crucial problem here is how to define the the sheaf on $X_{f_i}$, which is not necessarily affine.}

They are compatible on intersections $X_{f_i}\cap X_{f_j}$ where both $f_i,f_j$ are non-zero. Recall on the intersection $U_i\cap U_j$, the gluing isomorphism is 
$$
\varphi_{ij}: U_i\cap U_j\lrta U_i\cap U_j
$$
$$
x_{k/i}\longmapsto x_{k/j}/x_{i/j}
$$
Compositing with the constructed map $x_{k/j}\lrta \frac{f_k}{f_j}$.
We
have
$$
x_{k/i}\longmapsto x_{k/j}/x_{i/j}\longmapsto \frac{\frac{f_k}{f_j}}{\frac{f_i}{f_j}}=\frac{f_k}{f_i}.
$$
This means they are compatible on the intersections, we argue by~\ref{chap6exr:glue_morphisms_of_ringed_spaces} that we can glue it up to a morphism of schemes $\pi:X\lrta\proj^n_B$.

\item Given the explicit form of $(a)$, $(b)$ is obvious.
\end{enumerate}
\end{proof}
\begin{exr}
Omitted.
\end{exr}

\section{Maps of graded rings and maps of projective schemes}

\chapter{Useful classes of morphisms}
\chapter{Closed embeddings}
\chapter{Fibered product of schemes}
\chapter{Separated and proper schemes, varieties}
\part{``Geometric'' properties: Dimension and smoothness}
\chapter{Dimension}
\section{Dimension and codimension}
\section{Dimension, transcendence degree, and Noether normalization}
\section{Codimension one miracle, Krull's and Hartogs's Theorems}
\begin{exr}
Show that an irreducible homogeneous polynomial in $n+1$ variables over a field $k$ describes an integral scheme of dimension $n-1$ in $\proj^n_k$ 
\end{exr}
\begin{proof}[Sol.]
$S_\bullet=k[X_0,...,X_n]$ is an Noetherian integral domain. By Krull's principal ideal theorem. Suppose $f$ is an irreducible homogeneous polynomial in $S_\bullet$.
\end{proof}
\section{Dimensions of fibers of morphisms of Varieties}
\section{Proof of Krulls's Principal Ideal and Height Theorems}
\chapter{Regularity and smoothness}

\part{Quasicoherent sheaves}
\chapter{Quasicoherent and coherent sheaves}
\section{Vector bundles and locally free sheaves}
\begin{exr}
Show that over $U_i\cap U_j$, the vector-valued function $\vec{s}^i$ is related to ${s}^j$ by the (same) transition functions: $T_{ij} \vec{s}^{i}=\vec{s}^j$. (Make sure you get the correct superscripts)
\end{exr}
\begin{proof}[Sol.]
There is in fact some abuse of notions, where $\vec{s}^i$ should be interpreted as the restriction of $\vec{s}^i$ to $U_i\cap U_j$.
Here the superscripts are not for the indices of matrices but only denote the  charts.
$$
\tiny
\begin{tikzcd}
 & \calo(U_i)^d \arrow[rd] &  \\
\calf(U_i) \arrow[ru, "\phi_i(U_i)"] \arrow[rd, "\res"] &  & \calo(U_i\cap U_j)^d \arrow[dd, "T_{ij}"] \\
 & \calf(U_i\cap U_j) \arrow[rd, "\phi_j(U_i\cap U_j)"] \arrow[ru, "\phi_i(U_i\cap U_j)"] &  \\
\calf(U_j) \arrow[ru, "\res"] \arrow[rd, "\phi_j(U_j)"] &  & \calo(U_i\cap U_j)^d \\
 & \calo(U_j)^d \arrow[ru] & 
\end{tikzcd}
$$

Keep in mind that $\phi_i$ together with the open cover $U_i$ give the definition of a locally free sheaf. $T_{ij}$ is thus defined to be $\phi_j(U_i\cap U_j)\circ\phi_i(U_i\cap U_j)^{-1}$. 
\end{proof}
\begin{exr}
Suppose $\calf$ and $\calg$ are locally free sheaves on $X$ of rank $m$ and $n$ respectively. Show that $\phom_{\calo_X}(\calf , \calg)$ is a locally free sheaf of rank $mn$.
\end{exr}
\begin{proof}[Sol.]
Recall the definition of sheaf-hom
$$
\phom(\calf,\calg)(U):=\hom(\calf|_U,\calg|_U)
$$
(in fact, this notion has been implicitly extended to $\calo_X$-modules-hom)

On the other hand, 
$$
\calf|_U\simeq \calo_U^{\oplus m}
$$
and
$$
\calf|_U\simeq \calo_U^{\oplus n}
$$
We have
$$
\phom_{\calo_X}(\calf|_U,\calg|_U)\cong\phom_{\calo_X}(\calo_U^{\oplus m},\calo_U^{\oplus n}).
$$
The later is isomorphic to 
$$
M_{m\times n}(\calo_U)\cong\calo_U^{\oplus mn}
$$
(Note that the above isomorphism is in the perspective of $\calo_X$-module and we ignore the multiplication structure of matrix)
because for all open set $V\subset U$
$$
\phom_{\calo_X|_U}(\calo_U^{\oplus m},\calo_U^{\oplus n})(V)=\mor_{\calo_X|_V}(\calo_U^{\oplus m}|_V,\calo_U^{\oplus n}|_V)
$$
as $\calo_X$-modules, the RHS is isomorphic to
$$
M_{m\times n} (\calo_U|_V)\cong \calo_V^{\oplus mn}
$$
and this can be checked routinely via further checking the sections and compatibility with restrictions.

\end{proof}

\begin{exr}\label{chap13exr:dual_and_double_dual_of_locally_free sheaves}
If $\cale$ is a locally free sheaf on $X$ of (finite) rank $n$, the above exercise implies that $\cale^\vee:=\phom(\cale,\calo_X)$ is also a locally free sheaf of rank $n$. This is called the dual of $\cale$. Given transition functions for $\cale$, describe transition functions of $\cale^\vee$. (Note that if $\cale$ is of rank $1$, i.e., invertible, the transition functions of the dual are the inverse of the transition functions of the original.) Show that $\cale\cong\cale^{\vee\vee}$. (Caution: your argument showing that there is  a canonical isomorphism $(\calf^\vee)^\vee$ better not also show that there is an isomorphism $\calf^\vee\cong \calf$. We will see an example in \S 14.1 of a locally free $\calf$ that is not isomorphic to its dual: the invertible sheaf $\calo(1)$ on $\proj^n$.)
\end{exr}
\begin{proof}[Sol.]
The first question is to describe the transition function of the dual sheaf. Consider the following diagram
$$
\tiny
\begin{tikzcd}
 &  & \calo(U_i)^n \arrow[rrd, red] &  &  &  \\
\cale(U_i) \arrow[rru,red] \arrow[rrd,red] &  &  & (\calo^{n}|_{U_i})^{\vee} \arrow[rrd,blue] & \calo(U_i\cap U_j)^n \arrow[dd,red] &  \\
 & \cale^\vee(U_i) \arrow[rru,blue] \arrow[rrd,blue] & \cale(U_i\cap U_j) \arrow[rru,red] \arrow[rrd,red] &  &  & (\calo^n|_{U_i\cap U_j})^\vee \arrow[dd,blue] \\
\cale(U_j) \arrow[rru,red] \arrow[rrd,red] &  &  & \cale^\vee({U_j\cap U_j}) \arrow[rrd,blue] \arrow[rru,blue] & \calo(U_i\cap U_j)^n &  \\
 & \cale^\vee(U_j) \arrow[rru,blue] \arrow[rrd,blue] & \calo(U_j)^n \arrow[rru,red] &  &  & (\calo^n|_{U_i\cap U_j})^\vee \\
 &  &  & (\calo^n|_{U_j})^\vee \arrow[rru,blue] &  & 
\end{tikzcd}
$$
The locally free sheaf $\cale$ is defined by via an ``atlas'' $\{(U_i,\phi_i)_{i\in I}\}$, where $\phi_i:\cale|_{U_i}\cong \calo_X^{n}|_{U_i}$. 

If $U_i,\phi_i$ are already given, $\cale^\vee$ is built from the same open cover, but 
$$
\begin{aligned}
\phi_i^{\vee}:&\cale^\vee|_{U_i}\overset{\cong}{\lrta}\calo_{U_i}^n\\
\phi_i^{\vee}(U_i):&\hom(\cale|_{U_i},\calo_{U_i})\overset{\cong}{\lrta}\calo_{U_i}^n
\end{aligned}
$$
where
$$
\begin{aligned}
\hom(\cale|_{U_i},\calo_{U_i})&\cong \hom(\calo^n_{U_i},\calo_{U_i})\\
f\mapsto  f\circ \phi_i^{-1}
\end{aligned}
$$
therefore the canonical choice of $\phi_i^\vee(U_i)$ should be
$$
f\mapsto f\circ \phi_i^{-1}\mapsto (\iota_1\circ f\circ \phi_i^{-1}(e_1),...,\iota_n\circ f\circ \phi_i^{-1}(e_n))^{T}
$$
where we superessed all the possible choice of open subsets $V\subset U_i$ and notions like $f(V), \phi_i(V)$ and so on.
Similarly the inverse $\phi_i^\vee(U_i)^{-1}$ could be expressed as
$$
\calo_{U_i}^n\ni\alpha\mapsto \alpha\cdot\_\mapsto [\alpha\cdot\_]\circ \phi_i
$$


In this way
$$
\begin{aligned}
T^{\vee}_{ij}(\beta)&:= \phi_j^\vee(U_i\cap U_j)\circ \phi_i^\vee(U_i\cap U_j)^{-1}(\beta)\\
&=[g\_\mapsto (\iota_1\circ g\_\circ \phi_j^{-1}(U_i\cap U_j)(e_1),...,\iota_n\circ g\_\circ \phi_j^{-1}(U_i\cap U_j)(e_n))^{T}]\circ [\alpha\_\mapsto [\alpha\_\cdot\_]\circ \phi_i(U_i\cap U_j)](\beta)\\
&=[\alpha\_\mapsto (\alpha\_^{T}\circ \phi_i(U_i\cap U_j)\circ\phi_j^{-1}(U_i\cap U_j))^{T}](\beta) \\
&=(\phi_i(U_i\cap U_j)\circ\phi_j^{-1}(U_i\cap U_j))^T\beta\\
&=T_{ji}^{T}\beta
\end{aligned}
$$
Hence, $T_{ij}^\vee=T_{ji}^{T}=(T_{ij}^{-1})^{T}=T_{ij}^*$. 


The second question requires us to prove the canonical isomorphism $\cale\cong\cale^{\vee\vee}$.

This can be directly checked by the transition function argument $T_{ij}^{**}=T_{ij}$ and the fact that transition function determines the locally free sheaf.

Or we can directly construct the sheaf isomorphism $\varphi$, each $\varphi(U_i)$ is defined as follows, for all $v\in \cale(U_i)$
$$
v\longmapsto v^{\vee\vee}:=[\forall u^\vee\in \cale(U_i)^\vee, u^\vee\longmapsto u^\vee(v)].
$$
When they are free module of rank $n$, the map $v\mapsto v^{\vee\vee}$ is an isomorphism. This map is injective: Let $e_i^\vee$ be the dual basis of $M^\vee$. If $v\in \cale(U_i)$ and $v\neq 0$, the $v$ has a non-zero coordinate with respect to $e_i^{\vee}(v)\neq 0$ for some $i$, which means $v^\{\vee\vee\}(e_i^\vee)\neq 0$.

It is surjective. pick an $f\in \cale^{\vee\vee}(U_i)$ we want to find a $v\in \cale(U_i)$ s.t. $f(u^*)=u^*(v)$ for all $u^*\in \cale^\vee(U_i)$. We can set $u^*=e_i^\vee$ for all $i$ to get a collection of $\calo_X(U_i)$-linear equations. Let $a_i=f(e_i^\vee)\in \calo_X(U_i)$ and define $v=\sum^n_{i=1}a_i e_i\in M$. Then $f(e_i^\vee)=a_i=e_i^\vee(v)$ therefore $f=v^{\vee\vee}$.

And the compatibility with restriction and cocycle relation is just routine.
\end{proof}

\begin{exr}\label{chap13exr:tensor_product_of_invertible_sheaves}
If $\calf$ and $\calg$ are locally free sheaves, show that $\calf\otimes \calg$ is a locally free sheaf.  If $\calf$ is an invertible sheaf, show that $\calf\otimes \calf^\vee\cong \calo_X$.
\end{exr}
\begin{proof}[Sol.]
Note the the tensor of sheaves over abelian category requires sheafification. We can try proving this at the level of stalks. Recall Exercise 2.6.J that taking stalks commutes with tensoring, we have
$$
\calf_{x}\otimes\call_{x}\cong (\calf\otimes \calg)_{x},
$$
$$
\calf_{U,x}\cong\calo_{U,x}^n,
$$
and
$$
\calg_{U,x}\cong \calo_{U,x}^m,
$$
which altogether means 
$$
(\calf\otimes \calg)_{U,x}\cong \calo_{U,x}^n\otimes \calo_{U,x}^m\cong \calo_{U,x}^{mn}.
$$
This in turn means
$$
(\calf\otimes \calg)|_U\cong \calo_{U}^{mn} .
$$
If $\calf$ is a locally free sheaf of rank $1$, still we only need to check first that

\textbf{If $\call_1,\call_2$ are invertible so is their tensor product.} 

If $\call_1|_U\simeq \calo_X|_U$ and $\call_2|_U\simeq \calo_X|_U$,  
$$
(\call_1\otimes\call_2)|_U\simeq \calo_X|_U\otimes\calo_X|_U\simeq \calo_X|_U,
$$ where the LHS is sheaf associated to presheaf, (given $V\subset U$) $V\longmapsto\call_1(V)\otimes\call_2(V)$ and the $\calo_X(V)\otimes \calo_X(V)\simeq \calo_X(V)$. As a presheaf it is isomorphic to the sheaf $\calo_{X}(V)$. So the LHS is the sheaf $V\longmapsto \calo_X(V)$ and $\call_1|_U\otimes \call_2|_U\simeq \calo|_U$ and therefore $\call_1\otimes \call_2$ is invertible.

To prove $\call\otimes \call^\vee\cong \calo_X$, recall that in general the stalk of sheaf-hom is not the hom of stalks (Though in some coherent case this is true, but we don't want to use this result. See \href{https://mathoverflow.net/questions/642/stalks-of-sheaf-hom}{StackExchange} for a review).

Instead,
\underline{Claim}: For any $U\subset X$, we have an isomorphism of modules, $\call^\vee(U)\cong \hom_{\calo_X(U)}(\call(U),\calo_X(U))$ as $\calo_X(U)$-modules.
where 
$$
\begin{aligned}
\call^\vee(U):=\hom_{\calo_X|_U-mod}(\call|_U,\calo_X|_U)&\lrta \hom_{\calo_X(U)-mod}(\call(U),\calo_X(U))\\
\lambda&\longmapsto \lambda(U).
\end{aligned}
$$
We can construct the inverse by mapping $\phi\in \hom_{\calo_X(U)-mod}(\call(U),\calo_X(U))$ to $\res_{U,V}(\phi)$ and identify all the data $\res_{U,V}(\phi)$ as $\lambda(V)$ of a morphism of sheaves $\lambda$.

 If we further require $U$ is contained in some open set $V$, where $\call|_V\cong \calo_X|_V$
 $$
 \begin{aligned}
 (\call\odot \call^\vee)(U)&\cong \call(U)\otimes\call^{\vee}(U)\cong \call(U)\otimes\hom_{\calo_X(U)-mod}(\call(U),\calo_X(U))\overset{(*)}{\lrta}\calo_X(U)\\
  (s,\lambda)& \longmapsto (\lambda(U))(s),
 \end{aligned}
 $$
 The last isomorphism $(*)$ is due to fact $\call(U)\otimes_{\calo(U)}(\call(U))^\vee\cong End_{\calo_X(U)}(\call(U))=\calo_X(U)$ because $\call(U)\cong \calo_X(U).$  

 The above construction gives an isomorphism of presheaves on $U$. After sheafification, we get an morphism of sheaves on $U$, which induces isomorphism on stalks.

 In the end, we have a collection of isomorphism on a base $\{U_i\}$ of topology. If or choice of base refines the defining chart of locally free sheaves $\call$, we can check the isomorphisms on base are compatible on intersections and we can glue it to an isomorphism of sheaves on $X$.
\end{proof}

\begin{exr}
Recall that the tensor products tend to be only right-exact in general. Show that tensoring by a locally free sheaf is exact. More precisely, if $\calf$ is a locally free sheaf, and $\calg'\lrta \calg\lrta \calg''$ is an exact sequence of $\calo_X$-module, then so is $\calg'\otimes \calf\lrta \calg\otimes \calf\lrta\calg''\otimes \calf$.
\end{exr}
\begin{proof}[Sol.]
This theorem should intrinsically depends on the fact the free modules are flat. (in general projective module is flat).

The exactness of sequence of sheaves should be checked at the level of stalks. Given $\calg'\lrta\calg\lrta \calg''$ to be an exact sequence of $\calo_X$-modules and let $\calf$ be a locally free sheaf. Then for any $x\in X$, we have $\calf|_U\cong \calo_U^{I}$, for any open neighborhood of $x$, which would imply $\calf_x\cong \calo_x^{I}$. Hence, we have
$$
(\calg\otimes\calf)_x\cong \calg_x\otimes_{\calo_x}\calf_x.
$$
Also recall that the sequence 
$$
\calg_x'\lrta\calg_x\lrta\calg''_x
$$
is an exact sequence of $\calo_{X,x}$-modules. As we have shown, $\calf_x$ is a free $\calo_{X,x}$-module, tensoring with it would still give an exact sequence of $\calo_{X,x}$-module due to the commutative algebra facts.

The propose the sequence is exact at the level of stalks therefore is an exact sequence of sheaves.
\end{proof}
\begin{exr}
If $\cale$ is a locally free sheaf of finite rank, and $\calf$ and $\calg$ are $\calo_X$-modules, show that $\phom(\calf,\calg\otimes\cale)\cong \phom(\calf\otimes \cale^\vee,\calg)$.
\end{exr}
\begin{proof}[Sol.]
First, we consider the case where $\cale$ if a free sheaf of finite rank i.e. $\cale\cong \calo_X^n$, and check that in this way $\cale^\vee\cong\phom(\calo_X^n,\calo_X)$. We want to prove
$$
\phom(\calf,\calg\otimes\calo_X^n)\cong \phom(\calf\otimes \phom(\calo_X^n,\calo_X),\calg)
$$

Note that functors $\phom$ and $\otimes$ are additive, we can reduce the problem to the case $n=1$.
$$
\Lrta \phom(\calf,\oplus^n(\calg\otimes\calo_X))\overset{?}{\cong}\phom(\calf\otimes \oplus^n\phom(\calo_X,\calo_X),\calg)
$$
$$
\Lrta \bigoplus^n\phom(\calf,(\calg\otimes\calo_X))\overset{?}{\cong}\bigoplus^n\phom(\calf\otimes \phom(\calo_X,\calo_X),\calg)
$$

\underline{Claim}: 
$$
\phom(\calf,\calg\otimes\calo_X)\cong\phom(\calf\otimes \calo_X^\vee,\calg)
$$

This isomorphism is an obvious fact due to the adjointness of tensor and hom functors.

\underline{Subclaim}: 
$$
\calf\otimes\calo_X^\vee\cong \phom(\calo_X,\calf)
$$
 We first deal with the subclaim. We have shown that $\calo_X^\vee\cong\calo_X$ in Exercise~\ref{chap13exr:dual_and_double_dual_of_locally_free sheaves} and have verified $\phom(\calo_X,\calf)\cong\calf$ in $(c)$ of Exercise~\ref{chap2exr:OX-moduel-hom_from_special_Ox-modules}. Combining this two, we have the isomorphism $\calf\otimes\calo_X^\vee\cong\calf\cong\phom(\calo_X,\calf)$.

Then the claim can be re-expressed as
$$
\phom(\calf,\calg\otimes\calo_X)\cong\phom(\phom(\calo_X,\calf),\calg).
$$
This has noting to do with the proof of the claim, but we want give a relation similar but \textbf{not identical} to the adjointness of $\otimes \cale$ and $\phom(\cale,\cdot)$, see~\href{http://stacks.math.columbia.edu/tag/01CN}{Tag 01CN} of StackProject. 

The claim it self can be checked similarly to the subclaim:
$$
\phom(\calf,\calg\otimes\calo_X)\cong\phom(\calf,\calg)\cong\phom(\calf\otimes \calo_X^\vee,\calg).
$$
We have finished the proof in the case where $\cale$ is free. It is easy to generalize to the case of locally free sheaves.

For each point $x\in X$, there is an open neighborhood  $U\ni x$ such that 
$$
\cale|_U\cong \calo_U^n
$$
and we can check that
$$
\begin{aligned}
&\phom(\calf,\calg\otimes\cale)(U)\\
&=\mor_{\calo_U-Mod}(\calf|_U,(\calg\otimes_{\calo_X}\cale)|_U)\\
&=\mor_{\calo_U-Mod}(\calf|_U,\calg|_U\otimes_{\calo_U}\cale|_U)\\
&\cong \mor_{\calo_U-Mod}(\calf|_U,\calg|_U\otimes_{\calo_U}\calo_U^n)\\
&\cong \mor_{\calo_U-Mod}(\calf|_U\otimes\phom(\calo_U^n,\calo_U),\calg|_U)\\
\end{aligned}
$$
the last isomorphism is due to the free sheaf case we have proved above. 
Furthermore, we have
$$
\begin{aligned}
&\mor_{\calo_U-Mod}(\calf|_U\otimes\phom(\calo_U^n,\calo_U),\calg|_U)\\
&\cong \mor_{\calo_U-Mod}(\calf|_U\otimes\phom(\cale,\calo_X)|_U,\calg|_U)\\
&=\phom(\calf\otimes\phom(\cale,\calo_X),\calg)(U)
\end{aligned}
$$
and thus
$$
\phi(U):\phom(\calf,\calg\otimes\cale)(U)\cong\phom(\calf\otimes\cale^\vee,\calg)(U).
$$
The strategy of proving isomorphism of sheaves is always to firstly construct a morphism and check that it induces isomorphism on all stalks. What we have proved up to now means only the stalks are isomorphic. We have to prove that the isomorphisms of stalks are induced by a morphism of sheaves. (to check $\phi(U)$ is compatible with the restriction maps and hence renders a morphism of sheaves.) Explicitly, by~\href{http://stacks.math.columbia.edu/tag/01CN}{Tag 01CN} of StackProject, we only need to find an open cover of $X=\cup U_i$ and a collection of morphism of sheaves:
$$
\phi_i:\phom(\calf,\calg\otimes\cale)|_{U_i}\lrta \phom(\calf\otimes\cale^\vee,\calg)|_{U_i}.
$$
such that they are compatible on the intersections:
$$
\phi_i|_{U_i\cap U_j}=\phi_j|_{U_i\cap U_j}.
$$
If we choose the open cover refining the defining open cover of the locally free sheaf $\cale$, the compatibility condition is automatically satisfied.
\end{proof}

\begin{exr}
Show that the invertible sheaves on $X$ up to isomorphism form an abelian group under product. This is called the \textbf{Picard group} of $X$, and is denoted $\pic X$. 
\end{exr}
\begin{proof}[Sol.]
We only need to check 
\begin{enumerate}[label=(\alph*)]
\item $\call_1$ and $\call_2$ invertible sheaves $\Lrta \call_1\otimes\call_2$ is invertible.
\item $\call_1\otimes\calo_X\cong \call_1$
\item $\call_1\otimes\call_1^\vee\cong \calo_X$
\item $\call_1\otimes \call_2\cong\call_2\otimes\call_1$
\end{enumerate}
$(a)$: If $\call_1|_U\cong \calo_X|_U$ and $\call_2|_U\cong\calo_X|_U$, we want 
$$
(\call_1\otimes\call_2)|_U \cong \calo_X|_U.
$$
To avoid confusion, we use $\calf\odot\calg$ to denote the presheaf generated by $[V\longmapsto \calf(V)\otimes\calg(V)]$. In this way $\call_1\otimes\call_2=(\call_1\odot\call_2)^{sh}$.

Then we can check that as presheaves $(\call_1\odot\call_2)|_U\cong \calo_X|_U\odot \calo_X|_U\cong (\calo_X|_U)_{pre}$. Then the sheafification functor would send this isomorphism of presheaves to an isomorphism of sheaves
$$
(\call_1\otimes\call_2)|_U=((\call_1\odot\call_2)|_U)^{sh}\cong ((\calo_X|_U)_{pre})^{sh}\cong \calo_X|_U.
$$
$(b)$ For any $U\subset X$,
 $$
 \begin{aligned}
 \call(U)\otimes\calo_X(U)&\overset{\simeq}{\lrta}\call(U)\\
 (s,a)&\longmapsto as
 \end{aligned}
 $$
 this induces an isomorphism of presheaves
 $$
 \call\odot \calo_X\lrta \call_{pre}.
 $$
 This induces a morphism of sheaves after sheafification. At the level of stalks,  it induces an isomorphism
 $$
\call_x\otimes_{\calo_{X,x}}\calo_{X,x}\lrta\call_x.
 $$
 $(c)$ is already proved in~\ref{chap13exr:tensor_product_of_invertible_sheaves}.\\
$(d)$ We can check the isomorphism of the two presheaves, 
 $$
\call_1\odot \call_2 \cong \call_2\odot \call_1,
 $$
 where for any open  set $U\subset X$,
 $$
 (\call_1\odot \call_2) (U):=\call_1(U)\otimes\call_2(U) \cong \call_2(U)\otimes\call_1(U)=:  \call_2\odot \call_1(U).
 $$
We get the desired isomorphism of sheaves after sheafification.

\end{proof}
\begin{exr}
If $\pi:X\lrta Y$ is a morphism of ringed spaces, and $\calg$ is a locally free sheaf of rank $n$ on $Y$, figure out how to define a ``pull back'' locally free sheaf of rank $n$ on X, denoted $\pi^*\calg$. Then show that $\pic$ is a contravariant functor from the category of ringed spaces to the category $\mathsf{Ab}$ of abelian groups.
\end{exr}
\begin{proof}[Sol.]
In standard references, the pullback of quasi-coherent sheaf on ringed space is defined to be
$$
\pi^{-1}\calg\otimes_{\pi^{-1}\calo_Y}\calo_X.
$$
We first consider the simplest case where $\calg$ is chosen to be $\calo_Y$. Is $\pi^*\calo_Y$ a well defined locally free sheaf? In fact, we expect
$$
\pi^*\calo_Y\cong \calo_X.
$$

Recall the inverse image sheaf $\pi^{-1}\calo_Y$ on $X$
$$
\pi^{-1}_{pre}\calg (U):= \colim_{V\supset \pi(U)}\calg(V)
$$
and $\pi^{-1}\calg:=(\pi^{-1}_{pre}\calg)^{sh}$.

\underline{Warning}: We can not use directly the definition of inverse image sheaf, which is in general not an $\calo_X$-module.

\underline{Fact1}: $\calo_X$ is a $\pi^{-1}\calo_Y$-module.
Given the morphism of ringed spaces $\pi=(\pi,\pi^\#)$, where $\pi^\#:\calo_Y\lrta \pi_*\calo_X$. If we apply the inverse image functor on it, we get a morphism of sheaves
$$
\pi^{-1}\calo_Y\overset{\pi^{-1}(\pi^\#)}{\lrta}\pi^{-1}\pi_{*}\calo_X
$$
By the adjoint relation between $\pi^{-1}$ and $\pi_*$ (c.f.~\ref{chap2exr:adjoint_inverse_image_direct_image}, we have a morphism
$$
\pi^{-1}\pi_{*}\calo_X\lrta\calo_X.
$$
Composite the above two morphisms of sheaves together, we get a morphism
$$
\pi^{-1}\calo_Y\lrta\calo_X.
$$
It is  a morphism of sheaves of rings, we know $\calo_X$ can be regarded as a $\pi^{-1}\calo_Y$-module. 

On the other hand, for each point $y\in Y$, there is an open set $V\subset Y$ s.t. $\calg|_V\cong(\calo_Y|_V)^n$. Functors map isomorphisms to isomorphisms. We have
$$
(\pi^{-1}\calg)|_{\pi^{-1}(V)}\cong \left((\pi^{-1}\calo_Y)|_{\pi^{-1}(V)}\right)^n.
$$
Then, because of the algebraic fact
$$
B^n\otimes_B A\cong A^n
$$
where $A$ is a $B$-algebra.
We can establish an isomorphism of presheaves, for $U\subset \pi^{-1}V$,
$$
(\pi^{-1}\calg\odot_{\pi^{-1}\calo_Y}\calo_X)|_U\lrta (\calo_X|_U)^n.
$$

We need to check $\pi^*$ is compatible with isomorphism class of invertible sheaves.
If $\calg'\cong\calg$ are isomorphic sheaves on, we can check $\pi^*\calg'\cong\pi^*\calg$, which is guaranteed by the functorial property of $\pi^*$.
$$
\begin{tikzcd}
X \ar[r, "\pi"] \ar[d, "\pic"] & Y \arrow[d, "\pic"] \\
\text{Pic}\ X & \text{Pic}\ Y \arrow[l, "\pi^*"]
\end{tikzcd}
$$
\end{proof}
\begin{exr}
Suppose $s$ is a section of locally free sheaf $\calf$ on a scheme $X$. Define the notion of the subscheme cut out by $s=0$, denoted $V(s)$. Be sure to check that your definition is independent of choices.
\end{exr}
\begin{proof}[Sol.]
We have defined in Exercise~8.1.I what it means by a vanishing subscheme cut out be a global section in $\Gamma(X,\calo_X)$. In order to generalize this to the locally free sheaves, we don't have to use the affine chart, but only use the ``defining free chart'' of the locally free sheaf $\calf$. Take an open set  $U\subset X$ s.t. $\calf|_U\cong \calo_X^n|_U$. On $U$, $s$ can be expressed as a tuple of functions $s^i\in \Gamma(U,\calo_X|_U)$, we can then locally define $V_U(s):=\cap_i V_U(s^i) $ or the fibered product $V_U(s^1)\times_{U} V_U(s^2)\times_{U}\cdots\times_U V_U(s^n)$, where each $V_U(s^i)$ is already defined in Exercise~8.1.I. $V(s)$ is to be defined by gluing up $V_U(s)$. It is dependent of the choice of $U$, because for two intersecting free charts $x\in U_i\cap U_j$, $T_{ij}(x)s_i(x)=s_j(x)$, $s_i(x)=0\Llrta s_j(0)$, because $T_{ij}(x)\in GL(\calo_{X}(U_i\cap U_j)^n)$.

This proof works for locally free sheaves of finite rank. For infinite rank case, we can not argue as $GL(\calo_{X}(U_i\cap U_j)^\infty)$, but just remember $T_{ij}$ is still an isomorphism.

The coordinate-free proof is \textbf{TO BE ADDED}.
\end{proof}
\begin{exr}
Show that locally free sheaves on locally Noetherian normal schemes satisfy ``Hartog's Lemma''. sections defined away from a set of codimension at least 2 extends over that set. 
\end{exr}

\begin{exr}
Suppose $s$ is a nonzero rational section of an invertible sheaf on a locally Noetherian normal scheme. Show that if $s$ has no poles, then $s$ is regular.
\end{exr}
\begin{exr}
Omitted.
\end{exr}
\begin{exr}
Omitted.
\end{exr}

\section{Quasicoherent sheaves}
Given an $A$-module $M$, we define an $\calo_{\spec A}$-module $\tilde{M}$ on $\spec A$, where the sections over $D(f)$ were $M_f$.
\begin{definition}
If $X$ is a scheme, then an $\calo_X$-module $\calf$ is \textbf{quasicoherent} if for every affine open subset $\spec A\subset X$, $\calf|_{\spec A}\cong\tilde{M}$ for some $A$-module $M$. By theorem 13.2.1 It suffices to check on an affine open cover of $X$ due to Affine communication lemma.
\end{definition}
\begin{exr}
(NOT every $\calo_X$-module is quasicoherent)
\begin{enumerate}[label=(\alph*)]
\item Suppose $X=\spec k[t]$. Let $\calf$ be the skyscrper sheaf supported at the origin $[(t)]$, with group $k(t)$ and the usual $k[t]$-module structure. Show that this is an $\calo_X$-module  but not quasicoherent sheaf.
\item Suppose $X=\spec k[t]$. Let $\calf$ be the skyscraper sheaf supported at the generic point $[(0)]$, with group $k(t)$. Given this the structure of an $\calo_X$-module. Show that this is a quasicoherent sheaf. describe the restriction maps in the distinguished topology of $X$
\end{enumerate}
\end{exr}
\begin{proof}[Sol.]
\begin{enumerate}[label=(\alph*)]
\item 
\end{enumerate}
\end{proof}
\chapter{Line bundles: Invertible sheaves and divisors}
\chapter{Quasicoherent sheaves and projective $A$-schemes}
\chapter{Pushforwards and pullbacks of quasicoherent sheaves}
\section{Introduction}
\section{Pushforward of quasicoherent sheaves}
\section{Pullbacks of quasicoherent sheaves}
\section{Line bundles and maps to projective spaces}
\section{The Curve-to-Projective Extension Theorem
}
\section{Ample and very ample line bundles}
\section{The Grassmannian as a moduli space}
\part{More}

%----------------------------------------------------------------------------------------
%	BIBLIOGRAPHY
%----------------------------------------------------------------------------------------

\chapter*{Bibliography}
\addcontentsline{toc}{chapter}{\textcolor{ocre}{Bibliography}}

%------------------------------------------------

\section*{Articles}
\addcontentsline{toc}{section}{Articles}
\printbibliography[heading=bibempty,type=article]

%------------------------------------------------

\section*{Books}
\addcontentsline{toc}{section}{Books}
\printbibliography[heading=bibempty,type=book]

%----------------------------------------------------------------------------------------
%	INDEX
%----------------------------------------------------------------------------------------

\cleardoublepage
\phantomsection
\setlength{\columnsep}{0.75cm}
\addcontentsline{toc}{chapter}{\textcolor{ocre}{Index}}
\printindex

%----------------------------------------------------------------------------------------

\end{document}
